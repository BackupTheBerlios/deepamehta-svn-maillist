<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [deepamehta-svn] r230 - in branches/eschnepel: . .settings	develop/src/de/deepamehta develop/src/de/deepamehta/service	develop/src/de/deepamehta/service/web	develop/src/de/deepamehta/topics	develop/src/de/deepamehta/topics/helper	install/db/db-specific install/examples/artfacts	install/examples/artfacts/src/de/deepamehta/artfacts/topics	install/examples/dm-browser/config install/examples/dm-search	install/examples/dm-search/config install/examples/dm-topicmapviewer	install/examples/dm-topicmapviewer/config	install/examples/dm-web/config install/examples/kompetenzstern	install/examples/kompetenzstern/config	install/examples/kompetenzstern/pages	install/examples/ldap/src/de/deepamehta/topics	install/examples/movies install/examples/movies/bin	install/examples/movies/db	install/examples/movies/src/de/deepamehta/movies/topics
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/deepamehta-svn/2007-October/index.html" >
   <LINK REL="made" HREF="mailto:deepamehta-svn%40lists.berlios.de?Subject=Re%3A%20%5Bdeepamehta-svn%5D%20r230%20-%20in%20branches/eschnepel%3A%20.%20.settings%0A%09develop/src/de/deepamehta%20develop/src/de/deepamehta/service%0A%09develop/src/de/deepamehta/service/web%0A%09develop/src/de/deepamehta/topics%0A%09develop/src/de/deepamehta/topics/helper%0A%09install/db/db-specific%20install/examples/artfacts%0A%09install/examples/artfacts/src/de/deepamehta/artfacts/topics%0A%09install/examples/dm-browser/config%20install/examples/dm-search%0A%09install/examples/dm-search/config%20install/examples/dm-topicmapviewer%0A%09install/examples/dm-topicmapviewer/config%0A%09install/examples/dm-web/config%20install/examples/kompetenzstern%0A%09install/examples/kompetenzstern/config%0A%09install/examples/kompetenzstern/pages%0A%09install/examples/ldap/src/de/deepamehta/topics%0A%09install/examples/movies%20install/examples/movies/bin%0A%09install/examples/movies/db%0A%09install/examples/movies/src/de/deepamehta/movies/topics&In-Reply-To=%3C200710031745.l93HjSIO031695%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000074.html">
   <LINK REL="Next"  HREF="000076.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[deepamehta-svn] r230 - in branches/eschnepel: . .settings	develop/src/de/deepamehta develop/src/de/deepamehta/service	develop/src/de/deepamehta/service/web	develop/src/de/deepamehta/topics	develop/src/de/deepamehta/topics/helper	install/db/db-specific install/examples/artfacts	install/examples/artfacts/src/de/deepamehta/artfacts/topics	install/examples/dm-browser/config install/examples/dm-search	install/examples/dm-search/config install/examples/dm-topicmapviewer	install/examples/dm-topicmapviewer/config	install/examples/dm-web/config install/examples/kompetenzstern	install/examples/kompetenzstern/config	install/examples/kompetenzstern/pages	install/examples/ldap/src/de/deepamehta/topics	install/examples/movies install/examples/movies/bin	install/examples/movies/db	install/examples/movies/src/de/deepamehta/movies/topics</H1>
    <B>eschnepel at BerliOS</B> 
    <A HREF="mailto:deepamehta-svn%40lists.berlios.de?Subject=Re%3A%20%5Bdeepamehta-svn%5D%20r230%20-%20in%20branches/eschnepel%3A%20.%20.settings%0A%09develop/src/de/deepamehta%20develop/src/de/deepamehta/service%0A%09develop/src/de/deepamehta/service/web%0A%09develop/src/de/deepamehta/topics%0A%09develop/src/de/deepamehta/topics/helper%0A%09install/db/db-specific%20install/examples/artfacts%0A%09install/examples/artfacts/src/de/deepamehta/artfacts/topics%0A%09install/examples/dm-browser/config%20install/examples/dm-search%0A%09install/examples/dm-search/config%20install/examples/dm-topicmapviewer%0A%09install/examples/dm-topicmapviewer/config%0A%09install/examples/dm-web/config%20install/examples/kompetenzstern%0A%09install/examples/kompetenzstern/config%0A%09install/examples/kompetenzstern/pages%0A%09install/examples/ldap/src/de/deepamehta/topics%0A%09install/examples/movies%20install/examples/movies/bin%0A%09install/examples/movies/db%0A%09install/examples/movies/src/de/deepamehta/movies/topics&In-Reply-To=%3C200710031745.l93HjSIO031695%40sheep.berlios.de%3E"
       TITLE="[deepamehta-svn] r230 - in branches/eschnepel: . .settings	develop/src/de/deepamehta develop/src/de/deepamehta/service	develop/src/de/deepamehta/service/web	develop/src/de/deepamehta/topics	develop/src/de/deepamehta/topics/helper	install/db/db-specific install/examples/artfacts	install/examples/artfacts/src/de/deepamehta/artfacts/topics	install/examples/dm-browser/config install/examples/dm-search	install/examples/dm-search/config install/examples/dm-topicmapviewer	install/examples/dm-topicmapviewer/config	install/examples/dm-web/config install/examples/kompetenzstern	install/examples/kompetenzstern/config	install/examples/kompetenzstern/pages	install/examples/ldap/src/de/deepamehta/topics	install/examples/movies install/examples/movies/bin	install/examples/movies/db	install/examples/movies/src/de/deepamehta/movies/topics">eschnepel at mail.berlios.de
       </A><BR>
    <I>Wed Oct  3 19:45:28 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000074.html">[deepamehta-svn] r229 - in branches/eschnepel:	develop/src/de/deepamehta develop/src/de/deepamehta/assocs	develop/src/de/deepamehta/service	develop/src/de/deepamehta/service/web	develop/src/de/deepamehta/topics	develop/src/de/deepamehta/util install/client/stylesheets	install/db/patches
</A></li>
        <LI>Next message: <A HREF="000076.html">[deepamehta-svn] r231 - in trunk: .	develop/src/de/deepamehta/service/web	develop/src/de/deepamehta/topics install/config
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#75">[ date ]</a>
              <a href="thread.html#75">[ thread ]</a>
              <a href="subject.html#75">[ subject ]</a>
              <a href="author.html#75">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: eschnepel
Date: 2007-10-03 19:45:23 +0200 (Wed, 03 Oct 2007)
New Revision: 230

Added:
   branches/eschnepel/.settings/org.eclipse.core.runtime.prefs
Modified:
   branches/eschnepel/develop/src/de/deepamehta/Relation.java
   branches/eschnepel/develop/src/de/deepamehta/service/ActiveDirectoryLogin.java
   branches/eschnepel/develop/src/de/deepamehta/service/CorporateLDAPSource.java
   branches/eschnepel/develop/src/de/deepamehta/service/CorporateXMLSource.java
   branches/eschnepel/develop/src/de/deepamehta/service/LoginCheck.java
   branches/eschnepel/develop/src/de/deepamehta/service/web/DisplayObject.java
   branches/eschnepel/develop/src/de/deepamehta/topics/AppointmentTopic.java
   branches/eschnepel/develop/src/de/deepamehta/topics/AuthentificationSourceTopic.java
   branches/eschnepel/develop/src/de/deepamehta/topics/DataConsumerTopic.java
   branches/eschnepel/develop/src/de/deepamehta/topics/DataSourceTopic.java
   branches/eschnepel/develop/src/de/deepamehta/topics/ElementContainerTopic.java
   branches/eschnepel/develop/src/de/deepamehta/topics/EmailTopic.java
   branches/eschnepel/develop/src/de/deepamehta/topics/InstallationTopic.java
   branches/eschnepel/develop/src/de/deepamehta/topics/LoginTopic.java
   branches/eschnepel/develop/src/de/deepamehta/topics/PropertyTopic.java
   branches/eschnepel/develop/src/de/deepamehta/topics/helper/EmailChecker.java
   branches/eschnepel/develop/src/de/deepamehta/topics/helper/WhoisRequest.java
   branches/eschnepel/install/db/db-specific/db_tables_oracle.sql
   branches/eschnepel/install/examples/artfacts/build.xml
   branches/eschnepel/install/examples/artfacts/src/de/deepamehta/artfacts/topics/ArtworkSearchTopic.java
   branches/eschnepel/install/examples/dm-browser/config/web.xml
   branches/eschnepel/install/examples/dm-search/build.xml
   branches/eschnepel/install/examples/dm-search/config/web.xml
   branches/eschnepel/install/examples/dm-topicmapviewer/build.xml
   branches/eschnepel/install/examples/dm-topicmapviewer/config/web.xml
   branches/eschnepel/install/examples/dm-web/config/web.xml
   branches/eschnepel/install/examples/kompetenzstern/build.xml
   branches/eschnepel/install/examples/kompetenzstern/businesscheck.sql
   branches/eschnepel/install/examples/kompetenzstern/config/web.xml
   branches/eschnepel/install/examples/kompetenzstern/pages/Home.jsp
   branches/eschnepel/install/examples/ldap/src/de/deepamehta/topics/LdapGroupContainerTopic.java
   branches/eschnepel/install/examples/ldap/src/de/deepamehta/topics/LdapGroupTopic.java
   branches/eschnepel/install/examples/ldap/src/de/deepamehta/topics/LdapUserContainerTopic.java
   branches/eschnepel/install/examples/ldap/src/de/deepamehta/topics/LdapUserTopic.java
   branches/eschnepel/install/examples/movies/bin/dmexamples_oracle.bat
   branches/eschnepel/install/examples/movies/bin/dmexamples_oracle.sql
   branches/eschnepel/install/examples/movies/db/db_inserts.sql
   branches/eschnepel/install/examples/movies/db/db_tables_derby.sql
   branches/eschnepel/install/examples/movies/db/db_tables_hsqldb.sql
   branches/eschnepel/install/examples/movies/db/db_tables_mysql.sql
   branches/eschnepel/install/examples/movies/db/db_tables_oracle.sql
   branches/eschnepel/install/examples/movies/db/dmdb-movies-oracle.sql
   branches/eschnepel/install/examples/movies/db/dmdb-movies-sql.xml
   branches/eschnepel/install/examples/movies/db/dmdb-movies-xml.sql
   branches/eschnepel/install/examples/movies/db/dmdb-movies.sql
   branches/eschnepel/install/examples/movies/movies.xml
   branches/eschnepel/install/examples/movies/src/de/deepamehta/movies/topics/ActorContainerTopic.java
   branches/eschnepel/install/examples/movies/src/de/deepamehta/movies/topics/ActorTopic.java
   branches/eschnepel/install/examples/movies/src/de/deepamehta/movies/topics/MovieContainerTopic.java
   branches/eschnepel/install/examples/movies/src/de/deepamehta/movies/topics/MovieTopic.java
   branches/eschnepel/run.bat
   branches/eschnepel/run.sh
Log:
dos2unix and mac2unix conversion
unix2dos conversions for .bat and .cmd files

Added: branches/eschnepel/.settings/org.eclipse.core.runtime.prefs
===================================================================
--- branches/eschnepel/.settings/org.eclipse.core.runtime.prefs	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/.settings/org.eclipse.core.runtime.prefs	2007-10-03 17:45:23 UTC (rev 230)
@@ -0,0 +1,3 @@
+#Wed Oct 03 16:46:51 CEST 2007
+eclipse.preferences.version=1
+line.separator=\n

Modified: branches/eschnepel/develop/src/de/deepamehta/Relation.java
===================================================================
--- branches/eschnepel/develop/src/de/deepamehta/Relation.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/develop/src/de/deepamehta/Relation.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1 +1,65 @@
-package de.deepamehta;import de.deepamehta.topics.TypeTopic;/** * A model for a &quot;Relation&quot; (an association of type &lt;code&gt;at-relation&lt;/code&gt;), as part of a type definition. * &lt;p&gt; * A &lt;CODE&gt;Relation&lt;/CODE&gt; object is part of a type definition. * &lt;P&gt; * &lt;HR&gt; * Last functional change: 28.2.2004 (2.0b3-pre1)&lt;BR&gt; * Last documentation update: 23.2.2004 (2.0b3-pre1)&lt;BR&gt; * J&ouml;rg Richter&lt;BR&gt; * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A> */public class Relation implements OrderedItem {	public String id;				// association ID	public String name;				// association name (&quot;Name&quot; property)	public String relTopicTypeID;	// type ID of the related topic type	public String cardinality;		// &quot;Cardinality&quot; property	public String assocTypeID;		// &quot;Association Type ID&quot; property	public String webInfo;			// &quot;Web Info&quot; property	public String webForm;			// &quot;Web Form&quot; property	public int ordNr;				// &quot;Ordinal Number&quot; property	// *******************	// *** Constructor ***	// *******************	/!
 **	 * References checked: 23.2.2003 (2.0b3-pre1)	 *	 * @see		TypeTopic#addRelations	 */	public Relation(String id, String name, String relTopicTypeID, String cardinality, String assocTypeID,														String webInfo, String webForm, int ordNr) {		this.id = id;		this.name = name;		this.relTopicTypeID = relTopicTypeID;		this.cardinality = cardinality;		this.assocTypeID = assocTypeID;		this.webInfo = webInfo;		this.webForm = webForm;		this.ordNr = ordNr;	}	// *************************************************************	// *** Implementation of Interface de.deepamehta.OrderedItem ***	// *************************************************************	public int getOrdinalNr() {		return ordNr;	}}
\ No newline at end of file
+package de.deepamehta;
+
+import de.deepamehta.topics.TypeTopic;
+
+
+
+/**
+ * A model for a &quot;Relation&quot; (an association of type &lt;code&gt;at-relation&lt;/code&gt;), as part of a type definition.
+ * &lt;p&gt;
+ * A &lt;CODE&gt;Relation&lt;/CODE&gt; object is part of a type definition.
+ * &lt;P&gt;
+ * &lt;HR&gt;
+ * Last functional change: 28.2.2004 (2.0b3-pre1)&lt;BR&gt;
+ * Last documentation update: 23.2.2004 (2.0b3-pre1)&lt;BR&gt;
+ * J&ouml;rg Richter&lt;BR&gt;
+ * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>
+ */
+public class Relation implements OrderedItem {
+
+	public String id;				// association ID
+	public String name;				// association name (&quot;Name&quot; property)
+	public String relTopicTypeID;	// type ID of the related topic type
+	public String cardinality;		// &quot;Cardinality&quot; property
+	public String assocTypeID;		// &quot;Association Type ID&quot; property
+	public String webInfo;			// &quot;Web Info&quot; property
+	public String webForm;			// &quot;Web Form&quot; property
+	public int ordNr;				// &quot;Ordinal Number&quot; property
+
+
+
+	// *******************
+	// *** Constructor ***
+	// *******************
+
+
+
+	/**
+	 * References checked: 23.2.2003 (2.0b3-pre1)
+	 *
+	 * @see		TypeTopic#addRelations
+	 */
+	public Relation(String id, String name, String relTopicTypeID, String cardinality, String assocTypeID,
+														String webInfo, String webForm, int ordNr) {
+		this.id = id;
+		this.name = name;
+		this.relTopicTypeID = relTopicTypeID;
+		this.cardinality = cardinality;
+		this.assocTypeID = assocTypeID;
+		this.webInfo = webInfo;
+		this.webForm = webForm;
+		this.ordNr = ordNr;
+	}
+
+
+
+	// *************************************************************
+	// *** Implementation of Interface de.deepamehta.OrderedItem ***
+	// *************************************************************
+
+
+
+	public int getOrdinalNr() {
+		return ordNr;
+	}
+}

Modified: branches/eschnepel/develop/src/de/deepamehta/service/ActiveDirectoryLogin.java
===================================================================
--- branches/eschnepel/develop/src/de/deepamehta/service/ActiveDirectoryLogin.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/develop/src/de/deepamehta/service/ActiveDirectoryLogin.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,71 +1,71 @@
-package de.deepamehta.service;
-
-import de.deepamehta.topics.LiveTopic;
-
-import java.util.Hashtable;
-
-import javax.naming.Context;
-import javax.naming.NamingException;
-import javax.naming.directory.DirContext;
-import javax.naming.directory.InitialDirContext;
-
-
-
-/**
- * Implementation of LoginCheck for WebBuilder systems.
- * The LiveTopic representing this LoginCheck must have the following properties:
- * &lt;ul&gt;
- * &lt;li&gt; &lt;b&gt;URL:&lt;/b&gt;         A valid LDAP URL specifying host and port, e.g. &quot;<A HREF="ldap://192.168.251.145:389">ldap://192.168.251.145:389</A>&quot;
- * &lt;li&gt; &lt;b&gt;Domain Name:&lt;/b&gt; The name of the domain configured in the ActiveDirectory, e.g. &quot;staps2000.local&quot;
- * &lt;/ul&gt;
- */
-public class ActiveDirectoryLogin implements LoginCheck {
-
-	/**
-	 * The LiveTopic representing this LoginCheck.
-	 * Further property queries will be directed to this topic.
-	 */
-	LiveTopic topic;
-	
-	/**
-	 * Just stores the reference to the LiveTopic
-	 * representing this LoginCheck.
-	 */
-	public ActiveDirectoryLogin(LiveTopic topic) {
-		this.topic = topic;
-	}
-	
-	/**
-	 * Implementation of LoginCheck.
-	 * Note that empty passwords are not accepted
-	 * since they provide an anonymous login
-	 * to the ActiveDirectory.
-	 */
-	public boolean loginCheck(String username, String password) {
-		String url = topic.getProperty(&quot;URL&quot;);
-		String domain = topic.getProperty(&quot;Domain Name&quot;);
-		if (password != null &amp;&amp; password.length() &gt; 0) {
-			try {
-				return null != createInitialContext(url, username + &quot;@&quot; + domain,
-					password);
-			} catch(NamingException e) {
-			}
-		}
-		return false;
-	}
-	
-	/**
-	 *  Creates an initial DirContext.
-	 */
-	private DirContext createInitialContext(String url, String login, String password)
-	throws NamingException
-	{
-		Hashtable env = new Hashtable();
-		env.put(Context.INITIAL_CONTEXT_FACTORY, &quot;com.sun.jndi.ldap.LdapCtxFactory&quot;);
-		env.put(Context.PROVIDER_URL, url);
-		env.put(Context.SECURITY_PRINCIPAL, login);
-		env.put(Context.SECURITY_CREDENTIALS, password);
-		env.put(Context.SECURITY_AUTHENTICATION, &quot;simple&quot;);
-		return new InitialDirContext(env);
-	}
+package de.deepamehta.service;
+
+import de.deepamehta.topics.LiveTopic;
+
+import java.util.Hashtable;
+
+import javax.naming.Context;
+import javax.naming.NamingException;
+import javax.naming.directory.DirContext;
+import javax.naming.directory.InitialDirContext;
+
+
+
+/**
+ * Implementation of LoginCheck for WebBuilder systems.
+ * The LiveTopic representing this LoginCheck must have the following properties:
+ * &lt;ul&gt;
+ * &lt;li&gt; &lt;b&gt;URL:&lt;/b&gt;         A valid LDAP URL specifying host and port, e.g. &quot;<A HREF="ldap://192.168.251.145:389">ldap://192.168.251.145:389</A>&quot;
+ * &lt;li&gt; &lt;b&gt;Domain Name:&lt;/b&gt; The name of the domain configured in the ActiveDirectory, e.g. &quot;staps2000.local&quot;
+ * &lt;/ul&gt;
+ */
+public class ActiveDirectoryLogin implements LoginCheck {
+
+	/**
+	 * The LiveTopic representing this LoginCheck.
+	 * Further property queries will be directed to this topic.
+	 */
+	LiveTopic topic;
+	
+	/**
+	 * Just stores the reference to the LiveTopic
+	 * representing this LoginCheck.
+	 */
+	public ActiveDirectoryLogin(LiveTopic topic) {
+		this.topic = topic;
+	}
+	
+	/**
+	 * Implementation of LoginCheck.
+	 * Note that empty passwords are not accepted
+	 * since they provide an anonymous login
+	 * to the ActiveDirectory.
+	 */
+	public boolean loginCheck(String username, String password) {
+		String url = topic.getProperty(&quot;URL&quot;);
+		String domain = topic.getProperty(&quot;Domain Name&quot;);
+		if (password != null &amp;&amp; password.length() &gt; 0) {
+			try {
+				return null != createInitialContext(url, username + &quot;@&quot; + domain,
+					password);
+			} catch(NamingException e) {
+			}
+		}
+		return false;
+	}
+	
+	/**
+	 *  Creates an initial DirContext.
+	 */
+	private DirContext createInitialContext(String url, String login, String password)
+	throws NamingException
+	{
+		Hashtable env = new Hashtable();
+		env.put(Context.INITIAL_CONTEXT_FACTORY, &quot;com.sun.jndi.ldap.LdapCtxFactory&quot;);
+		env.put(Context.PROVIDER_URL, url);
+		env.put(Context.SECURITY_PRINCIPAL, login);
+		env.put(Context.SECURITY_CREDENTIALS, password);
+		env.put(Context.SECURITY_AUTHENTICATION, &quot;simple&quot;);
+		return new InitialDirContext(env);
+	}
 }
\ No newline at end of file

Modified: branches/eschnepel/develop/src/de/deepamehta/service/CorporateLDAPSource.java
===================================================================
--- branches/eschnepel/develop/src/de/deepamehta/service/CorporateLDAPSource.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/develop/src/de/deepamehta/service/CorporateLDAPSource.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,447 +1,447 @@
-package de.deepamehta.service;
-
-import de.deepamehta.DeepaMehtaConstants;
-import de.deepamehta.DeepaMehtaException;
-
-import java.util.Enumeration;
-import java.util.Hashtable;
-import java.util.StringTokenizer;
-import java.util.Vector;
-
-import javax.naming.Context;
-import javax.naming.NameClassPair;
-import javax.naming.NamingException;
-import javax.naming.directory.Attribute;
-import javax.naming.directory.Attributes;
-import javax.naming.directory.DirContext;
-import javax.naming.directory.InitialDirContext;
-import javax.naming.directory.SearchControls;
-
-
-
-/** 
- * An Implementation of CorporateDataSource for access to LDAP directory services.
- */
-public class CorporateLDAPSource implements CorporateDatasource, DeepaMehtaConstants {
-
-	private DirContext initial;
-
-	/**
-	 *  A directory context to work with.
-	 */
-	private DirContext ctx;
-
-	/**
-	 *  Used to determine whether object search should be
-	 *  performed in onelevel scope or subtree scope.
-	 */
-	private SearchControls controls;
-
-	/**
-	 *  The URL connect String.
-	 */
-	private String url;
-
-
-
-	// *******************
-	// *** Constructor ***
-	// *******************
-
-
-
-	/**
-	 *  @param url a valid LDAP URL of the form &lt;CODE&gt;
-     *             <A HREF="ldap://host:port?login=name&amp;password=pwd&amp;baseDN=bdn&amp;searchScope=scp">ldap://host:port?login=name&amp;password=pwd&amp;baseDN=bdn&amp;searchScope=scp</A>
-	 *             &lt;/CODE&gt;, where:
-     *                   host is either an IP address or a DNS hostname, 
-	 *                   port is usually 389 or 636 (SSL-connection),
-	 *                   name is a valid login name on the LDAP system,
-	 *                   pwd is the password according to the login name,
-	 *                   bdn is the Base DN (only elements below this DN will be found), and
-	 *                   scp is the search scope. This may be either &quot;ONELEVEL_SCOPE&quot; or &quot;SUBTREE_SCOPE&quot;.
-	 *                                            In the first case, only the current directory will be searched, 
-	 *                                            otherwise subdirectories will be searched as well.
-	 *  For instance:
-	 *  <A HREF="ldap://192.168.251.145:389?login=olaf@staps2000.local&amp;password=olaf&amp;baseDN=DC=staps2000,DC=local&amp;searchScope=SUBTREE_SCOPE">ldap://192.168.251.145:389?login=olaf@staps2000.local&amp;password=olaf&amp;baseDN=DC=staps2000,DC=local&amp;searchScope=SUBTREE_SCOPE</A>
-	 */
-	public CorporateLDAPSource(String url) throws Exception {	
-		this.url = url;
-		reconnect();
-	}
-
-
-
-	// *********************************************************************
-	// *** Implementation of interface de.deepamehta.CorporateDatasource ***
-	// *********************************************************************
-
-
-
-	// --- queryElements (3 forms) ---
-
-	/**
-	 *  Retrieves Elements belonging to a certain type and
-	 *  fulfilling a set of conditions.
-	 *
-	 *  Note that the caseSensitiv parameter isn't used,
-	 *  since the definition whether attribute identification
-	 *  is case-sensitive or not is part of the LDAP attribute definition.
-	 *
-	 *  @param type maps to the value of the objectClass attribute
-	 *  @param conditions Map of (name, value) attribute pairs
-	 *  @param caseSensitiv unused (see above)
-	 */
-	public Vector queryElements(String type, Hashtable conditions, boolean caseSensitiv) throws Exception {
-		String filter = createFilter(conditions);
-		filter += createExactFilter(&quot;objectClass&quot;, type);
-		return performSearch(conjunctFilters(filter));
-	}
-
-	/**
-	 *  Retrieves Elements belonging to a certain type and
-	 *  fulfilling a certain &quot;fieldName=fieldValue&quot; condition.
-	 *  
-	 *  Note that the caseSensitiv parameter isn't used,
-	 *  since the definition whether attribute identification
-	 *  is case-sensitive or not is part of the LDAP attribute definition.
-	 *
-	 *  @param type maps to the value of the objectClass attribute
-	 *  @param fieldName name of a single attribute
-	 *  @param fieldValue attribute value
-	 *  @param caseSensitiv unused (see above)
-	 */
-	public Vector queryElements(String type, String fieldName, String fieldValue, boolean caseSensitiv) throws Exception {
-		String filter = createFilter(fieldName, fieldValue);
-		filter += createExactFilter(&quot;objectClass&quot;, type);
-		return performSearch(conjunctFilters(filter));
-	}
-
-	public Vector queryElements(String elementType, String id, String relatedElementType, String helperElementType) {
-		return new Vector();	// ### not yet implemented
-	}
-
-	// ---
-
-	/** 
-	 *  Retrieves one Element by its identifier.
-	 *
-	 *  @param type maps to the value of the objectClass attribute
-	 *  @param id maps to the DN of this element.
-	 */
-	public Hashtable queryElement(String type, String id) throws Exception {	
-		DirContext ctx = (DirContext) createContext(initial).lookup(id);
-		return transferAttributes(ctx);
-	}
-
-	/**
-	 * Categorizes elements according to the values of a certain grouping attribute.
-	 *
-	 * @param type			maps to the value of the objectClass attribute
-	 * param conditions     Map of attribute name - attribute value pairs
-	 * @param groupingField	The grouping attribute (e.g. &quot;Year&quot;)
-	 *
-	 * @return vector of 2-element String-arrays
-	 *         element 1: the grouping value (e.g. &quot;1994&quot;)
-	 *	       element 2: number of elements in that group (&quot;18&quot;)
-	 */
-	public Vector queryGroups(String type, Hashtable conditions, String groupingField) throws Exception {
-		Counter counter = new Counter();
-		
-		Vector elements = queryElements(type, conditions, false);
-		Enumeration e2 = elements.elements();
-		while (e2.hasMoreElements())
-		{
-			Hashtable hash = (Hashtable) e2.nextElement();
-			String val = (String) hash.get(groupingField);
-			counter.hit(val);
-		}
-		return counter.getResult();
-	}
-
-	/**
-	 *  Retrieves the number of elements of a certain type.
-	 *
-	 *  @param type maps to the value of the objectClass attribute
-	 *  @return the number of elements of this type
-	 */
-	public int getElementCount(String type) throws Exception {
-		String filter = createExactFilter(&quot;objectClass&quot;, type);
-		Enumeration e2 = createContext(ctx).search(&quot;&quot;, filter, controls);
-		int count = 0;
-		while (e2.hasMoreElements())
-		{
-			e2.nextElement();
-			count++;
-		}
-		return count;
-	}
-
-	public int getElementCount(String elementType, Hashtable attributes, boolean caseSensitiv) throws Exception {
-		return 0;	// ### not yet implemented	
-	}
-
-	public int getElementCount(String elementType, String id, String relatedElementType, String helperElementType) throws Exception {
-		return 0;	// ### not yet implemented	
-	}
-
-
-
-	// ***********************
-	// *** Private Methods ***
-	// ***********************
-
-
-
-	/**
-	 *  Performs a (re)connect to the LDAP server.
-	 */
-	private void reconnect() throws NamingException
-	{
-		System.out.println( &quot;=========&gt; trying reconnect...&quot; );
-		int query_pos = url.indexOf(&quot;?&quot;);
-		String firstUrl = url.substring(0, query_pos);
-		
-		String args = url.substring(query_pos + 1, url.length());
-		Hashtable hash = parseArguments(args);
-		
-		String login       = getValue(hash, &quot;login&quot;);
-		String password    = getValue(hash, &quot;password&quot;);
-		String baseDN      = getValue(hash, &quot;baseDN&quot;);
-		String searchScope = getValue(hash, &quot;searchScope&quot;);
-		
-		initial = createInitialContext(firstUrl, login, password);
-		ctx = (DirContext) initial.lookup(baseDN);
-		setSearchScope(searchScope);
-	}
-
-	/**
-	 *  parses a String of the form &lt;CODE&gt;
-	 *  key1=value1&amp;key2=value2&amp;key3=value3
-	 *  &lt;/CODE&gt; and returns the result as Hashtable.
-	 */
-	private Hashtable parseArguments(String arg)
-	{
-		Hashtable hash = new Hashtable();
-		Enumeration tokens = new StringTokenizer(arg, &quot;&amp;&quot;);
-		while (tokens.hasMoreElements())
-		{
-			String token = (String) tokens.nextElement();
-			int pos = token.indexOf(&quot;=&quot;);
-			String key = token.substring(0, pos);
-			String val = token.substring(pos + 1, token.length());
-			hash.put(key, val);
-		}
-		return hash;
-	}
-
-	/**
-	 *  Utility method which throws an exception if
-	 *  a value for &lt;code&gt;key&lt;/code&gt; cannot be found in &lt;code&gt;hash&lt;/code&gt;.
-	 */
-	private String getValue(Hashtable hash, String key)
-	{
-		String value = (String) hash.get(key);
-		if (value == null) {
-			throw new DeepaMehtaException(&quot;*** CorporateLDAPSource.getValue(): no value for key \&quot;&quot; + key + &quot;\&quot; defined!&quot;);
-		}
-		return value;
-	}
-	
-	/**
-	 *  Creates an initial DirContext.
-	 */
-	private DirContext createInitialContext(String url, String login, String password)
-	throws NamingException
-	{
-		Hashtable env = new Hashtable();
-		env.put( Context.INITIAL_CONTEXT_FACTORY, &quot;com.sun.jndi.ldap.LdapCtxFactory&quot; );
-
-		env.put(Context.PROVIDER_URL, url);
-		env.put(Context.SECURITY_PRINCIPAL, login);
-		env.put(Context.SECURITY_CREDENTIALS, password);
-		
-		// requests communication via LDAP v3, if possible
-		env.put(&quot;java.naming.ldap.version&quot;, &quot;3&quot;);
-		
-		// declares the objectSid attribute to have binary values
-//		env.put(&quot;java.naming.ldap.attributes.binary&quot;, &quot;objectSid&quot;);  
-		
-		return new InitialDirContext(env);
-	}
-	
-	/**
-	 *  Sets the search scope.
-	 */
-	private void setSearchScope(String searchScope)
-	{		
-		controls = new SearchControls();
-		
-		if (&quot;ONELEVEL_SCOPE&quot;.equalsIgnoreCase(searchScope)) {
-			controls.setSearchScope(SearchControls.ONELEVEL_SCOPE);
-		}
-		
-		else {
-			controls.setSearchScope(SearchControls.SUBTREE_SCOPE);
-		}
-	}
-	
-	/**
-	 *  Creates a search filter from a Hashtable of conditions.
-	 *
-	 *  AND-related substring filters:
-	 *  (&amp;(key1=*val1*)(key2=*val2*))
-	 *  @see <A HREF="http://www.tc-trustcenter.de/certservices/ldap/ldap_manual.pdf">http://www.tc-trustcenter.de/certservices/ldap/ldap_manual.pdf</A>
-	 *
-	 *  Note: some attribute fields don't allow substring search,
-	 *  e.g. memberOf-Attribute in ActiveDirectory users
-	 */
-	private String createFilter(Hashtable hash)
-	{
-		String filter = &quot;&quot;;
-		Enumeration keys = hash.keys();
-		while (keys.hasMoreElements())
-		{
-			String key = (String) keys.nextElement();
-			filter += createFilter(key, hash.get(key));
-		}
-		return filter;
-	}
-	
-	/**
-	 *  Creates a single substring search filter from a key-value pair.
-	 */
-	private String createFilter(String key, Object val) {
-		return &quot;(&quot; + key + &quot;=*&quot; + val + &quot;*)&quot;;
-	}
-	
-	/**
-	 *  Creates a single search filter from a key-value pair.
-	 */
-	private String createExactFilter(String key, Object val) {
-		return &quot;(&quot; + key + &quot;=&quot; + val + &quot;)&quot;;
-	}	
-	
-	/** To logically AND multiple filters. */
-	private String conjunctFilters(String filters) {
-		return &quot;(&amp;&quot; + filters + &quot;)&quot;;
-	}
-	
-	/**
-	 *  Puts the attributes of an element in a Hashtable.
-	 *  Multiple values for an attribute will be concatenated
-	 *  in one value, separated by the constant MULTIPLE_VALUE_DELIMITER.
-	 *  @param ctx the context which attributes should be put in the Hashtable.
-	 */
-	private Hashtable transferAttributes(DirContext ctx) throws NamingException
-	{	
-		Hashtable hash = new Hashtable();
-		
-		// id for direct access to elements
-		hash.put(&quot;ID&quot;, ctx.getNameInNamespace());
-		
-		Attributes attribs = ctx.getAttributes(&quot;&quot;);
-
-		Enumeration e2 = attribs.getAll();		
-		while (e2.hasMoreElements())
-		{
-			Attribute attr = (Attribute) e2.nextElement();		
-			String attrname = attr.getID();
-			
-			// Get the list of values of this attribute
-			Enumeration en = attr.getAll();		
-			boolean firstValue = true;
-			String valueList = &quot;&quot;;
-			
-			while (en.hasMoreElements())
-			{
-				Object val = en.nextElement();
-				valueList += (firstValue ? &quot;&quot; : MULTIPLE_VALUE_DELIMITER) + val;
-				firstValue = false;
-			}
-			
-			hash.put(attrname, valueList);
-		}
-		return hash;		
-	}
-	
-	/**
-	 *  @return a new instance of the DirContext
-	 *  which may be used concurrently.
-	 *  Performs a reconnect if an exception occurred.
-	 */
-	private DirContext createContext(DirContext ctx) throws NamingException
-	{
-		try {
-			return (DirContext) ctx.lookup(&quot;&quot;);
-		}
-		catch(Exception e)
-		{
-			reconnect();
-			return (DirContext) ctx.lookup(&quot;&quot;);
-		}
-	}	
-	
-	/**
-	 *  Performs an LDAP search, using the default DirContext
-	 *  and the given filter String.
-	 *  @return a Vector of Hashtables, containing the attribute-value pairs.
-	 */
-	private Vector performSearch(String filter) throws NamingException
-	{
-		System.out.println(&quot;### performSearch: \&quot;&quot; + filter + &quot;\&quot;&quot;);
-		Enumeration e2 = createContext(ctx).search(&quot;&quot;, filter, controls);
-		Vector v = new Vector();
-		while (e2.hasMoreElements())
-		{
-			NameClassPair pair = (NameClassPair) e2.nextElement();
-			String objname = pair.getName();
-			DirContext obj = (DirContext) createContext(ctx).lookup(objname);
-			v.add(transferAttributes(obj));
-		}
-		return v;
-	}
-	
-	/**
-	 *  Helper class to count the occurrences of certain values
-	 */
-	private class Counter
-	{
-		Hashtable scores = new Hashtable();
-		
-		/**
-		 *  Increases the score of the occurrence of val
-		 */
-		void hit(String val)
-		{
-			if (! scores.containsKey(val)) {
-				scores.put(val, new Integer(1));
-			}
-			
-			else {
-				int count = ( (Integer) scores.get(val) ).intValue();
-				scores.put(val, new Integer(count++));
-			}
-		}
-		
-		/**
-		 *  @return a Vector of scores in a format suitable for queryGroups().
-		 *  @see #queryGroups
-		 */
-		Vector getResult()
-		{
-			Vector result = new Vector();
-			
-			Enumeration keys = scores.keys();
-			while (keys.hasMoreElements())
-			{
-				String [] groupData = new String[2];
-				String key = (String) keys.nextElement();
-				groupData[0] = key;
-				groupData[1] = ( (Integer) scores.get(key) ).toString();
-				result.add(groupData);
-			}
-			return result;
-		}
-	}
+package de.deepamehta.service;
+
+import de.deepamehta.DeepaMehtaConstants;
+import de.deepamehta.DeepaMehtaException;
+
+import java.util.Enumeration;
+import java.util.Hashtable;
+import java.util.StringTokenizer;
+import java.util.Vector;
+
+import javax.naming.Context;
+import javax.naming.NameClassPair;
+import javax.naming.NamingException;
+import javax.naming.directory.Attribute;
+import javax.naming.directory.Attributes;
+import javax.naming.directory.DirContext;
+import javax.naming.directory.InitialDirContext;
+import javax.naming.directory.SearchControls;
+
+
+
+/** 
+ * An Implementation of CorporateDataSource for access to LDAP directory services.
+ */
+public class CorporateLDAPSource implements CorporateDatasource, DeepaMehtaConstants {
+
+	private DirContext initial;
+
+	/**
+	 *  A directory context to work with.
+	 */
+	private DirContext ctx;
+
+	/**
+	 *  Used to determine whether object search should be
+	 *  performed in onelevel scope or subtree scope.
+	 */
+	private SearchControls controls;
+
+	/**
+	 *  The URL connect String.
+	 */
+	private String url;
+
+
+
+	// *******************
+	// *** Constructor ***
+	// *******************
+
+
+
+	/**
+	 *  @param url a valid LDAP URL of the form &lt;CODE&gt;
+     *             <A HREF="ldap://host:port?login=name&amp;password=pwd&amp;baseDN=bdn&amp;searchScope=scp">ldap://host:port?login=name&amp;password=pwd&amp;baseDN=bdn&amp;searchScope=scp</A>
+	 *             &lt;/CODE&gt;, where:
+     *                   host is either an IP address or a DNS hostname, 
+	 *                   port is usually 389 or 636 (SSL-connection),
+	 *                   name is a valid login name on the LDAP system,
+	 *                   pwd is the password according to the login name,
+	 *                   bdn is the Base DN (only elements below this DN will be found), and
+	 *                   scp is the search scope. This may be either &quot;ONELEVEL_SCOPE&quot; or &quot;SUBTREE_SCOPE&quot;.
+	 *                                            In the first case, only the current directory will be searched, 
+	 *                                            otherwise subdirectories will be searched as well.
+	 *  For instance:
+	 *  <A HREF="ldap://192.168.251.145:389?login=olaf@staps2000.local&amp;password=olaf&amp;baseDN=DC=staps2000,DC=local&amp;searchScope=SUBTREE_SCOPE">ldap://192.168.251.145:389?login=olaf@staps2000.local&amp;password=olaf&amp;baseDN=DC=staps2000,DC=local&amp;searchScope=SUBTREE_SCOPE</A>
+	 */
+	public CorporateLDAPSource(String url) throws Exception {	
+		this.url = url;
+		reconnect();
+	}
+
+
+
+	// *********************************************************************
+	// *** Implementation of interface de.deepamehta.CorporateDatasource ***
+	// *********************************************************************
+
+
+
+	// --- queryElements (3 forms) ---
+
+	/**
+	 *  Retrieves Elements belonging to a certain type and
+	 *  fulfilling a set of conditions.
+	 *
+	 *  Note that the caseSensitiv parameter isn't used,
+	 *  since the definition whether attribute identification
+	 *  is case-sensitive or not is part of the LDAP attribute definition.
+	 *
+	 *  @param type maps to the value of the objectClass attribute
+	 *  @param conditions Map of (name, value) attribute pairs
+	 *  @param caseSensitiv unused (see above)
+	 */
+	public Vector queryElements(String type, Hashtable conditions, boolean caseSensitiv) throws Exception {
+		String filter = createFilter(conditions);
+		filter += createExactFilter(&quot;objectClass&quot;, type);
+		return performSearch(conjunctFilters(filter));
+	}
+
+	/**
+	 *  Retrieves Elements belonging to a certain type and
+	 *  fulfilling a certain &quot;fieldName=fieldValue&quot; condition.
+	 *  
+	 *  Note that the caseSensitiv parameter isn't used,
+	 *  since the definition whether attribute identification
+	 *  is case-sensitive or not is part of the LDAP attribute definition.
+	 *
+	 *  @param type maps to the value of the objectClass attribute
+	 *  @param fieldName name of a single attribute
+	 *  @param fieldValue attribute value
+	 *  @param caseSensitiv unused (see above)
+	 */
+	public Vector queryElements(String type, String fieldName, String fieldValue, boolean caseSensitiv) throws Exception {
+		String filter = createFilter(fieldName, fieldValue);
+		filter += createExactFilter(&quot;objectClass&quot;, type);
+		return performSearch(conjunctFilters(filter));
+	}
+
+	public Vector queryElements(String elementType, String id, String relatedElementType, String helperElementType) {
+		return new Vector();	// ### not yet implemented
+	}
+
+	// ---
+
+	/** 
+	 *  Retrieves one Element by its identifier.
+	 *
+	 *  @param type maps to the value of the objectClass attribute
+	 *  @param id maps to the DN of this element.
+	 */
+	public Hashtable queryElement(String type, String id) throws Exception {	
+		DirContext ctx = (DirContext) createContext(initial).lookup(id);
+		return transferAttributes(ctx);
+	}
+
+	/**
+	 * Categorizes elements according to the values of a certain grouping attribute.
+	 *
+	 * @param type			maps to the value of the objectClass attribute
+	 * param conditions     Map of attribute name - attribute value pairs
+	 * @param groupingField	The grouping attribute (e.g. &quot;Year&quot;)
+	 *
+	 * @return vector of 2-element String-arrays
+	 *         element 1: the grouping value (e.g. &quot;1994&quot;)
+	 *	       element 2: number of elements in that group (&quot;18&quot;)
+	 */
+	public Vector queryGroups(String type, Hashtable conditions, String groupingField) throws Exception {
+		Counter counter = new Counter();
+		
+		Vector elements = queryElements(type, conditions, false);
+		Enumeration e2 = elements.elements();
+		while (e2.hasMoreElements())
+		{
+			Hashtable hash = (Hashtable) e2.nextElement();
+			String val = (String) hash.get(groupingField);
+			counter.hit(val);
+		}
+		return counter.getResult();
+	}
+
+	/**
+	 *  Retrieves the number of elements of a certain type.
+	 *
+	 *  @param type maps to the value of the objectClass attribute
+	 *  @return the number of elements of this type
+	 */
+	public int getElementCount(String type) throws Exception {
+		String filter = createExactFilter(&quot;objectClass&quot;, type);
+		Enumeration e2 = createContext(ctx).search(&quot;&quot;, filter, controls);
+		int count = 0;
+		while (e2.hasMoreElements())
+		{
+			e2.nextElement();
+			count++;
+		}
+		return count;
+	}
+
+	public int getElementCount(String elementType, Hashtable attributes, boolean caseSensitiv) throws Exception {
+		return 0;	// ### not yet implemented	
+	}
+
+	public int getElementCount(String elementType, String id, String relatedElementType, String helperElementType) throws Exception {
+		return 0;	// ### not yet implemented	
+	}
+
+
+
+	// ***********************
+	// *** Private Methods ***
+	// ***********************
+
+
+
+	/**
+	 *  Performs a (re)connect to the LDAP server.
+	 */
+	private void reconnect() throws NamingException
+	{
+		System.out.println( &quot;=========&gt; trying reconnect...&quot; );
+		int query_pos = url.indexOf(&quot;?&quot;);
+		String firstUrl = url.substring(0, query_pos);
+		
+		String args = url.substring(query_pos + 1, url.length());
+		Hashtable hash = parseArguments(args);
+		
+		String login       = getValue(hash, &quot;login&quot;);
+		String password    = getValue(hash, &quot;password&quot;);
+		String baseDN      = getValue(hash, &quot;baseDN&quot;);
+		String searchScope = getValue(hash, &quot;searchScope&quot;);
+		
+		initial = createInitialContext(firstUrl, login, password);
+		ctx = (DirContext) initial.lookup(baseDN);
+		setSearchScope(searchScope);
+	}
+
+	/**
+	 *  parses a String of the form &lt;CODE&gt;
+	 *  key1=value1&amp;key2=value2&amp;key3=value3
+	 *  &lt;/CODE&gt; and returns the result as Hashtable.
+	 */
+	private Hashtable parseArguments(String arg)
+	{
+		Hashtable hash = new Hashtable();
+		Enumeration tokens = new StringTokenizer(arg, &quot;&amp;&quot;);
+		while (tokens.hasMoreElements())
+		{
+			String token = (String) tokens.nextElement();
+			int pos = token.indexOf(&quot;=&quot;);
+			String key = token.substring(0, pos);
+			String val = token.substring(pos + 1, token.length());
+			hash.put(key, val);
+		}
+		return hash;
+	}
+
+	/**
+	 *  Utility method which throws an exception if
+	 *  a value for &lt;code&gt;key&lt;/code&gt; cannot be found in &lt;code&gt;hash&lt;/code&gt;.
+	 */
+	private String getValue(Hashtable hash, String key)
+	{
+		String value = (String) hash.get(key);
+		if (value == null) {
+			throw new DeepaMehtaException(&quot;*** CorporateLDAPSource.getValue(): no value for key \&quot;&quot; + key + &quot;\&quot; defined!&quot;);
+		}
+		return value;
+	}
+	
+	/**
+	 *  Creates an initial DirContext.
+	 */
+	private DirContext createInitialContext(String url, String login, String password)
+	throws NamingException
+	{
+		Hashtable env = new Hashtable();
+		env.put( Context.INITIAL_CONTEXT_FACTORY, &quot;com.sun.jndi.ldap.LdapCtxFactory&quot; );
+
+		env.put(Context.PROVIDER_URL, url);
+		env.put(Context.SECURITY_PRINCIPAL, login);
+		env.put(Context.SECURITY_CREDENTIALS, password);
+		
+		// requests communication via LDAP v3, if possible
+		env.put(&quot;java.naming.ldap.version&quot;, &quot;3&quot;);
+		
+		// declares the objectSid attribute to have binary values
+//		env.put(&quot;java.naming.ldap.attributes.binary&quot;, &quot;objectSid&quot;);  
+		
+		return new InitialDirContext(env);
+	}
+	
+	/**
+	 *  Sets the search scope.
+	 */
+	private void setSearchScope(String searchScope)
+	{		
+		controls = new SearchControls();
+		
+		if (&quot;ONELEVEL_SCOPE&quot;.equalsIgnoreCase(searchScope)) {
+			controls.setSearchScope(SearchControls.ONELEVEL_SCOPE);
+		}
+		
+		else {
+			controls.setSearchScope(SearchControls.SUBTREE_SCOPE);
+		}
+	}
+	
+	/**
+	 *  Creates a search filter from a Hashtable of conditions.
+	 *
+	 *  AND-related substring filters:
+	 *  (&amp;(key1=*val1*)(key2=*val2*))
+	 *  @see <A HREF="http://www.tc-trustcenter.de/certservices/ldap/ldap_manual.pdf">http://www.tc-trustcenter.de/certservices/ldap/ldap_manual.pdf</A>
+	 *
+	 *  Note: some attribute fields don't allow substring search,
+	 *  e.g. memberOf-Attribute in ActiveDirectory users
+	 */
+	private String createFilter(Hashtable hash)
+	{
+		String filter = &quot;&quot;;
+		Enumeration keys = hash.keys();
+		while (keys.hasMoreElements())
+		{
+			String key = (String) keys.nextElement();
+			filter += createFilter(key, hash.get(key));
+		}
+		return filter;
+	}
+	
+	/**
+	 *  Creates a single substring search filter from a key-value pair.
+	 */
+	private String createFilter(String key, Object val) {
+		return &quot;(&quot; + key + &quot;=*&quot; + val + &quot;*)&quot;;
+	}
+	
+	/**
+	 *  Creates a single search filter from a key-value pair.
+	 */
+	private String createExactFilter(String key, Object val) {
+		return &quot;(&quot; + key + &quot;=&quot; + val + &quot;)&quot;;
+	}	
+	
+	/** To logically AND multiple filters. */
+	private String conjunctFilters(String filters) {
+		return &quot;(&amp;&quot; + filters + &quot;)&quot;;
+	}
+	
+	/**
+	 *  Puts the attributes of an element in a Hashtable.
+	 *  Multiple values for an attribute will be concatenated
+	 *  in one value, separated by the constant MULTIPLE_VALUE_DELIMITER.
+	 *  @param ctx the context which attributes should be put in the Hashtable.
+	 */
+	private Hashtable transferAttributes(DirContext ctx) throws NamingException
+	{	
+		Hashtable hash = new Hashtable();
+		
+		// id for direct access to elements
+		hash.put(&quot;ID&quot;, ctx.getNameInNamespace());
+		
+		Attributes attribs = ctx.getAttributes(&quot;&quot;);
+
+		Enumeration e2 = attribs.getAll();		
+		while (e2.hasMoreElements())
+		{
+			Attribute attr = (Attribute) e2.nextElement();		
+			String attrname = attr.getID();
+			
+			// Get the list of values of this attribute
+			Enumeration en = attr.getAll();		
+			boolean firstValue = true;
+			String valueList = &quot;&quot;;
+			
+			while (en.hasMoreElements())
+			{
+				Object val = en.nextElement();
+				valueList += (firstValue ? &quot;&quot; : MULTIPLE_VALUE_DELIMITER) + val;
+				firstValue = false;
+			}
+			
+			hash.put(attrname, valueList);
+		}
+		return hash;		
+	}
+	
+	/**
+	 *  @return a new instance of the DirContext
+	 *  which may be used concurrently.
+	 *  Performs a reconnect if an exception occurred.
+	 */
+	private DirContext createContext(DirContext ctx) throws NamingException
+	{
+		try {
+			return (DirContext) ctx.lookup(&quot;&quot;);
+		}
+		catch(Exception e)
+		{
+			reconnect();
+			return (DirContext) ctx.lookup(&quot;&quot;);
+		}
+	}	
+	
+	/**
+	 *  Performs an LDAP search, using the default DirContext
+	 *  and the given filter String.
+	 *  @return a Vector of Hashtables, containing the attribute-value pairs.
+	 */
+	private Vector performSearch(String filter) throws NamingException
+	{
+		System.out.println(&quot;### performSearch: \&quot;&quot; + filter + &quot;\&quot;&quot;);
+		Enumeration e2 = createContext(ctx).search(&quot;&quot;, filter, controls);
+		Vector v = new Vector();
+		while (e2.hasMoreElements())
+		{
+			NameClassPair pair = (NameClassPair) e2.nextElement();
+			String objname = pair.getName();
+			DirContext obj = (DirContext) createContext(ctx).lookup(objname);
+			v.add(transferAttributes(obj));
+		}
+		return v;
+	}
+	
+	/**
+	 *  Helper class to count the occurrences of certain values
+	 */
+	private class Counter
+	{
+		Hashtable scores = new Hashtable();
+		
+		/**
+		 *  Increases the score of the occurrence of val
+		 */
+		void hit(String val)
+		{
+			if (! scores.containsKey(val)) {
+				scores.put(val, new Integer(1));
+			}
+			
+			else {
+				int count = ( (Integer) scores.get(val) ).intValue();
+				scores.put(val, new Integer(count++));
+			}
+		}
+		
+		/**
+		 *  @return a Vector of scores in a format suitable for queryGroups().
+		 *  @see #queryGroups
+		 */
+		Vector getResult()
+		{
+			Vector result = new Vector();
+			
+			Enumeration keys = scores.keys();
+			while (keys.hasMoreElements())
+			{
+				String [] groupData = new String[2];
+				String key = (String) keys.nextElement();
+				groupData[0] = key;
+				groupData[1] = ( (Integer) scores.get(key) ).toString();
+				result.add(groupData);
+			}
+			return result;
+		}
+	}
 }
\ No newline at end of file

Modified: branches/eschnepel/develop/src/de/deepamehta/service/CorporateXMLSource.java
===================================================================
--- branches/eschnepel/develop/src/de/deepamehta/service/CorporateXMLSource.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/develop/src/de/deepamehta/service/CorporateXMLSource.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,284 +1,284 @@
-package de.deepamehta.service;
-
-import org.w3c.dom.Document;
-import org.w3c.dom.Element;
-import org.w3c.dom.Node;
-import org.w3c.dom.NodeList;
-import org.xml.sax.InputSource;
-import org.xml.sax.SAXException;
-
-import com.ibm.xml.parsers.NonValidatingDOMParser;
-
-import java.io.FileInputStream;
-import java.io.IOException;
-import java.util.Enumeration;
-import java.util.Hashtable;
-import java.util.Map;
-import java.util.StringTokenizer;
-import java.util.Vector;
-
-
-
-/**
- * A {@link CorporateDatasource} implementation for XML data.
- * &lt;P&gt;
- * The XML parsing is performed by means of IBM's xml4j parser.
- * &lt;P&gt;
- * &lt;HR&gt;
- * Last functional update: 1.2.2003 (2.0a18-pre1)&lt;BR&gt;
- * Last documentation update: 6.11.2000 (2.0a7-pre2)&lt;BR&gt;
- * J&ouml;rg Richter&lt;BR&gt;
- * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>
- */
-public class CorporateXMLSource implements CorporateDatasource {
-
-
-
-	// *************
-	// *** Field ***
-	// *************
-
-
-
-	// key: entityname (String)
-	// value: Hashtable
-	//		key: id
-	//		value: Hashtable
-	//			key: fieldname
-	//			value: value
-	private Hashtable storeData = new Hashtable();
-
-
-
-	// *******************
-	// *** Constructor ***
-	// *******************
-
-
-
-	/**
-	 * @see		de.deepamehta.topics.DataSourceTopic#openCorporateDatasource
-	 */
-	public CorporateXMLSource(String xmlFile, String elementNames) throws SAXException, IOException {
-		System.out.println(&quot;&gt; CorporateXMLSource(): \&quot;&quot; + xmlFile + &quot;\&quot;&quot;);
-		NonValidatingDOMParser parser = new NonValidatingDOMParser();
-		parser.parse(new InputSource(new FileInputStream(xmlFile)));
-		Document doc = parser.getDocument();
-		Element docElement = doc.getDocumentElement();
-		Element element; // = (Element) docElement.getFirstChild();
-		// String elementType = element.getTagName();
-		StringTokenizer st = new StringTokenizer(elementNames, &quot;, &quot;);
-		NodeList elements;
-		String elementName;
-		Hashtable elementData;
-		while (st.hasMoreTokens()) {
-			elementName = st.nextToken();
-			elements = docElement.getElementsByTagName(elementName);
-			elementData = new Hashtable();
-			storeData.put(elementName, elementData);
-			System.out.println(&quot;&gt; Store &lt;&quot; + docElement.getTagName() + &quot;&gt; contains &quot; + elements.getLength() + &quot; &lt;&quot; + elementName + &quot;&gt; elements&quot;);
-			for (int n = 0; n &lt; elements.getLength(); n++) {
-				element = (Element) elements.item(n);
-				storeElement(elementData, element);
-			}
-		}
-	}
-
-
-
-	// *********************************************************************
-	// *** Implementation of interface de.deepamehta.CorporateDatasource ***
-	// *********************************************************************
-
-
-
-	// --- queryElements (3 forms) ---
-
-	public Vector queryElements(String elementName, Hashtable conditions, boolean caseSensitiv /*, TypeTopic typeDef*/) {
-		Vector result = new Vector();
-		Hashtable elementData = getElementData(elementName);
-		/* if (elementData == null) {
-			System.out.println(&quot;*** CorporateXMLSource.queryElements(): entity \&quot;&quot; + elementName + &quot;\&quot; not known -- no result&quot;);
-			return result;
-		} */
-		Enumeration e = elementData.elements();
-		Hashtable data;
-		try {
-			while (e.hasMoreElements()) {
-				data = (Hashtable) e.nextElement();
-				if (matches(data, conditions, caseSensitiv)) {
-					// add element to the result
-					result.addElement(data);
-				}
-			}
-		} catch (IllegalArgumentException e2) {
-			System.out.println(&quot;*** CorporateXMLSource.queryElements(): entity \&quot;&quot; + elementName + &quot;\&quot;: &quot; + e2.getMessage() + &quot; -- no result&quot;);
-		}
-		return result;
-	}
-
-	public Vector queryElements(String elementName, String fieldName, String fieldValue, boolean caseSensitiv) {
-		Vector result = new Vector();
-		Hashtable elementData = getElementData(elementName);
-		/* if (elementData == null) {
-			System.out.println(&quot;*** CorporateXMLSource.queryElements(): entity \&quot;&quot; + elementName + &quot;\&quot; not known -- no result&quot;);
-			return result;
-		} */
-		Enumeration e = elementData.elements();
-		Hashtable data;
-		String value;
-		while (e.hasMoreElements()) {
-			data = (Hashtable) e.nextElement();
-			value = (String) data.get(fieldName);
-			if (value == null) {
-				System.out.println(&quot;*** CorporateXMLSource.queryElements(): field \&quot;&quot; + fieldName + &quot;\&quot; not part of entity \&quot;&quot; + elementName + &quot;\&quot;&quot;);
-				continue;
-			}
-			if (matches(value, fieldValue, caseSensitiv)) {
-				result.addElement(data);
-			}
-		}
-		return result;
-	}
-
-	public Vector queryElements(String elementType, String id, String relatedElementType, String helperElementType) {
-		return new Vector();	// ### not yet implemented
-	}
-
-	// ---
-
-	public Hashtable queryElement(String elementName, String id) {
-		return (Hashtable) getElementData(elementName).get(id);
-	}
-/*
-	public String queryElement(String elementName, String id, String fieldName) {
-		return (String) queryElement(elementName, id).get(fieldName);
-	}
-*/
-	// Called from
-	//		- ContainerTopic.autoSearch()
-	public Vector queryGroups(String elementName, Hashtable conditions, String groupingField) {
-		Vector grouping = new Vector();
-		int[] itemCount = new int[7];	// #
-		Enumeration e = queryElements(elementName, conditions, false).elements();
-		Hashtable data;
-		String item;
-		int index;
-		boolean overflow = false;
-		while (e.hasMoreElements()) {
-			data = (Hashtable) e.nextElement();
-			item = (String) data.get(groupingField);
-			if (item == null) {
-				continue;
-			}
-			index = grouping.indexOf(item);
-			if (index == -1) {
-				index = grouping.size();
-				if (index &lt; 7) {		// #
-					grouping.addElement(item);
-					itemCount[index]++;
-				} else {
-					overflow = true;
-				}
-			} else {
-				itemCount[index]++;
-			}
-		}
-		if (overflow) {
-			System.out.println(&quot;* CorporateXMLSource.queryGroups(): there are more than 7 \&quot;&quot; + groupingField + &quot;\&quot; groups -- only 7 groups returned&quot;);	// #
-		}
-		// build result vector
-		Vector result = new Vector();
-		int groups = grouping.size();
-		String[] group;
-		for (int i = 0; i &lt; groups; i++) {
-			group = new String[2];
-			group[0] = (String) grouping.elementAt(i);
-			group[1] = Integer.toString(itemCount[i]);
-			result.addElement(group);
-		}
-		return result;
-	}
-
-	public int getElementCount(String type) {
-		return getElementData(type).size();
-	}
-
-	public int getElementCount(String elementType, Hashtable attributes, boolean caseSensitiv) throws Exception {
-		return 0;	// ### not yet implemented	
-	}
-
-	public int getElementCount(String elementType, String id, String relatedElementType, String helperElementType) throws Exception {
-		return 0;	// ### not yet implemented	
-	}
-
-
-
-	// ***********************
-	// *** Private Methods ***
-	// ***********************
-
-
-
-	private Hashtable getElementData(String elementName) {
-		return (Hashtable) storeData.get(elementName);
-	}
-
-	private void storeElement(Hashtable elementData, Element element) {
-		String tagname;
-		Node node;
-		String value;
-		String id = element.getAttribute(&quot;ID&quot;);
-		if (id.equals(&quot;&quot;)) {
-			System.out.println(&quot;*** CorporateXMLSource.storeElement(): element is missing \&quot;ID\&quot; attribute -- not stored&quot;);
-			return;
-		}
-		Hashtable topicData = new Hashtable();
-		topicData.put(&quot;ID&quot;, id);
-		element = (Element) element.getFirstChild();
-		while (element != null) {
-			tagname = element.getTagName();
-			node = element.getFirstChild();
-			value = node != null ? node.getNodeValue() : &quot;&quot;;
-			topicData.put(tagname, value);
-			element = (Element) element.getNextSibling();
-		}
-		elementData.put(id, topicData);
-	}
-
-	private boolean matches(Hashtable data, Hashtable queryData, boolean caseSensitiv) throws IllegalArgumentException {
-		// System.out.println(&quot;CorporateXMLSource.matches(): &quot; + data);
-		Enumeration e = queryData.keys();
-		String fieldname;
-		String value;
-		String compValue;
-		boolean matches = true;
-		// go through all fields of the query form
-		while (e.hasMoreElements()) {
-			fieldname = (String) e.nextElement();
-			value = (String) queryData.get(fieldname);
-			// only consider filled fields
-			if (!value.equals(&quot;&quot;)) {
-				// if (!value.equals(data.get(fieldname))) {
-				compValue = (String) data.get(fieldname);
-				if (compValue == null) {
-					throw new IllegalArgumentException(&quot;field \&quot;&quot; + fieldname + &quot;\&quot; unknown&quot;);
-				}
-				if (!matches(compValue, value, caseSensitiv)) {
-					matches = false;
-					break;
-				}
-			}
-		}
-		return matches;
-	}
-
-	private boolean matches(String str1, String needle, boolean caseSensitiv) {
-		if (caseSensitiv) {
-			return str1.equals(needle);
-		} else {
-			str1 = str1.toLowerCase();
-			return str1.indexOf(needle.toLowerCase()) != -1;
-		}
-	} 
-}
+package de.deepamehta.service;
+
+import org.w3c.dom.Document;
+import org.w3c.dom.Element;
+import org.w3c.dom.Node;
+import org.w3c.dom.NodeList;
+import org.xml.sax.InputSource;
+import org.xml.sax.SAXException;
+
+import com.ibm.xml.parsers.NonValidatingDOMParser;
+
+import java.io.FileInputStream;
+import java.io.IOException;
+import java.util.Enumeration;
+import java.util.Hashtable;
+import java.util.Map;
+import java.util.StringTokenizer;
+import java.util.Vector;
+
+
+
+/**
+ * A {@link CorporateDatasource} implementation for XML data.
+ * &lt;P&gt;
+ * The XML parsing is performed by means of IBM's xml4j parser.
+ * &lt;P&gt;
+ * &lt;HR&gt;
+ * Last functional update: 1.2.2003 (2.0a18-pre1)&lt;BR&gt;
+ * Last documentation update: 6.11.2000 (2.0a7-pre2)&lt;BR&gt;
+ * J&ouml;rg Richter&lt;BR&gt;
+ * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>
+ */
+public class CorporateXMLSource implements CorporateDatasource {
+
+
+
+	// *************
+	// *** Field ***
+	// *************
+
+
+
+	// key: entityname (String)
+	// value: Hashtable
+	//		key: id
+	//		value: Hashtable
+	//			key: fieldname
+	//			value: value
+	private Hashtable storeData = new Hashtable();
+
+
+
+	// *******************
+	// *** Constructor ***
+	// *******************
+
+
+
+	/**
+	 * @see		de.deepamehta.topics.DataSourceTopic#openCorporateDatasource
+	 */
+	public CorporateXMLSource(String xmlFile, String elementNames) throws SAXException, IOException {
+		System.out.println(&quot;&gt; CorporateXMLSource(): \&quot;&quot; + xmlFile + &quot;\&quot;&quot;);
+		NonValidatingDOMParser parser = new NonValidatingDOMParser();
+		parser.parse(new InputSource(new FileInputStream(xmlFile)));
+		Document doc = parser.getDocument();
+		Element docElement = doc.getDocumentElement();
+		Element element; // = (Element) docElement.getFirstChild();
+		// String elementType = element.getTagName();
+		StringTokenizer st = new StringTokenizer(elementNames, &quot;, &quot;);
+		NodeList elements;
+		String elementName;
+		Hashtable elementData;
+		while (st.hasMoreTokens()) {
+			elementName = st.nextToken();
+			elements = docElement.getElementsByTagName(elementName);
+			elementData = new Hashtable();
+			storeData.put(elementName, elementData);
+			System.out.println(&quot;&gt; Store &lt;&quot; + docElement.getTagName() + &quot;&gt; contains &quot; + elements.getLength() + &quot; &lt;&quot; + elementName + &quot;&gt; elements&quot;);
+			for (int n = 0; n &lt; elements.getLength(); n++) {
+				element = (Element) elements.item(n);
+				storeElement(elementData, element);
+			}
+		}
+	}
+
+
+
+	// *********************************************************************
+	// *** Implementation of interface de.deepamehta.CorporateDatasource ***
+	// *********************************************************************
+
+
+
+	// --- queryElements (3 forms) ---
+
+	public Vector queryElements(String elementName, Hashtable conditions, boolean caseSensitiv /*, TypeTopic typeDef*/) {
+		Vector result = new Vector();
+		Hashtable elementData = getElementData(elementName);
+		/* if (elementData == null) {
+			System.out.println(&quot;*** CorporateXMLSource.queryElements(): entity \&quot;&quot; + elementName + &quot;\&quot; not known -- no result&quot;);
+			return result;
+		} */
+		Enumeration e = elementData.elements();
+		Hashtable data;
+		try {
+			while (e.hasMoreElements()) {
+				data = (Hashtable) e.nextElement();
+				if (matches(data, conditions, caseSensitiv)) {
+					// add element to the result
+					result.addElement(data);
+				}
+			}
+		} catch (IllegalArgumentException e2) {
+			System.out.println(&quot;*** CorporateXMLSource.queryElements(): entity \&quot;&quot; + elementName + &quot;\&quot;: &quot; + e2.getMessage() + &quot; -- no result&quot;);
+		}
+		return result;
+	}
+
+	public Vector queryElements(String elementName, String fieldName, String fieldValue, boolean caseSensitiv) {
+		Vector result = new Vector();
+		Hashtable elementData = getElementData(elementName);
+		/* if (elementData == null) {
+			System.out.println(&quot;*** CorporateXMLSource.queryElements(): entity \&quot;&quot; + elementName + &quot;\&quot; not known -- no result&quot;);
+			return result;
+		} */
+		Enumeration e = elementData.elements();
+		Hashtable data;
+		String value;
+		while (e.hasMoreElements()) {
+			data = (Hashtable) e.nextElement();
+			value = (String) data.get(fieldName);
+			if (value == null) {
+				System.out.println(&quot;*** CorporateXMLSource.queryElements(): field \&quot;&quot; + fieldName + &quot;\&quot; not part of entity \&quot;&quot; + elementName + &quot;\&quot;&quot;);
+				continue;
+			}
+			if (matches(value, fieldValue, caseSensitiv)) {
+				result.addElement(data);
+			}
+		}
+		return result;
+	}
+
+	public Vector queryElements(String elementType, String id, String relatedElementType, String helperElementType) {
+		return new Vector();	// ### not yet implemented
+	}
+
+	// ---
+
+	public Hashtable queryElement(String elementName, String id) {
+		return (Hashtable) getElementData(elementName).get(id);
+	}
+/*
+	public String queryElement(String elementName, String id, String fieldName) {
+		return (String) queryElement(elementName, id).get(fieldName);
+	}
+*/
+	// Called from
+	//		- ContainerTopic.autoSearch()
+	public Vector queryGroups(String elementName, Hashtable conditions, String groupingField) {
+		Vector grouping = new Vector();
+		int[] itemCount = new int[7];	// #
+		Enumeration e = queryElements(elementName, conditions, false).elements();
+		Hashtable data;
+		String item;
+		int index;
+		boolean overflow = false;
+		while (e.hasMoreElements()) {
+			data = (Hashtable) e.nextElement();
+			item = (String) data.get(groupingField);
+			if (item == null) {
+				continue;
+			}
+			index = grouping.indexOf(item);
+			if (index == -1) {
+				index = grouping.size();
+				if (index &lt; 7) {		// #
+					grouping.addElement(item);
+					itemCount[index]++;
+				} else {
+					overflow = true;
+				}
+			} else {
+				itemCount[index]++;
+			}
+		}
+		if (overflow) {
+			System.out.println(&quot;* CorporateXMLSource.queryGroups(): there are more than 7 \&quot;&quot; + groupingField + &quot;\&quot; groups -- only 7 groups returned&quot;);	// #
+		}
+		// build result vector
+		Vector result = new Vector();
+		int groups = grouping.size();
+		String[] group;
+		for (int i = 0; i &lt; groups; i++) {
+			group = new String[2];
+			group[0] = (String) grouping.elementAt(i);
+			group[1] = Integer.toString(itemCount[i]);
+			result.addElement(group);
+		}
+		return result;
+	}
+
+	public int getElementCount(String type) {
+		return getElementData(type).size();
+	}
+
+	public int getElementCount(String elementType, Hashtable attributes, boolean caseSensitiv) throws Exception {
+		return 0;	// ### not yet implemented	
+	}
+
+	public int getElementCount(String elementType, String id, String relatedElementType, String helperElementType) throws Exception {
+		return 0;	// ### not yet implemented	
+	}
+
+
+
+	// ***********************
+	// *** Private Methods ***
+	// ***********************
+
+
+
+	private Hashtable getElementData(String elementName) {
+		return (Hashtable) storeData.get(elementName);
+	}
+
+	private void storeElement(Hashtable elementData, Element element) {
+		String tagname;
+		Node node;
+		String value;
+		String id = element.getAttribute(&quot;ID&quot;);
+		if (id.equals(&quot;&quot;)) {
+			System.out.println(&quot;*** CorporateXMLSource.storeElement(): element is missing \&quot;ID\&quot; attribute -- not stored&quot;);
+			return;
+		}
+		Hashtable topicData = new Hashtable();
+		topicData.put(&quot;ID&quot;, id);
+		element = (Element) element.getFirstChild();
+		while (element != null) {
+			tagname = element.getTagName();
+			node = element.getFirstChild();
+			value = node != null ? node.getNodeValue() : &quot;&quot;;
+			topicData.put(tagname, value);
+			element = (Element) element.getNextSibling();
+		}
+		elementData.put(id, topicData);
+	}
+
+	private boolean matches(Hashtable data, Hashtable queryData, boolean caseSensitiv) throws IllegalArgumentException {
+		// System.out.println(&quot;CorporateXMLSource.matches(): &quot; + data);
+		Enumeration e = queryData.keys();
+		String fieldname;
+		String value;
+		String compValue;
+		boolean matches = true;
+		// go through all fields of the query form
+		while (e.hasMoreElements()) {
+			fieldname = (String) e.nextElement();
+			value = (String) queryData.get(fieldname);
+			// only consider filled fields
+			if (!value.equals(&quot;&quot;)) {
+				// if (!value.equals(data.get(fieldname))) {
+				compValue = (String) data.get(fieldname);
+				if (compValue == null) {
+					throw new IllegalArgumentException(&quot;field \&quot;&quot; + fieldname + &quot;\&quot; unknown&quot;);
+				}
+				if (!matches(compValue, value, caseSensitiv)) {
+					matches = false;
+					break;
+				}
+			}
+		}
+		return matches;
+	}
+
+	private boolean matches(String str1, String needle, boolean caseSensitiv) {
+		if (caseSensitiv) {
+			return str1.equals(needle);
+		} else {
+			str1 = str1.toLowerCase();
+			return str1.indexOf(needle.toLowerCase()) != -1;
+		}
+	} 
+}

Modified: branches/eschnepel/develop/src/de/deepamehta/service/LoginCheck.java
===================================================================
--- branches/eschnepel/develop/src/de/deepamehta/service/LoginCheck.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/develop/src/de/deepamehta/service/LoginCheck.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,18 +1,18 @@
-package de.deepamehta.service;
-
-
-
-/**
- * ### to be dropped
- */
-public interface LoginCheck {
-
-	/**
-	 *  Validates the given username and password.
-	 *  @param username the cleartext login account
-	 *  @param password the cleartext password
-	 *  @return true if validation succeeded,
-	 *          false otherwise.
-	 */
-	public boolean loginCheck(String username, String password);
+package de.deepamehta.service;
+
+
+
+/**
+ * ### to be dropped
+ */
+public interface LoginCheck {
+
+	/**
+	 *  Validates the given username and password.
+	 *  @param username the cleartext login account
+	 *  @param password the cleartext password
+	 *  @return true if validation succeeded,
+	 *          false otherwise.
+	 */
+	public boolean loginCheck(String username, String password);
 }
\ No newline at end of file

Modified: branches/eschnepel/develop/src/de/deepamehta/service/web/DisplayObject.java
===================================================================
--- branches/eschnepel/develop/src/de/deepamehta/service/web/DisplayObject.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/develop/src/de/deepamehta/service/web/DisplayObject.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1 +1,31 @@
-package de.deepamehta.service.web;public class DisplayObject {	public int mode;	public Object param1, param2, param3;	public DisplayObject(int mode) {		this.mode = mode;	}	public DisplayObject(int mode, Object param1) {		this.mode = mode;		this.param1 = param1;	}	public DisplayObject(int mode, Object param1, Object param2) {		this.mode = mode;		this.param1 = param1;		this.param2 = param2;	}	public DisplayObject(int mode, Object param1, Object param2, Object param3) {		this.mode = mode;		this.param1 = param1;		this.param2 = param2;		this.param3 = param3;	}}
\ No newline at end of file
+package de.deepamehta.service.web;
+
+
+
+public class DisplayObject {
+
+	public int mode;
+	public Object param1, param2, param3;
+
+	public DisplayObject(int mode) {
+		this.mode = mode;
+	}
+
+	public DisplayObject(int mode, Object param1) {
+		this.mode = mode;
+		this.param1 = param1;
+	}
+
+	public DisplayObject(int mode, Object param1, Object param2) {
+		this.mode = mode;
+		this.param1 = param1;
+		this.param2 = param2;
+	}
+
+	public DisplayObject(int mode, Object param1, Object param2, Object param3) {
+		this.mode = mode;
+		this.param1 = param1;
+		this.param2 = param2;
+		this.param3 = param3;
+	}
+}

Modified: branches/eschnepel/develop/src/de/deepamehta/topics/AppointmentTopic.java
===================================================================
--- branches/eschnepel/develop/src/de/deepamehta/topics/AppointmentTopic.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/develop/src/de/deepamehta/topics/AppointmentTopic.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1 +1,21 @@
-package de.deepamehta.topics;import de.deepamehta.BaseTopic;import de.deepamehta.service.ApplicationService;public class AppointmentTopic extends LiveTopic {	// *******************	// *** Constructor ***	// *******************	public AppointmentTopic(BaseTopic topic, ApplicationService as) {		super(topic, as);	}}
\ No newline at end of file
+package de.deepamehta.topics;
+
+import de.deepamehta.BaseTopic;
+import de.deepamehta.service.ApplicationService;
+
+
+
+public class AppointmentTopic extends LiveTopic {
+
+
+
+	// *******************
+	// *** Constructor ***
+	// *******************
+
+
+
+	public AppointmentTopic(BaseTopic topic, ApplicationService as) {
+		super(topic, as);
+	}
+}

Modified: branches/eschnepel/develop/src/de/deepamehta/topics/AuthentificationSourceTopic.java
===================================================================
--- branches/eschnepel/develop/src/de/deepamehta/topics/AuthentificationSourceTopic.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/develop/src/de/deepamehta/topics/AuthentificationSourceTopic.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,69 +1,69 @@
-package de.deepamehta.topics;
-
-import de.deepamehta.BaseTopic;
-import de.deepamehta.service.ApplicationService;
-import de.deepamehta.service.Session;
-
-
-
-/**
- * ### This is the entry point for authentification. There is only one topic of this type in
- * the system which is associated to exactly one LoginTopic.
- * &lt;P&gt;
- * The actual authentification procedure will be managed by the LoginCheck object which
- * is represented by the LoginTopic.
- * &lt;P&gt;
- * The association is from the authentification source topic to the login topic (type
- * {@link #SEMANTIC_AUTHENTIFICATION_SOURCE}).
- */
-public class AuthentificationSourceTopic extends LiveTopic {
-
-	public AuthentificationSourceTopic(BaseTopic topic, ApplicationService as) {
-		super(topic, as);
-	}
-
-	/**
-	 * If the login check by the LoginCheck object succeeded, a lookup is performed to
-	 * determine if the user is already represented by a user object. ### If the user is
-	 * logged in for the first time, a new user object with associated personal map
-	 * will be created.
-	 *
-	 * @see		de.deepamehta.service.InteractionConnection#login
-	 */
-	public BaseTopic loginCheck(String username, String password, Session session) {
-		try {
-			if (loginCheck(username, password)) {
-				// Check if the user is a registered DeepaMehta user already
-				// ### possibly the check isn't sufficient. Must the user exist in the
-				// &quot;Users and Groups&quot; view?
-				BaseTopic user = cm.getTopic(TOPICTYPE_USER, username, 1);
-				/* ### if (user == null) {
-					System.out.println(&quot;&gt;&gt;&gt; AuthentificationSourceTopic: register new &quot; +
-						&quot;DeepaMehta user \&quot;&quot; + username + &quot;\&quot;&quot;);
-					// register new DeepaMehta user ### also if CM is used for authentification?
-					// ### Note: programatically registered users will not appear in the
-					// &quot;Users and Groups&quot; view
-					user = new BaseTopic(as.getNewTopicID(), 1, TOPICTYPE_USER, 1, username);
-					as.createLiveTopic(user, false, session);
-					as.evokeLiveTopic(user, session, null, null);
-				} */
-				return user;
-			}
-		} catch (Exception e) {
-			System.out.println(&quot;*** AuthentificationSourceTopic.loginCheck(3): &quot; +
-				&quot;login check not performed (&quot; + e + &quot;)&quot;);
-			e.printStackTrace();
-		}
-		return null;
-	}
-
-	/**
-	 * Retrieves the responsible LoginCheck object from ApplicationService and passes
-	 * the loginCheck to that.
-	 *
-	 * @return true if loginCheck succeeded, false otherwise.
-	 */
-	private boolean loginCheck(String username, String password) {
-		return as.getLoginCheck().loginCheck(username, password);
-	}
-}
+package de.deepamehta.topics;
+
+import de.deepamehta.BaseTopic;
+import de.deepamehta.service.ApplicationService;
+import de.deepamehta.service.Session;
+
+
+
+/**
+ * ### This is the entry point for authentification. There is only one topic of this type in
+ * the system which is associated to exactly one LoginTopic.
+ * &lt;P&gt;
+ * The actual authentification procedure will be managed by the LoginCheck object which
+ * is represented by the LoginTopic.
+ * &lt;P&gt;
+ * The association is from the authentification source topic to the login topic (type
+ * {@link #SEMANTIC_AUTHENTIFICATION_SOURCE}).
+ */
+public class AuthentificationSourceTopic extends LiveTopic {
+
+	public AuthentificationSourceTopic(BaseTopic topic, ApplicationService as) {
+		super(topic, as);
+	}
+
+	/**
+	 * If the login check by the LoginCheck object succeeded, a lookup is performed to
+	 * determine if the user is already represented by a user object. ### If the user is
+	 * logged in for the first time, a new user object with associated personal map
+	 * will be created.
+	 *
+	 * @see		de.deepamehta.service.InteractionConnection#login
+	 */
+	public BaseTopic loginCheck(String username, String password, Session session) {
+		try {
+			if (loginCheck(username, password)) {
+				// Check if the user is a registered DeepaMehta user already
+				// ### possibly the check isn't sufficient. Must the user exist in the
+				// &quot;Users and Groups&quot; view?
+				BaseTopic user = cm.getTopic(TOPICTYPE_USER, username, 1);
+				/* ### if (user == null) {
+					System.out.println(&quot;&gt;&gt;&gt; AuthentificationSourceTopic: register new &quot; +
+						&quot;DeepaMehta user \&quot;&quot; + username + &quot;\&quot;&quot;);
+					// register new DeepaMehta user ### also if CM is used for authentification?
+					// ### Note: programatically registered users will not appear in the
+					// &quot;Users and Groups&quot; view
+					user = new BaseTopic(as.getNewTopicID(), 1, TOPICTYPE_USER, 1, username);
+					as.createLiveTopic(user, false, session);
+					as.evokeLiveTopic(user, session, null, null);
+				} */
+				return user;
+			}
+		} catch (Exception e) {
+			System.out.println(&quot;*** AuthentificationSourceTopic.loginCheck(3): &quot; +
+				&quot;login check not performed (&quot; + e + &quot;)&quot;);
+			e.printStackTrace();
+		}
+		return null;
+	}
+
+	/**
+	 * Retrieves the responsible LoginCheck object from ApplicationService and passes
+	 * the loginCheck to that.
+	 *
+	 * @return true if loginCheck succeeded, false otherwise.
+	 */
+	private boolean loginCheck(String username, String password) {
+		return as.getLoginCheck().loginCheck(username, password);
+	}
+}

Modified: branches/eschnepel/develop/src/de/deepamehta/topics/DataConsumerTopic.java
===================================================================
--- branches/eschnepel/develop/src/de/deepamehta/topics/DataConsumerTopic.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/develop/src/de/deepamehta/topics/DataConsumerTopic.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,426 +1,426 @@
-package de.deepamehta.topics;
-
-import de.deepamehta.BaseTopic;
-import de.deepamehta.DeepaMehtaException;
-import de.deepamehta.TopicInitException;
-import de.deepamehta.service.ApplicationService;
-import de.deepamehta.service.CorporateDirectives;
-import de.deepamehta.service.Session;
-
-import java.util.Enumeration;
-import java.util.Hashtable;
-import java.util.StringTokenizer;
-import java.util.Vector;
-
-
-
-/**
- * Abstract baseclass for application topics who can reveal topics and associations
- * from a {@link de.deepamehta.service.CorporateDatasource} on-the-fly .
- *
- * &lt;H4&gt;Active behavoir&lt;/H4&gt;
- *
- * The active &lt;I&gt;initialization&lt;/I&gt; behavoir of a &lt;CODE&gt;DataConsumerTopic&lt;/CODE&gt; is
- * setting the associated &lt;CODE&gt;CorporateDatasource&lt;/CODE&gt;.
- * &lt;P&gt;
- * The active &lt;I&gt;association type revealing&lt;/I&gt; behavoir of a
- * &lt;CODE&gt;DataConsumerTopic&lt;/CODE&gt; is checking which relation types exists by quering the
- * &lt;CODE&gt;CorporateDatasource&lt;/CODE&gt; based upon registered relation
- * specifications.
- * &lt;P&gt;
- * The active &lt;I&gt;topic revealing&lt;/I&gt; behavoir of a &lt;CODE&gt;DataConsumerTopic&lt;/CODE&gt; is
- * quering the &lt;CODE&gt;CorporateDatasource&lt;/CODE&gt; for elements based upon a
- * registered relation specification and creating corresponding topics and associations
- * in corporate memory. The properties of each element are replicated as topic properties.
- *
- * &lt;H4&gt;Note to application programmers&lt;/H4&gt;
- *
- * &lt;CODE&gt;DataConsumerTopic&lt;/CODE&gt; is an
- * &lt;I&gt;abstract&lt;/I&gt; class -- it provides the behavoir described above without &quot;knowing&quot; an
- * actual relation specification. The actual relation specifications are provided by
- * active topics derived from &lt;CODE&gt;DataConsumerTopic&lt;/CODE&gt;. They will register one or
- * more relation specifications as theirs &lt;I&gt;initialization&lt;/I&gt; behavoir. Generally there
- * are 2 types of relations: &lt;I&gt;&quot;to one&quot;&lt;/I&gt; and &lt;I&gt;&quot;to many&quot;&lt;/I&gt;.
- * &lt;P&gt;
- * E.g. the {@link de.deepamehta.movies.topics.MovieTopic} registers a &quot;to many&quot; relation to specify how to retrieve
- * the related actors for the respective movie.
- * &lt;P&gt;
- * &lt;HR&gt;
- * Last functional change: 7.6.2005 (2.0b6)&lt;BR&gt;
- * Last documentation update: 12.11.2000 (2.0a7-pre2)&lt;BR&gt;
- * J&ouml;rg Richter&lt;BR&gt;
- * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>
- */
-public abstract class DataConsumerTopic extends LiveTopic {
-
-
-
-	// **************
-	// *** Fields ***
-	// **************
-
-
-
-	/**
-	 * The registered relations of this consumer.
-	 * &lt;P&gt;
-	 * Key: topic type ID (&lt;CODE&gt;String&lt;/CODE&gt;)&lt;BR&gt;
-	 * Value: Relation
-	 */
-	private Hashtable relations = new Hashtable();
-
-
-
-	// *******************
-	// *** Constructor ***
-	// *******************
-
-
-
-	public DataConsumerTopic(BaseTopic topic, ApplicationService as) {
-		super(topic, as);
-	}
-
-
-
-	// **********************
-	// *** Defining Hooks ***
-	// **********************
-
-
-
-	// ------------------
-	// --- Life Cycle ---
-	// ------------------
-
-
-
-	/**
-	 * &lt;P&gt;
-	 * &lt;TABLE&gt;
-	 * &lt;TR&gt;&lt;TD&gt;&lt;B&gt;Called by&lt;/B&gt;&lt;/TD&gt;&lt;TD&gt;&lt;CODE&gt;initLevel&lt;/CODE&gt;&lt;/TD&gt;&lt;/TR&gt;
-	 * &lt;TR&gt;&lt;TD&gt;{@link de.deepamehta.service.ApplicationService#createLiveTopic}&lt;/TD&gt;&lt;TD&gt;1&lt;/TD&gt;&lt;/TR&gt;
-	 * &lt;TR&gt;&lt;TD&gt;{@link de.deepamehta.service.ApplicationService#initTopic}&lt;/TD&gt;&lt;TD&gt;variable&lt;/TD&gt;&lt;/TR&gt;
-	 * &lt;TR&gt;&lt;TD&gt;{@link de.deepamehta.service.ApplicationService#initTypeTopic}&lt;/TD&gt;&lt;TD&gt;3&lt;/TD&gt;&lt;/TR&gt;
-	 * &lt;/TABLE&gt;
-	 */
-	public CorporateDirectives init(int initLevel, Session session) throws TopicInitException {
-		CorporateDirectives directives = super.init(initLevel, session);
-		//
-		if (initLevel == INITLEVEL_2) {
-			if (LOG_TOPIC_INIT) {
-				System.out.println(&quot;&gt;&gt;&gt; DataConsumerTopic.init(&quot; + initLevel + &quot;): &quot; +
-					this + &quot; -- sets data source&quot;);
-			}
-			setDataSource(session, directives);		// defined in LiveTopic
-		}
-		//
-		return directives;
-	}
-
-
-
-	// -----------------------------------
-	// --- Revealing topics on-the-fly ---
-	// -----------------------------------
-
-
-
-	/**
-	 * @see		de.deepamehta.service.ApplicationService#revealTopicTypes
-	 */
-	public Hashtable revealTopicTypes() throws DeepaMehtaException {
-		// retrieve association types from corporate memory (storage layer)
-		Hashtable topicTypes = super.revealTopicTypes();
-		//
-		if (relations.size() == 0) {
-			// this data consumer has no registered active association types
-			return topicTypes;
-		}
-		// error check
-		if (dataSource == null) {
-			throw new DeepaMehtaException(&quot;*** DataConsumerTopic.revealTopicTypes(): &quot; + this +
-				&quot; has no data source (no association types revealed)&quot;);
-		}
-		//
-		StringBuffer report = new StringBuffer(&quot;&gt;&gt;&gt; DataConsumerTopic.revealTopicTypes(): &quot; + this +
-			&quot; (&quot; + relations.size() + &quot; topic types registered) ...&quot;);
-		//
-		// go through registered association types and potentially add respective types
-		try {
-			Enumeration e = relations.elements();
-			String[] typeEntry;
-			while (e.hasMoreElements()) {
-				Relation rel = (Relation) e.nextElement();
-				String typeID = rel.topicType;
-				report.append(&quot; &quot; + typeID + &quot; &quot;);
-				// --- query the data source ---
-				Vector topics;
-				switch (rel.assocKind) {
-				case ASSOC_1:
-					String elementID = getProperty(rel.fieldName);
-					topics = dataSource.queryElements(rel.entityName, &quot;ID&quot;, elementID, true);	// ### &quot;ID&quot; is hardcoded
-					break;
-				case ASSOC_N:
-					elementID = getProperty(&quot;ID&quot;);	// ### &quot;ID&quot; is hardcoded
-					topics = dataSource.queryElements(rel.entityName, rel.fieldName, elementID, true);
-					break;
-				case ASSOC_X:
-					topics = new Vector();
-					Enumeration e2 = new StringTokenizer(getProperty(rel.fieldName), MULTIPLE_VALUE_DELIMITER);
-					while (e2.hasMoreElements()) {					
-						topics.add(e2.nextElement());
-					}
-					break;
-				default:
-					throw new DeepaMehtaException(&quot;unexpected relation kind: &quot; + rel.assocKind);
-				}
-				//
-				int found = topics.size();
-				if (found &gt; 0) {
-					// add association type
-					report.append(&quot;(+)&quot;);
-					topicTypes.put(typeID, Integer.toString(found));
-					// Note: if the type has been already revealed from corporate memory it is overridden to let
-					// the number of instances (as shown in the navigation menu) reflect the state of the datasource
-				} else {
-					report.append(&quot;(-)&quot;);
-				}
-			}
-			System.out.println(report);
-			return topicTypes;
-		} catch (Exception e) {
-			throw new DeepaMehtaException(&quot;*** DataConsumerTopic.revealTopicTypes(): &quot; +
-				&quot;topic types of &quot; + this + &quot; not revealed (&quot; + e + &quot;)&quot;, e);
-		}
-	}
-
-	/**
-	 * Overridden to extend the corporate memory on-the-fly by retrieving elements from a datasource.
-	 *
-	 * @see		de.deepamehta.topics.LiveTopic#navigateByTopictype
-	 */
-	public void revealRelatedTopics(String topicTypeID) throws DeepaMehtaException {
-		Relation rel = getRelation(topicTypeID);
-		if (rel == null) {
-			// generic association types require no dynamic revealing ### think about
-			if (topicTypeID != &quot;at-generic&quot;) {
-				System.out.println(&quot;*** DataConsumerTopic.revealRelatedTopics(): related topic type of &quot; + this +
-					&quot; via \&quot;&quot; + topicTypeID + &quot;\&quot; not registered&quot;);
-			}
-			return;
-		}
-		// error check
-		if (dataSource == null) {
-			throw new DeepaMehtaException(&quot;*** DataConsumerTopic.revealRelatedTopics(): &quot; + this +
-				&quot; has no data source (no related topics revealed)&quot;);
-		}
-		//
-		System.out.print(&quot;&gt; DataConsumerTopic.revealRelatedTopics(): related topics of &quot; +
-			this + &quot; via \&quot;&quot; + topicTypeID + &quot;\&quot; ... &quot;);
-		//
-		try {
-			String elementID;
-			switch (rel.assocKind) {
-			case ASSOC_1:
-				System.out.println(&quot;1 (:1)&quot;);
-				// potentially create new topic (and corresponding association) in
-				// corporate memory
-				elementID = getProperty(rel.fieldName);
-				createTopicFromElement(elementID, rel);
-				//
-				break;
-			case ASSOC_N:
-				// query the data source
-				String selfID = getProperty(&quot;ID&quot;);
-				Vector foundElements = dataSource.queryElements(rel.entityName, rel.fieldName, selfID, true);
-				int found = foundElements.size();
-				if (found &gt; 0) {
-					System.out.println(found + &quot; (:N)&quot;);
-					Enumeration e = foundElements.elements();
-					// go through found elements
-					while (e.hasMoreElements()) {
-						Hashtable partData = (Hashtable) e.nextElement();
-						// potentially create new topic (and corresponding association) in corporate memory
-						elementID = (String) partData.get(rel.relatedFieldName);
-						createTopicFromElement(elementID, rel);
-					}
-				} else {
-					System.out.println(&quot;*** none&quot;);
-				}
-				break;
-			case ASSOC_X:
-				String ids = getProperty(rel.fieldName);
-				Enumeration e2 = new StringTokenizer(ids, MULTIPLE_VALUE_DELIMITER);
-				while (e2.hasMoreElements()) {
-					elementID = (String) e2.nextElement();
-					createTopicFromElement(elementID, rel);
-				}
-				break;				
-			}
-		} catch (Exception e) {
-			throw new DeepaMehtaException(&quot;*** DataConsumerTopic.revealRelatedTopics():&quot; +
-				&quot; related topics of &quot; + this + &quot; not revealed (&quot; + e + &quot;)&quot;, e);
-		}
-	}
-
-
-
-	// ***************
-	// *** Methods ***
-	// ***************
-
-
-
-	/**
-	 * ### to be dropped
-	 */
-	protected final void registerRelation1(String assocType, String entityName, String fieldName,
-									 String topicType, String relatedElementType, String nameField) {
-		relations.put(topicType, new Relation(ASSOC_1, null, assocType, entityName, fieldName,
-			null, topicType, relatedElementType, nameField));	// relatedFieldName=null
-	}
-
-	/**
-	 * ### to be dropped
-	 */
-	protected final void registerRelationN(String elementType, String assocType, String entityName, String fieldName,
-									 String relatedFieldName,
-									 String topicType, String relatedElementType, String nameField) {
-		relations.put(topicType, new Relation(ASSOC_N, elementType, assocType, entityName, fieldName,
-			relatedFieldName, topicType, relatedElementType, nameField));
-	}
-
-	/**
-	 * ### to be dropped
-	 */
-	protected final void registerRelationX(String assocType, String entityName, String fieldName,
-									 String topicType, String relatedElementType, String nameField) {
-		relations.put(topicType, new Relation(ASSOC_X, null, assocType, entityName, fieldName,
-			null, topicType, relatedElementType, nameField));	// relatedFieldName=null
-	}
-
-	// ---
-
-	protected final Vector getRelatedElements(String topicTypeID) {
-		try {
-			Relation rel = getRelation(topicTypeID);
-			String selfID = getProperty(&quot;ID&quot;);
-			Vector elements = dataSource.queryElements(rel.elementType, selfID, rel.relatedElementType, rel.entityName);
-			return elements;
-		} catch (Exception e) {
-			throw new DeepaMehtaException(&quot;related \&quot;&quot; + topicTypeID + &quot;\&quot; topics of &quot; + this + &quot; can't be retrieved (&quot; + e + &quot;)&quot;);
-		}
-	}
-
-	protected final int getRelatedElementCount(String topicTypeID) {
-		try {
-			Relation rel = getRelation(topicTypeID);
-			String selfID = getProperty(&quot;ID&quot;);
-			int count = dataSource.getElementCount(rel.elementType, selfID, rel.relatedElementType, rel.entityName);
-			//
-			return count;
-		} catch (Exception e) {
-			throw new DeepaMehtaException(&quot;related \&quot;&quot; + topicTypeID + &quot;\&quot; topics of &quot; + this + &quot; can't be retrieved (&quot; + e + &quot;)&quot;);
-		}
-	}
-
-
-
-	// ***********************
-	// *** Private Methods ***
-	// ***********************
-
-
-	private Relation getRelation(String topicTypeID) {
-		return (Relation) relations.get(topicTypeID);
-	}
-
-	/**
-	 * @see		#revealRelatedTopics
-	 */
-	private void createTopicFromElement(String elementID, Relation rel) throws Exception {
-		// ### compare to ElementContainerTopic.createTopicFromElement()
-		// build identifier as topic id
-		String topicID = createTopicID(rel.relatedElementType, elementID);
-		// check if the element is already in corporate memory
-		// Note: no version number is involved in the existence check
-		if (!cm.topicExists(topicID)) {
-			// get the element data
-			Hashtable elementData = dataSource.queryElement(rel.relatedElementType, elementID);
-			if (elementData == null) {
-				System.out.println(&quot;*** DataConsumerTopic.createTopicFromElement(): \&quot;&quot; + rel.relatedElementType +
-					&quot;\&quot; with ID \&quot;&quot; + elementID + &quot; not fetched from datasource -- no topic created in corporate memory&quot;);
-				return;
-			}
-			//
-			String name = topicName(elementData, rel.nameField);	// ### there is new naming policy
-			// ### create new topic in corporate memory
-			String typeID = rel.topicType;
-			cm.createTopic(topicID, 1, typeID, 1, name);			// ### must create live topic instead
-			// --- trigger makeProperties() hook ---
-			Hashtable props = as.triggerMakeProperties(typeID, elementData);
-			cm.setTopicData(topicID, 1, props);
-		}
-		// check if the association is already in corporate memory
-		// ### Note: the direction is ignored
-		if (!cm.associationExists(getID(), topicID, true)) {
-			// create new association in corporate memory
-			String assocID = cm.getNewAssociationID();
-			cm.createAssociation(assocID, 1, rel.assocType, 1, getID(), 1, topicID, 1);		// ### versions
-		}
-	}
-
-	/**
-	 * Creates a unique topic ID for an element.
-	 */
-	protected String createTopicID(String elementType, String elementID) {
-		// &gt;&gt;&gt; compare to ElementContainerTopic.createTopicID()
-		return &quot;t-&quot; + elementType + &quot;-&quot; + elementID;
-	}
-
-
-
-	// *******************
-	// *** Inner Class ***
-	// *******************
-
-
-
-	/**
-	 * ### to be dropped
-	 * &lt;P&gt;
-	 * A registered relation.
-	 * &lt;P&gt;
-	 * [### explain]
-	 */
-	private class Relation {
-
-		// *** Fields ***
-
-		int assocKind;					// ASSOC_1, ASSOC_N or ASSOC_X
-		String elementType;				// the source element type
-		String assocType;
-		String entityName;
-		String fieldName;
-		String relatedFieldName;		// only used for N:M
-		String topicType;				// related topic type
-		String relatedElementType;		// related element type
-		String nameField;
-
-		// *** Constructor ***
-
-		Relation(int assocKind, String elementType, String assocType, String entityName, String fieldName,
-				 String relatedFieldName, String topicType, String relatedElementType, String nameField) {
-			this.assocKind = assocKind;
-			this.elementType = elementType;
-			this.assocType = assocType;
-			this.entityName = entityName;
-			this.fieldName = fieldName;
-			this.relatedFieldName = relatedFieldName;
-			this.topicType = topicType;
-			this.relatedElementType = relatedElementType;
-			this.nameField = nameField;
-		}
-	}
-}
+package de.deepamehta.topics;
+
+import de.deepamehta.BaseTopic;
+import de.deepamehta.DeepaMehtaException;
+import de.deepamehta.TopicInitException;
+import de.deepamehta.service.ApplicationService;
+import de.deepamehta.service.CorporateDirectives;
+import de.deepamehta.service.Session;
+
+import java.util.Enumeration;
+import java.util.Hashtable;
+import java.util.StringTokenizer;
+import java.util.Vector;
+
+
+
+/**
+ * Abstract baseclass for application topics who can reveal topics and associations
+ * from a {@link de.deepamehta.service.CorporateDatasource} on-the-fly .
+ *
+ * &lt;H4&gt;Active behavoir&lt;/H4&gt;
+ *
+ * The active &lt;I&gt;initialization&lt;/I&gt; behavoir of a &lt;CODE&gt;DataConsumerTopic&lt;/CODE&gt; is
+ * setting the associated &lt;CODE&gt;CorporateDatasource&lt;/CODE&gt;.
+ * &lt;P&gt;
+ * The active &lt;I&gt;association type revealing&lt;/I&gt; behavoir of a
+ * &lt;CODE&gt;DataConsumerTopic&lt;/CODE&gt; is checking which relation types exists by quering the
+ * &lt;CODE&gt;CorporateDatasource&lt;/CODE&gt; based upon registered relation
+ * specifications.
+ * &lt;P&gt;
+ * The active &lt;I&gt;topic revealing&lt;/I&gt; behavoir of a &lt;CODE&gt;DataConsumerTopic&lt;/CODE&gt; is
+ * quering the &lt;CODE&gt;CorporateDatasource&lt;/CODE&gt; for elements based upon a
+ * registered relation specification and creating corresponding topics and associations
+ * in corporate memory. The properties of each element are replicated as topic properties.
+ *
+ * &lt;H4&gt;Note to application programmers&lt;/H4&gt;
+ *
+ * &lt;CODE&gt;DataConsumerTopic&lt;/CODE&gt; is an
+ * &lt;I&gt;abstract&lt;/I&gt; class -- it provides the behavoir described above without &quot;knowing&quot; an
+ * actual relation specification. The actual relation specifications are provided by
+ * active topics derived from &lt;CODE&gt;DataConsumerTopic&lt;/CODE&gt;. They will register one or
+ * more relation specifications as theirs &lt;I&gt;initialization&lt;/I&gt; behavoir. Generally there
+ * are 2 types of relations: &lt;I&gt;&quot;to one&quot;&lt;/I&gt; and &lt;I&gt;&quot;to many&quot;&lt;/I&gt;.
+ * &lt;P&gt;
+ * E.g. the {@link de.deepamehta.movies.topics.MovieTopic} registers a &quot;to many&quot; relation to specify how to retrieve
+ * the related actors for the respective movie.
+ * &lt;P&gt;
+ * &lt;HR&gt;
+ * Last functional change: 7.6.2005 (2.0b6)&lt;BR&gt;
+ * Last documentation update: 12.11.2000 (2.0a7-pre2)&lt;BR&gt;
+ * J&ouml;rg Richter&lt;BR&gt;
+ * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>
+ */
+public abstract class DataConsumerTopic extends LiveTopic {
+
+
+
+	// **************
+	// *** Fields ***
+	// **************
+
+
+
+	/**
+	 * The registered relations of this consumer.
+	 * &lt;P&gt;
+	 * Key: topic type ID (&lt;CODE&gt;String&lt;/CODE&gt;)&lt;BR&gt;
+	 * Value: Relation
+	 */
+	private Hashtable relations = new Hashtable();
+
+
+
+	// *******************
+	// *** Constructor ***
+	// *******************
+
+
+
+	public DataConsumerTopic(BaseTopic topic, ApplicationService as) {
+		super(topic, as);
+	}
+
+
+
+	// **********************
+	// *** Defining Hooks ***
+	// **********************
+
+
+
+	// ------------------
+	// --- Life Cycle ---
+	// ------------------
+
+
+
+	/**
+	 * &lt;P&gt;
+	 * &lt;TABLE&gt;
+	 * &lt;TR&gt;&lt;TD&gt;&lt;B&gt;Called by&lt;/B&gt;&lt;/TD&gt;&lt;TD&gt;&lt;CODE&gt;initLevel&lt;/CODE&gt;&lt;/TD&gt;&lt;/TR&gt;
+	 * &lt;TR&gt;&lt;TD&gt;{@link de.deepamehta.service.ApplicationService#createLiveTopic}&lt;/TD&gt;&lt;TD&gt;1&lt;/TD&gt;&lt;/TR&gt;
+	 * &lt;TR&gt;&lt;TD&gt;{@link de.deepamehta.service.ApplicationService#initTopic}&lt;/TD&gt;&lt;TD&gt;variable&lt;/TD&gt;&lt;/TR&gt;
+	 * &lt;TR&gt;&lt;TD&gt;{@link de.deepamehta.service.ApplicationService#initTypeTopic}&lt;/TD&gt;&lt;TD&gt;3&lt;/TD&gt;&lt;/TR&gt;
+	 * &lt;/TABLE&gt;
+	 */
+	public CorporateDirectives init(int initLevel, Session session) throws TopicInitException {
+		CorporateDirectives directives = super.init(initLevel, session);
+		//
+		if (initLevel == INITLEVEL_2) {
+			if (LOG_TOPIC_INIT) {
+				System.out.println(&quot;&gt;&gt;&gt; DataConsumerTopic.init(&quot; + initLevel + &quot;): &quot; +
+					this + &quot; -- sets data source&quot;);
+			}
+			setDataSource(session, directives);		// defined in LiveTopic
+		}
+		//
+		return directives;
+	}
+
+
+
+	// -----------------------------------
+	// --- Revealing topics on-the-fly ---
+	// -----------------------------------
+
+
+
+	/**
+	 * @see		de.deepamehta.service.ApplicationService#revealTopicTypes
+	 */
+	public Hashtable revealTopicTypes() throws DeepaMehtaException {
+		// retrieve association types from corporate memory (storage layer)
+		Hashtable topicTypes = super.revealTopicTypes();
+		//
+		if (relations.size() == 0) {
+			// this data consumer has no registered active association types
+			return topicTypes;
+		}
+		// error check
+		if (dataSource == null) {
+			throw new DeepaMehtaException(&quot;*** DataConsumerTopic.revealTopicTypes(): &quot; + this +
+				&quot; has no data source (no association types revealed)&quot;);
+		}
+		//
+		StringBuffer report = new StringBuffer(&quot;&gt;&gt;&gt; DataConsumerTopic.revealTopicTypes(): &quot; + this +
+			&quot; (&quot; + relations.size() + &quot; topic types registered) ...&quot;);
+		//
+		// go through registered association types and potentially add respective types
+		try {
+			Enumeration e = relations.elements();
+			String[] typeEntry;
+			while (e.hasMoreElements()) {
+				Relation rel = (Relation) e.nextElement();
+				String typeID = rel.topicType;
+				report.append(&quot; &quot; + typeID + &quot; &quot;);
+				// --- query the data source ---
+				Vector topics;
+				switch (rel.assocKind) {
+				case ASSOC_1:
+					String elementID = getProperty(rel.fieldName);
+					topics = dataSource.queryElements(rel.entityName, &quot;ID&quot;, elementID, true);	// ### &quot;ID&quot; is hardcoded
+					break;
+				case ASSOC_N:
+					elementID = getProperty(&quot;ID&quot;);	// ### &quot;ID&quot; is hardcoded
+					topics = dataSource.queryElements(rel.entityName, rel.fieldName, elementID, true);
+					break;
+				case ASSOC_X:
+					topics = new Vector();
+					Enumeration e2 = new StringTokenizer(getProperty(rel.fieldName), MULTIPLE_VALUE_DELIMITER);
+					while (e2.hasMoreElements()) {					
+						topics.add(e2.nextElement());
+					}
+					break;
+				default:
+					throw new DeepaMehtaException(&quot;unexpected relation kind: &quot; + rel.assocKind);
+				}
+				//
+				int found = topics.size();
+				if (found &gt; 0) {
+					// add association type
+					report.append(&quot;(+)&quot;);
+					topicTypes.put(typeID, Integer.toString(found));
+					// Note: if the type has been already revealed from corporate memory it is overridden to let
+					// the number of instances (as shown in the navigation menu) reflect the state of the datasource
+				} else {
+					report.append(&quot;(-)&quot;);
+				}
+			}
+			System.out.println(report);
+			return topicTypes;
+		} catch (Exception e) {
+			throw new DeepaMehtaException(&quot;*** DataConsumerTopic.revealTopicTypes(): &quot; +
+				&quot;topic types of &quot; + this + &quot; not revealed (&quot; + e + &quot;)&quot;, e);
+		}
+	}
+
+	/**
+	 * Overridden to extend the corporate memory on-the-fly by retrieving elements from a datasource.
+	 *
+	 * @see		de.deepamehta.topics.LiveTopic#navigateByTopictype
+	 */
+	public void revealRelatedTopics(String topicTypeID) throws DeepaMehtaException {
+		Relation rel = getRelation(topicTypeID);
+		if (rel == null) {
+			// generic association types require no dynamic revealing ### think about
+			if (topicTypeID != &quot;at-generic&quot;) {
+				System.out.println(&quot;*** DataConsumerTopic.revealRelatedTopics(): related topic type of &quot; + this +
+					&quot; via \&quot;&quot; + topicTypeID + &quot;\&quot; not registered&quot;);
+			}
+			return;
+		}
+		// error check
+		if (dataSource == null) {
+			throw new DeepaMehtaException(&quot;*** DataConsumerTopic.revealRelatedTopics(): &quot; + this +
+				&quot; has no data source (no related topics revealed)&quot;);
+		}
+		//
+		System.out.print(&quot;&gt; DataConsumerTopic.revealRelatedTopics(): related topics of &quot; +
+			this + &quot; via \&quot;&quot; + topicTypeID + &quot;\&quot; ... &quot;);
+		//
+		try {
+			String elementID;
+			switch (rel.assocKind) {
+			case ASSOC_1:
+				System.out.println(&quot;1 (:1)&quot;);
+				// potentially create new topic (and corresponding association) in
+				// corporate memory
+				elementID = getProperty(rel.fieldName);
+				createTopicFromElement(elementID, rel);
+				//
+				break;
+			case ASSOC_N:
+				// query the data source
+				String selfID = getProperty(&quot;ID&quot;);
+				Vector foundElements = dataSource.queryElements(rel.entityName, rel.fieldName, selfID, true);
+				int found = foundElements.size();
+				if (found &gt; 0) {
+					System.out.println(found + &quot; (:N)&quot;);
+					Enumeration e = foundElements.elements();
+					// go through found elements
+					while (e.hasMoreElements()) {
+						Hashtable partData = (Hashtable) e.nextElement();
+						// potentially create new topic (and corresponding association) in corporate memory
+						elementID = (String) partData.get(rel.relatedFieldName);
+						createTopicFromElement(elementID, rel);
+					}
+				} else {
+					System.out.println(&quot;*** none&quot;);
+				}
+				break;
+			case ASSOC_X:
+				String ids = getProperty(rel.fieldName);
+				Enumeration e2 = new StringTokenizer(ids, MULTIPLE_VALUE_DELIMITER);
+				while (e2.hasMoreElements()) {
+					elementID = (String) e2.nextElement();
+					createTopicFromElement(elementID, rel);
+				}
+				break;				
+			}
+		} catch (Exception e) {
+			throw new DeepaMehtaException(&quot;*** DataConsumerTopic.revealRelatedTopics():&quot; +
+				&quot; related topics of &quot; + this + &quot; not revealed (&quot; + e + &quot;)&quot;, e);
+		}
+	}
+
+
+
+	// ***************
+	// *** Methods ***
+	// ***************
+
+
+
+	/**
+	 * ### to be dropped
+	 */
+	protected final void registerRelation1(String assocType, String entityName, String fieldName,
+									 String topicType, String relatedElementType, String nameField) {
+		relations.put(topicType, new Relation(ASSOC_1, null, assocType, entityName, fieldName,
+			null, topicType, relatedElementType, nameField));	// relatedFieldName=null
+	}
+
+	/**
+	 * ### to be dropped
+	 */
+	protected final void registerRelationN(String elementType, String assocType, String entityName, String fieldName,
+									 String relatedFieldName,
+									 String topicType, String relatedElementType, String nameField) {
+		relations.put(topicType, new Relation(ASSOC_N, elementType, assocType, entityName, fieldName,
+			relatedFieldName, topicType, relatedElementType, nameField));
+	}
+
+	/**
+	 * ### to be dropped
+	 */
+	protected final void registerRelationX(String assocType, String entityName, String fieldName,
+									 String topicType, String relatedElementType, String nameField) {
+		relations.put(topicType, new Relation(ASSOC_X, null, assocType, entityName, fieldName,
+			null, topicType, relatedElementType, nameField));	// relatedFieldName=null
+	}
+
+	// ---
+
+	protected final Vector getRelatedElements(String topicTypeID) {
+		try {
+			Relation rel = getRelation(topicTypeID);
+			String selfID = getProperty(&quot;ID&quot;);
+			Vector elements = dataSource.queryElements(rel.elementType, selfID, rel.relatedElementType, rel.entityName);
+			return elements;
+		} catch (Exception e) {
+			throw new DeepaMehtaException(&quot;related \&quot;&quot; + topicTypeID + &quot;\&quot; topics of &quot; + this + &quot; can't be retrieved (&quot; + e + &quot;)&quot;);
+		}
+	}
+
+	protected final int getRelatedElementCount(String topicTypeID) {
+		try {
+			Relation rel = getRelation(topicTypeID);
+			String selfID = getProperty(&quot;ID&quot;);
+			int count = dataSource.getElementCount(rel.elementType, selfID, rel.relatedElementType, rel.entityName);
+			//
+			return count;
+		} catch (Exception e) {
+			throw new DeepaMehtaException(&quot;related \&quot;&quot; + topicTypeID + &quot;\&quot; topics of &quot; + this + &quot; can't be retrieved (&quot; + e + &quot;)&quot;);
+		}
+	}
+
+
+
+	// ***********************
+	// *** Private Methods ***
+	// ***********************
+
+
+	private Relation getRelation(String topicTypeID) {
+		return (Relation) relations.get(topicTypeID);
+	}
+
+	/**
+	 * @see		#revealRelatedTopics
+	 */
+	private void createTopicFromElement(String elementID, Relation rel) throws Exception {
+		// ### compare to ElementContainerTopic.createTopicFromElement()
+		// build identifier as topic id
+		String topicID = createTopicID(rel.relatedElementType, elementID);
+		// check if the element is already in corporate memory
+		// Note: no version number is involved in the existence check
+		if (!cm.topicExists(topicID)) {
+			// get the element data
+			Hashtable elementData = dataSource.queryElement(rel.relatedElementType, elementID);
+			if (elementData == null) {
+				System.out.println(&quot;*** DataConsumerTopic.createTopicFromElement(): \&quot;&quot; + rel.relatedElementType +
+					&quot;\&quot; with ID \&quot;&quot; + elementID + &quot; not fetched from datasource -- no topic created in corporate memory&quot;);
+				return;
+			}
+			//
+			String name = topicName(elementData, rel.nameField);	// ### there is new naming policy
+			// ### create new topic in corporate memory
+			String typeID = rel.topicType;
+			cm.createTopic(topicID, 1, typeID, 1, name);			// ### must create live topic instead
+			// --- trigger makeProperties() hook ---
+			Hashtable props = as.triggerMakeProperties(typeID, elementData);
+			cm.setTopicData(topicID, 1, props);
+		}
+		// check if the association is already in corporate memory
+		// ### Note: the direction is ignored
+		if (!cm.associationExists(getID(), topicID, true)) {
+			// create new association in corporate memory
+			String assocID = cm.getNewAssociationID();
+			cm.createAssociation(assocID, 1, rel.assocType, 1, getID(), 1, topicID, 1);		// ### versions
+		}
+	}
+
+	/**
+	 * Creates a unique topic ID for an element.
+	 */
+	protected String createTopicID(String elementType, String elementID) {
+		// &gt;&gt;&gt; compare to ElementContainerTopic.createTopicID()
+		return &quot;t-&quot; + elementType + &quot;-&quot; + elementID;
+	}
+
+
+
+	// *******************
+	// *** Inner Class ***
+	// *******************
+
+
+
+	/**
+	 * ### to be dropped
+	 * &lt;P&gt;
+	 * A registered relation.
+	 * &lt;P&gt;
+	 * [### explain]
+	 */
+	private class Relation {
+
+		// *** Fields ***
+
+		int assocKind;					// ASSOC_1, ASSOC_N or ASSOC_X
+		String elementType;				// the source element type
+		String assocType;
+		String entityName;
+		String fieldName;
+		String relatedFieldName;		// only used for N:M
+		String topicType;				// related topic type
+		String relatedElementType;		// related element type
+		String nameField;
+
+		// *** Constructor ***
+
+		Relation(int assocKind, String elementType, String assocType, String entityName, String fieldName,
+				 String relatedFieldName, String topicType, String relatedElementType, String nameField) {
+			this.assocKind = assocKind;
+			this.elementType = elementType;
+			this.assocType = assocType;
+			this.entityName = entityName;
+			this.fieldName = fieldName;
+			this.relatedFieldName = relatedFieldName;
+			this.topicType = topicType;
+			this.relatedElementType = relatedElementType;
+			this.nameField = nameField;
+		}
+	}
+}

Modified: branches/eschnepel/develop/src/de/deepamehta/topics/DataSourceTopic.java
===================================================================
--- branches/eschnepel/develop/src/de/deepamehta/topics/DataSourceTopic.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/develop/src/de/deepamehta/topics/DataSourceTopic.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,347 +1,347 @@
-package de.deepamehta.topics;
-
-import de.deepamehta.BaseTopic;
-import de.deepamehta.DeepaMehtaException;
-import de.deepamehta.TopicInitException;
-import de.deepamehta.service.ApplicationService;
-import de.deepamehta.service.CorporateDatasource;
-import de.deepamehta.service.CorporateDirectives;
-import de.deepamehta.service.CorporateLDAPSource;
-import de.deepamehta.service.CorporateSQLSource;
-import de.deepamehta.service.CorporateXMLSource;
-import de.deepamehta.service.Session;
-
-import org.xml.sax.SAXException;
-
-import java.io.IOException;
-import java.util.Enumeration;
-import java.util.Hashtable;
-import java.util.Vector;
-
-
-
-/**
- * This kernel topic represents a {@link de.deepamehta.service.CorporateDatasource}.
- * &lt;P&gt;
- * A &lt;CODE&gt;DataSourceTopic&lt;/CODE&gt; is associated to its {@link DataConsumerTopic}s by
- * means of an association of type &lt;CODE&gt;at-association&lt;/CODE&gt; (direction is from
- * data consumer to datasource).
- * &lt;P&gt;
- * &lt;HR&gt;
- * Last functional change: 8.11.2004 (2.0b3)&lt;BR&gt;
- * Last documentation update: 23.2.2001 (2.0a9-post1)&lt;BR&gt;
- * J&ouml;rg Richter&lt;BR&gt;
- * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>
- */
-public class DataSourceTopic extends LiveTopic implements Runnable {
-
-
-
-	// **************
-	// *** Fields ***
-	// **************
-
-
-
-	// Note: the XML path is relative to servers working directory
-
-	protected String url;
-	protected String dbtype;
-	protected String elements;
-	protected String idleElement;
-
-	protected CorporateDatasource myDataSource;
-
-	/**
-	 * The idle thread.
-	 */
-	Thread idleThread;
-	private String username;
-	private String password;
-
-
-
-	// *******************
-	// *** Constructor ***
-	// *******************
-
-
-
-	public DataSourceTopic(BaseTopic topic, ApplicationService as) {
-		super(topic, as);
-	}
-
-
-
-	// ******************************************************
-	// *** Implementation of Interface java.lang.Runnable ***
-	// ******************************************************
-
-
-
-	/**
-	 * The body of the idle thread.
-	 */
-	public void run() {
-		while (true) {
-			try {
-				Thread.sleep(5 * 60 * 1000);	// interval is 5 min.
-				System.out.println(&quot;&gt; \&quot;&quot; + getName() + &quot;\&quot; statistics (\&quot;&quot; +
-					idleElement + &quot;\&quot;): &quot; + dataSource.getElementCount(idleElement));
-			} catch (InterruptedException e) {
-				System.out.println(&quot;*** DataSourceTopic.run(): &quot; + e);
-			} catch (Exception e) {
-				System.out.println(&quot;*** DataSourceTopic.run(): &quot; + e);
-			}
-		}
-	}
-
-
-
-	// ***************
-	// *** Methods ***
-	// ***************
-
-
-
-	/**
-	 * @see		DataConsumerTopic#setDataSource
-	 */
-	public String getURL() {
-		return url;
-	}
-
-	/**
-	 * @see		DataConsumerTopic#setDataSource
-	 */
-	public CorporateDatasource getDataSource() {
-		return myDataSource;
-	}
-
-
-
-	// ----------------------
-	// --- Defining Hooks ---
-	// ----------------------
-
-
-
-	/**
-	 * &lt;TABLE&gt;
-	 * &lt;TR&gt;&lt;TD&gt;&lt;B&gt;Called by&lt;/B&gt;&lt;/TD&gt;&lt;TD&gt;&lt;CODE&gt;initLevel&lt;/CODE&gt;&lt;/TD&gt;&lt;/TR&gt;
-	 * &lt;TR&gt;&lt;TD&gt;{@link de.deepamehta.service.ApplicationService#createLiveTopic}&lt;/TD&gt;&lt;TD&gt;1&lt;/TD&gt;&lt;/TR&gt;
-	 * &lt;TR&gt;&lt;TD&gt;{@link de.deepamehta.service.ApplicationService#initTopic}&lt;/TD&gt;&lt;TD&gt;variable&lt;/TD&gt;&lt;/TR&gt;
-	 * &lt;TR&gt;&lt;TD&gt;{@link de.deepamehta.service.ApplicationService#initTypeTopic}&lt;/TD&gt;&lt;TD&gt;3&lt;/TD&gt;&lt;/TR&gt;
-	 * &lt;/TABLE&gt;
-	 */
-	public CorporateDirectives init(int initLevel, Session session)
-															throws TopicInitException {
-		CorporateDirectives directives = super.init(initLevel, session);
-		//
-		if (initLevel == INITLEVEL_1) {
-			if (LOG_TOPIC_INIT) {
-				System.out.println(&quot;&gt;&gt;&gt; DataSourceTopic.init(&quot; + initLevel + &quot;): &quot; +
-					this + &quot; -- open corporate datasource&quot;);
-			}
-			openCorporateDatasource();		// throws TopicInitException
-		}
-		//
-		return directives;
-	}
-
-	public CorporateDirectives propertiesChanged(Hashtable newData, Hashtable oldData,
-				String topicmapID, String viewmode, Session session) throws DeepaMehtaException {
-		try {
-			System.out.println(&quot;&gt;&gt;&gt; DataSourceTopic.propertiesChanged(): connection &quot; +
-				&quot;parameters changed from &quot; + oldData + &quot; to &quot; + newData + &quot; -- reopen &quot; +
-				&quot;corporate datasource&quot;);
-			//
-			CorporateDirectives directives = super.propertiesChanged(newData, oldData,
-				topicmapID, viewmode, session);
-			// --- reopen the corporate datasource ---
-			openCorporateDatasource();		// throws TopicInitException
-			// --- inform all associated consumers of this datasource ---
-			Vector consumerTypes = as.dataConsumerTypes(getID());
-			Enumeration e = consumerTypes.elements();
-			BaseTopic consumerType;
-			Enumeration consumers;
-			int topicCount;	// reporting only
-			int initCount;	// reporting only
-			String consumerID;
-			LiveTopic consumer;
-			// loop through all topic types who consumes from this datasource
-			while (e.hasMoreElements()) {
-				consumerType = (BaseTopic) e.nextElement();
-				// get all instances of that type in the current topicmap
-				consumers = cm.getTopicIDs(consumerType.getID(), topicmapID).elements();
-				//
-				topicCount = 0;
-				initCount = 0;
-				// loop through all instances
-				while (consumers.hasMoreElements()) {
-					topicCount++;
-					consumerID = (String) consumers.nextElement();
-					// ### version is set to 1
-					// ### may throw DeepaMehtaException
-					consumer = as.getLiveTopic(consumerID, 1);
-					if (reinitializeDataconsumer(consumer, directives, session)) {
-						initCount++;
-					}
-				}
-				directives.add(DIRECTIVE_SHOW_MESSAGE, &quot;Datasource of &quot; +
-					initCount + &quot;/&quot; + topicCount + &quot; \&quot;&quot; + consumerType.getName() +
-					&quot;\&quot; topics reinitialized&quot;, new Integer(NOTIFICATION_DEFAULT));
-			}
-			return directives;
-		} catch (TopicInitException e2) {
-			throw new DeepaMehtaException(e2.getMessage());
-		}
-	}
-
-
-
-	// **********************
-	// *** Private Method ***
-	// **********************
-
-
-
-	/**
-	 * @see		#init
-	 * @see		#propertiesChanged
-	 */
-	private void openCorporateDatasource() throws TopicInitException {
-		this.url = getProperty(&quot;URL&quot;);
-		this.dbtype = getProperty(&quot;Database Type&quot;);
-		this.elements = getProperty(&quot;Entities&quot;);
-		this.idleElement = getProperty(&quot;Idle Elementtype&quot;);
-		this.username=getProperty(&quot;Username&quot;);
-		this.password=getProperty(&quot;Password&quot;);
-		//
-		String text = &quot;Datasource \&quot;&quot; + getName() + &quot;\&quot; not available &quot;;
-		// error check 1
-		if (url.equals(&quot;&quot;)) {
-			throw new TopicInitException(text + &quot;(URL not set)&quot;);
-		}
-		// error check 2
-		if (dbtype.equals(&quot;&quot;)) {
-			throw new TopicInitException(text + &quot;(Database Type not set)&quot;);
-		}
-		// ### passing text bad
-		if (url.startsWith(&quot;xml:&quot;)) {
-			// throws TopicInitException
-			this.myDataSource = createXMLSource(url, elements, text);
-		} else if (url.startsWith(&quot;jdbc:&quot;)) {
-			// throws TopicInitException
-			this.myDataSource = createSQLSource(url, dbtype, text);
-		} else if (url.startsWith(&quot;ldap:&quot;)) {
-			// throws TopicInitException
-			this.myDataSource = createLDAPSource(url, text);
-		} else {
-			throw new TopicInitException(text + &quot;(URL has unexpected protocol: \&quot;&quot; +
-				url + &quot;\&quot;&quot; + &quot; &gt;&gt;&gt; expected protocols are \&quot;jdbc:\&quot;, \&quot;xml:\&quot; and \&quot;ldap:\&quot;)&quot;);
-		}
-	}
-	
-	/** @return a new instance of CorporateXMLSource */
-	private CorporateDatasource createXMLSource(String url, String elements, String errmsg)
-																	throws TopicInitException {
-		// Note: the XML path is relative to servers working directory
-		String file = url.substring(4);
-		// --- open XML datasource ---
-		try {
-			return new CorporateXMLSource(file, elements);
-		} catch (SAXException e) {
-			throw new TopicInitException(errmsg + &quot;(Syntax error in \&quot;&quot; + file +
-				&quot;\&quot;: &quot; + e + &quot; &gt;&gt;&gt; Make sure attribute values are enclosed in \&quot;\&quot;)&quot;, e);
-		} catch (IOException e) {
-			throw new TopicInitException(errmsg + &quot;(&quot; + e + &quot;)&quot;, e);
-		}
-	}
-
-	/**
-	 * @return	a new instance of CorporateSQLSource
-	 */
-	private CorporateDatasource createSQLSource(String url, String dbtype, String errmsg)
-														throws TopicInitException {
-		//  --- open SQL datasource ---
-		try {
-			CorporateDatasource source = new CorporateSQLSource(url, dbtype, username, password);
-			startIdleThread();
-			return source;
-		} catch (ClassNotFoundException e) {
-			throw new TopicInitException(errmsg + &quot;(class not found: &quot; +
-				e.getMessage() + &quot;)&quot;, e);
-		} catch (Exception e) {
-			throw new TopicInitException(errmsg + &quot;(&quot; + e + &quot;)&quot;, e);
-		}
-	}
-
-	/**
-	 * @return	a new instance of CorporateLDAPSource
-	 */
-	private CorporateDatasource createLDAPSource(String url, String errmsg)
-														throws TopicInitException {
-		try {
-			return new CorporateLDAPSource(url);
-		} catch (Throwable e) {
-			throw new TopicInitException(errmsg + &quot;(&quot; + e + &quot;)&quot;);
-		}
-	}
-
-	/**
-	 * @see		#propertiesChanged
-	 */
-	private boolean reinitializeDataconsumer(LiveTopic consumer,
-								CorporateDirectives directives, Session session) {
-		try {
-			if (consumer instanceof DataConsumerTopic ||
-				consumer instanceof ElementContainerTopic) {
-				// reinitialize DataConsumerTopic
-				consumer.init(INITLEVEL_2, session);
-				return true;
-			} else {
-				String text = &quot;\&quot;&quot; + consumer.getName() + &quot;\&quot; is neither a &quot; +
-					&quot;DataConsumerTopic nor a ElementContainerTopic, but a &quot; +
-					consumer.getClass() + &quot; -- datasource not reinitialized&quot;;
-				System.out.println(&quot;*** DataSourceTopic.reinitializeDataconsumer(): &quot; +
-					text);
-				directives.add(DIRECTIVE_SHOW_MESSAGE, text,
-					new Integer(NOTIFICATION_WARNING));
-			}
-		} catch (DeepaMehtaException e) {
-			System.out.println(&quot;*** DataSourceTopic.reinitializeDataconsumer(): &quot; +
-				e.getMessage() + &quot; -- datasource of dataconsumer not &quot; +
-				&quot;properly reinitialized&quot;);
-			directives.add(DIRECTIVE_SHOW_MESSAGE, e.getMessage(),
-				new Integer(NOTIFICATION_ERROR));
-		} catch (TopicInitException e) {
-			System.out.println(&quot;*** DataSourceTopic.reinitializeDataconsumer(): &quot; +
-				e.getMessage() + &quot; -- datasource of dataconsumer not &quot; +
-				&quot;properly reinitialized&quot;);
-			directives.add(DIRECTIVE_SHOW_MESSAGE, e.getMessage(),
-				new Integer(NOTIFICATION_ERROR));
-		}
-		return false;
-	}
-
-	/**
-	 * @see		#openCorporateDatasource
-	 */
-	private void startIdleThread() {
-		// error check
-		if (idleElement.equals(&quot;&quot;)) {
-			System.out.println(&quot;*** \&quot;Idle Elementtype\&quot; not set for datasource \&quot;&quot; +
-				getName() + &quot;\&quot;&quot;);
-		}
-		//
-		if (idleThread == null) {
-			// ### System.out.print(&quot;&gt;    starting idle thread ... &quot;);
-			//
-			idleThread = new Thread(this);
-			idleThread.start();
-			//
-			// ### System.out.println(&quot;OK&quot;);
-		}
-	}
-}
+package de.deepamehta.topics;
+
+import de.deepamehta.BaseTopic;
+import de.deepamehta.DeepaMehtaException;
+import de.deepamehta.TopicInitException;
+import de.deepamehta.service.ApplicationService;
+import de.deepamehta.service.CorporateDatasource;
+import de.deepamehta.service.CorporateDirectives;
+import de.deepamehta.service.CorporateLDAPSource;
+import de.deepamehta.service.CorporateSQLSource;
+import de.deepamehta.service.CorporateXMLSource;
+import de.deepamehta.service.Session;
+
+import org.xml.sax.SAXException;
+
+import java.io.IOException;
+import java.util.Enumeration;
+import java.util.Hashtable;
+import java.util.Vector;
+
+
+
+/**
+ * This kernel topic represents a {@link de.deepamehta.service.CorporateDatasource}.
+ * &lt;P&gt;
+ * A &lt;CODE&gt;DataSourceTopic&lt;/CODE&gt; is associated to its {@link DataConsumerTopic}s by
+ * means of an association of type &lt;CODE&gt;at-association&lt;/CODE&gt; (direction is from
+ * data consumer to datasource).
+ * &lt;P&gt;
+ * &lt;HR&gt;
+ * Last functional change: 8.11.2004 (2.0b3)&lt;BR&gt;
+ * Last documentation update: 23.2.2001 (2.0a9-post1)&lt;BR&gt;
+ * J&ouml;rg Richter&lt;BR&gt;
+ * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>
+ */
+public class DataSourceTopic extends LiveTopic implements Runnable {
+
+
+
+	// **************
+	// *** Fields ***
+	// **************
+
+
+
+	// Note: the XML path is relative to servers working directory
+
+	protected String url;
+	protected String dbtype;
+	protected String elements;
+	protected String idleElement;
+
+	protected CorporateDatasource myDataSource;
+
+	/**
+	 * The idle thread.
+	 */
+	Thread idleThread;
+	private String username;
+	private String password;
+
+
+
+	// *******************
+	// *** Constructor ***
+	// *******************
+
+
+
+	public DataSourceTopic(BaseTopic topic, ApplicationService as) {
+		super(topic, as);
+	}
+
+
+
+	// ******************************************************
+	// *** Implementation of Interface java.lang.Runnable ***
+	// ******************************************************
+
+
+
+	/**
+	 * The body of the idle thread.
+	 */
+	public void run() {
+		while (true) {
+			try {
+				Thread.sleep(5 * 60 * 1000);	// interval is 5 min.
+				System.out.println(&quot;&gt; \&quot;&quot; + getName() + &quot;\&quot; statistics (\&quot;&quot; +
+					idleElement + &quot;\&quot;): &quot; + dataSource.getElementCount(idleElement));
+			} catch (InterruptedException e) {
+				System.out.println(&quot;*** DataSourceTopic.run(): &quot; + e);
+			} catch (Exception e) {
+				System.out.println(&quot;*** DataSourceTopic.run(): &quot; + e);
+			}
+		}
+	}
+
+
+
+	// ***************
+	// *** Methods ***
+	// ***************
+
+
+
+	/**
+	 * @see		DataConsumerTopic#setDataSource
+	 */
+	public String getURL() {
+		return url;
+	}
+
+	/**
+	 * @see		DataConsumerTopic#setDataSource
+	 */
+	public CorporateDatasource getDataSource() {
+		return myDataSource;
+	}
+
+
+
+	// ----------------------
+	// --- Defining Hooks ---
+	// ----------------------
+
+
+
+	/**
+	 * &lt;TABLE&gt;
+	 * &lt;TR&gt;&lt;TD&gt;&lt;B&gt;Called by&lt;/B&gt;&lt;/TD&gt;&lt;TD&gt;&lt;CODE&gt;initLevel&lt;/CODE&gt;&lt;/TD&gt;&lt;/TR&gt;
+	 * &lt;TR&gt;&lt;TD&gt;{@link de.deepamehta.service.ApplicationService#createLiveTopic}&lt;/TD&gt;&lt;TD&gt;1&lt;/TD&gt;&lt;/TR&gt;
+	 * &lt;TR&gt;&lt;TD&gt;{@link de.deepamehta.service.ApplicationService#initTopic}&lt;/TD&gt;&lt;TD&gt;variable&lt;/TD&gt;&lt;/TR&gt;
+	 * &lt;TR&gt;&lt;TD&gt;{@link de.deepamehta.service.ApplicationService#initTypeTopic}&lt;/TD&gt;&lt;TD&gt;3&lt;/TD&gt;&lt;/TR&gt;
+	 * &lt;/TABLE&gt;
+	 */
+	public CorporateDirectives init(int initLevel, Session session)
+															throws TopicInitException {
+		CorporateDirectives directives = super.init(initLevel, session);
+		//
+		if (initLevel == INITLEVEL_1) {
+			if (LOG_TOPIC_INIT) {
+				System.out.println(&quot;&gt;&gt;&gt; DataSourceTopic.init(&quot; + initLevel + &quot;): &quot; +
+					this + &quot; -- open corporate datasource&quot;);
+			}
+			openCorporateDatasource();		// throws TopicInitException
+		}
+		//
+		return directives;
+	}
+
+	public CorporateDirectives propertiesChanged(Hashtable newData, Hashtable oldData,
+				String topicmapID, String viewmode, Session session) throws DeepaMehtaException {
+		try {
+			System.out.println(&quot;&gt;&gt;&gt; DataSourceTopic.propertiesChanged(): connection &quot; +
+				&quot;parameters changed from &quot; + oldData + &quot; to &quot; + newData + &quot; -- reopen &quot; +
+				&quot;corporate datasource&quot;);
+			//
+			CorporateDirectives directives = super.propertiesChanged(newData, oldData,
+				topicmapID, viewmode, session);
+			// --- reopen the corporate datasource ---
+			openCorporateDatasource();		// throws TopicInitException
+			// --- inform all associated consumers of this datasource ---
+			Vector consumerTypes = as.dataConsumerTypes(getID());
+			Enumeration e = consumerTypes.elements();
+			BaseTopic consumerType;
+			Enumeration consumers;
+			int topicCount;	// reporting only
+			int initCount;	// reporting only
+			String consumerID;
+			LiveTopic consumer;
+			// loop through all topic types who consumes from this datasource
+			while (e.hasMoreElements()) {
+				consumerType = (BaseTopic) e.nextElement();
+				// get all instances of that type in the current topicmap
+				consumers = cm.getTopicIDs(consumerType.getID(), topicmapID).elements();
+				//
+				topicCount = 0;
+				initCount = 0;
+				// loop through all instances
+				while (consumers.hasMoreElements()) {
+					topicCount++;
+					consumerID = (String) consumers.nextElement();
+					// ### version is set to 1
+					// ### may throw DeepaMehtaException
+					consumer = as.getLiveTopic(consumerID, 1);
+					if (reinitializeDataconsumer(consumer, directives, session)) {
+						initCount++;
+					}
+				}
+				directives.add(DIRECTIVE_SHOW_MESSAGE, &quot;Datasource of &quot; +
+					initCount + &quot;/&quot; + topicCount + &quot; \&quot;&quot; + consumerType.getName() +
+					&quot;\&quot; topics reinitialized&quot;, new Integer(NOTIFICATION_DEFAULT));
+			}
+			return directives;
+		} catch (TopicInitException e2) {
+			throw new DeepaMehtaException(e2.getMessage());
+		}
+	}
+
+
+
+	// **********************
+	// *** Private Method ***
+	// **********************
+
+
+
+	/**
+	 * @see		#init
+	 * @see		#propertiesChanged
+	 */
+	private void openCorporateDatasource() throws TopicInitException {
+		this.url = getProperty(&quot;URL&quot;);
+		this.dbtype = getProperty(&quot;Database Type&quot;);
+		this.elements = getProperty(&quot;Entities&quot;);
+		this.idleElement = getProperty(&quot;Idle Elementtype&quot;);
+		this.username=getProperty(&quot;Username&quot;);
+		this.password=getProperty(&quot;Password&quot;);
+		//
+		String text = &quot;Datasource \&quot;&quot; + getName() + &quot;\&quot; not available &quot;;
+		// error check 1
+		if (url.equals(&quot;&quot;)) {
+			throw new TopicInitException(text + &quot;(URL not set)&quot;);
+		}
+		// error check 2
+		if (dbtype.equals(&quot;&quot;)) {
+			throw new TopicInitException(text + &quot;(Database Type not set)&quot;);
+		}
+		// ### passing text bad
+		if (url.startsWith(&quot;xml:&quot;)) {
+			// throws TopicInitException
+			this.myDataSource = createXMLSource(url, elements, text);
+		} else if (url.startsWith(&quot;jdbc:&quot;)) {
+			// throws TopicInitException
+			this.myDataSource = createSQLSource(url, dbtype, text);
+		} else if (url.startsWith(&quot;ldap:&quot;)) {
+			// throws TopicInitException
+			this.myDataSource = createLDAPSource(url, text);
+		} else {
+			throw new TopicInitException(text + &quot;(URL has unexpected protocol: \&quot;&quot; +
+				url + &quot;\&quot;&quot; + &quot; &gt;&gt;&gt; expected protocols are \&quot;jdbc:\&quot;, \&quot;xml:\&quot; and \&quot;ldap:\&quot;)&quot;);
+		}
+	}
+	
+	/** @return a new instance of CorporateXMLSource */
+	private CorporateDatasource createXMLSource(String url, String elements, String errmsg)
+																	throws TopicInitException {
+		// Note: the XML path is relative to servers working directory
+		String file = url.substring(4);
+		// --- open XML datasource ---
+		try {
+			return new CorporateXMLSource(file, elements);
+		} catch (SAXException e) {
+			throw new TopicInitException(errmsg + &quot;(Syntax error in \&quot;&quot; + file +
+				&quot;\&quot;: &quot; + e + &quot; &gt;&gt;&gt; Make sure attribute values are enclosed in \&quot;\&quot;)&quot;, e);
+		} catch (IOException e) {
+			throw new TopicInitException(errmsg + &quot;(&quot; + e + &quot;)&quot;, e);
+		}
+	}
+
+	/**
+	 * @return	a new instance of CorporateSQLSource
+	 */
+	private CorporateDatasource createSQLSource(String url, String dbtype, String errmsg)
+														throws TopicInitException {
+		//  --- open SQL datasource ---
+		try {
+			CorporateDatasource source = new CorporateSQLSource(url, dbtype, username, password);
+			startIdleThread();
+			return source;
+		} catch (ClassNotFoundException e) {
+			throw new TopicInitException(errmsg + &quot;(class not found: &quot; +
+				e.getMessage() + &quot;)&quot;, e);
+		} catch (Exception e) {
+			throw new TopicInitException(errmsg + &quot;(&quot; + e + &quot;)&quot;, e);
+		}
+	}
+
+	/**
+	 * @return	a new instance of CorporateLDAPSource
+	 */
+	private CorporateDatasource createLDAPSource(String url, String errmsg)
+														throws TopicInitException {
+		try {
+			return new CorporateLDAPSource(url);
+		} catch (Throwable e) {
+			throw new TopicInitException(errmsg + &quot;(&quot; + e + &quot;)&quot;);
+		}
+	}
+
+	/**
+	 * @see		#propertiesChanged
+	 */
+	private boolean reinitializeDataconsumer(LiveTopic consumer,
+								CorporateDirectives directives, Session session) {
+		try {
+			if (consumer instanceof DataConsumerTopic ||
+				consumer instanceof ElementContainerTopic) {
+				// reinitialize DataConsumerTopic
+				consumer.init(INITLEVEL_2, session);
+				return true;
+			} else {
+				String text = &quot;\&quot;&quot; + consumer.getName() + &quot;\&quot; is neither a &quot; +
+					&quot;DataConsumerTopic nor a ElementContainerTopic, but a &quot; +
+					consumer.getClass() + &quot; -- datasource not reinitialized&quot;;
+				System.out.println(&quot;*** DataSourceTopic.reinitializeDataconsumer(): &quot; +
+					text);
+				directives.add(DIRECTIVE_SHOW_MESSAGE, text,
+					new Integer(NOTIFICATION_WARNING));
+			}
+		} catch (DeepaMehtaException e) {
+			System.out.println(&quot;*** DataSourceTopic.reinitializeDataconsumer(): &quot; +
+				e.getMessage() + &quot; -- datasource of dataconsumer not &quot; +
+				&quot;properly reinitialized&quot;);
+			directives.add(DIRECTIVE_SHOW_MESSAGE, e.getMessage(),
+				new Integer(NOTIFICATION_ERROR));
+		} catch (TopicInitException e) {
+			System.out.println(&quot;*** DataSourceTopic.reinitializeDataconsumer(): &quot; +
+				e.getMessage() + &quot; -- datasource of dataconsumer not &quot; +
+				&quot;properly reinitialized&quot;);
+			directives.add(DIRECTIVE_SHOW_MESSAGE, e.getMessage(),
+				new Integer(NOTIFICATION_ERROR));
+		}
+		return false;
+	}
+
+	/**
+	 * @see		#openCorporateDatasource
+	 */
+	private void startIdleThread() {
+		// error check
+		if (idleElement.equals(&quot;&quot;)) {
+			System.out.println(&quot;*** \&quot;Idle Elementtype\&quot; not set for datasource \&quot;&quot; +
+				getName() + &quot;\&quot;&quot;);
+		}
+		//
+		if (idleThread == null) {
+			// ### System.out.print(&quot;&gt;    starting idle thread ... &quot;);
+			//
+			idleThread = new Thread(this);
+			idleThread.start();
+			//
+			// ### System.out.println(&quot;OK&quot;);
+		}
+	}
+}

Modified: branches/eschnepel/develop/src/de/deepamehta/topics/ElementContainerTopic.java
===================================================================
--- branches/eschnepel/develop/src/de/deepamehta/topics/ElementContainerTopic.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/develop/src/de/deepamehta/topics/ElementContainerTopic.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,471 +1,471 @@
-package de.deepamehta.topics;
-
-import de.deepamehta.BaseTopic;
-import de.deepamehta.DeepaMehtaException;
-import de.deepamehta.PresentableAssociation;
-import de.deepamehta.PresentableTopic;
-import de.deepamehta.TopicInitException;
-import de.deepamehta.service.ApplicationService;
-import de.deepamehta.service.CorporateDirectives;
-import de.deepamehta.service.Session;
-
-import java.util.Enumeration;
-import java.util.Hashtable;
-import java.util.Vector;
-
-
-
-/**
- * A container representing a set of elements existing in a
- * {@link de.deepamehta.service.CorporateDatasource corporate datasource}.
- * &lt;P&gt;
- * An &lt;CODE&gt;ElementContainerTopic&lt;/CODE&gt; provides the behavoir of replicating datasource
- * elements into topics along with properties.
- * &lt;P&gt;
- * &lt;HR&gt;
- * Last functional change: 27.11.2004 (2.0b4)&lt;BR&gt;
- * Last documentation update: 16.11.2000 (2.0a7-pre3)&lt;BR&gt;
- * J&ouml;rg Richter&lt;BR&gt;
- * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>
- */
-public abstract class ElementContainerTopic extends ContainerTopic {
-
-
-
-	// *******************
-	// *** Constructor ***
-	// *******************
-
-
-
-	public ElementContainerTopic(BaseTopic topic, ApplicationService as) {
-		super(topic, as);
-	}
-
-
-
-	// ***********************
-	// *** Abstract Method ***
-	// ***********************
-
-
-
-	/**
-	 * When creating a topic name from an element: returns the elements attribute
-	 * to be used as name. ### meanwhile we have a general naming policy
-	 */
-	protected abstract String getNameAttribute();
-
-
-
-	// **********************
-	// *** Defining Hooks ***
-	// **********************
-
-
-
-	// ------------------
-	// --- Life Cycle ---
-	// ------------------
-
-
-
-	public CorporateDirectives init(int initLevel, Session session) throws TopicInitException {
-		CorporateDirectives directives = super.init(initLevel, session);
-		//
-		if (initLevel == INITLEVEL_2) {
-			if (LOG_TOPIC_INIT) {
-				System.out.println(&quot;&gt;&gt;&gt; ElementContainerTopic.init(&quot; + initLevel +
-					&quot;): &quot; + this + &quot; -- sets data source&quot;);
-			}
-			setDataSource(session, directives);
-		}
-		//
-		return directives;
-	}
-
-
-
-	// ************************
-	// *** Protected Method ***
-	// ************************
-
-
-
-	/**
-	 * Sublasses can override to perform some transformation upon the enetered data e.g.
-	 * perform lookup in foreign tables and replace foreign values by its foregin keys.
-	 * &lt;P&gt;
-	 * ### This is a hook method introduced in this class
-	 * &lt;P&gt;
-	 * Subclasses can return &lt;CODE&gt;null&lt;/CODE&gt; in case of failed lookup to signalize
-	 * the main query to halt.
-	 * &lt;P&gt;
-	 * Look inside the source of the {@link AdresseContainerTopic} to see how it performs
-	 * the country lookup in a foreign table.
-	 * &lt;P&gt;
-	 * The default implementation returns the entered data directly.
-	 *
-	 * @see		#processQuery
-	 */
-	protected Hashtable queryData(Hashtable formData) {
-		return formData;
-	}
-
-
-
-	// ************************************************************
-	// *** Implementation of abstract methods of ContainerTopic ***
-	// ************************************************************
-
-
-
-	// Note: getContentType() and getContentTypeID() remain abstract in this class
-	// and must be implemented in the subclasses of ElementContainerTopic
-	// ### this isn't necessary anymore because meanwhile there is a association
-	// (type &quot;aggregation&quot; between the container type and the element type)
-
-
-
-	/**
-	 * Retriggers the search and returns the result elements.
-	 * 
-	 * @return	result elements as vector of 2-element &lt;CODE&gt;String&lt;/CODE&gt; arrays:&lt;BR&gt;
-	 *			element 1: element ID&lt;BR&gt;
-	 *			element 2: element name
-	 *
-	 * @see		ContainerTopic#contextCommands
-	 * @see		ContainerTopic#getDetail
-	 */
-	protected Vector getContent() throws DeepaMehtaException {
-		try {
-			// error check
-			if (dataSource == null) {
-				throw new DeepaMehtaException(&quot;the datasource of &quot; + this + &quot; is not known&quot;);
-			}
-			// --- query the datasource ---
-			Vector elements = getElements(containerPropertyFilter, containerRelatedTopic);	// ### queryData()
-			int topicCount = elements.size();
-			//
-			System.out.println(&quot;&gt; ElementContainerTopic.getContent(): &quot; + containerPropertyFilter + &quot; -- &quot; + topicCount + &quot; elements found&quot;);
-			//
-			// --- build list of elements ---
-			Vector topicEntries = new Vector();
-			Enumeration e = elements.elements();
-			while (e.hasMoreElements()) {
-				Hashtable attributes = (Hashtable) e.nextElement();
-				String[] topicEntry = new String[2];
-				topicEntry[0] = (String) attributes.get(&quot;ID&quot;);		// ### hardcoded
-				topicEntry[1] = topicName(attributes, getNameAttribute());
-				topicEntries.addElement(topicEntry);
-			}
-			//
-			return topicEntries;
-		} catch (Exception e) {
-			throw new DeepaMehtaException(&quot;error while retrieving content of &quot; + this + &quot; (&quot; + e + &quot;)&quot;);
-		}
-	}
-
-	protected int getContentSize() {
-		try {
-			return getElementCount(containerPropertyFilter, containerRelatedTopic);
-		} catch (Exception e) {
-			System.out.println(&quot;*** ElementContainerTopic.getContentSize(): &quot; + e);
-			return 0;
-		}
-	}
-
-	// Note: id is the element ID, not a topicID
-	protected String getAppearance(String id, String name, Session session,
-													CorporateDirectives directives) {
-		// ### inidividual appearance of already evoked elements is not considered.
-		// ### the version is set to 1
-		// &gt;&gt;&gt; compare to TopicContainerTopic.getAppearance()
-		// ### as.checkLiveTopic(new BaseTopic(id, 1, getContentTypeID(), 1, name), session, directives);
-		return as.getIconfile(getContentTypeID(), 1);	// ### was (id, 1)
-	}
-
-	/**
-	 * @param	propertyFilter		must not be null
-	 *
-	 * @throws	DeepaMehtaException	if this container doesn't know its data source
-	 *
-	 * @see		ContainerTopic#triggerQuery
-	 * @see		ContainerTopic#executeCommand
-	 */
-	protected CorporateDirectives processQuery(String nameFilter, Hashtable propertyFilter,
-									BaseTopic relatedTopic, String relatedTopicSemantic, String topicmapID) throws DeepaMehtaException {
-		// error check 1
-		if (dataSource == null) {
-			throw new DeepaMehtaException(&quot;the datasource of &quot; + this + &quot; is not known&quot;);
-		}
-		//
-		CorporateDirectives directives = new CorporateDirectives();
-		// ### perform possible tranformation upon eneterd form data to obtain the
-		// actual query -- this feature is only used by subclasses
-		Hashtable attributes = queryData(propertyFilter);
-		//
-		if (attributes == null) {
-			System.out.println(&quot;&gt;&gt;&gt; ElementContainerTopic.processQuery(): subquery of &quot; + this +
-				&quot; returns nothing -- performing main query aborted&quot;);
-			directives.add(DIRECTIVE_PLAY_SOUND, NOTIFICATION_SOUNDS[SOUND_NO_RESULT]);
-			return directives;
-		}
-		// error check 2
-		if (relatedTopic != null &amp;&amp; attributes.size() &gt; 0) {
-			throw new DeepaMehtaException(&quot;property filter and relation filter of &quot; + this +
-				&quot; are set at the same time -- not yet implemented&quot;);
-		}
-		//
-		try {
-			// --- query the data source ---
-			int elementCount = getElementCount(attributes, relatedTopic);
-			Vector topics = null;
-			if (elementCount &lt;= MAX_REVEALING) {
-				Vector elements = getElements(attributes, relatedTopic);
-				topics = createTopicsFromElements(elements);
-			}
-			//
-			System.out.println(&quot;&gt; ElementContainerTopic.processQuery(): &quot; + attributes +
-				&quot; -- &quot; + elementCount + &quot; elements found&quot;);
-			//
-			String relTopicID = relatedTopic == null ? &quot;&quot; : relatedTopic.getID();
-			directives.add(as.createNewContainer(this, getType(), nameFilter, propertyFilter, relTopicID,
-				relatedTopicSemantic, elementCount, topics, true));		// evokeContent=true
-			//
-			return directives;
-		} catch (Exception e) {
-			e.printStackTrace();
-			throw new DeepaMehtaException(&quot;error while retrieving content of &quot; + this + &quot; (&quot; + e + &quot;)&quot;);
-		}
-	}
-
-	/**
-	 * @see		de.deepamehta.movies.topics.MovieContainerTopic#executeCommand
-	 */
-	protected CorporateDirectives autoSearch(String groupingField) {
-		CorporateDirectives directives = new CorporateDirectives();
-		// check if this container is already narrowed by the grouping field
-		// if so, no further grouping is possible
-		if (containerPropertyFilter.containsKey(groupingField)) {
-			System.out.println(&quot;&gt;&gt;&gt; ElementContainerTopic.autoSearch(): The container &quot; +
-				&quot;\&quot;&quot; + getName() + &quot;\&quot; is already narrowed by \&quot;&quot; + groupingField +
-				&quot;\&quot; -- no further grouping possible&quot;);
-			directives.add(DIRECTIVE_SHOW_MESSAGE, &quot;The container \&quot;&quot; +
-				getName() + &quot;\&quot; is already narrowed by \&quot;&quot; + groupingField + &quot;\&quot; -- &quot; +
-				&quot;no further grouping possible&quot;, new Integer(NOTIFICATION_DEFAULT));
-			return directives;
-		}
-		// error check
-		if (dataSource == null) {
-			throw new DeepaMehtaException(&quot;*** ElementContainerTopic.autoSearch(): &quot; +
-				this + &quot; has no data source -- grouping not possible&quot;);
-		}
-		//
-		try {
-			// query the data source for groups
-			Vector groups = dataSource.queryGroups(getContentType(),
-				containerPropertyFilter, groupingField);
-			int groupCount = groups.size();
-			System.out.println(&quot;&gt;&gt;&gt; ElementContainerTopic.autoSearch(): \&quot;&quot; +
-				containerPropertyFilter + &quot;\&quot; -- &quot; + groupCount + &quot; groups found&quot;);
-			// check if groups are found
-			if (groupCount == 0) {
-				return directives;
-			}
-			// check if the result is too extensive
-			// ### if so, the visualization is just truncated for the moment -- required
-			// is more intelligent grouping
-			if (groupCount &gt; MAX_REVEALING) {
-				System.out.println(&quot;&gt;&gt;&gt; ElementContainerTopic.autoSearch(): There are &quot; +
-					groupCount + &quot; \&quot;&quot; + groupingField + &quot;\&quot; groups -- only &quot; +
-					MAX_REVEALING + &quot; are shown&quot;);
-				directives.add(DIRECTIVE_SHOW_MESSAGE, &quot;There are &quot; + groupCount + &quot; \&quot;&quot; +
-					groupingField + &quot;\&quot; groups -- only &quot; + MAX_REVEALING + &quot; are shown&quot;,
-					new Integer(NOTIFICATION_DEFAULT));
-			}
-			// determine query elements
-			String queryElements = as.queryElements(containerPropertyFilter);
-			if (queryElements.length() &gt; 0) {
-				queryElements += &quot;,&quot;;
-			}
-			queryElements += groupingField;
-			// determine basename for group
-			String groupname = as.queryString(containerPropertyFilter);
-			if (groupname.length() &gt; 0) {
-				groupname += &quot;, &quot;;
-			}
-			// --- visualize result set ---
-			System.out.println(&quot;&gt; ElementContainerTopic.autoSearch(): &quot; + groupingField +
-				&quot;: query elements of subcontainers: \&quot;&quot; + queryElements + &quot;\&quot;&quot;);
-			String[] group;
-			PresentableTopic topic;
-			PresentableAssociation assoc;
-			// loop through the groups
-			for (int i = 0; i &lt; Math.min(groupCount, MAX_REVEALING); i++) {
-				group = (String[]) groups.elementAt(i);
-				// create new container representing the group
-				topic = createNewContainer(&quot;\&quot;&quot; + groupname + group[0] + &quot;\&quot;&quot;, getType(),
-					groupingField, group[0], queryElements, containerPropertyFilter, group[1]);
-				// associate the group container with this container
-				assoc = as.createPresentableAssociation(SEMANTIC_CONTAINER_HIERARCHY,
-					getID(), getVersion(), topic.getID(), 1, false);
-				// DIRECTIVE_SHOW_TOPIC causes the client to show the respective group as a
-				// container. DIRECTIVE_SHOW_ASSOCIATION causes the client to associate
-				// the group with this container
-				directives.add(DIRECTIVE_SHOW_TOPIC, topic, Boolean.TRUE);
-				directives.add(DIRECTIVE_SHOW_ASSOCIATION, assoc, Boolean.TRUE);
-			}
-			return directives;
-		} catch (Exception e) {
-			throw new DeepaMehtaException(&quot;*** ElementContainerTopic.autoSearch(): &quot; +
-				&quot;content of &quot; + this + &quot; not available (&quot; + e + &quot;)&quot;);
-		}
-	}
-
-	/**
-	 * @see		ContainerTopic#executeCommand
-	 */
-	protected String revealTopic(String id, String topicmapID, CorporateDirectives directives) throws DeepaMehtaException {
-		try {
-			// query the data source
-			Hashtable elementData = dataSource.queryElement(getContentType(), id);
-			//
-			PresentableTopic topic = createTopicFromElement(id, elementData);
-			String topicID = topic.getID();
-			PresentableAssociation assoc = as.createPresentableAssociation(SEMANTIC_CONTAINER_HIERARCHY,
-				getID(), getVersion(), topicID, 1, true);
-			directives.add(DIRECTIVE_SHOW_TOPIC, topic, Boolean.TRUE);
-			directives.add(DIRECTIVE_SHOW_ASSOCIATION, assoc, Boolean.TRUE);
-			directives.add(DIRECTIVE_SELECT_TOPIC, topicID);
-			//
-			return topicID;
-		} catch (Exception e) {
-			e.printStackTrace();
-			throw new DeepaMehtaException(&quot;*** ElementContainerTopic.revealTopic(): &quot; +
-				&quot;topic \&quot;&quot; + id + &quot;\&quot; not revealed (&quot; + e + &quot;)&quot;, e);
-		}
-	}
-
-
-
-	// ***********************
-	// *** Private Methods ***
-	// ***********************
-
-
-
-	/**
-	 * @see		#getContent
-	 * @see		#processQuery
-	 */
-	private Vector getElements(Hashtable attributes, BaseTopic relatedTopic) throws Exception {
-		if (relatedTopic == null) {
-			return dataSource.queryElements(getContentType(), attributes, false);	// caseSensitiv=false, throws Exception
-		} else {
-			return ((DataConsumerTopic) as.getLiveTopic(relatedTopic)).getRelatedElements(getContentTypeID());
-		}
-	}
-
-	private int getElementCount(Hashtable attributes, BaseTopic relatedTopic) throws Exception {
-		if (relatedTopic == null) {
-			return dataSource.getElementCount(getContentType(), attributes, false);	// caseSensitiv=false, throws Exception
-		} else {
-			return ((DataConsumerTopic) as.getLiveTopic(relatedTopic)).getRelatedElementCount(getContentTypeID());
-		}
-	}
-
-	// ---
-
-	/**
-	 * @return	The topic ID of the newly created container or &lt;CODE&gt;null&lt;/CODE&gt; of no
-	 *			container was created.
-	 *
-	 * @see		#autoSearch
-	 */
-	private PresentableTopic createNewContainer(String containerName, String containerType,
-												String groupingField, String groupingValue,
-												String queryElements, Hashtable formData, String foundStr) {
-		// create topic data
-		Hashtable topicData;
-		topicData = (Hashtable) formData.clone();
-		topicData.put(groupingField, groupingValue);
-		topicData.put(&quot;QueryElements&quot;, queryElements);
-		topicData.put(&quot;ElementCount&quot;, foundStr);
-		// create new container topic
-		String containerID = cm.getNewTopicID();
-		// the version of a new container topic is 1
-		// ### the version of the type is set to 1
-		// ### the container should not created in corporate memory here but while
-		// CorporateDirectives.updateCorporateMemory() -- not possible until we
-		// have further information in directives regarding the server only
-		cm.createTopic(containerID, 1, containerType, 1, containerName);
-		cm.setTopicData(containerID, 1, topicData);
-		//
-		return new PresentableTopic(containerID, 1, containerType, 1, containerName, getID(), foundStr);
-	}
-
-	// ---
-
-	/**
-	 * Creates {@link de.deepamehta.PresentableTopic}s corresponding to the
-	 * elements in the specified vector.
-	 * &lt;P&gt;
-	 * Presumption 1: there are not more than {@link #MAX_REVEALING} elements.&lt;BR&gt;
-	 * Presumption 2: the element data contain a field &lt;CODE&gt;ID&lt;/CODE&gt;.
-	 *
-	 * @return	Vector of {@link de.deepamehta.PresentableTopic}
-	 *
-	 * @see		#processQuery
-	 */
-	private Vector createTopicsFromElements(Vector elements) {
-		Vector topics = new Vector();
-		//
-		Enumeration e = elements.elements();
-		while (e.hasMoreElements()) {
-			Hashtable elementData = (Hashtable) e.nextElement();
-			String elementID = (String) elementData.get(&quot;ID&quot;);		// ### hardcoded
-			// create topics in corporate memory (storage layer)
-			PresentableTopic topic = createTopicFromElement(elementID, elementData);
-			// add PresentableTopic to result
-			topics.addElement(topic);
-		}
-		//
-		return topics;
-	}
-
-	/**
-	 * Creates a topic from an element.&lt;BR&gt;
-	 * The elements attributes are stored as topic properties.
-	 * &lt;P&gt;
-	 * To possibly unifying the element with an existing topic the topic ID is constructed programatically
-	 * involving the elements type as well as the elements ID.
-	 * ### This is probably not sufficient resp. unique. The datasource could be involved too.
-	 *
-	 * @see		#revealTopic
-	 * @see		#createTopicsFromElements
-	 */
-	private PresentableTopic createTopicFromElement(String elementID, Hashtable elementData) {
-		// ### compare to DataConsumerTopic.createTopicFromElement()
-		String topicID = createTopicID(elementID);					// build identifier as topic id
-		String typeID = getContentTypeID();
-		String name = topicName(elementData, getNameAttribute());	// ### there is new naming policy
-		PresentableTopic topic = new PresentableTopic(topicID, 1, typeID, 1, name, getID(), &quot;&quot;);
-		// --- trigger makeProperties() hook ---
-		Hashtable props = as.triggerMakeProperties(typeID, elementData);
-		topic.setProperties(props);
-		topic.setVirtual(true);
-		//
-		return topic;
-	}
-
-	/**
-	 * Creates a unique topic ID for an element.
-	 *
-	 * @see		#createTopicFromElement
-	 */
-	protected String createTopicID(String elementID) {
-		// &gt;&gt;&gt; compare to DataConsumerTopic.createTopicID()
-		return &quot;t-&quot; + getContentType() + &quot;-&quot; + elementID;
-	}
-}
+package de.deepamehta.topics;
+
+import de.deepamehta.BaseTopic;
+import de.deepamehta.DeepaMehtaException;
+import de.deepamehta.PresentableAssociation;
+import de.deepamehta.PresentableTopic;
+import de.deepamehta.TopicInitException;
+import de.deepamehta.service.ApplicationService;
+import de.deepamehta.service.CorporateDirectives;
+import de.deepamehta.service.Session;
+
+import java.util.Enumeration;
+import java.util.Hashtable;
+import java.util.Vector;
+
+
+
+/**
+ * A container representing a set of elements existing in a
+ * {@link de.deepamehta.service.CorporateDatasource corporate datasource}.
+ * &lt;P&gt;
+ * An &lt;CODE&gt;ElementContainerTopic&lt;/CODE&gt; provides the behavoir of replicating datasource
+ * elements into topics along with properties.
+ * &lt;P&gt;
+ * &lt;HR&gt;
+ * Last functional change: 27.11.2004 (2.0b4)&lt;BR&gt;
+ * Last documentation update: 16.11.2000 (2.0a7-pre3)&lt;BR&gt;
+ * J&ouml;rg Richter&lt;BR&gt;
+ * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>
+ */
+public abstract class ElementContainerTopic extends ContainerTopic {
+
+
+
+	// *******************
+	// *** Constructor ***
+	// *******************
+
+
+
+	public ElementContainerTopic(BaseTopic topic, ApplicationService as) {
+		super(topic, as);
+	}
+
+
+
+	// ***********************
+	// *** Abstract Method ***
+	// ***********************
+
+
+
+	/**
+	 * When creating a topic name from an element: returns the elements attribute
+	 * to be used as name. ### meanwhile we have a general naming policy
+	 */
+	protected abstract String getNameAttribute();
+
+
+
+	// **********************
+	// *** Defining Hooks ***
+	// **********************
+
+
+
+	// ------------------
+	// --- Life Cycle ---
+	// ------------------
+
+
+
+	public CorporateDirectives init(int initLevel, Session session) throws TopicInitException {
+		CorporateDirectives directives = super.init(initLevel, session);
+		//
+		if (initLevel == INITLEVEL_2) {
+			if (LOG_TOPIC_INIT) {
+				System.out.println(&quot;&gt;&gt;&gt; ElementContainerTopic.init(&quot; + initLevel +
+					&quot;): &quot; + this + &quot; -- sets data source&quot;);
+			}
+			setDataSource(session, directives);
+		}
+		//
+		return directives;
+	}
+
+
+
+	// ************************
+	// *** Protected Method ***
+	// ************************
+
+
+
+	/**
+	 * Sublasses can override to perform some transformation upon the enetered data e.g.
+	 * perform lookup in foreign tables and replace foreign values by its foregin keys.
+	 * &lt;P&gt;
+	 * ### This is a hook method introduced in this class
+	 * &lt;P&gt;
+	 * Subclasses can return &lt;CODE&gt;null&lt;/CODE&gt; in case of failed lookup to signalize
+	 * the main query to halt.
+	 * &lt;P&gt;
+	 * Look inside the source of the {@link AdresseContainerTopic} to see how it performs
+	 * the country lookup in a foreign table.
+	 * &lt;P&gt;
+	 * The default implementation returns the entered data directly.
+	 *
+	 * @see		#processQuery
+	 */
+	protected Hashtable queryData(Hashtable formData) {
+		return formData;
+	}
+
+
+
+	// ************************************************************
+	// *** Implementation of abstract methods of ContainerTopic ***
+	// ************************************************************
+
+
+
+	// Note: getContentType() and getContentTypeID() remain abstract in this class
+	// and must be implemented in the subclasses of ElementContainerTopic
+	// ### this isn't necessary anymore because meanwhile there is a association
+	// (type &quot;aggregation&quot; between the container type and the element type)
+
+
+
+	/**
+	 * Retriggers the search and returns the result elements.
+	 * 
+	 * @return	result elements as vector of 2-element &lt;CODE&gt;String&lt;/CODE&gt; arrays:&lt;BR&gt;
+	 *			element 1: element ID&lt;BR&gt;
+	 *			element 2: element name
+	 *
+	 * @see		ContainerTopic#contextCommands
+	 * @see		ContainerTopic#getDetail
+	 */
+	protected Vector getContent() throws DeepaMehtaException {
+		try {
+			// error check
+			if (dataSource == null) {
+				throw new DeepaMehtaException(&quot;the datasource of &quot; + this + &quot; is not known&quot;);
+			}
+			// --- query the datasource ---
+			Vector elements = getElements(containerPropertyFilter, containerRelatedTopic);	// ### queryData()
+			int topicCount = elements.size();
+			//
+			System.out.println(&quot;&gt; ElementContainerTopic.getContent(): &quot; + containerPropertyFilter + &quot; -- &quot; + topicCount + &quot; elements found&quot;);
+			//
+			// --- build list of elements ---
+			Vector topicEntries = new Vector();
+			Enumeration e = elements.elements();
+			while (e.hasMoreElements()) {
+				Hashtable attributes = (Hashtable) e.nextElement();
+				String[] topicEntry = new String[2];
+				topicEntry[0] = (String) attributes.get(&quot;ID&quot;);		// ### hardcoded
+				topicEntry[1] = topicName(attributes, getNameAttribute());
+				topicEntries.addElement(topicEntry);
+			}
+			//
+			return topicEntries;
+		} catch (Exception e) {
+			throw new DeepaMehtaException(&quot;error while retrieving content of &quot; + this + &quot; (&quot; + e + &quot;)&quot;);
+		}
+	}
+
+	protected int getContentSize() {
+		try {
+			return getElementCount(containerPropertyFilter, containerRelatedTopic);
+		} catch (Exception e) {
+			System.out.println(&quot;*** ElementContainerTopic.getContentSize(): &quot; + e);
+			return 0;
+		}
+	}
+
+	// Note: id is the element ID, not a topicID
+	protected String getAppearance(String id, String name, Session session,
+													CorporateDirectives directives) {
+		// ### inidividual appearance of already evoked elements is not considered.
+		// ### the version is set to 1
+		// &gt;&gt;&gt; compare to TopicContainerTopic.getAppearance()
+		// ### as.checkLiveTopic(new BaseTopic(id, 1, getContentTypeID(), 1, name), session, directives);
+		return as.getIconfile(getContentTypeID(), 1);	// ### was (id, 1)
+	}
+
+	/**
+	 * @param	propertyFilter		must not be null
+	 *
+	 * @throws	DeepaMehtaException	if this container doesn't know its data source
+	 *
+	 * @see		ContainerTopic#triggerQuery
+	 * @see		ContainerTopic#executeCommand
+	 */
+	protected CorporateDirectives processQuery(String nameFilter, Hashtable propertyFilter,
+									BaseTopic relatedTopic, String relatedTopicSemantic, String topicmapID) throws DeepaMehtaException {
+		// error check 1
+		if (dataSource == null) {
+			throw new DeepaMehtaException(&quot;the datasource of &quot; + this + &quot; is not known&quot;);
+		}
+		//
+		CorporateDirectives directives = new CorporateDirectives();
+		// ### perform possible tranformation upon eneterd form data to obtain the
+		// actual query -- this feature is only used by subclasses
+		Hashtable attributes = queryData(propertyFilter);
+		//
+		if (attributes == null) {
+			System.out.println(&quot;&gt;&gt;&gt; ElementContainerTopic.processQuery(): subquery of &quot; + this +
+				&quot; returns nothing -- performing main query aborted&quot;);
+			directives.add(DIRECTIVE_PLAY_SOUND, NOTIFICATION_SOUNDS[SOUND_NO_RESULT]);
+			return directives;
+		}
+		// error check 2
+		if (relatedTopic != null &amp;&amp; attributes.size() &gt; 0) {
+			throw new DeepaMehtaException(&quot;property filter and relation filter of &quot; + this +
+				&quot; are set at the same time -- not yet implemented&quot;);
+		}
+		//
+		try {
+			// --- query the data source ---
+			int elementCount = getElementCount(attributes, relatedTopic);
+			Vector topics = null;
+			if (elementCount &lt;= MAX_REVEALING) {
+				Vector elements = getElements(attributes, relatedTopic);
+				topics = createTopicsFromElements(elements);
+			}
+			//
+			System.out.println(&quot;&gt; ElementContainerTopic.processQuery(): &quot; + attributes +
+				&quot; -- &quot; + elementCount + &quot; elements found&quot;);
+			//
+			String relTopicID = relatedTopic == null ? &quot;&quot; : relatedTopic.getID();
+			directives.add(as.createNewContainer(this, getType(), nameFilter, propertyFilter, relTopicID,
+				relatedTopicSemantic, elementCount, topics, true));		// evokeContent=true
+			//
+			return directives;
+		} catch (Exception e) {
+			e.printStackTrace();
+			throw new DeepaMehtaException(&quot;error while retrieving content of &quot; + this + &quot; (&quot; + e + &quot;)&quot;);
+		}
+	}
+
+	/**
+	 * @see		de.deepamehta.movies.topics.MovieContainerTopic#executeCommand
+	 */
+	protected CorporateDirectives autoSearch(String groupingField) {
+		CorporateDirectives directives = new CorporateDirectives();
+		// check if this container is already narrowed by the grouping field
+		// if so, no further grouping is possible
+		if (containerPropertyFilter.containsKey(groupingField)) {
+			System.out.println(&quot;&gt;&gt;&gt; ElementContainerTopic.autoSearch(): The container &quot; +
+				&quot;\&quot;&quot; + getName() + &quot;\&quot; is already narrowed by \&quot;&quot; + groupingField +
+				&quot;\&quot; -- no further grouping possible&quot;);
+			directives.add(DIRECTIVE_SHOW_MESSAGE, &quot;The container \&quot;&quot; +
+				getName() + &quot;\&quot; is already narrowed by \&quot;&quot; + groupingField + &quot;\&quot; -- &quot; +
+				&quot;no further grouping possible&quot;, new Integer(NOTIFICATION_DEFAULT));
+			return directives;
+		}
+		// error check
+		if (dataSource == null) {
+			throw new DeepaMehtaException(&quot;*** ElementContainerTopic.autoSearch(): &quot; +
+				this + &quot; has no data source -- grouping not possible&quot;);
+		}
+		//
+		try {
+			// query the data source for groups
+			Vector groups = dataSource.queryGroups(getContentType(),
+				containerPropertyFilter, groupingField);
+			int groupCount = groups.size();
+			System.out.println(&quot;&gt;&gt;&gt; ElementContainerTopic.autoSearch(): \&quot;&quot; +
+				containerPropertyFilter + &quot;\&quot; -- &quot; + groupCount + &quot; groups found&quot;);
+			// check if groups are found
+			if (groupCount == 0) {
+				return directives;
+			}
+			// check if the result is too extensive
+			// ### if so, the visualization is just truncated for the moment -- required
+			// is more intelligent grouping
+			if (groupCount &gt; MAX_REVEALING) {
+				System.out.println(&quot;&gt;&gt;&gt; ElementContainerTopic.autoSearch(): There are &quot; +
+					groupCount + &quot; \&quot;&quot; + groupingField + &quot;\&quot; groups -- only &quot; +
+					MAX_REVEALING + &quot; are shown&quot;);
+				directives.add(DIRECTIVE_SHOW_MESSAGE, &quot;There are &quot; + groupCount + &quot; \&quot;&quot; +
+					groupingField + &quot;\&quot; groups -- only &quot; + MAX_REVEALING + &quot; are shown&quot;,
+					new Integer(NOTIFICATION_DEFAULT));
+			}
+			// determine query elements
+			String queryElements = as.queryElements(containerPropertyFilter);
+			if (queryElements.length() &gt; 0) {
+				queryElements += &quot;,&quot;;
+			}
+			queryElements += groupingField;
+			// determine basename for group
+			String groupname = as.queryString(containerPropertyFilter);
+			if (groupname.length() &gt; 0) {
+				groupname += &quot;, &quot;;
+			}
+			// --- visualize result set ---
+			System.out.println(&quot;&gt; ElementContainerTopic.autoSearch(): &quot; + groupingField +
+				&quot;: query elements of subcontainers: \&quot;&quot; + queryElements + &quot;\&quot;&quot;);
+			String[] group;
+			PresentableTopic topic;
+			PresentableAssociation assoc;
+			// loop through the groups
+			for (int i = 0; i &lt; Math.min(groupCount, MAX_REVEALING); i++) {
+				group = (String[]) groups.elementAt(i);
+				// create new container representing the group
+				topic = createNewContainer(&quot;\&quot;&quot; + groupname + group[0] + &quot;\&quot;&quot;, getType(),
+					groupingField, group[0], queryElements, containerPropertyFilter, group[1]);
+				// associate the group container with this container
+				assoc = as.createPresentableAssociation(SEMANTIC_CONTAINER_HIERARCHY,
+					getID(), getVersion(), topic.getID(), 1, false);
+				// DIRECTIVE_SHOW_TOPIC causes the client to show the respective group as a
+				// container. DIRECTIVE_SHOW_ASSOCIATION causes the client to associate
+				// the group with this container
+				directives.add(DIRECTIVE_SHOW_TOPIC, topic, Boolean.TRUE);
+				directives.add(DIRECTIVE_SHOW_ASSOCIATION, assoc, Boolean.TRUE);
+			}
+			return directives;
+		} catch (Exception e) {
+			throw new DeepaMehtaException(&quot;*** ElementContainerTopic.autoSearch(): &quot; +
+				&quot;content of &quot; + this + &quot; not available (&quot; + e + &quot;)&quot;);
+		}
+	}
+
+	/**
+	 * @see		ContainerTopic#executeCommand
+	 */
+	protected String revealTopic(String id, String topicmapID, CorporateDirectives directives) throws DeepaMehtaException {
+		try {
+			// query the data source
+			Hashtable elementData = dataSource.queryElement(getContentType(), id);
+			//
+			PresentableTopic topic = createTopicFromElement(id, elementData);
+			String topicID = topic.getID();
+			PresentableAssociation assoc = as.createPresentableAssociation(SEMANTIC_CONTAINER_HIERARCHY,
+				getID(), getVersion(), topicID, 1, true);
+			directives.add(DIRECTIVE_SHOW_TOPIC, topic, Boolean.TRUE);
+			directives.add(DIRECTIVE_SHOW_ASSOCIATION, assoc, Boolean.TRUE);
+			directives.add(DIRECTIVE_SELECT_TOPIC, topicID);
+			//
+			return topicID;
+		} catch (Exception e) {
+			e.printStackTrace();
+			throw new DeepaMehtaException(&quot;*** ElementContainerTopic.revealTopic(): &quot; +
+				&quot;topic \&quot;&quot; + id + &quot;\&quot; not revealed (&quot; + e + &quot;)&quot;, e);
+		}
+	}
+
+
+
+	// ***********************
+	// *** Private Methods ***
+	// ***********************
+
+
+
+	/**
+	 * @see		#getContent
+	 * @see		#processQuery
+	 */
+	private Vector getElements(Hashtable attributes, BaseTopic relatedTopic) throws Exception {
+		if (relatedTopic == null) {
+			return dataSource.queryElements(getContentType(), attributes, false);	// caseSensitiv=false, throws Exception
+		} else {
+			return ((DataConsumerTopic) as.getLiveTopic(relatedTopic)).getRelatedElements(getContentTypeID());
+		}
+	}
+
+	private int getElementCount(Hashtable attributes, BaseTopic relatedTopic) throws Exception {
+		if (relatedTopic == null) {
+			return dataSource.getElementCount(getContentType(), attributes, false);	// caseSensitiv=false, throws Exception
+		} else {
+			return ((DataConsumerTopic) as.getLiveTopic(relatedTopic)).getRelatedElementCount(getContentTypeID());
+		}
+	}
+
+	// ---
+
+	/**
+	 * @return	The topic ID of the newly created container or &lt;CODE&gt;null&lt;/CODE&gt; of no
+	 *			container was created.
+	 *
+	 * @see		#autoSearch
+	 */
+	private PresentableTopic createNewContainer(String containerName, String containerType,
+												String groupingField, String groupingValue,
+												String queryElements, Hashtable formData, String foundStr) {
+		// create topic data
+		Hashtable topicData;
+		topicData = (Hashtable) formData.clone();
+		topicData.put(groupingField, groupingValue);
+		topicData.put(&quot;QueryElements&quot;, queryElements);
+		topicData.put(&quot;ElementCount&quot;, foundStr);
+		// create new container topic
+		String containerID = cm.getNewTopicID();
+		// the version of a new container topic is 1
+		// ### the version of the type is set to 1
+		// ### the container should not created in corporate memory here but while
+		// CorporateDirectives.updateCorporateMemory() -- not possible until we
+		// have further information in directives regarding the server only
+		cm.createTopic(containerID, 1, containerType, 1, containerName);
+		cm.setTopicData(containerID, 1, topicData);
+		//
+		return new PresentableTopic(containerID, 1, containerType, 1, containerName, getID(), foundStr);
+	}
+
+	// ---
+
+	/**
+	 * Creates {@link de.deepamehta.PresentableTopic}s corresponding to the
+	 * elements in the specified vector.
+	 * &lt;P&gt;
+	 * Presumption 1: there are not more than {@link #MAX_REVEALING} elements.&lt;BR&gt;
+	 * Presumption 2: the element data contain a field &lt;CODE&gt;ID&lt;/CODE&gt;.
+	 *
+	 * @return	Vector of {@link de.deepamehta.PresentableTopic}
+	 *
+	 * @see		#processQuery
+	 */
+	private Vector createTopicsFromElements(Vector elements) {
+		Vector topics = new Vector();
+		//
+		Enumeration e = elements.elements();
+		while (e.hasMoreElements()) {
+			Hashtable elementData = (Hashtable) e.nextElement();
+			String elementID = (String) elementData.get(&quot;ID&quot;);		// ### hardcoded
+			// create topics in corporate memory (storage layer)
+			PresentableTopic topic = createTopicFromElement(elementID, elementData);
+			// add PresentableTopic to result
+			topics.addElement(topic);
+		}
+		//
+		return topics;
+	}
+
+	/**
+	 * Creates a topic from an element.&lt;BR&gt;
+	 * The elements attributes are stored as topic properties.
+	 * &lt;P&gt;
+	 * To possibly unifying the element with an existing topic the topic ID is constructed programatically
+	 * involving the elements type as well as the elements ID.
+	 * ### This is probably not sufficient resp. unique. The datasource could be involved too.
+	 *
+	 * @see		#revealTopic
+	 * @see		#createTopicsFromElements
+	 */
+	private PresentableTopic createTopicFromElement(String elementID, Hashtable elementData) {
+		// ### compare to DataConsumerTopic.createTopicFromElement()
+		String topicID = createTopicID(elementID);					// build identifier as topic id
+		String typeID = getContentTypeID();
+		String name = topicName(elementData, getNameAttribute());	// ### there is new naming policy
+		PresentableTopic topic = new PresentableTopic(topicID, 1, typeID, 1, name, getID(), &quot;&quot;);
+		// --- trigger makeProperties() hook ---
+		Hashtable props = as.triggerMakeProperties(typeID, elementData);
+		topic.setProperties(props);
+		topic.setVirtual(true);
+		//
+		return topic;
+	}
+
+	/**
+	 * Creates a unique topic ID for an element.
+	 *
+	 * @see		#createTopicFromElement
+	 */
+	protected String createTopicID(String elementID) {
+		// &gt;&gt;&gt; compare to DataConsumerTopic.createTopicID()
+		return &quot;t-&quot; + getContentType() + &quot;-&quot; + elementID;
+	}
+}

Modified: branches/eschnepel/develop/src/de/deepamehta/topics/EmailTopic.java
===================================================================
--- branches/eschnepel/develop/src/de/deepamehta/topics/EmailTopic.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/develop/src/de/deepamehta/topics/EmailTopic.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,440 +1,440 @@
-package de.deepamehta.topics;
-
-import de.deepamehta.BaseTopic;
-import de.deepamehta.DeepaMehtaException;
-import de.deepamehta.PresentableAssociation;
-import de.deepamehta.PresentableTopic;
-import de.deepamehta.service.ApplicationService;
-import de.deepamehta.service.CorporateCommands;
-import de.deepamehta.service.CorporateDirectives;
-import de.deepamehta.service.Session;
-
-import java.util.ArrayList;
-import java.util.Date;
-import java.util.Enumeration;
-import java.util.HashSet;
-import java.util.Hashtable;
-import java.util.Properties;
-import java.util.StringTokenizer;
-import java.util.Vector;
-
-import javax.activation.DataHandler;
-import javax.activation.FileDataSource;
-import javax.mail.Message;
-import javax.mail.MessagingException;
-import javax.mail.Multipart;
-import javax.mail.Transport;
-import javax.mail.internet.InternetAddress;
-import javax.mail.internet.MimeBodyPart;
-import javax.mail.internet.MimeMessage;
-import javax.mail.internet.MimeMultipart;
-
-
-
-/**
- * An email.
- * &lt;P&gt;
- * &lt;HR&gt;
- * Last sourcecode change: 27.9.2007 (2.0b8)&lt;BR&gt;
- * Last documentation update: 21.11.2001 (2.0a13-post1)&lt;BR&gt;
- * J&ouml;rg Richter&lt;BR&gt;
- * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>
- */
-public class EmailTopic extends LiveTopic {
-
-	private static final String TEXT_NO_SUBJECT = &quot;&lt;No Subject&gt;&quot;;
-
-	// email states
-	private static final String EMAIL_STATE_DRAFT = &quot;Draft&quot;;
-	private static final String EMAIL_STATE_RECEIVED = &quot;Received&quot;;
-	private static final String EMAIL_STATE_SENT = &quot;Sent&quot;;
-
-	// commands
-	private static final String ITEM_SEND = &quot;Send&quot;;
-	private static final String CMD_SEND = &quot;send&quot;;
-	private static final String ICON_SEND = &quot;sendEmail.gif&quot;;
-
-	private static final String ITEM_REPLY = &quot;Reply&quot;;
-	private static final String CMD_REPLY = &quot;reply&quot;;
-
-	private static final String ITEM_FORWARD = &quot;Forward&quot;;
-	private static final String CMD_FORWARD = &quot;forward&quot;;
-	
-	// &quot;Email&quot; -&gt; &quot;Recipient&quot; (User)
-	public static final String ASSOCTYPE_EMAILADDRESSEE = &quot;at-emailaddressee&quot;;	// ###
-	public static final String ASSOCTYPE_ATTACHEMENT = &quot;at-attachement&quot;;
-
-	public class LocateRcptsResult  {
-		public ArrayList	aRcpts;
-		public boolean		bUsedAttached;
-	}
-
-
-
-	// *******************
-	// *** Constructor ***
-	// *******************
-
-
-
-	public EmailTopic(BaseTopic topic, ApplicationService as) {
-		super(topic, as);
-	}
-
-
-
-	// **********************
-	// *** Defining Hooks ***
-	// **********************
-
-
-
-	// ------------------
-	// --- Life Cycle ---
-	// ------------------
-
-
-
-	public CorporateDirectives evoke(Session session, String topicmapID, String viewmode) {
-		CorporateDirectives directives = super.evoke(session, topicmapID, viewmode);
-		setTopicData(PROPERTY_STATUS, EMAIL_STATE_DRAFT);
-		String author = as.getEmailAddress(session.getUserID());	// may return null
-		if (author != null) {
-			setTopicData(PROPERTY_FROM, author);
-		}
-		as.createLiveAssociation(as.getNewAssociationID(), ASSOCTYPE_SENDER, getID(), session.getUserID(), session, directives);
-		return directives;
-	}
-
-
-
-	// --------------------------
-	// --- Providing Commands ---
-	// --------------------------
-
-
-
-	public CorporateCommands contextCommands(String topicmapID, String viewmode,
-								Session session, CorporateDirectives directives) {
-		CorporateCommands commands = new CorporateCommands(as);
-		//
-		int editorContext = as.editorContext(topicmapID);
-		commands.addNavigationCommands(this, editorContext, session);
-		// --- send/reply/forward ---
-		String s = getProperty(PROPERTY_STATUS);
-		commands.addSeparator();
-		if (s.equals(EMAIL_STATE_DRAFT)) {
-			commands.addCommand(ITEM_SEND, CMD_SEND, FILESERVER_IMAGES_PATH, ICON_SEND);
-		} else if (s.equals(EMAIL_STATE_RECEIVED)) {
-			commands.addCommand(ITEM_REPLY, CMD_REPLY);
-			commands.addCommand(ITEM_FORWARD, CMD_FORWARD);
-		} else if (s.equals(EMAIL_STATE_SENT)) {
-			commands.addCommand(ITEM_FORWARD, CMD_FORWARD);
-		} else {
-			throw new DeepaMehtaException(&quot;unexpected email status: \&quot;&quot; + s + &quot;\&quot;&quot;);
-		}
-		//
-		commands.addStandardCommands(this, editorContext, viewmode, session, directives);
-		//
-		return commands;
-	}
-
-
-
-	// --------------------------
-	// --- Executing Commands ---
-	// --------------------------
-
-
-
-	public CorporateDirectives executeCommand(String command, Session session,
-													String topicmapID, String viewmode) {
-		CorporateDirectives directives = new CorporateDirectives();
-		if (command.equals(CMD_SEND)) {
-			sendMail(directives);
-		} else if (command.equals(CMD_REPLY)) {
-			createDraftForReply(session.getUserID(), 1, directives);
-		} else if (command.equals(CMD_FORWARD)) {
-			createDraftForForward(session.getUserID(), 1, directives);
-		} else {
-			return super.executeCommand(command, session, topicmapID, viewmode);
-		}
-		return directives;
-	}
-
-
-
-	// ---------------------------
-	// --- Handling Properties ---
-	// ---------------------------
-
-
-
-	public String getNameProperty() {
-		return PROPERTY_SUBJECT;
-	}
-
-
-
-	// ***************
-	// *** Methods ***
-	// ***************
-
-
-
-	private void sendMail(CorporateDirectives directives) throws DeepaMehtaException {
-		Hashtable data = getProperties();
-		if (!data.get(PROPERTY_STATUS).equals(EMAIL_STATE_DRAFT)) {
-			return;
-		}
-		LocateRcptsResult locRes = locateRcpts();
-		ArrayList aRcpts = locRes.aRcpts;
-		if (aRcpts.size() == 0) {
-			return;
-		}
-		String author = (String) data.get(PROPERTY_FROM);
-		System.out.println(&quot;&gt;&gt;&gt; EmailTopic.sendMail(): &quot; + this + &quot;, author=\&quot;&quot; + author + &quot;\&quot;&quot;);
-		Properties mprops = new Properties();
-		mprops.put(&quot;mail.smtp.host&quot;, as.getSMTPServer());	// throws DME
-		javax.mail.Session session = javax.mail.Session.getDefaultInstance(mprops, null);
-		session.setDebug(true);
-		try {
-			MimeMessage msg = new MimeMessage(session);
-			msg.setFrom(new InternetAddress(author));
-			InternetAddress[] address = new InternetAddress[aRcpts.size()];
-			for (int i = 0; i &lt; aRcpts.size(); i++) {
-				address[i] = new InternetAddress((String)aRcpts.get(i));
-			}
-			msg.setRecipients(Message.RecipientType.TO, address);
-			String subject = (String) data.get(PROPERTY_SUBJECT);
-			if (subject == null || subject.equals(&quot;&quot;)) {
-				subject = TEXT_NO_SUBJECT;
-			}
-			msg.setSubject(subject);
-			Date d = new Date();
-			msg.setSentDate(d);			
-			String msgText = (String) data.get(PROPERTY_TEXT);
-			addAttachs(msgText, msg);
-			//
-			Transport.send(msg);
-			//
-			setTopicData(PROPERTY_STATUS, EMAIL_STATE_SENT);
-			setTopicData(PROPERTY_DATE, d.toString());
-		} catch (MessagingException me) {
-			throw new DeepaMehtaException(me.toString());
-		}
-	}
-
-	public static void sendMail(String smtpServer, String from, String to, String subject, String body) {
-		Properties props = new Properties();
-		props.put(&quot;mail.smtp.host&quot;, smtpServer);
-		javax.mail.Session session = javax.mail.Session.getDefaultInstance(props);	// ### authenticator=null
-		session.setDebug(true);	// ###
-		try {
-			MimeMessage msg = new MimeMessage(session);
-			msg.setFrom(new InternetAddress(from));
-			msg.setRecipients(Message.RecipientType.TO, to);
-			if (subject == null || subject.equals(&quot;&quot;)) {
-				subject = TEXT_NO_SUBJECT;
-			}
-			msg.setSubject(subject);
-			msg.setText(body);
-			msg.setSentDate(new Date());
-			//
-			Transport.send(msg);
-		} catch (MessagingException me) {
-			throw new DeepaMehtaException(me.toString());
-		}
-	}
-
-	// ---
-
-	public LocateRcptsResult locateRcpts() {
-		LocateRcptsResult res = new LocateRcptsResult();
-		ArrayList aOut = new ArrayList();
-		res.aRcpts = aOut;
-		res.bUsedAttached = false;
-		HashSet setCheck = new HashSet();
-		String sRcpts = getProperty(PROPERTY_TO);
-		if (sRcpts != null) {
-			StringTokenizer st = new StringTokenizer(sRcpts, &quot;,;&quot;);
-			while (st.hasMoreTokens()) {
-				String val = st.nextToken();
-				String key = new String(val);
-				key = key.toLowerCase().trim();
-				if (!setCheck.contains(key)) {
-					setCheck.add(key);
-					aOut.add(val);
-				}
-			}
-		}
-		Enumeration eRcpts = as.getRelatedTopics(getID(), ASSOCTYPE_EMAILADDRESSEE, 2).elements();
-		while (eRcpts.hasMoreElements()) {
-			BaseTopic user = (BaseTopic) eRcpts.nextElement();
-			String val = as.getEmailAddress(user.getID());
-			if ((val != null) &amp;&amp; (val.length() &gt; 0)) {
-				String key = new String(val);
-				key = key.toLowerCase().trim();
-				if (!setCheck.contains(key)) {
-					setCheck.add(key);
-					aOut.add(val);
-					res.bUsedAttached = true;
-				}
-			}
-		}
-		return res;
-	}
-	
-	public void addAttachs(String msgText, MimeMessage msg) throws MessagingException {
-		Enumeration docs = as.getRelatedTopics(getID(), ASSOCTYPE_ATTACHEMENT, 1).elements();
-		Multipart mp = null;
-		while (docs.hasMoreElements()) {
-			BaseTopic doc = (BaseTopic)docs.nextElement();
-			if (doc.getType().equals(TOPICTYPE_DOCUMENT)) {
-				String sFileName = as.getTopicProperty(doc.getID(), doc.getVersion(), &quot;File&quot;);
-				String sFile = FILESERVER_DOCUMENTS_PATH + sFileName;
-				MimeBodyPart mbp = new MimeBodyPart();
-				FileDataSource ds = new FileDataSource(sFile);
-				DataHandler dh = new DataHandler(ds);
-				mbp.setDataHandler(dh);
-				String sFileDoc = doc.getName();
-				if ((sFileDoc != null) &amp;&amp; !sFileDoc.equals(&quot;&quot;)){
-					mbp.setFileName(sFileDoc);
-				} else {
-					mbp.setFileName(sFileName);
-				}
-				if (mp == null) {
-					mp = new MimeMultipart();
-					MimeBodyPart mbpText = new MimeBodyPart();
-					mbpText.setContent(msgText, &quot;text/plain&quot;);
-					mp.addBodyPart(mbpText);
-				}
-				mp.addBodyPart(mbp);
-			}
-		}
-		if (mp != null) {
-			msg.setContent(mp);
-		} else {
-			msg.setContent(msgText, &quot;text/plain&quot;);
-		}
-	}
-
-	public void createDraftForReply(String userID, int userVersion, CorporateDirectives directives) {
-		Hashtable data = getProperties();
-		if (!data.get(PROPERTY_STATUS).equals(EMAIL_STATE_RECEIVED)) {
-			return;
-		}
-		String rcpts = (String)data.get(&quot;AuthorAddress&quot;);
-		String author = as.getEmailAddress(userID);		// ### null
-		String subject = &quot;RE:&quot; + (String)data.get(PROPERTY_SUBJECT);
-		String date = &quot;&quot;;
-		String msgText = formatPassedMsgText(data, &quot;     &quot;);
-		String topicID = as.cm.getNewTopicID();
-		as.cm.createTopic(topicID, 1, TOPICTYPE_EMAIL, 1, subject);
-		Hashtable elementData = new Hashtable();
-		elementData.put(PROPERTY_FROM, author);
-		elementData.put(PROPERTY_TO, rcpts);
-		elementData.put(PROPERTY_SUBJECT, subject);
-		elementData.put(&quot;UID&quot;, &quot;0&quot;);
-		elementData.put(PROPERTY_STATUS, EMAIL_STATE_DRAFT);
-		elementData.put(PROPERTY_DATE, date);
-		elementData.put(PROPERTY_TEXT, msgText);
-		as.cm.setTopicData(topicID, 1, elementData);
-		String assocID = as.cm.getNewAssociationID();
-		as.cm.createAssociation(assocID, 1, ASSOCTYPE_ASSOCIATION, 1, topicID, 1, userID, 1);
-		PresentableTopic presTopic = new PresentableTopic(topicID, 1, TOPICTYPE_EMAIL, 1, subject, getID(), &quot;&quot;);
-		directives.add(DIRECTIVE_SHOW_TOPIC, presTopic, Boolean.TRUE, &quot;&quot;);
-	}
-	
-	public void createDraftForForward(String userID, int userVersion, CorporateDirectives directives) {
-		Hashtable data = getProperties();
-		if (!data.get(PROPERTY_STATUS).equals(EMAIL_STATE_RECEIVED) &amp;&amp;
-			!data.get(PROPERTY_STATUS).equals(EMAIL_STATE_SENT)) {
-			return;
-		}
-		String rcpts = &quot;&quot;;
-		String author = as.getEmailAddress(userID);		// ### null
-		String subject = &quot;FW:&quot; + (String)data.get(PROPERTY_SUBJECT);
-		String date = &quot;&quot;;
-		String msgText = formatPassedMsgText(data, &quot;&quot;);
-		String topicID = as.cm.getNewTopicID();
-		as.cm.createTopic(topicID, 1, TOPICTYPE_EMAIL, 1, subject);
-		Hashtable elementData = new Hashtable();
-		elementData.put(PROPERTY_FROM, author);
-		elementData.put(PROPERTY_TO, rcpts);
-		elementData.put(PROPERTY_SUBJECT, subject);
-		elementData.put(&quot;UID&quot;, &quot;0&quot;);
-		elementData.put(PROPERTY_STATUS, EMAIL_STATE_DRAFT);
-		elementData.put(PROPERTY_DATE, date);
-		elementData.put(PROPERTY_TEXT, msgText);
-		as.cm.setTopicData(topicID, 1, elementData);
-		String assocID = as.cm.getNewAssociationID();
-		as.cm.createAssociation(assocID, 1, ASSOCTYPE_ASSOCIATION, 1, topicID, 1, userID, userVersion);
-		Vector vAssocs = copyAttachsAssocs(topicID);
-		PresentableTopic presTopic = new PresentableTopic(topicID, 1, TOPICTYPE_EMAIL, 1, subject, getID(), &quot;&quot;);
-		directives.add(DIRECTIVE_SHOW_TOPIC, presTopic, Boolean.TRUE, &quot;&quot;);
-		showAssocs(vAssocs, directives);		
-	}
-	
-	public Vector copyAttachsAssocs(String topicID) {
-		BaseTopic attdoc = null;
-		Vector vAssocs = new Vector();
-		Enumeration attachs = as.getRelatedTopics(getID(), ASSOCTYPE_ATTACHEMENT, 1).elements();
-		while (attachs.hasMoreElements()) {
-			attdoc = (BaseTopic)attachs.nextElement();
-			if (attdoc.getType().equals(TOPICTYPE_DOCUMENT)) {
-				String assocID = as.cm.getNewAssociationID();
-				as.cm.createAssociation( assocID, 1, ASSOCTYPE_ATTACHEMENT, 1, attdoc.getID(), 1, topicID, 1);
-				PresentableAssociation presAssoc = new PresentableAssociation(
-					assocID, 1, ASSOCTYPE_ATTACHEMENT, 1, &quot;&quot;, attdoc.getID(), 1, topicID, 1);
-				vAssocs.add(presAssoc);
-			}
-		}
-		return vAssocs;
-	}
-
-	public void showAssocs(Vector vAssocs, CorporateDirectives directives) {
-		Enumeration assocs = vAssocs.elements();
-		while (assocs.hasMoreElements()) {
-			PresentableAssociation presAssoc = (PresentableAssociation) assocs.nextElement();
-			directives.add(DIRECTIVE_SHOW_ASSOCIATION, presAssoc, Boolean.TRUE, &quot;&quot;);
-		}		
-	}
-	
-	public String formatPassedMsgText(Hashtable data, String sIndent) {
-		String sTextOut = &quot;\n&quot; + sIndent +&quot;-----Original Message:-----\n&quot;;
-		String sHeader = formatMsgHeaderAbstract(data, sIndent);
-		sTextOut += sHeader;
-		sTextOut += &quot;\n&quot;;
-		String sMsgOrig = (String)data.get(PROPERTY_TEXT);
-		sTextOut += indentText(sMsgOrig, sIndent);
-		return sTextOut;
-	}
-	
-	public String formatMsgHeaderAbstract(Hashtable data, String sIndent) {
-		String sTextOut = new String();
-		sTextOut += sIndent + &quot;From:\t&quot; + (String) data.get(PROPERTY_FROM) + &quot;\n&quot;;
-		sTextOut += sIndent + &quot;Sent:\t&quot; + (String) data.get(PROPERTY_DATE) + &quot;\n&quot;;
-		sTextOut += sIndent + &quot;To:\t&quot; + (String) data.get(PROPERTY_TO) + &quot;\n&quot;;
-		sTextOut += sIndent + &quot;Subject:\t&quot; + (String) data.get(PROPERTY_SUBJECT) + &quot;\n&quot;;
-		return sTextOut;
-	}
-	
-	public String indentText(String sTextIn, String sIndent) {
-		String sTextOut = &quot;&quot;;
-		boolean bIndent = true;
-		StringTokenizer st = new StringTokenizer(sTextIn, &quot;\n\r&quot;, true);
-		while (st.hasMoreTokens()) {
-			String s = st.nextToken();
-			if (bIndent) {
-				bIndent = false;
-				sTextOut += sIndent;
-			}
-			if (s.charAt(0) == '\n') {
-				bIndent = true;
-			}
-			sTextOut += s;
-		}
-		return sTextOut;
-	}
-}
+package de.deepamehta.topics;
+
+import de.deepamehta.BaseTopic;
+import de.deepamehta.DeepaMehtaException;
+import de.deepamehta.PresentableAssociation;
+import de.deepamehta.PresentableTopic;
+import de.deepamehta.service.ApplicationService;
+import de.deepamehta.service.CorporateCommands;
+import de.deepamehta.service.CorporateDirectives;
+import de.deepamehta.service.Session;
+
+import java.util.ArrayList;
+import java.util.Date;
+import java.util.Enumeration;
+import java.util.HashSet;
+import java.util.Hashtable;
+import java.util.Properties;
+import java.util.StringTokenizer;
+import java.util.Vector;
+
+import javax.activation.DataHandler;
+import javax.activation.FileDataSource;
+import javax.mail.Message;
+import javax.mail.MessagingException;
+import javax.mail.Multipart;
+import javax.mail.Transport;
+import javax.mail.internet.InternetAddress;
+import javax.mail.internet.MimeBodyPart;
+import javax.mail.internet.MimeMessage;
+import javax.mail.internet.MimeMultipart;
+
+
+
+/**
+ * An email.
+ * &lt;P&gt;
+ * &lt;HR&gt;
+ * Last sourcecode change: 27.9.2007 (2.0b8)&lt;BR&gt;
+ * Last documentation update: 21.11.2001 (2.0a13-post1)&lt;BR&gt;
+ * J&ouml;rg Richter&lt;BR&gt;
+ * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>
+ */
+public class EmailTopic extends LiveTopic {
+
+	private static final String TEXT_NO_SUBJECT = &quot;&lt;No Subject&gt;&quot;;
+
+	// email states
+	private static final String EMAIL_STATE_DRAFT = &quot;Draft&quot;;
+	private static final String EMAIL_STATE_RECEIVED = &quot;Received&quot;;
+	private static final String EMAIL_STATE_SENT = &quot;Sent&quot;;
+
+	// commands
+	private static final String ITEM_SEND = &quot;Send&quot;;
+	private static final String CMD_SEND = &quot;send&quot;;
+	private static final String ICON_SEND = &quot;sendEmail.gif&quot;;
+
+	private static final String ITEM_REPLY = &quot;Reply&quot;;
+	private static final String CMD_REPLY = &quot;reply&quot;;
+
+	private static final String ITEM_FORWARD = &quot;Forward&quot;;
+	private static final String CMD_FORWARD = &quot;forward&quot;;
+	
+	// &quot;Email&quot; -&gt; &quot;Recipient&quot; (User)
+	public static final String ASSOCTYPE_EMAILADDRESSEE = &quot;at-emailaddressee&quot;;	// ###
+	public static final String ASSOCTYPE_ATTACHEMENT = &quot;at-attachement&quot;;
+
+	public class LocateRcptsResult  {
+		public ArrayList	aRcpts;
+		public boolean		bUsedAttached;
+	}
+
+
+
+	// *******************
+	// *** Constructor ***
+	// *******************
+
+
+
+	public EmailTopic(BaseTopic topic, ApplicationService as) {
+		super(topic, as);
+	}
+
+
+
+	// **********************
+	// *** Defining Hooks ***
+	// **********************
+
+
+
+	// ------------------
+	// --- Life Cycle ---
+	// ------------------
+
+
+
+	public CorporateDirectives evoke(Session session, String topicmapID, String viewmode) {
+		CorporateDirectives directives = super.evoke(session, topicmapID, viewmode);
+		setTopicData(PROPERTY_STATUS, EMAIL_STATE_DRAFT);
+		String author = as.getEmailAddress(session.getUserID());	// may return null
+		if (author != null) {
+			setTopicData(PROPERTY_FROM, author);
+		}
+		as.createLiveAssociation(as.getNewAssociationID(), ASSOCTYPE_SENDER, getID(), session.getUserID(), session, directives);
+		return directives;
+	}
+
+
+
+	// --------------------------
+	// --- Providing Commands ---
+	// --------------------------
+
+
+
+	public CorporateCommands contextCommands(String topicmapID, String viewmode,
+								Session session, CorporateDirectives directives) {
+		CorporateCommands commands = new CorporateCommands(as);
+		//
+		int editorContext = as.editorContext(topicmapID);
+		commands.addNavigationCommands(this, editorContext, session);
+		// --- send/reply/forward ---
+		String s = getProperty(PROPERTY_STATUS);
+		commands.addSeparator();
+		if (s.equals(EMAIL_STATE_DRAFT)) {
+			commands.addCommand(ITEM_SEND, CMD_SEND, FILESERVER_IMAGES_PATH, ICON_SEND);
+		} else if (s.equals(EMAIL_STATE_RECEIVED)) {
+			commands.addCommand(ITEM_REPLY, CMD_REPLY);
+			commands.addCommand(ITEM_FORWARD, CMD_FORWARD);
+		} else if (s.equals(EMAIL_STATE_SENT)) {
+			commands.addCommand(ITEM_FORWARD, CMD_FORWARD);
+		} else {
+			throw new DeepaMehtaException(&quot;unexpected email status: \&quot;&quot; + s + &quot;\&quot;&quot;);
+		}
+		//
+		commands.addStandardCommands(this, editorContext, viewmode, session, directives);
+		//
+		return commands;
+	}
+
+
+
+	// --------------------------
+	// --- Executing Commands ---
+	// --------------------------
+
+
+
+	public CorporateDirectives executeCommand(String command, Session session,
+													String topicmapID, String viewmode) {
+		CorporateDirectives directives = new CorporateDirectives();
+		if (command.equals(CMD_SEND)) {
+			sendMail(directives);
+		} else if (command.equals(CMD_REPLY)) {
+			createDraftForReply(session.getUserID(), 1, directives);
+		} else if (command.equals(CMD_FORWARD)) {
+			createDraftForForward(session.getUserID(), 1, directives);
+		} else {
+			return super.executeCommand(command, session, topicmapID, viewmode);
+		}
+		return directives;
+	}
+
+
+
+	// ---------------------------
+	// --- Handling Properties ---
+	// ---------------------------
+
+
+
+	public String getNameProperty() {
+		return PROPERTY_SUBJECT;
+	}
+
+
+
+	// ***************
+	// *** Methods ***
+	// ***************
+
+
+
+	private void sendMail(CorporateDirectives directives) throws DeepaMehtaException {
+		Hashtable data = getProperties();
+		if (!data.get(PROPERTY_STATUS).equals(EMAIL_STATE_DRAFT)) {
+			return;
+		}
+		LocateRcptsResult locRes = locateRcpts();
+		ArrayList aRcpts = locRes.aRcpts;
+		if (aRcpts.size() == 0) {
+			return;
+		}
+		String author = (String) data.get(PROPERTY_FROM);
+		System.out.println(&quot;&gt;&gt;&gt; EmailTopic.sendMail(): &quot; + this + &quot;, author=\&quot;&quot; + author + &quot;\&quot;&quot;);
+		Properties mprops = new Properties();
+		mprops.put(&quot;mail.smtp.host&quot;, as.getSMTPServer());	// throws DME
+		javax.mail.Session session = javax.mail.Session.getDefaultInstance(mprops, null);
+		session.setDebug(true);
+		try {
+			MimeMessage msg = new MimeMessage(session);
+			msg.setFrom(new InternetAddress(author));
+			InternetAddress[] address = new InternetAddress[aRcpts.size()];
+			for (int i = 0; i &lt; aRcpts.size(); i++) {
+				address[i] = new InternetAddress((String)aRcpts.get(i));
+			}
+			msg.setRecipients(Message.RecipientType.TO, address);
+			String subject = (String) data.get(PROPERTY_SUBJECT);
+			if (subject == null || subject.equals(&quot;&quot;)) {
+				subject = TEXT_NO_SUBJECT;
+			}
+			msg.setSubject(subject);
+			Date d = new Date();
+			msg.setSentDate(d);			
+			String msgText = (String) data.get(PROPERTY_TEXT);
+			addAttachs(msgText, msg);
+			//
+			Transport.send(msg);
+			//
+			setTopicData(PROPERTY_STATUS, EMAIL_STATE_SENT);
+			setTopicData(PROPERTY_DATE, d.toString());
+		} catch (MessagingException me) {
+			throw new DeepaMehtaException(me.toString());
+		}
+	}
+
+	public static void sendMail(String smtpServer, String from, String to, String subject, String body) {
+		Properties props = new Properties();
+		props.put(&quot;mail.smtp.host&quot;, smtpServer);
+		javax.mail.Session session = javax.mail.Session.getDefaultInstance(props);	// ### authenticator=null
+		session.setDebug(true);	// ###
+		try {
+			MimeMessage msg = new MimeMessage(session);
+			msg.setFrom(new InternetAddress(from));
+			msg.setRecipients(Message.RecipientType.TO, to);
+			if (subject == null || subject.equals(&quot;&quot;)) {
+				subject = TEXT_NO_SUBJECT;
+			}
+			msg.setSubject(subject);
+			msg.setText(body);
+			msg.setSentDate(new Date());
+			//
+			Transport.send(msg);
+		} catch (MessagingException me) {
+			throw new DeepaMehtaException(me.toString());
+		}
+	}
+
+	// ---
+
+	public LocateRcptsResult locateRcpts() {
+		LocateRcptsResult res = new LocateRcptsResult();
+		ArrayList aOut = new ArrayList();
+		res.aRcpts = aOut;
+		res.bUsedAttached = false;
+		HashSet setCheck = new HashSet();
+		String sRcpts = getProperty(PROPERTY_TO);
+		if (sRcpts != null) {
+			StringTokenizer st = new StringTokenizer(sRcpts, &quot;,;&quot;);
+			while (st.hasMoreTokens()) {
+				String val = st.nextToken();
+				String key = new String(val);
+				key = key.toLowerCase().trim();
+				if (!setCheck.contains(key)) {
+					setCheck.add(key);
+					aOut.add(val);
+				}
+			}
+		}
+		Enumeration eRcpts = as.getRelatedTopics(getID(), ASSOCTYPE_EMAILADDRESSEE, 2).elements();
+		while (eRcpts.hasMoreElements()) {
+			BaseTopic user = (BaseTopic) eRcpts.nextElement();
+			String val = as.getEmailAddress(user.getID());
+			if ((val != null) &amp;&amp; (val.length() &gt; 0)) {
+				String key = new String(val);
+				key = key.toLowerCase().trim();
+				if (!setCheck.contains(key)) {
+					setCheck.add(key);
+					aOut.add(val);
+					res.bUsedAttached = true;
+				}
+			}
+		}
+		return res;
+	}
+	
+	public void addAttachs(String msgText, MimeMessage msg) throws MessagingException {
+		Enumeration docs = as.getRelatedTopics(getID(), ASSOCTYPE_ATTACHEMENT, 1).elements();
+		Multipart mp = null;
+		while (docs.hasMoreElements()) {
+			BaseTopic doc = (BaseTopic)docs.nextElement();
+			if (doc.getType().equals(TOPICTYPE_DOCUMENT)) {
+				String sFileName = as.getTopicProperty(doc.getID(), doc.getVersion(), &quot;File&quot;);
+				String sFile = FILESERVER_DOCUMENTS_PATH + sFileName;
+				MimeBodyPart mbp = new MimeBodyPart();
+				FileDataSource ds = new FileDataSource(sFile);
+				DataHandler dh = new DataHandler(ds);
+				mbp.setDataHandler(dh);
+				String sFileDoc = doc.getName();
+				if ((sFileDoc != null) &amp;&amp; !sFileDoc.equals(&quot;&quot;)){
+					mbp.setFileName(sFileDoc);
+				} else {
+					mbp.setFileName(sFileName);
+				}
+				if (mp == null) {
+					mp = new MimeMultipart();
+					MimeBodyPart mbpText = new MimeBodyPart();
+					mbpText.setContent(msgText, &quot;text/plain&quot;);
+					mp.addBodyPart(mbpText);
+				}
+				mp.addBodyPart(mbp);
+			}
+		}
+		if (mp != null) {
+			msg.setContent(mp);
+		} else {
+			msg.setContent(msgText, &quot;text/plain&quot;);
+		}
+	}
+
+	public void createDraftForReply(String userID, int userVersion, CorporateDirectives directives) {
+		Hashtable data = getProperties();
+		if (!data.get(PROPERTY_STATUS).equals(EMAIL_STATE_RECEIVED)) {
+			return;
+		}
+		String rcpts = (String)data.get(&quot;AuthorAddress&quot;);
+		String author = as.getEmailAddress(userID);		// ### null
+		String subject = &quot;RE:&quot; + (String)data.get(PROPERTY_SUBJECT);
+		String date = &quot;&quot;;
+		String msgText = formatPassedMsgText(data, &quot;     &quot;);
+		String topicID = as.cm.getNewTopicID();
+		as.cm.createTopic(topicID, 1, TOPICTYPE_EMAIL, 1, subject);
+		Hashtable elementData = new Hashtable();
+		elementData.put(PROPERTY_FROM, author);
+		elementData.put(PROPERTY_TO, rcpts);
+		elementData.put(PROPERTY_SUBJECT, subject);
+		elementData.put(&quot;UID&quot;, &quot;0&quot;);
+		elementData.put(PROPERTY_STATUS, EMAIL_STATE_DRAFT);
+		elementData.put(PROPERTY_DATE, date);
+		elementData.put(PROPERTY_TEXT, msgText);
+		as.cm.setTopicData(topicID, 1, elementData);
+		String assocID = as.cm.getNewAssociationID();
+		as.cm.createAssociation(assocID, 1, ASSOCTYPE_ASSOCIATION, 1, topicID, 1, userID, 1);
+		PresentableTopic presTopic = new PresentableTopic(topicID, 1, TOPICTYPE_EMAIL, 1, subject, getID(), &quot;&quot;);
+		directives.add(DIRECTIVE_SHOW_TOPIC, presTopic, Boolean.TRUE, &quot;&quot;);
+	}
+	
+	public void createDraftForForward(String userID, int userVersion, CorporateDirectives directives) {
+		Hashtable data = getProperties();
+		if (!data.get(PROPERTY_STATUS).equals(EMAIL_STATE_RECEIVED) &amp;&amp;
+			!data.get(PROPERTY_STATUS).equals(EMAIL_STATE_SENT)) {
+			return;
+		}
+		String rcpts = &quot;&quot;;
+		String author = as.getEmailAddress(userID);		// ### null
+		String subject = &quot;FW:&quot; + (String)data.get(PROPERTY_SUBJECT);
+		String date = &quot;&quot;;
+		String msgText = formatPassedMsgText(data, &quot;&quot;);
+		String topicID = as.cm.getNewTopicID();
+		as.cm.createTopic(topicID, 1, TOPICTYPE_EMAIL, 1, subject);
+		Hashtable elementData = new Hashtable();
+		elementData.put(PROPERTY_FROM, author);
+		elementData.put(PROPERTY_TO, rcpts);
+		elementData.put(PROPERTY_SUBJECT, subject);
+		elementData.put(&quot;UID&quot;, &quot;0&quot;);
+		elementData.put(PROPERTY_STATUS, EMAIL_STATE_DRAFT);
+		elementData.put(PROPERTY_DATE, date);
+		elementData.put(PROPERTY_TEXT, msgText);
+		as.cm.setTopicData(topicID, 1, elementData);
+		String assocID = as.cm.getNewAssociationID();
+		as.cm.createAssociation(assocID, 1, ASSOCTYPE_ASSOCIATION, 1, topicID, 1, userID, userVersion);
+		Vector vAssocs = copyAttachsAssocs(topicID);
+		PresentableTopic presTopic = new PresentableTopic(topicID, 1, TOPICTYPE_EMAIL, 1, subject, getID(), &quot;&quot;);
+		directives.add(DIRECTIVE_SHOW_TOPIC, presTopic, Boolean.TRUE, &quot;&quot;);
+		showAssocs(vAssocs, directives);		
+	}
+	
+	public Vector copyAttachsAssocs(String topicID) {
+		BaseTopic attdoc = null;
+		Vector vAssocs = new Vector();
+		Enumeration attachs = as.getRelatedTopics(getID(), ASSOCTYPE_ATTACHEMENT, 1).elements();
+		while (attachs.hasMoreElements()) {
+			attdoc = (BaseTopic)attachs.nextElement();
+			if (attdoc.getType().equals(TOPICTYPE_DOCUMENT)) {
+				String assocID = as.cm.getNewAssociationID();
+				as.cm.createAssociation( assocID, 1, ASSOCTYPE_ATTACHEMENT, 1, attdoc.getID(), 1, topicID, 1);
+				PresentableAssociation presAssoc = new PresentableAssociation(
+					assocID, 1, ASSOCTYPE_ATTACHEMENT, 1, &quot;&quot;, attdoc.getID(), 1, topicID, 1);
+				vAssocs.add(presAssoc);
+			}
+		}
+		return vAssocs;
+	}
+
+	public void showAssocs(Vector vAssocs, CorporateDirectives directives) {
+		Enumeration assocs = vAssocs.elements();
+		while (assocs.hasMoreElements()) {
+			PresentableAssociation presAssoc = (PresentableAssociation) assocs.nextElement();
+			directives.add(DIRECTIVE_SHOW_ASSOCIATION, presAssoc, Boolean.TRUE, &quot;&quot;);
+		}		
+	}
+	
+	public String formatPassedMsgText(Hashtable data, String sIndent) {
+		String sTextOut = &quot;\n&quot; + sIndent +&quot;-----Original Message:-----\n&quot;;
+		String sHeader = formatMsgHeaderAbstract(data, sIndent);
+		sTextOut += sHeader;
+		sTextOut += &quot;\n&quot;;
+		String sMsgOrig = (String)data.get(PROPERTY_TEXT);
+		sTextOut += indentText(sMsgOrig, sIndent);
+		return sTextOut;
+	}
+	
+	public String formatMsgHeaderAbstract(Hashtable data, String sIndent) {
+		String sTextOut = new String();
+		sTextOut += sIndent + &quot;From:\t&quot; + (String) data.get(PROPERTY_FROM) + &quot;\n&quot;;
+		sTextOut += sIndent + &quot;Sent:\t&quot; + (String) data.get(PROPERTY_DATE) + &quot;\n&quot;;
+		sTextOut += sIndent + &quot;To:\t&quot; + (String) data.get(PROPERTY_TO) + &quot;\n&quot;;
+		sTextOut += sIndent + &quot;Subject:\t&quot; + (String) data.get(PROPERTY_SUBJECT) + &quot;\n&quot;;
+		return sTextOut;
+	}
+	
+	public String indentText(String sTextIn, String sIndent) {
+		String sTextOut = &quot;&quot;;
+		boolean bIndent = true;
+		StringTokenizer st = new StringTokenizer(sTextIn, &quot;\n\r&quot;, true);
+		while (st.hasMoreTokens()) {
+			String s = st.nextToken();
+			if (bIndent) {
+				bIndent = false;
+				sTextOut += sIndent;
+			}
+			if (s.charAt(0) == '\n') {
+				bIndent = true;
+			}
+			sTextOut += s;
+		}
+		return sTextOut;
+	}
+}

Modified: branches/eschnepel/develop/src/de/deepamehta/topics/InstallationTopic.java
===================================================================
--- branches/eschnepel/develop/src/de/deepamehta/topics/InstallationTopic.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/develop/src/de/deepamehta/topics/InstallationTopic.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1 +1,164 @@
-package de.deepamehta.topics;import de.deepamehta.BaseTopic;import de.deepamehta.PropertyDefinition;import de.deepamehta.service.ApplicationService;import de.deepamehta.service.CorporateDirectives;import de.deepamehta.service.Session;import java.util.Hashtable;import java.util.StringTokenizer;/** * &lt;P&gt; * &lt;HR&gt; * Last functional change: 11.9.2007 (2.0b8)&lt;BR&gt; * Last documentation update: 7.12.2000 (2.0a8-pre2)&lt;BR&gt; * J&ouml;rg Richter&lt;BR&gt; * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A> */public class InstallationTopic extends LiveTopic {	static final String  CMD_ASSIGN_CORPORATE_ICON = &quot;assignCorporateIcon&quot;;	static final String  CMD_ASSIGN_CUSTOMER_ICON = &quot;assignCustomerIcon&quot;;	// *******************	// *** Constructor ***	// *******************	/**	 * @see		de.deepamehta.service.ApplicationService#createLiveTopic	 */	public InstallationTopic(BaseTopic topic, ApplicationService as) {		super(topic, as);	}	// --------------------------	// --- Providing Commands ---!
 	// --------------------------	/**	 * @see		TypeTopic#makeTypeDefinition	 */	public static void buttonCommand(PropertyDefinition propDef, ApplicationService as, Session session) {		String propName = propDef.getPropertyName();		if (propName.equals(PROPERTY_CORPORATE_ICON)) {			propDef.setActionButton(as.string(BUTTON_ASSIGN_FILE), CMD_ASSIGN_CORPORATE_ICON);		} else if (propName.equals(PROPERTY_CUSTOMER_ICON)) {			propDef.setActionButton(as.string(BUTTON_ASSIGN_FILE), CMD_ASSIGN_CUSTOMER_ICON);		}	}	// --------------------------	// --- Executing Commands ---	// --------------------------	public CorporateDirectives executeCommand(String command, Session session,													String topicmapID, String viewmode) {		StringTokenizer st = new StringTokenizer(command, COMMAND_SEPARATOR);		String cmd = st.nextToken();		//		if (cmd.equals(CMD_ASSIGN_CORPORATE_ICON) || cmd.equals(CMD_ASSIGN_CUSTOMER_ICON)) {			CorporateDirectives directives = new Corporate!
 Directives();			directives.add(DIRECTIVE_CHOOSE_FILE);			ret!
 urn dire
ctives;		} else {			return super.executeCommand(command, session, topicmapID, viewmode);		}	}	public CorporateDirectives executeChainedCommand(String command, String result,											String topicmapID, String viewmode, Session session) {		// Note: the result of a DIRECTIVE_CHOOSE_FILE contains the absolute		// path of the (client side) selected icon file		CorporateDirectives directives = new CorporateDirectives();		//		if (command.equals(CMD_ASSIGN_CORPORATE_ICON)) {			copyAndUpload(result, FILE_IMAGE, PROPERTY_CORPORATE_ICON, session, directives);			return directives;		} else if (command.equals(CMD_ASSIGN_CUSTOMER_ICON)) {			copyAndUpload(result, FILE_IMAGE, PROPERTY_CUSTOMER_ICON, session, directives);			return directives;		} else {			return super.executeChainedCommand(command, result, topicmapID, viewmode, session);		}	}	// ---------------------------	// --- Handling Properties ---	// ---------------------------	public CorporateDirectives p!
 ropertiesChanged(Hashtable newData, Hashtable oldData,											String topicmapID, String viewmode, Session session) {		CorporateDirectives directives = super.propertiesChanged(newData, oldData,			topicmapID, viewmode, session);		String value;		// --- &quot;Language&quot; ---		value = (String) newData.get(PROPERTY_LANGUAGE);		if (value != null) {			addHint(PROPERTY_LANGUAGE, value, directives);		}		// --- &quot;Corporate Icon&quot; ---		value = (String) newData.get(PROPERTY_CORPORATE_ICON);		if (value != null) {			addHint(PROPERTY_CORPORATE_ICON, value, directives);		}		// --- &quot;Customer Icon&quot; ---		value = (String) newData.get(PROPERTY_CUSTOMER_ICON);		if (value != null) {			addHint(PROPERTY_CUSTOMER_ICON, value, directives);		}		//		return directives;	}	/**	 * @see		de.deepamehta.topics.TypeTopic#makeTypeDefinition	 */	public static void propertyLabel(PropertyDefinition propDef, ApplicationService as, Session session) {		if (as.getLanguage() == LANGUAGE_GERMAN) {	!
 		String propName = propDef.getPropertyName();			if (propName!
 .equals(
PROPERTY_LANGUAGE)) {				propDef.setPropertyLabel(&quot;Sprache&quot;);			} else if (propName.equals(PROPERTY_CORPORATE_ICON)) {				propDef.setPropertyLabel(&quot;Firmen-Icon&quot;);			} else if (propName.equals(PROPERTY_CUSTOMER_ICON)) {				propDef.setPropertyLabel(&quot;Kunden-Icon&quot;);			}		}	}	// ***********************	// *** Private Methods ***	// ***********************	// ### copy in UserPreferencesTopic	private void addHint(String propName, String value, CorporateDirectives directives) {		directives.add(DIRECTIVE_SHOW_MESSAGE, &quot;\&quot;&quot; + propName + &quot;\&quot; will be &quot; +			&quot;\&quot;&quot; + value + &quot;\&quot; in next session&quot;, new Integer(NOTIFICATION_DEFAULT));	}}
\ No newline at end of file
+package de.deepamehta.topics;
+
+import de.deepamehta.BaseTopic;
+import de.deepamehta.PropertyDefinition;
+import de.deepamehta.service.ApplicationService;
+import de.deepamehta.service.CorporateDirectives;
+import de.deepamehta.service.Session;
+
+import java.util.Hashtable;
+import java.util.StringTokenizer;
+
+
+
+/**
+ * &lt;P&gt;
+ * &lt;HR&gt;
+ * Last functional change: 11.9.2007 (2.0b8)&lt;BR&gt;
+ * Last documentation update: 7.12.2000 (2.0a8-pre2)&lt;BR&gt;
+ * J&ouml;rg Richter&lt;BR&gt;
+ * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>
+ */
+public class InstallationTopic extends LiveTopic {
+
+
+
+	static final String  CMD_ASSIGN_CORPORATE_ICON = &quot;assignCorporateIcon&quot;;
+	static final String  CMD_ASSIGN_CUSTOMER_ICON = &quot;assignCustomerIcon&quot;;
+
+
+
+	// *******************
+	// *** Constructor ***
+	// *******************
+
+
+
+	/**
+	 * @see		de.deepamehta.service.ApplicationService#createLiveTopic
+	 */
+	public InstallationTopic(BaseTopic topic, ApplicationService as) {
+		super(topic, as);
+	}
+
+
+
+	// --------------------------
+	// --- Providing Commands ---
+	// --------------------------
+
+
+
+	/**
+	 * @see		TypeTopic#makeTypeDefinition
+	 */
+	public static void buttonCommand(PropertyDefinition propDef, ApplicationService as, Session session) {
+		String propName = propDef.getPropertyName();
+		if (propName.equals(PROPERTY_CORPORATE_ICON)) {
+			propDef.setActionButton(as.string(BUTTON_ASSIGN_FILE), CMD_ASSIGN_CORPORATE_ICON);
+		} else if (propName.equals(PROPERTY_CUSTOMER_ICON)) {
+			propDef.setActionButton(as.string(BUTTON_ASSIGN_FILE), CMD_ASSIGN_CUSTOMER_ICON);
+		}
+	}
+
+
+
+	// --------------------------
+	// --- Executing Commands ---
+	// --------------------------
+
+
+
+	public CorporateDirectives executeCommand(String command, Session session,
+													String topicmapID, String viewmode) {
+		StringTokenizer st = new StringTokenizer(command, COMMAND_SEPARATOR);
+		String cmd = st.nextToken();
+		//
+		if (cmd.equals(CMD_ASSIGN_CORPORATE_ICON) || cmd.equals(CMD_ASSIGN_CUSTOMER_ICON)) {
+			CorporateDirectives directives = new CorporateDirectives();
+			directives.add(DIRECTIVE_CHOOSE_FILE);
+			return directives;
+		} else {
+			return super.executeCommand(command, session, topicmapID, viewmode);
+		}
+	}
+
+	public CorporateDirectives executeChainedCommand(String command, String result,
+											String topicmapID, String viewmode, Session session) {
+		// Note: the result of a DIRECTIVE_CHOOSE_FILE contains the absolute
+		// path of the (client side) selected icon file
+		CorporateDirectives directives = new CorporateDirectives();
+		//
+		if (command.equals(CMD_ASSIGN_CORPORATE_ICON)) {
+			copyAndUpload(result, FILE_IMAGE, PROPERTY_CORPORATE_ICON, session, directives);
+			return directives;
+		} else if (command.equals(CMD_ASSIGN_CUSTOMER_ICON)) {
+			copyAndUpload(result, FILE_IMAGE, PROPERTY_CUSTOMER_ICON, session, directives);
+			return directives;
+		} else {
+			return super.executeChainedCommand(command, result, topicmapID, viewmode, session);
+		}
+	}
+
+
+
+	// ---------------------------
+	// --- Handling Properties ---
+	// ---------------------------
+
+
+
+	public CorporateDirectives propertiesChanged(Hashtable newData, Hashtable oldData,
+											String topicmapID, String viewmode, Session session) {
+		CorporateDirectives directives = super.propertiesChanged(newData, oldData,
+			topicmapID, viewmode, session);
+		String value;
+		// --- &quot;Language&quot; ---
+		value = (String) newData.get(PROPERTY_LANGUAGE);
+		if (value != null) {
+			addHint(PROPERTY_LANGUAGE, value, directives);
+		}
+		// --- &quot;Corporate Icon&quot; ---
+		value = (String) newData.get(PROPERTY_CORPORATE_ICON);
+		if (value != null) {
+			addHint(PROPERTY_CORPORATE_ICON, value, directives);
+		}
+		// --- &quot;Customer Icon&quot; ---
+		value = (String) newData.get(PROPERTY_CUSTOMER_ICON);
+		if (value != null) {
+			addHint(PROPERTY_CUSTOMER_ICON, value, directives);
+		}
+		//
+		return directives;
+	}
+
+	/**
+	 * @see		de.deepamehta.topics.TypeTopic#makeTypeDefinition
+	 */
+	public static void propertyLabel(PropertyDefinition propDef, ApplicationService as, Session session) {
+		if (as.getLanguage() == LANGUAGE_GERMAN) {
+			String propName = propDef.getPropertyName();
+			if (propName.equals(PROPERTY_LANGUAGE)) {
+				propDef.setPropertyLabel(&quot;Sprache&quot;);
+			} else if (propName.equals(PROPERTY_CORPORATE_ICON)) {
+				propDef.setPropertyLabel(&quot;Firmen-Icon&quot;);
+			} else if (propName.equals(PROPERTY_CUSTOMER_ICON)) {
+				propDef.setPropertyLabel(&quot;Kunden-Icon&quot;);
+			}
+		}
+	}
+
+
+
+	// ***********************
+	// *** Private Methods ***
+	// ***********************
+
+
+
+	// ### copy in UserPreferencesTopic
+	private void addHint(String propName, String value, CorporateDirectives directives) {
+		directives.add(DIRECTIVE_SHOW_MESSAGE, &quot;\&quot;&quot; + propName + &quot;\&quot; will be &quot; +
+			&quot;\&quot;&quot; + value + &quot;\&quot; in next session&quot;, new Integer(NOTIFICATION_DEFAULT));
+	}
+}

Modified: branches/eschnepel/develop/src/de/deepamehta/topics/LoginTopic.java
===================================================================
--- branches/eschnepel/develop/src/de/deepamehta/topics/LoginTopic.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/develop/src/de/deepamehta/topics/LoginTopic.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,74 +1,74 @@
-package de.deepamehta.topics;
-
-import de.deepamehta.BaseTopic;
-import de.deepamehta.service.ApplicationService;
-import de.deepamehta.service.LoginCheck;
-
-import java.lang.reflect.Constructor;
-
-
-
-/**
- * ### to be dropped
- * &lt;P&gt;
- * Represents a LoginCheck object. Other TopicTypes may be derived from the TopicType
- * which has this Class as &quot;Implementing Class&quot;. The necessary properties of the derived
- * TopicTypes depend on the actual implementation of LoginCheck.
- * &lt;P&gt;
- * The Class of the LoginCheck object is derived from the name of the TopicType.
- */
-public class LoginTopic extends LiveTopic {
-
-	private static final String SERVER_PACKAGE = &quot;de.deepamehta.service&quot;;
-	private LoginCheck loginCheck;
-
-	public LoginTopic(BaseTopic topic, ApplicationService as) {
-		super(topic, as);
-	}
-
-	/**
-	 * @see AuthentificationSourceTopic#loginCheck
-	 */
-	public boolean loginCheck(String name, String password) {
-		try {
-			return getLoginCheck().loginCheck(name, password);
-		} catch(Exception e) {
-			System.out.println(&quot;*** LoginTopic.loginCheck() failed: &quot; + e);
-			return false;
-		}
-	}
-
-	/**
-	 * Note: creation of the object is lazy.
-	 *
-	 * @return		the LoginCheck object.
-	 *
-	 * @see de.deepamehta.service.ApplicationService#getLoginCheck
-	 */
-	public LoginCheck getLoginCheck() {
-		if (loginCheck == null) {
-			loginCheck = createLoginCheck();
-		}		
-		System.out.println(&quot;&gt;&gt;&gt; LoginTopic.getLoginCheck(): using instance of &quot; +
-				loginCheck.getClass().getName() + &quot; for authentification.&quot;);
-		return loginCheck;
-	}
-
-	/**
-	 * Creates a new instance of a LoginCheck object.
-	 * The Class of the LoginCheck object is derived from the
-	 * name of the TopicType.
-	 */
-	private LoginCheck createLoginCheck() {
-		String loginClassName = SERVER_PACKAGE + &quot;.&quot; + as.typeName(this);
-		try {
-			Constructor cons = Class.forName(loginClassName).getConstructor(
-				new Class[] {LiveTopic.class});
-			return (LoginCheck) cons.newInstance(new Object[] {this});
-		} catch (Exception e) {
-			System.out.println(&quot;*** LoginTopic.createLoginCheck(): creation of &quot; +
-			&quot;LoginCheck failed: &quot; + e + &quot; -- using ApplicationService&quot;);
-			return as;
-		}		
-	}
-}
+package de.deepamehta.topics;
+
+import de.deepamehta.BaseTopic;
+import de.deepamehta.service.ApplicationService;
+import de.deepamehta.service.LoginCheck;
+
+import java.lang.reflect.Constructor;
+
+
+
+/**
+ * ### to be dropped
+ * &lt;P&gt;
+ * Represents a LoginCheck object. Other TopicTypes may be derived from the TopicType
+ * which has this Class as &quot;Implementing Class&quot;. The necessary properties of the derived
+ * TopicTypes depend on the actual implementation of LoginCheck.
+ * &lt;P&gt;
+ * The Class of the LoginCheck object is derived from the name of the TopicType.
+ */
+public class LoginTopic extends LiveTopic {
+
+	private static final String SERVER_PACKAGE = &quot;de.deepamehta.service&quot;;
+	private LoginCheck loginCheck;
+
+	public LoginTopic(BaseTopic topic, ApplicationService as) {
+		super(topic, as);
+	}
+
+	/**
+	 * @see AuthentificationSourceTopic#loginCheck
+	 */
+	public boolean loginCheck(String name, String password) {
+		try {
+			return getLoginCheck().loginCheck(name, password);
+		} catch(Exception e) {
+			System.out.println(&quot;*** LoginTopic.loginCheck() failed: &quot; + e);
+			return false;
+		}
+	}
+
+	/**
+	 * Note: creation of the object is lazy.
+	 *
+	 * @return		the LoginCheck object.
+	 *
+	 * @see de.deepamehta.service.ApplicationService#getLoginCheck
+	 */
+	public LoginCheck getLoginCheck() {
+		if (loginCheck == null) {
+			loginCheck = createLoginCheck();
+		}		
+		System.out.println(&quot;&gt;&gt;&gt; LoginTopic.getLoginCheck(): using instance of &quot; +
+				loginCheck.getClass().getName() + &quot; for authentification.&quot;);
+		return loginCheck;
+	}
+
+	/**
+	 * Creates a new instance of a LoginCheck object.
+	 * The Class of the LoginCheck object is derived from the
+	 * name of the TopicType.
+	 */
+	private LoginCheck createLoginCheck() {
+		String loginClassName = SERVER_PACKAGE + &quot;.&quot; + as.typeName(this);
+		try {
+			Constructor cons = Class.forName(loginClassName).getConstructor(
+				new Class[] {LiveTopic.class});
+			return (LoginCheck) cons.newInstance(new Object[] {this});
+		} catch (Exception e) {
+			System.out.println(&quot;*** LoginTopic.createLoginCheck(): creation of &quot; +
+			&quot;LoginCheck failed: &quot; + e + &quot; -- using ApplicationService&quot;);
+			return as;
+		}		
+	}
+}

Modified: branches/eschnepel/develop/src/de/deepamehta/topics/PropertyTopic.java
===================================================================
--- branches/eschnepel/develop/src/de/deepamehta/topics/PropertyTopic.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/develop/src/de/deepamehta/topics/PropertyTopic.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,240 +1,240 @@
-package de.deepamehta.topics;
-
-import de.deepamehta.BaseTopic;
-import de.deepamehta.PropertyDefinition;
-import de.deepamehta.service.ApplicationService;
-import de.deepamehta.service.CorporateCommands;
-import de.deepamehta.service.CorporateDirectives;
-import de.deepamehta.service.Session;
-
-import java.util.Enumeration;
-import java.util.Vector;
-
-
-
-/**
- * A topic resp. association property.
- * &lt;P&gt;
- * &lt;HR&gt;
- * Last functional change: 28.9.2004 (2.0b3)&lt;BR&gt;
- * Last documentation update: 12.11.2000 (2.0a7-pre2)&lt;BR&gt;
- * J&ouml;rg Richter&lt;BR&gt;
- * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>
- */
-public class PropertyTopic extends LiveTopic {
-
-
-
-	// **************
-	// *** Fields ***
-	// **************
-
-
-
-	// model
-	private PropertyDefinition propDef;
-	// ### drop this 4 variables
-	private String type;	// ### to be dropped
-	private String visualization;
-	private String defaultValue;
-	private String editIconfile;
-	private Vector values = new Vector();	// element type is PresentableTopic
-
-	// commands
-	protected static String ITEM_ASSIGN_NEW_PROPERTY_VALUE = &quot;Create Property Value&quot;;
-	protected static final String  CMD_ASSIGN_NEW_PROPERTY_VALUE = &quot;assignNewPropertyValue&quot;;
-	protected static final String ICON_ASSIGN_NEW_PROPERTY_VALUE = &quot;createProperty.gif&quot;;	// ###
-
-	private static final String  CMD_ASSIGN_EDIT_ICON = &quot;assignEditIcon&quot;;
-
-
-
-	// *******************
-	// *** Constructor ***
-	// *******************
-
-
-
-	public PropertyTopic(BaseTopic topic, ApplicationService as) {
-		super(topic, as);
-	}
-
-
-
-	// **********************
-	// *** Defining Hooks ***
-	// **********************
-
-
-
-	// ------------------
-	// --- Life Cycle ---
-	// ------------------
-
-
-
-	// actually not needed. the property model is inited (initPropertyDefinition()) while the type model is inited
-	/* ### public CorporateDirectives init(int initLevel, Session session) throws TopicInitException {
-		CorporateDirectives directives = super.init(initLevel, session);
-		//
-		if (initLevel == INITLEVEL_2) {
-			// ### Note: A PropertyTopic initializes at level 2 because it relies on
-			// ### involved constants beeing in live corporate memory
-			// ### since the constants are preloaded we could actually init at level 1
-			if (LOG_TOPIC_INIT) {
-				System.out.println(&quot;&gt;&gt;&gt; PropertyTopic.init(&quot; + initLevel + &quot;): &quot; +
-					this + &quot; -- set property definition&quot;);
-			}
-			initPropertyDefinition(session, directives);
-		}
-		// Note: actually empty directives are returned
-		return directives;
-	} */
-
-	// since 2.0b3: we use the default-value-facility instead (property &quot;Default Value&quot; of topic type &quot;Property&quot;)
-	/* ### public CorporateDirectives evoke(Session session, String topicmapID, String viewmode) {
-		// --- set default property ---
-		setTopicData(PROPERTY_VISUALIZATION, VISUAL_FIELD);
-		// Note: actually empty directives are returned
-		return super.evoke(session, topicmapID, viewmode);
-	} */
-
-
-
-	// --------------------------
-	// --- Providing Commands ---
-	// --------------------------
-
-
-
-	/**
-	 * @see		de.deepamehta.service.ApplicationService#showTopicMenu
-	 */
-	public CorporateCommands contextCommands(String topicmapID, String viewmode,
-								Session session, CorporateDirectives directives) {
-		CorporateCommands commands = new CorporateCommands(as);
-		int editorContext = as.editorContext(topicmapID);
-		//
-		commands.addNavigationCommands(this, editorContext, session);
-		// --- &quot;Create Property Value&quot; ---
-		commands.addSeparator();
-		int cmdState = session.isDemo() ? COMMAND_STATE_DISABLED : COMMAND_STATE_DEFAULT;
-		commands.addCommand(ITEM_ASSIGN_NEW_PROPERTY_VALUE, CMD_ASSIGN_NEW_PROPERTY_VALUE,
-			FILESERVER_IMAGES_PATH, ICON_ASSIGN_NEW_PROPERTY_VALUE, cmdState);
-		//
-		commands.addStandardCommands(this, editorContext, viewmode, session, directives);
-		//
-		return commands;
-	}
-
-	public static void buttonCommand(PropertyDefinition propDef, ApplicationService as, Session session) {
-		String propName = propDef.getPropertyName();
-		if (propName.equals(PROPERTY_EDIT_PROPERTY_ICON)) {
-			propDef.setActionButton(as.string(BUTTON_ASSIGN_FILE), CMD_ASSIGN_EDIT_ICON);
-		}
-	}
-
-
-
-	// --------------------------
-	// --- Executing Commands ---
-	// --------------------------
-
-
-
-	public CorporateDirectives executeCommand(String actionCommand, Session session,
-													String topicmapID, String viewmode) {
-		CorporateDirectives directives = new CorporateDirectives();
-		//
-		if (actionCommand.equals(CMD_ASSIGN_NEW_PROPERTY_VALUE)) {
-			createChildTopic(TOPICTYPE_PROPERTY_VALUE, SEMANTIC_OPTION_DEFINITION, session, directives);
-			return directives;
-		} else if (actionCommand.equals(CMD_ASSIGN_EDIT_ICON)) {
-			directives.add(DIRECTIVE_CHOOSE_FILE);
-			return directives;
-		} else {
-			return super.executeCommand(actionCommand, session, topicmapID, viewmode);
-		}
-	}
-
-	public CorporateDirectives executeChainedCommand(String command, String result,
-													String topicmapID, String viewmode, Session session) {
-		if (command.equals(CMD_ASSIGN_EDIT_ICON)) {
-			CorporateDirectives directives = new CorporateDirectives();
-			// Note: the result of a DIRECTIVE_CHOOSE_FILE contains the absolute
-			// path of the (client side) selected icon file
-			copyAndUpload(result, FILE_IMAGE, PROPERTY_EDIT_PROPERTY_ICON, session, directives);
-			return directives;
-		} else {
-			return super.executeChainedCommand(command, result, topicmapID, viewmode, session);
-		}
-	}
-
-
-
-	// **********************
-	// *** Custom Methods ***
-	// **********************
-
-
-
-	public PropertyDefinition getDefinition() {
-		return propDef;
-	}
-
-	// ---
-
-	String getDataType() {
-		return type;
-	}
-
-	String getVisualization() {
-		return visualization;
-	}
-
-	String getDefaultValue() {
-		return defaultValue;
-	}
-
-	/**
-	 * @see		TypeTopic#makeTypeDefinition
-	 */
-	String getEditIconfile() {
-		return editIconfile;
-	}
-
-	/**
-	 * References checked: 19.10.2001 (2.0a13-pre1)
-	 *
-	 * @return	Vector of {@link de.deepamehta.PresentableTopic}.
-	 *
-	 * @see		TypeTopic#makeTypeDefinition
-	 */
-	Vector getOptions() {
-		return values;
-	}
-
-	// ---
-
-	/**
-	 * Initializes/Updates the property definition.
-	 *
-	 * @see		TypeTopic#addPropertyDefinitions
-	 */
-	void initPropertyDefinition(Session session, CorporateDirectives directives) {
-		this.type = getProperty(&quot;Type&quot;);	// ###
-		this.visualization = getProperty(PROPERTY_VISUALIZATION);
-		this.defaultValue = getProperty(PROPERTY_DEFAULT_VALUE);
-		this.editIconfile = getProperty(PROPERTY_EDIT_PROPERTY_ICON);
-		// --- property values ---		
-		values.setSize(0);		// clear the values vector (needed because this topic is re-inted)
-		Enumeration topics = as.getRelatedTopics(getID(), SEMANTIC_OPTION_DEFINITION,
-			TOPICTYPE_PROPERTY_VALUE, 2, true).elements();		// get all values of this property
-		while (topics.hasMoreElements()) {
-			BaseTopic propertyValue = (BaseTopic) topics.nextElement();
-			values.addElement(as.createPresentableTopic(propertyValue));
-		}
-		//
-		this.propDef = new PropertyDefinition(getName(), type, visualization, defaultValue, editIconfile, values);
-	}
-}
+package de.deepamehta.topics;
+
+import de.deepamehta.BaseTopic;
+import de.deepamehta.PropertyDefinition;
+import de.deepamehta.service.ApplicationService;
+import de.deepamehta.service.CorporateCommands;
+import de.deepamehta.service.CorporateDirectives;
+import de.deepamehta.service.Session;
+
+import java.util.Enumeration;
+import java.util.Vector;
+
+
+
+/**
+ * A topic resp. association property.
+ * &lt;P&gt;
+ * &lt;HR&gt;
+ * Last functional change: 28.9.2004 (2.0b3)&lt;BR&gt;
+ * Last documentation update: 12.11.2000 (2.0a7-pre2)&lt;BR&gt;
+ * J&ouml;rg Richter&lt;BR&gt;
+ * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>
+ */
+public class PropertyTopic extends LiveTopic {
+
+
+
+	// **************
+	// *** Fields ***
+	// **************
+
+
+
+	// model
+	private PropertyDefinition propDef;
+	// ### drop this 4 variables
+	private String type;	// ### to be dropped
+	private String visualization;
+	private String defaultValue;
+	private String editIconfile;
+	private Vector values = new Vector();	// element type is PresentableTopic
+
+	// commands
+	protected static String ITEM_ASSIGN_NEW_PROPERTY_VALUE = &quot;Create Property Value&quot;;
+	protected static final String  CMD_ASSIGN_NEW_PROPERTY_VALUE = &quot;assignNewPropertyValue&quot;;
+	protected static final String ICON_ASSIGN_NEW_PROPERTY_VALUE = &quot;createProperty.gif&quot;;	// ###
+
+	private static final String  CMD_ASSIGN_EDIT_ICON = &quot;assignEditIcon&quot;;
+
+
+
+	// *******************
+	// *** Constructor ***
+	// *******************
+
+
+
+	public PropertyTopic(BaseTopic topic, ApplicationService as) {
+		super(topic, as);
+	}
+
+
+
+	// **********************
+	// *** Defining Hooks ***
+	// **********************
+
+
+
+	// ------------------
+	// --- Life Cycle ---
+	// ------------------
+
+
+
+	// actually not needed. the property model is inited (initPropertyDefinition()) while the type model is inited
+	/* ### public CorporateDirectives init(int initLevel, Session session) throws TopicInitException {
+		CorporateDirectives directives = super.init(initLevel, session);
+		//
+		if (initLevel == INITLEVEL_2) {
+			// ### Note: A PropertyTopic initializes at level 2 because it relies on
+			// ### involved constants beeing in live corporate memory
+			// ### since the constants are preloaded we could actually init at level 1
+			if (LOG_TOPIC_INIT) {
+				System.out.println(&quot;&gt;&gt;&gt; PropertyTopic.init(&quot; + initLevel + &quot;): &quot; +
+					this + &quot; -- set property definition&quot;);
+			}
+			initPropertyDefinition(session, directives);
+		}
+		// Note: actually empty directives are returned
+		return directives;
+	} */
+
+	// since 2.0b3: we use the default-value-facility instead (property &quot;Default Value&quot; of topic type &quot;Property&quot;)
+	/* ### public CorporateDirectives evoke(Session session, String topicmapID, String viewmode) {
+		// --- set default property ---
+		setTopicData(PROPERTY_VISUALIZATION, VISUAL_FIELD);
+		// Note: actually empty directives are returned
+		return super.evoke(session, topicmapID, viewmode);
+	} */
+
+
+
+	// --------------------------
+	// --- Providing Commands ---
+	// --------------------------
+
+
+
+	/**
+	 * @see		de.deepamehta.service.ApplicationService#showTopicMenu
+	 */
+	public CorporateCommands contextCommands(String topicmapID, String viewmode,
+								Session session, CorporateDirectives directives) {
+		CorporateCommands commands = new CorporateCommands(as);
+		int editorContext = as.editorContext(topicmapID);
+		//
+		commands.addNavigationCommands(this, editorContext, session);
+		// --- &quot;Create Property Value&quot; ---
+		commands.addSeparator();
+		int cmdState = session.isDemo() ? COMMAND_STATE_DISABLED : COMMAND_STATE_DEFAULT;
+		commands.addCommand(ITEM_ASSIGN_NEW_PROPERTY_VALUE, CMD_ASSIGN_NEW_PROPERTY_VALUE,
+			FILESERVER_IMAGES_PATH, ICON_ASSIGN_NEW_PROPERTY_VALUE, cmdState);
+		//
+		commands.addStandardCommands(this, editorContext, viewmode, session, directives);
+		//
+		return commands;
+	}
+
+	public static void buttonCommand(PropertyDefinition propDef, ApplicationService as, Session session) {
+		String propName = propDef.getPropertyName();
+		if (propName.equals(PROPERTY_EDIT_PROPERTY_ICON)) {
+			propDef.setActionButton(as.string(BUTTON_ASSIGN_FILE), CMD_ASSIGN_EDIT_ICON);
+		}
+	}
+
+
+
+	// --------------------------
+	// --- Executing Commands ---
+	// --------------------------
+
+
+
+	public CorporateDirectives executeCommand(String actionCommand, Session session,
+													String topicmapID, String viewmode) {
+		CorporateDirectives directives = new CorporateDirectives();
+		//
+		if (actionCommand.equals(CMD_ASSIGN_NEW_PROPERTY_VALUE)) {
+			createChildTopic(TOPICTYPE_PROPERTY_VALUE, SEMANTIC_OPTION_DEFINITION, session, directives);
+			return directives;
+		} else if (actionCommand.equals(CMD_ASSIGN_EDIT_ICON)) {
+			directives.add(DIRECTIVE_CHOOSE_FILE);
+			return directives;
+		} else {
+			return super.executeCommand(actionCommand, session, topicmapID, viewmode);
+		}
+	}
+
+	public CorporateDirectives executeChainedCommand(String command, String result,
+													String topicmapID, String viewmode, Session session) {
+		if (command.equals(CMD_ASSIGN_EDIT_ICON)) {
+			CorporateDirectives directives = new CorporateDirectives();
+			// Note: the result of a DIRECTIVE_CHOOSE_FILE contains the absolute
+			// path of the (client side) selected icon file
+			copyAndUpload(result, FILE_IMAGE, PROPERTY_EDIT_PROPERTY_ICON, session, directives);
+			return directives;
+		} else {
+			return super.executeChainedCommand(command, result, topicmapID, viewmode, session);
+		}
+	}
+
+
+
+	// **********************
+	// *** Custom Methods ***
+	// **********************
+
+
+
+	public PropertyDefinition getDefinition() {
+		return propDef;
+	}
+
+	// ---
+
+	String getDataType() {
+		return type;
+	}
+
+	String getVisualization() {
+		return visualization;
+	}
+
+	String getDefaultValue() {
+		return defaultValue;
+	}
+
+	/**
+	 * @see		TypeTopic#makeTypeDefinition
+	 */
+	String getEditIconfile() {
+		return editIconfile;
+	}
+
+	/**
+	 * References checked: 19.10.2001 (2.0a13-pre1)
+	 *
+	 * @return	Vector of {@link de.deepamehta.PresentableTopic}.
+	 *
+	 * @see		TypeTopic#makeTypeDefinition
+	 */
+	Vector getOptions() {
+		return values;
+	}
+
+	// ---
+
+	/**
+	 * Initializes/Updates the property definition.
+	 *
+	 * @see		TypeTopic#addPropertyDefinitions
+	 */
+	void initPropertyDefinition(Session session, CorporateDirectives directives) {
+		this.type = getProperty(&quot;Type&quot;);	// ###
+		this.visualization = getProperty(PROPERTY_VISUALIZATION);
+		this.defaultValue = getProperty(PROPERTY_DEFAULT_VALUE);
+		this.editIconfile = getProperty(PROPERTY_EDIT_PROPERTY_ICON);
+		// --- property values ---		
+		values.setSize(0);		// clear the values vector (needed because this topic is re-inted)
+		Enumeration topics = as.getRelatedTopics(getID(), SEMANTIC_OPTION_DEFINITION,
+			TOPICTYPE_PROPERTY_VALUE, 2, true).elements();		// get all values of this property
+		while (topics.hasMoreElements()) {
+			BaseTopic propertyValue = (BaseTopic) topics.nextElement();
+			values.addElement(as.createPresentableTopic(propertyValue));
+		}
+		//
+		this.propDef = new PropertyDefinition(getName(), type, visualization, defaultValue, editIconfile, values);
+	}
+}

Modified: branches/eschnepel/develop/src/de/deepamehta/topics/helper/EmailChecker.java
===================================================================
--- branches/eschnepel/develop/src/de/deepamehta/topics/helper/EmailChecker.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/develop/src/de/deepamehta/topics/helper/EmailChecker.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,378 +1,378 @@
-package de.deepamehta.topics.helper;
-
-import de.deepamehta.BaseTopic;
-import de.deepamehta.DeepaMehtaConstants;
-import de.deepamehta.service.ApplicationService;
-
-import com.sun.mail.pop3.POP3Folder;
-
-import java.io.BufferedInputStream;
-import java.io.BufferedOutputStream;
-import java.io.BufferedReader;
-import java.io.BufferedWriter;
-import java.io.File;
-import java.io.FileOutputStream;
-import java.io.FileWriter;
-import java.io.IOException;
-import java.io.InputStream;
-import java.io.OutputStream;
-import java.io.Reader;
-import java.io.StringReader;
-import java.io.Writer;
-import java.util.Date;
-import java.util.Enumeration;
-import java.util.Hashtable;
-import java.util.Properties;
-import java.util.Vector;
-
-import javax.mail.Address;
-import javax.mail.FetchProfile;
-import javax.mail.Folder;
-import javax.mail.Message;
-import javax.mail.MessagingException;
-import javax.mail.Multipart;
-import javax.mail.Part;
-import javax.mail.Session;
-import javax.mail.Store;
-import javax.mail.UIDFolder;
-import javax.mail.URLName;
-import javax.mail.internet.InternetAddress;
-
-
-
-public class EmailChecker implements DeepaMehtaConstants, Runnable {
-
-	public static final String ASSOCTYPE_ATTACHEMENT = &quot;at-attachement&quot;;
-	
-	public class MsgFound {
-
-		public boolean	bFound;
-		public String	text;
-		
-		MsgFound() { 
-			bFound = false;
-			text = new String();
-		}
-	}
-	
-	static final long clSleep = 5 * 60 * 1000;	// every 5 minutes
-	private String	userID;
-	private int		userVersion;
-	ApplicationService	as;
-
-	/**
-	 * @see		de.deepamehta.service.ApplicationService#startSession
-	 */
-	public EmailChecker(String userID, int userVersion, ApplicationService as) {
-		this.userID = userID;
-		this.userVersion = userVersion;
-		this.as = as;
-		//
-		new Thread(this).start();
-	}
-	
-	public void run() {
-		while (true) {
-			updateEmails();
-			try {
-				Thread.sleep(clSleep);
-			} catch (InterruptedException e) {
-			}
-		}
-	}
-	
-	public synchronized void updateEmails() {
-		try {
-			// ### System.out.println(&quot;&gt;&gt;&gt; checking emails for user \&quot;&quot; + userID + &quot;\&quot;&quot;);
-			int newMailCount = 0;
-			String mbox = &quot;INBOX&quot;;
-			UIDFolder ufolder = null;
-			POP3Folder pfolder = null;
-			//
-			Properties props = System.getProperties();
-			Session session = Session.getInstance(props, null);
-			// session.setDebug(debug);
-			Store store = null;
-			String url = as.getMailboxURL(userID);
-			if (url == null) {
-				// ### System.out.println(&quot;*** EmailChecker.updateEmails(): for user \&quot;&quot; + userID + &quot;\&quot; no mailbox is set&quot;);
-				return;
-			}
-			URLName urln = new URLName(url);
-			store = session.getStore(urln);
-			store.connect();
-			Folder folder = store.getDefaultFolder();
-			if (folder == null) {
-				System.out.println(&quot;No default folder&quot;);
-				return;
-			}
-			folder = folder.getFolder(mbox);
-			if (folder == null) {
-				System.out.println(&quot;Invalid folder&quot;);
-				return;
-			}
-			//
-			if ((folder instanceof UIDFolder)) {
-			    ufolder = (UIDFolder)folder;
-			} else if (folder instanceof POP3Folder) {
-				pfolder = (POP3Folder)folder;
-			} else {
-				System.out.println(&quot;This Provider or this folder does not support UIDs&quot;);
-				return;
-			}
-			try {
-				folder.open(Folder.READ_WRITE);
-			} catch (MessagingException ex) {
-				folder.open(Folder.READ_ONLY);
-			}
-			int totalMessages = folder.getMessageCount();
-			//
-			if (totalMessages == 0) {
-				System.out.println(&quot;Empty folder&quot;);
-				folder.close(false);
-				store.close();
-				return;
-			}
-			// Attributes &amp; Flags for all messages ..
-			Message[] msgs = folder.getMessages();
-			// Use a suitable FetchProfile
-			FetchProfile fp = new FetchProfile();
-			fp.add(FetchProfile.Item.ENVELOPE);
-			fp.add(FetchProfile.Item.FLAGS);
-			fp.add(&quot;X-Mailer&quot;);
-			folder.fetch(msgs, fp);
-			//
-			Hashtable mailsMap = getMailsMap(userID, userVersion);
-			for (int i = 0; i &lt; msgs.length; i++) {
-				String sUID = &quot;&quot;;
-				if (ufolder != null) {
-					sUID += ufolder.getUID(msgs[i]);
-				} else {
-					sUID += pfolder.getUID(msgs[i]);
-				}
-				if (mailsMap.get(sUID) == null) {
-					addEmail(msgs[i], sUID);
-					newMailCount++;
-				}
-			}
-			//
-			System.out.println(&quot;&gt;&gt;&gt; &quot; + newMailCount + &quot; new emails for user \&quot;&quot; + userID + &quot;\&quot;&quot;);
-			folder.close(false);
-			store.close();
-		} catch (NoClassDefFoundError e) {
-			System.out.println(&quot;*** EmailChecker.updateEmails(): &quot; + e + &quot; -- mailbox for \&quot;&quot; + userID + &quot;\&quot; not updated&quot;);
-			String className = e.getMessage();
-			if (className.startsWith(&quot;javax/mail/&quot;)) {
-				System.out.println(&quot;&gt;&gt;&gt; Make shure Sun's Javamail package (mail.jar) is installed correctly&quot;);
-			}
-		} catch (Exception e) {
-			System.out.println(&quot;*** EmailChecker.updateEmails(): &quot; + e + &quot; -- mailbox for \&quot;&quot; + userID + &quot;\&quot; not updated&quot;);
-		}
-	}
-	
-	void addEmail(Message msg, String sUID) {
-		String name = &quot;&quot;;	// topicname
-		String author = &quot;&quot;;
-		String authorAddress = &quot;&quot;;
-		String rcpts = &quot;&quot;;
-		String subject = &quot;&quot;;
-		String date = &quot;Unknown&quot;;
-		MsgFound msgFound = new MsgFound();
-		Vector attachs = new Vector();
-		try {
-			name = msg.getSubject();
-			if (name.length() &gt; 32) {	// ###
-				name = name.substring( 0, 32);
-			}
-			Address[] a = msg.getFrom();
-			if (a != null) {
-				for (int i = 0; i &lt; a.length; i++) {
-					if (i &gt; 0) {
-						author += &quot;, &quot;;
-					}
-					if (a[i] instanceof InternetAddress) {
-						InternetAddress ia = (InternetAddress)a[i];
-						author += ia.getPersonal() + &quot; &lt;&quot; + ia.getAddress() + &quot;&gt;&quot;;
-						if (authorAddress.length()==0) {
-							authorAddress = ia.getAddress();
-						}
-					} else {
-						author += a[i].toString();
-					}
-				}
-			}
-			//
-			a = msg.getRecipients(Message.RecipientType.TO);
-			if (a != null) {
-				for (int i = 0; i &lt; a.length; i++) {
-					if (i &gt; 0) {
-						rcpts += &quot;,&quot;;
-					}
-					rcpts += a[i].toString();
-				}
-			}
-			subject = msg.getSubject();
-			Date d = msg.getSentDate();
-			if (d != null) {
-				date = d.toString();
-			}
-			traverseParts(msg, msgFound, attachs);
-		} catch (Exception ex) {
-			System.out.println(&quot;*** EmailChecker.addEmail(): &quot; + ex);
-			ex.printStackTrace();
-		}
-		// create &quot;Email&quot; topic
-		System.out.println(&quot;&gt; new mail from \&quot;&quot; + author + &quot;\&quot;: \&quot;&quot; + subject + &quot;\&quot;, &quot; + date);
-		String topicID = as.cm.getNewTopicID();
-		as.cm.createTopic(topicID, 1, TOPICTYPE_EMAIL, 1, name);
-		Hashtable props = new Hashtable();
-		props.put(PROPERTY_FROM, author);
-		props.put(&quot;AuthorAddress&quot;, authorAddress);
-		props.put(PROPERTY_TO, rcpts);
-		props.put(PROPERTY_SUBJECT, subject);
-		props.put(&quot;UID&quot;, sUID);
-		props.put(PROPERTY_STATUS, &quot;Received&quot;);
-		props.put(PROPERTY_DATE, date);
-		props.put(PROPERTY_TEXT, msgFound.bFound ? msgFound.text : &quot;&quot;);
-		as.cm.setTopicData(topicID, 1, props);
-		String assocID = as.cm.getNewAssociationID();
-		as.cm.createAssociation(assocID, 1, ASSOCTYPE_ASSOCIATION, 1, topicID, 1, userID, 1);
-		//
-		addAttachs(topicID, attachs);
-	}
-
-	public boolean traverseParts(Part p, MsgFound msgFound, Vector attachs) {
-		try {
-			if (p.isMimeType(&quot;text/plain&quot;)) {
-				if (!msgFound.bFound) {
-					msgFound.text = (String)p.getContent();
-					msgFound.bFound = true;
-				} else {
-					attachs.add(p);
-				}
-			} else if (p.isMimeType(&quot;multipart/*&quot;)) {
-				Multipart mp = (Multipart)p.getContent();
-				int count = mp.getCount();
-				for (int i = 0; i &lt; count; i++) {
-					traverseParts( mp.getBodyPart(i), msgFound, attachs);
-				}
-			} else if (p.isMimeType(&quot;message/rfc822&quot;)) {
-				//todo
-			} else {
-				Object o = p.getContent();
-				if (o instanceof String) {
-					//todo
-				} else if (o instanceof InputStream) {
-					attachs.add(p);
-				}
-			}
-		} catch (MessagingException ex) {
-			System.out.println(&quot;EmailChecker.traverseParts: E-mail exception &quot; + ex.getMessage());
-			ex.printStackTrace();
-		} catch (Exception ex) {
-			System.out.println(&quot;EmailChecker.traverseParts: Exception &quot; + ex.getMessage());
-			ex.printStackTrace();
-		}
-		return true;
-	}
-	
-	public void addAttachs(String mailID, Vector attachs) {
-		Enumeration e = attachs.elements();
-		try {
-			while (e.hasMoreElements()) {
-				Part p = (Part)e.nextElement();
-				String fileName = p.getFileName();
-				if (fileName == null) { continue;
-				}
-				if (p.isMimeType(&quot;text/plain&quot;)) {
-					addAttach(mailID, p.getContentType(), fileName, new StringReader((String)p.getContent()));
-				} else {
-					Object o = p.getContent();
-					if (o instanceof InputStream) {
-						addAttach( mailID, p.getContentType(), fileName, (InputStream)o);
-					}
-				}
-			}
-		} catch (MessagingException ex) {
-			System.out.println(&quot;EmailChecker.addAttachs: E-mail exception &quot; + ex.getMessage());
-			ex.printStackTrace();
-		} catch (IOException ex) {
-			return;
-		}
-	}
-	
-	public boolean addAttach(String mailID, String mimeType, String fileName, Object inData) {
-		String path = FILESERVER_DOCUMENTS_PATH;
-		File dstDir = new File(path);
-		// ### create target directory
-		if (dstDir.mkdirs()) {
-			System.out.println(&quot;&gt;&gt;&gt; EmailChecker.saveAttach(): target directory created: &quot; + dstDir);
-		}
-		File dstFile;
-		try {
-			dstFile = File.createTempFile(&quot;att&quot;, fileName, dstDir);	// ### requires JDK 1.2
-			if (inData instanceof InputStream) {
-				copyFile((InputStream) inData, dstFile);
-			}else if (inData instanceof Reader) {
-				copyFile((Reader) inData, dstFile);
-			}
-		} catch (IOException e) {
-			return false;
-		}
-		//
-		Hashtable props = new Hashtable();
-		String topicID = as.cm.getNewTopicID();
-		as.cm.createTopic(topicID, 1, TOPICTYPE_DOCUMENT, 1, fileName);
-		props.put(&quot;File&quot;, dstFile.getName());
-		props.put(&quot;MimeType&quot;, mimeType);
-		as.cm.setTopicData(topicID, 1, props);
-		String assocID = as.cm.getNewAssociationID();
-		as.cm.createAssociation(assocID, 1, ASSOCTYPE_ATTACHEMENT, 1, topicID, 1, mailID, 1);
-		return true;
-	}
-
-	public void copyFile(InputStream inStream, File dstFile) throws IOException {
-		InputStream fileIn = new BufferedInputStream(inStream, FILE_BUFFER_SIZE);
-		OutputStream fileOut = new BufferedOutputStream(
-							   new FileOutputStream(dstFile), FILE_BUFFER_SIZE);
-		byte[] buffer = new byte[FILE_BUFFER_SIZE];
-		long totalBytes = 0;
-		int readBytes;
-		while ((readBytes = fileIn.read(buffer)) != -1) {
-			fileOut.write(buffer, 0, readBytes);
-			totalBytes += readBytes;
-		}
-		fileIn.close();
-		fileOut.close();
-		System.out.println(&quot;&gt; &quot; + totalBytes + &quot; bytes copied&quot;);
-	}
-	
-	public void copyFile(Reader reader, File dstFile) throws IOException {
-		Reader fileIn = new BufferedReader(reader, FILE_BUFFER_SIZE/2);
-		Writer fileOut = new BufferedWriter(new FileWriter(dstFile), FILE_BUFFER_SIZE/2);
-		char[] buffer = new char[FILE_BUFFER_SIZE/2];
-		long totalChars = 0;
-		int readChars;
-		while ((readChars = fileIn.read(buffer)) != -1) {
-			fileOut.write(buffer, 0, readChars);
-			totalChars += readChars;
-		}
-		fileIn.close();
-		fileOut.close();
-		System.out.println(&quot;&gt; &quot; + totalChars + &quot; chars copied&quot;);
-	}
-	
-	public Hashtable getMailsMap(String userID, int userVersion) {
-		Hashtable mapMails = new Hashtable();
-		Enumeration mails = as.getRelatedTopics(userID, ASSOCTYPE_ASSOCIATION, 1).elements();
-		while (mails.hasMoreElements()) {
-			BaseTopic mail = (BaseTopic) mails.nextElement();
-			if (mail.getType().equals(TOPICTYPE_EMAIL)) {
-				String uid = as.getTopicProperty(mail.getID(), mail.getVersion(), &quot;UID&quot;);
-				mapMails.put(uid, mail);
-			}
-		}
-		return mapMails;
-	}
-}
-
+package de.deepamehta.topics.helper;
+
+import de.deepamehta.BaseTopic;
+import de.deepamehta.DeepaMehtaConstants;
+import de.deepamehta.service.ApplicationService;
+
+import com.sun.mail.pop3.POP3Folder;
+
+import java.io.BufferedInputStream;
+import java.io.BufferedOutputStream;
+import java.io.BufferedReader;
+import java.io.BufferedWriter;
+import java.io.File;
+import java.io.FileOutputStream;
+import java.io.FileWriter;
+import java.io.IOException;
+import java.io.InputStream;
+import java.io.OutputStream;
+import java.io.Reader;
+import java.io.StringReader;
+import java.io.Writer;
+import java.util.Date;
+import java.util.Enumeration;
+import java.util.Hashtable;
+import java.util.Properties;
+import java.util.Vector;
+
+import javax.mail.Address;
+import javax.mail.FetchProfile;
+import javax.mail.Folder;
+import javax.mail.Message;
+import javax.mail.MessagingException;
+import javax.mail.Multipart;
+import javax.mail.Part;
+import javax.mail.Session;
+import javax.mail.Store;
+import javax.mail.UIDFolder;
+import javax.mail.URLName;
+import javax.mail.internet.InternetAddress;
+
+
+
+public class EmailChecker implements DeepaMehtaConstants, Runnable {
+
+	public static final String ASSOCTYPE_ATTACHEMENT = &quot;at-attachement&quot;;
+	
+	public class MsgFound {
+
+		public boolean	bFound;
+		public String	text;
+		
+		MsgFound() { 
+			bFound = false;
+			text = new String();
+		}
+	}
+	
+	static final long clSleep = 5 * 60 * 1000;	// every 5 minutes
+	private String	userID;
+	private int		userVersion;
+	ApplicationService	as;
+
+	/**
+	 * @see		de.deepamehta.service.ApplicationService#startSession
+	 */
+	public EmailChecker(String userID, int userVersion, ApplicationService as) {
+		this.userID = userID;
+		this.userVersion = userVersion;
+		this.as = as;
+		//
+		new Thread(this).start();
+	}
+	
+	public void run() {
+		while (true) {
+			updateEmails();
+			try {
+				Thread.sleep(clSleep);
+			} catch (InterruptedException e) {
+			}
+		}
+	}
+	
+	public synchronized void updateEmails() {
+		try {
+			// ### System.out.println(&quot;&gt;&gt;&gt; checking emails for user \&quot;&quot; + userID + &quot;\&quot;&quot;);
+			int newMailCount = 0;
+			String mbox = &quot;INBOX&quot;;
+			UIDFolder ufolder = null;
+			POP3Folder pfolder = null;
+			//
+			Properties props = System.getProperties();
+			Session session = Session.getInstance(props, null);
+			// session.setDebug(debug);
+			Store store = null;
+			String url = as.getMailboxURL(userID);
+			if (url == null) {
+				// ### System.out.println(&quot;*** EmailChecker.updateEmails(): for user \&quot;&quot; + userID + &quot;\&quot; no mailbox is set&quot;);
+				return;
+			}
+			URLName urln = new URLName(url);
+			store = session.getStore(urln);
+			store.connect();
+			Folder folder = store.getDefaultFolder();
+			if (folder == null) {
+				System.out.println(&quot;No default folder&quot;);
+				return;
+			}
+			folder = folder.getFolder(mbox);
+			if (folder == null) {
+				System.out.println(&quot;Invalid folder&quot;);
+				return;
+			}
+			//
+			if ((folder instanceof UIDFolder)) {
+			    ufolder = (UIDFolder)folder;
+			} else if (folder instanceof POP3Folder) {
+				pfolder = (POP3Folder)folder;
+			} else {
+				System.out.println(&quot;This Provider or this folder does not support UIDs&quot;);
+				return;
+			}
+			try {
+				folder.open(Folder.READ_WRITE);
+			} catch (MessagingException ex) {
+				folder.open(Folder.READ_ONLY);
+			}
+			int totalMessages = folder.getMessageCount();
+			//
+			if (totalMessages == 0) {
+				System.out.println(&quot;Empty folder&quot;);
+				folder.close(false);
+				store.close();
+				return;
+			}
+			// Attributes &amp; Flags for all messages ..
+			Message[] msgs = folder.getMessages();
+			// Use a suitable FetchProfile
+			FetchProfile fp = new FetchProfile();
+			fp.add(FetchProfile.Item.ENVELOPE);
+			fp.add(FetchProfile.Item.FLAGS);
+			fp.add(&quot;X-Mailer&quot;);
+			folder.fetch(msgs, fp);
+			//
+			Hashtable mailsMap = getMailsMap(userID, userVersion);
+			for (int i = 0; i &lt; msgs.length; i++) {
+				String sUID = &quot;&quot;;
+				if (ufolder != null) {
+					sUID += ufolder.getUID(msgs[i]);
+				} else {
+					sUID += pfolder.getUID(msgs[i]);
+				}
+				if (mailsMap.get(sUID) == null) {
+					addEmail(msgs[i], sUID);
+					newMailCount++;
+				}
+			}
+			//
+			System.out.println(&quot;&gt;&gt;&gt; &quot; + newMailCount + &quot; new emails for user \&quot;&quot; + userID + &quot;\&quot;&quot;);
+			folder.close(false);
+			store.close();
+		} catch (NoClassDefFoundError e) {
+			System.out.println(&quot;*** EmailChecker.updateEmails(): &quot; + e + &quot; -- mailbox for \&quot;&quot; + userID + &quot;\&quot; not updated&quot;);
+			String className = e.getMessage();
+			if (className.startsWith(&quot;javax/mail/&quot;)) {
+				System.out.println(&quot;&gt;&gt;&gt; Make shure Sun's Javamail package (mail.jar) is installed correctly&quot;);
+			}
+		} catch (Exception e) {
+			System.out.println(&quot;*** EmailChecker.updateEmails(): &quot; + e + &quot; -- mailbox for \&quot;&quot; + userID + &quot;\&quot; not updated&quot;);
+		}
+	}
+	
+	void addEmail(Message msg, String sUID) {
+		String name = &quot;&quot;;	// topicname
+		String author = &quot;&quot;;
+		String authorAddress = &quot;&quot;;
+		String rcpts = &quot;&quot;;
+		String subject = &quot;&quot;;
+		String date = &quot;Unknown&quot;;
+		MsgFound msgFound = new MsgFound();
+		Vector attachs = new Vector();
+		try {
+			name = msg.getSubject();
+			if (name.length() &gt; 32) {	// ###
+				name = name.substring( 0, 32);
+			}
+			Address[] a = msg.getFrom();
+			if (a != null) {
+				for (int i = 0; i &lt; a.length; i++) {
+					if (i &gt; 0) {
+						author += &quot;, &quot;;
+					}
+					if (a[i] instanceof InternetAddress) {
+						InternetAddress ia = (InternetAddress)a[i];
+						author += ia.getPersonal() + &quot; &lt;&quot; + ia.getAddress() + &quot;&gt;&quot;;
+						if (authorAddress.length()==0) {
+							authorAddress = ia.getAddress();
+						}
+					} else {
+						author += a[i].toString();
+					}
+				}
+			}
+			//
+			a = msg.getRecipients(Message.RecipientType.TO);
+			if (a != null) {
+				for (int i = 0; i &lt; a.length; i++) {
+					if (i &gt; 0) {
+						rcpts += &quot;,&quot;;
+					}
+					rcpts += a[i].toString();
+				}
+			}
+			subject = msg.getSubject();
+			Date d = msg.getSentDate();
+			if (d != null) {
+				date = d.toString();
+			}
+			traverseParts(msg, msgFound, attachs);
+		} catch (Exception ex) {
+			System.out.println(&quot;*** EmailChecker.addEmail(): &quot; + ex);
+			ex.printStackTrace();
+		}
+		// create &quot;Email&quot; topic
+		System.out.println(&quot;&gt; new mail from \&quot;&quot; + author + &quot;\&quot;: \&quot;&quot; + subject + &quot;\&quot;, &quot; + date);
+		String topicID = as.cm.getNewTopicID();
+		as.cm.createTopic(topicID, 1, TOPICTYPE_EMAIL, 1, name);
+		Hashtable props = new Hashtable();
+		props.put(PROPERTY_FROM, author);
+		props.put(&quot;AuthorAddress&quot;, authorAddress);
+		props.put(PROPERTY_TO, rcpts);
+		props.put(PROPERTY_SUBJECT, subject);
+		props.put(&quot;UID&quot;, sUID);
+		props.put(PROPERTY_STATUS, &quot;Received&quot;);
+		props.put(PROPERTY_DATE, date);
+		props.put(PROPERTY_TEXT, msgFound.bFound ? msgFound.text : &quot;&quot;);
+		as.cm.setTopicData(topicID, 1, props);
+		String assocID = as.cm.getNewAssociationID();
+		as.cm.createAssociation(assocID, 1, ASSOCTYPE_ASSOCIATION, 1, topicID, 1, userID, 1);
+		//
+		addAttachs(topicID, attachs);
+	}
+
+	public boolean traverseParts(Part p, MsgFound msgFound, Vector attachs) {
+		try {
+			if (p.isMimeType(&quot;text/plain&quot;)) {
+				if (!msgFound.bFound) {
+					msgFound.text = (String)p.getContent();
+					msgFound.bFound = true;
+				} else {
+					attachs.add(p);
+				}
+			} else if (p.isMimeType(&quot;multipart/*&quot;)) {
+				Multipart mp = (Multipart)p.getContent();
+				int count = mp.getCount();
+				for (int i = 0; i &lt; count; i++) {
+					traverseParts( mp.getBodyPart(i), msgFound, attachs);
+				}
+			} else if (p.isMimeType(&quot;message/rfc822&quot;)) {
+				//todo
+			} else {
+				Object o = p.getContent();
+				if (o instanceof String) {
+					//todo
+				} else if (o instanceof InputStream) {
+					attachs.add(p);
+				}
+			}
+		} catch (MessagingException ex) {
+			System.out.println(&quot;EmailChecker.traverseParts: E-mail exception &quot; + ex.getMessage());
+			ex.printStackTrace();
+		} catch (Exception ex) {
+			System.out.println(&quot;EmailChecker.traverseParts: Exception &quot; + ex.getMessage());
+			ex.printStackTrace();
+		}
+		return true;
+	}
+	
+	public void addAttachs(String mailID, Vector attachs) {
+		Enumeration e = attachs.elements();
+		try {
+			while (e.hasMoreElements()) {
+				Part p = (Part)e.nextElement();
+				String fileName = p.getFileName();
+				if (fileName == null) { continue;
+				}
+				if (p.isMimeType(&quot;text/plain&quot;)) {
+					addAttach(mailID, p.getContentType(), fileName, new StringReader((String)p.getContent()));
+				} else {
+					Object o = p.getContent();
+					if (o instanceof InputStream) {
+						addAttach( mailID, p.getContentType(), fileName, (InputStream)o);
+					}
+				}
+			}
+		} catch (MessagingException ex) {
+			System.out.println(&quot;EmailChecker.addAttachs: E-mail exception &quot; + ex.getMessage());
+			ex.printStackTrace();
+		} catch (IOException ex) {
+			return;
+		}
+	}
+	
+	public boolean addAttach(String mailID, String mimeType, String fileName, Object inData) {
+		String path = FILESERVER_DOCUMENTS_PATH;
+		File dstDir = new File(path);
+		// ### create target directory
+		if (dstDir.mkdirs()) {
+			System.out.println(&quot;&gt;&gt;&gt; EmailChecker.saveAttach(): target directory created: &quot; + dstDir);
+		}
+		File dstFile;
+		try {
+			dstFile = File.createTempFile(&quot;att&quot;, fileName, dstDir);	// ### requires JDK 1.2
+			if (inData instanceof InputStream) {
+				copyFile((InputStream) inData, dstFile);
+			}else if (inData instanceof Reader) {
+				copyFile((Reader) inData, dstFile);
+			}
+		} catch (IOException e) {
+			return false;
+		}
+		//
+		Hashtable props = new Hashtable();
+		String topicID = as.cm.getNewTopicID();
+		as.cm.createTopic(topicID, 1, TOPICTYPE_DOCUMENT, 1, fileName);
+		props.put(&quot;File&quot;, dstFile.getName());
+		props.put(&quot;MimeType&quot;, mimeType);
+		as.cm.setTopicData(topicID, 1, props);
+		String assocID = as.cm.getNewAssociationID();
+		as.cm.createAssociation(assocID, 1, ASSOCTYPE_ATTACHEMENT, 1, topicID, 1, mailID, 1);
+		return true;
+	}
+
+	public void copyFile(InputStream inStream, File dstFile) throws IOException {
+		InputStream fileIn = new BufferedInputStream(inStream, FILE_BUFFER_SIZE);
+		OutputStream fileOut = new BufferedOutputStream(
+							   new FileOutputStream(dstFile), FILE_BUFFER_SIZE);
+		byte[] buffer = new byte[FILE_BUFFER_SIZE];
+		long totalBytes = 0;
+		int readBytes;
+		while ((readBytes = fileIn.read(buffer)) != -1) {
+			fileOut.write(buffer, 0, readBytes);
+			totalBytes += readBytes;
+		}
+		fileIn.close();
+		fileOut.close();
+		System.out.println(&quot;&gt; &quot; + totalBytes + &quot; bytes copied&quot;);
+	}
+	
+	public void copyFile(Reader reader, File dstFile) throws IOException {
+		Reader fileIn = new BufferedReader(reader, FILE_BUFFER_SIZE/2);
+		Writer fileOut = new BufferedWriter(new FileWriter(dstFile), FILE_BUFFER_SIZE/2);
+		char[] buffer = new char[FILE_BUFFER_SIZE/2];
+		long totalChars = 0;
+		int readChars;
+		while ((readChars = fileIn.read(buffer)) != -1) {
+			fileOut.write(buffer, 0, readChars);
+			totalChars += readChars;
+		}
+		fileIn.close();
+		fileOut.close();
+		System.out.println(&quot;&gt; &quot; + totalChars + &quot; chars copied&quot;);
+	}
+	
+	public Hashtable getMailsMap(String userID, int userVersion) {
+		Hashtable mapMails = new Hashtable();
+		Enumeration mails = as.getRelatedTopics(userID, ASSOCTYPE_ASSOCIATION, 1).elements();
+		while (mails.hasMoreElements()) {
+			BaseTopic mail = (BaseTopic) mails.nextElement();
+			if (mail.getType().equals(TOPICTYPE_EMAIL)) {
+				String uid = as.getTopicProperty(mail.getID(), mail.getVersion(), &quot;UID&quot;);
+				mapMails.put(uid, mail);
+			}
+		}
+		return mapMails;
+	}
+}
+

Modified: branches/eschnepel/develop/src/de/deepamehta/topics/helper/WhoisRequest.java
===================================================================
--- branches/eschnepel/develop/src/de/deepamehta/topics/helper/WhoisRequest.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/develop/src/de/deepamehta/topics/helper/WhoisRequest.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,113 +1,113 @@
-package de.deepamehta.topics.helper;
-
-import java.io.BufferedReader;
-import java.io.DataOutputStream;
-import java.io.IOException;
-import java.io.InputStreamReader;
-import java.net.Socket;
-
-
-
-/**
- * This class is used for sending requests on whois servers.
- */
-public class WhoisRequest {
-
-	// - - - - - - - - - - - - - - - - - - - - - Vars
-	
-	/**
-	 * holds the search term and the results
-	 */	
-	private StringBuffer query;		// holds the search term and the results.
-	/**
-	 * holds the query domain
-	 */	
-	private String targetDomain;	// holds the query domain.
-	/**
-	 * used to catch input 1 line at a time
-	 */	
-	private String feed;			// used to catch input 1 line at a time.
-	/**
-	 * the TCP socket
-	 */	
-	private Socket socket;			// the TCP socket. 
-	/**
-	 * reads data in from the socket
-	 */	
-	private BufferedReader in;		// reads data in from the socket.
-	/**
-	 * writes data to the socket
-	 */	
-	private DataOutputStream out;	// writes data to the socket.
-	/**
-	 * whois server address
-	 */	
-	private String whoisServer;		// whois server address
-		
-	// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - Whois(String)
-	/**
-	 * constructor
-	 *
-	 * @param _whoisServer Whois server URL
-	 */
-		
-	/* *******************************************************
-	 * PRE:		
-	 * IN:		java.lang.String. The query string.
-	 * OUT:		
-	 * THROWS:	
-	 ********************************************************/
-	
-	public WhoisRequest(String _whoisServer) {
-		this.whoisServer=_whoisServer;
-	}
-	
-	/**
-	 * sends request to whois server
-	 *
-	 * @param _targetDomain domain
-	 * @return information from the whois server
-	 */
-
-	// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - String whois()
-	/* *******************************************************
-	 * PRE:		
-	 * IN:		
-	 * OUT:		java.lang.String. The whois daemon reply. With \n's.
-	 * THROWS:	IOexception. Socket could not be opened.
-	 ********************************************************/
-	
-	public String whois(String _targetDomain) throws IOException{
-
-		this.targetDomain = _targetDomain;
-
-	/* Initialize some variables. */
-
-		feed = new String(&quot;&quot;);
-		query = new StringBuffer(&quot;&quot;);
-
-	/* Open a new socket. */
-
-		//socket = new Socket(&quot;whois.internic.net&quot;,43);
-		socket = new Socket(whoisServer,43);
-
-	/* Attatch a BufferedReader to the socket to read in data. */
-
-		in = new BufferedReader(new InputStreamReader(socket.getInputStream()));
-
-	/* Attatch a DataOutputStream to the socket to write data out. */
-
-		out = new DataOutputStream(socket.getOutputStream());
-
-	/* After the connection, send the target query. */
-
-		out.writeBytes(targetDomain+&quot;\n&quot;);
-
-	/* Read in the response line by line and then return it to the calling program. */
-
-		while((feed = in.readLine())!=null){
-			query.append(feed+&quot;\n&quot;);
-		}
-		return (query.toString());
-	}	
-}
+package de.deepamehta.topics.helper;
+
+import java.io.BufferedReader;
+import java.io.DataOutputStream;
+import java.io.IOException;
+import java.io.InputStreamReader;
+import java.net.Socket;
+
+
+
+/**
+ * This class is used for sending requests on whois servers.
+ */
+public class WhoisRequest {
+
+	// - - - - - - - - - - - - - - - - - - - - - Vars
+	
+	/**
+	 * holds the search term and the results
+	 */	
+	private StringBuffer query;		// holds the search term and the results.
+	/**
+	 * holds the query domain
+	 */	
+	private String targetDomain;	// holds the query domain.
+	/**
+	 * used to catch input 1 line at a time
+	 */	
+	private String feed;			// used to catch input 1 line at a time.
+	/**
+	 * the TCP socket
+	 */	
+	private Socket socket;			// the TCP socket. 
+	/**
+	 * reads data in from the socket
+	 */	
+	private BufferedReader in;		// reads data in from the socket.
+	/**
+	 * writes data to the socket
+	 */	
+	private DataOutputStream out;	// writes data to the socket.
+	/**
+	 * whois server address
+	 */	
+	private String whoisServer;		// whois server address
+		
+	// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - Whois(String)
+	/**
+	 * constructor
+	 *
+	 * @param _whoisServer Whois server URL
+	 */
+		
+	/* *******************************************************
+	 * PRE:		
+	 * IN:		java.lang.String. The query string.
+	 * OUT:		
+	 * THROWS:	
+	 ********************************************************/
+	
+	public WhoisRequest(String _whoisServer) {
+		this.whoisServer=_whoisServer;
+	}
+	
+	/**
+	 * sends request to whois server
+	 *
+	 * @param _targetDomain domain
+	 * @return information from the whois server
+	 */
+
+	// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - String whois()
+	/* *******************************************************
+	 * PRE:		
+	 * IN:		
+	 * OUT:		java.lang.String. The whois daemon reply. With \n's.
+	 * THROWS:	IOexception. Socket could not be opened.
+	 ********************************************************/
+	
+	public String whois(String _targetDomain) throws IOException{
+
+		this.targetDomain = _targetDomain;
+
+	/* Initialize some variables. */
+
+		feed = new String(&quot;&quot;);
+		query = new StringBuffer(&quot;&quot;);
+
+	/* Open a new socket. */
+
+		//socket = new Socket(&quot;whois.internic.net&quot;,43);
+		socket = new Socket(whoisServer,43);
+
+	/* Attatch a BufferedReader to the socket to read in data. */
+
+		in = new BufferedReader(new InputStreamReader(socket.getInputStream()));
+
+	/* Attatch a DataOutputStream to the socket to write data out. */
+
+		out = new DataOutputStream(socket.getOutputStream());
+
+	/* After the connection, send the target query. */
+
+		out.writeBytes(targetDomain+&quot;\n&quot;);
+
+	/* Read in the response line by line and then return it to the calling program. */
+
+		while((feed = in.readLine())!=null){
+			query.append(feed+&quot;\n&quot;);
+		}
+		return (query.toString());
+	}	
+}

Modified: branches/eschnepel/install/db/db-specific/db_tables_oracle.sql
===================================================================
--- branches/eschnepel/install/db/db-specific/db_tables_oracle.sql	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/db/db-specific/db_tables_oracle.sql	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,87 +1,87 @@
--- DeepaMehta database model for use with Oracle.
--- This script creates just the tables.
-
-CREATE TABLE topic (
-    typeid      VARCHAR2(40) NOT NULL,
-    typeversion INT         NOT NULL,
-    version     INT         NOT NULL,
-    id          VARCHAR2(40) NOT NULL,
-    name        VARCHAR2(255) NOT NULL,
-    CONSTRAINT pk_topic PRIMARY KEY (id, version)
-);
-CREATE INDEX i_topic ON topic (typeid, typeversion, name);
-
--- ----------------------------------------------------------------------------
-
-CREATE TABLE association (
-    typeid        VARCHAR2(40) NOT NULL,
-    typeversion   INT         NOT NULL,
-    version       INT         NOT NULL,
-    id            VARCHAR2(40) NOT NULL,
-    name          VARCHAR2(255) NOT NULL,
-    topicid1      VARCHAR2(40) NOT NULL,
-    topicversion1 INT         NOT NULL,
-    topicid2      VARCHAR2(40) NOT NULL,
-    topicversion2 INT         NOT NULL,
-    CONSTRAINT pk_association PRIMARY KEY (id, version)
-);
-CREATE INDEX i1_association ON association (id, version, typeid, typeversion);
-CREATE INDEX i2_association ON association (topicid1, topicversion1);
-CREATE INDEX i3_association ON association (topicid2, topicversion2);
-
--- ----------------------------------------------------------------------------
-
-CREATE TABLE viewtopic (
-    viewtopicid      VARCHAR2(40) NOT NULL,
-    viewtopicversion INT         NOT NULL,
-    topicid          VARCHAR2(40) NOT NULL,
-    topicversion     INT         NOT NULL,
-    x                INT         NOT NULL,
-    y                INT         NOT NULL
-);
-CREATE INDEX i1_viewtopic ON viewtopic (ViewTopicID, ViewTopicVersion);
-CREATE INDEX i2_viewtopic ON viewtopic (TopicID);
-
--- ----------------------------------------------------------------------------
-
-CREATE TABLE viewassociation (
-    viewtopicid        VARCHAR2(40) NOT NULL,
-    viewtopicversion   INT         NOT NULL,
-    associationid      VARCHAR2(40) NOT NULL,
-    associationversion INT         NOT NULL
-);
-CREATE INDEX i_viewassociation ON viewassociation (viewtopicid, viewtopicversion);
-
--- ----------------------------------------------------------------------------
-
-CREATE TABLE topicprop (
-    topicid      VARCHAR2(40) NOT NULL,
-    topicversion INT         NOT NULL,
-    propname    VARCHAR2(255) NOT NULL,
-    propvalue   VARCHAR2(4000)
-);
-ALTER TABLE TopicProp ADD PRIMARY KEY (
-	TopicID, TopicVersion, PropName
-);
-
--- ----------------------------------------------------------------------------
-
-CREATE TABLE associationprop (
-    associationid      VARCHAR2(40) NOT NULL,
-    associationversion INT         NOT NULL,
-    propname          VARCHAR2(255) NOT NULL,
-    propvalue         VARCHAR2(4000)
-);
-ALTER TABLE AssociationProp ADD PRIMARY KEY (
-	AssociationID, AssociationVersion, PropName
-);
-    
--- ----------------------------------------------------------------------------
-
-CREATE TABLE keygenerator (
-    relation VARCHAR2(24) NOT NULL,
-    nextkey  INT         NOT NULL,
-    CONSTRAINT pk_keygenerator PRIMARY KEY (relation)
-);
-
--- ----------------------------------------------------------------------------
+-- DeepaMehta database model for use with Oracle.
+-- This script creates just the tables.
+
+CREATE TABLE topic (
+    typeid      VARCHAR2(40) NOT NULL,
+    typeversion INT         NOT NULL,
+    version     INT         NOT NULL,
+    id          VARCHAR2(40) NOT NULL,
+    name        VARCHAR2(255) NOT NULL,
+    CONSTRAINT pk_topic PRIMARY KEY (id, version)
+);
+CREATE INDEX i_topic ON topic (typeid, typeversion, name);
+
+-- ----------------------------------------------------------------------------
+
+CREATE TABLE association (
+    typeid        VARCHAR2(40) NOT NULL,
+    typeversion   INT         NOT NULL,
+    version       INT         NOT NULL,
+    id            VARCHAR2(40) NOT NULL,
+    name          VARCHAR2(255) NOT NULL,
+    topicid1      VARCHAR2(40) NOT NULL,
+    topicversion1 INT         NOT NULL,
+    topicid2      VARCHAR2(40) NOT NULL,
+    topicversion2 INT         NOT NULL,
+    CONSTRAINT pk_association PRIMARY KEY (id, version)
+);
+CREATE INDEX i1_association ON association (id, version, typeid, typeversion);
+CREATE INDEX i2_association ON association (topicid1, topicversion1);
+CREATE INDEX i3_association ON association (topicid2, topicversion2);
+
+-- ----------------------------------------------------------------------------
+
+CREATE TABLE viewtopic (
+    viewtopicid      VARCHAR2(40) NOT NULL,
+    viewtopicversion INT         NOT NULL,
+    topicid          VARCHAR2(40) NOT NULL,
+    topicversion     INT         NOT NULL,
+    x                INT         NOT NULL,
+    y                INT         NOT NULL
+);
+CREATE INDEX i1_viewtopic ON viewtopic (ViewTopicID, ViewTopicVersion);
+CREATE INDEX i2_viewtopic ON viewtopic (TopicID);
+
+-- ----------------------------------------------------------------------------
+
+CREATE TABLE viewassociation (
+    viewtopicid        VARCHAR2(40) NOT NULL,
+    viewtopicversion   INT         NOT NULL,
+    associationid      VARCHAR2(40) NOT NULL,
+    associationversion INT         NOT NULL
+);
+CREATE INDEX i_viewassociation ON viewassociation (viewtopicid, viewtopicversion);
+
+-- ----------------------------------------------------------------------------
+
+CREATE TABLE topicprop (
+    topicid      VARCHAR2(40) NOT NULL,
+    topicversion INT         NOT NULL,
+    propname    VARCHAR2(255) NOT NULL,
+    propvalue   VARCHAR2(4000)
+);
+ALTER TABLE TopicProp ADD PRIMARY KEY (
+	TopicID, TopicVersion, PropName
+);
+
+-- ----------------------------------------------------------------------------
+
+CREATE TABLE associationprop (
+    associationid      VARCHAR2(40) NOT NULL,
+    associationversion INT         NOT NULL,
+    propname          VARCHAR2(255) NOT NULL,
+    propvalue         VARCHAR2(4000)
+);
+ALTER TABLE AssociationProp ADD PRIMARY KEY (
+	AssociationID, AssociationVersion, PropName
+);
+    
+-- ----------------------------------------------------------------------------
+
+CREATE TABLE keygenerator (
+    relation VARCHAR2(24) NOT NULL,
+    nextkey  INT         NOT NULL,
+    CONSTRAINT pk_keygenerator PRIMARY KEY (relation)
+);
+
+-- ----------------------------------------------------------------------------

Modified: branches/eschnepel/install/examples/artfacts/build.xml
===================================================================
--- branches/eschnepel/install/examples/artfacts/build.xml	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/artfacts/build.xml	2007-10-03 17:45:23 UTC (rev 230)
@@ -34,7 +34,7 @@
 	&lt;target name=&quot;build&quot; depends=&quot;jar&quot;/&gt;
 
 	&lt;target name=&quot;cleanup&quot; description=&quot;remove build directory&quot;&gt;
-		&lt;delete dir=&quot;${build}&quot;/&gt;
+		&lt;delete dir=&quot;${build}&quot; includes=&quot;**&quot;/&gt;
 	&lt;/target&gt;
 
 &lt;/project&gt;

Modified: branches/eschnepel/install/examples/artfacts/src/de/deepamehta/artfacts/topics/ArtworkSearchTopic.java
===================================================================
--- branches/eschnepel/install/examples/artfacts/src/de/deepamehta/artfacts/topics/ArtworkSearchTopic.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/artfacts/src/de/deepamehta/artfacts/topics/ArtworkSearchTopic.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,60 +1,60 @@
-package de.deepamehta.artfacts.topics;
-
-import de.deepamehta.BaseTopic;
-import de.deepamehta.artfacts.Artfacts;
-import de.deepamehta.service.ApplicationService;
-import de.deepamehta.topics.ElementContainerTopic;
-
-
-
-/**
- * Part of the &quot;Artfacts&quot; example.
- * &lt;P&gt;
- * &lt;HR&gt;
- * Last functional change: 30.1.2003 (2.0a18-pre1)&lt;BR&gt;
- * Last documentation update: 25.1.2003 (2.0a17-pre7)&lt;BR&gt;
- * J&ouml;rg Richter&lt;BR&gt;
- * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>
- */
-public class ArtworkSearchTopic extends ElementContainerTopic implements Artfacts {
-
-
-
-	// *******************
-	// *** Constructor ***
-	// *******************
-
-
-
-	public ArtworkSearchTopic(BaseTopic topic, ApplicationService as) {
-		super(topic, as);
-	}
-
-
-
-	// *******************************************************
-	// *** Implementing abstract methods of ContainerTopic ***
-	// *******************************************************
-
-
-
-	protected String getContentType() {
-		return &quot;Artwork&quot;;
-	}
-
-	protected String getContentTypeID() {
-		return TOPICTYPE_ARTWORK;
-	}
-
-
-
-	// **************************************************************
-	// *** Implementing abstract methods of ElementContainerTopic ***
-	// **************************************************************
-
-
-
-	public String getNameAttribute() {
-		return &quot;Title&quot;;
-	}
-}
+package de.deepamehta.artfacts.topics;
+
+import de.deepamehta.BaseTopic;
+import de.deepamehta.artfacts.Artfacts;
+import de.deepamehta.service.ApplicationService;
+import de.deepamehta.topics.ElementContainerTopic;
+
+
+
+/**
+ * Part of the &quot;Artfacts&quot; example.
+ * &lt;P&gt;
+ * &lt;HR&gt;
+ * Last functional change: 30.1.2003 (2.0a18-pre1)&lt;BR&gt;
+ * Last documentation update: 25.1.2003 (2.0a17-pre7)&lt;BR&gt;
+ * J&ouml;rg Richter&lt;BR&gt;
+ * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>
+ */
+public class ArtworkSearchTopic extends ElementContainerTopic implements Artfacts {
+
+
+
+	// *******************
+	// *** Constructor ***
+	// *******************
+
+
+
+	public ArtworkSearchTopic(BaseTopic topic, ApplicationService as) {
+		super(topic, as);
+	}
+
+
+
+	// *******************************************************
+	// *** Implementing abstract methods of ContainerTopic ***
+	// *******************************************************
+
+
+
+	protected String getContentType() {
+		return &quot;Artwork&quot;;
+	}
+
+	protected String getContentTypeID() {
+		return TOPICTYPE_ARTWORK;
+	}
+
+
+
+	// **************************************************************
+	// *** Implementing abstract methods of ElementContainerTopic ***
+	// **************************************************************
+
+
+
+	public String getNameAttribute() {
+		return &quot;Title&quot;;
+	}
+}

Modified: branches/eschnepel/install/examples/dm-browser/config/web.xml
===================================================================
--- branches/eschnepel/install/examples/dm-browser/config/web.xml	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/dm-browser/config/web.xml	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,77 +1,77 @@
-&lt;!DOCTYPE web-app 
-    PUBLIC &quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot; 
-    &quot;<A HREF="http://java.sun.com/dtd/web-app_2_3.dtd">http://java.sun.com/dtd/web-app_2_3.dtd</A>&quot;&gt;
-
-&lt;web-app&gt;
-
-    &lt;!-- General description of the web application --&gt;
-
-    &lt;display-name&gt;DeepaMehta Browser&lt;/display-name&gt;
-    &lt;description&gt;
-      Version 1.0b1.
-      Written by J\u0x9arg Richter (<A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>)
-    &lt;/description&gt;
-
-    &lt;!-- Context initialization parameters that define shared
-         String constants used within your application, which
-         can be customized by the system administrator who is
-         installing your application.
-    --&gt;
-
-    &lt;context-param&gt;
-      &lt;param-name&gt;service&lt;/param-name&gt;
-      &lt;param-value&gt;default&lt;/param-value&gt;
-      &lt;description&gt;
-        Selects a DeepaMehta service.
-        If this parameter is not set the &quot;default&quot; service will be used.
-        To configure DeepaMehta services see the file install/client/dms.rc
-      &lt;/description&gt;
-    &lt;/context-param&gt;
-
-    &lt;context-param&gt;
-      &lt;param-name&gt;generator&lt;/param-name&gt;
-      &lt;param-value&gt;xslt&lt;/param-value&gt;
-      &lt;description&gt;
-        Selects the HTML generator method.
-        Supported values are &quot;jsp&quot; (default) and &quot;xslt&quot; (experimental)
-      &lt;/description&gt;
-    &lt;/context-param&gt;
-
-    &lt;context-param&gt;
-      &lt;param-name&gt;stylesheet&lt;/param-name&gt;
-      &lt;param-value&gt;browser/browser.xsl&lt;/param-value&gt;
-      &lt;description&gt;
-        Sets the stylesheet for the XSL transformation.
-		This parameter is required if the XSLT generator method is used, see parameter &quot;generator&quot;
-      &lt;/description&gt;
-    &lt;/context-param&gt;
-
-    &lt;!-- Servlet definitions for the servlets that make up
-         the web application.
-    --&gt;
-
-    &lt;servlet&gt;
-      &lt;servlet-name&gt;Browser Servlet&lt;/servlet-name&gt;
-      &lt;description&gt;Browser Servlet Controler&lt;/description&gt;
-      &lt;servlet-class&gt;de.deepamehta.browser.BrowserServlet&lt;/servlet-class&gt;
-    &lt;/servlet&gt;
-
-    &lt;!-- Define mappings that are used by the servlet container to
-         translate a particular request URI (context-relative) to a
-         particular servlet.
-    --&gt;
-
-    &lt;servlet-mapping&gt;
-      &lt;servlet-name&gt;Browser Servlet&lt;/servlet-name&gt;
-      &lt;url-pattern&gt;/controller&lt;/url-pattern&gt;
-    &lt;/servlet-mapping&gt;
-
-    &lt;!-- Define the default session timeout for your application,
-         in minutes.
-    --&gt;
-
-    &lt;session-config&gt;
-      &lt;session-timeout&gt;30&lt;/session-timeout&gt;
-    &lt;/session-config&gt;
-
-&lt;/web-app&gt;
+&lt;!DOCTYPE web-app 
+    PUBLIC &quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot; 
+    &quot;<A HREF="http://java.sun.com/dtd/web-app_2_3.dtd">http://java.sun.com/dtd/web-app_2_3.dtd</A>&quot;&gt;
+
+&lt;web-app&gt;
+
+    &lt;!-- General description of the web application --&gt;
+
+    &lt;display-name&gt;DeepaMehta Browser&lt;/display-name&gt;
+    &lt;description&gt;
+      Version 1.0b1.
+      Written by J\u0x9arg Richter (<A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>)
+    &lt;/description&gt;
+
+    &lt;!-- Context initialization parameters that define shared
+         String constants used within your application, which
+         can be customized by the system administrator who is
+         installing your application.
+    --&gt;
+
+    &lt;context-param&gt;
+      &lt;param-name&gt;service&lt;/param-name&gt;
+      &lt;param-value&gt;default&lt;/param-value&gt;
+      &lt;description&gt;
+        Selects a DeepaMehta service.
+        If this parameter is not set the &quot;default&quot; service will be used.
+        To configure DeepaMehta services see the file install/client/dms.rc
+      &lt;/description&gt;
+    &lt;/context-param&gt;
+
+    &lt;context-param&gt;
+      &lt;param-name&gt;generator&lt;/param-name&gt;
+      &lt;param-value&gt;xslt&lt;/param-value&gt;
+      &lt;description&gt;
+        Selects the HTML generator method.
+        Supported values are &quot;jsp&quot; (default) and &quot;xslt&quot; (experimental)
+      &lt;/description&gt;
+    &lt;/context-param&gt;
+
+    &lt;context-param&gt;
+      &lt;param-name&gt;stylesheet&lt;/param-name&gt;
+      &lt;param-value&gt;browser/browser.xsl&lt;/param-value&gt;
+      &lt;description&gt;
+        Sets the stylesheet for the XSL transformation.
+		This parameter is required if the XSLT generator method is used, see parameter &quot;generator&quot;
+      &lt;/description&gt;
+    &lt;/context-param&gt;
+
+    &lt;!-- Servlet definitions for the servlets that make up
+         the web application.
+    --&gt;
+
+    &lt;servlet&gt;
+      &lt;servlet-name&gt;Browser Servlet&lt;/servlet-name&gt;
+      &lt;description&gt;Browser Servlet Controler&lt;/description&gt;
+      &lt;servlet-class&gt;de.deepamehta.browser.BrowserServlet&lt;/servlet-class&gt;
+    &lt;/servlet&gt;
+
+    &lt;!-- Define mappings that are used by the servlet container to
+         translate a particular request URI (context-relative) to a
+         particular servlet.
+    --&gt;
+
+    &lt;servlet-mapping&gt;
+      &lt;servlet-name&gt;Browser Servlet&lt;/servlet-name&gt;
+      &lt;url-pattern&gt;/controller&lt;/url-pattern&gt;
+    &lt;/servlet-mapping&gt;
+
+    &lt;!-- Define the default session timeout for your application,
+         in minutes.
+    --&gt;
+
+    &lt;session-config&gt;
+      &lt;session-timeout&gt;30&lt;/session-timeout&gt;
+    &lt;/session-config&gt;
+
+&lt;/web-app&gt;

Modified: branches/eschnepel/install/examples/dm-search/build.xml
===================================================================
--- branches/eschnepel/install/examples/dm-search/build.xml	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/dm-search/build.xml	2007-10-03 17:45:23 UTC (rev 230)
@@ -48,7 +48,7 @@
 	&lt;/target&gt;
 
 	&lt;target name=&quot;cleanup&quot; description=&quot;remove build directory&quot;&gt;
-		&lt;delete includes=&quot;${build}/**&quot; /&gt;
+		&lt;delete dir=&quot;${build}&quot; includes=&quot;**&quot;/&gt;
 	&lt;/target&gt;
 
 &lt;/project&gt;

Modified: branches/eschnepel/install/examples/dm-search/config/web.xml
===================================================================
--- branches/eschnepel/install/examples/dm-search/config/web.xml	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/dm-search/config/web.xml	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,69 +1,69 @@
-&lt;!DOCTYPE web-app 
-    PUBLIC &quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot; 
-    &quot;<A HREF="http://java.sun.com/dtd/web-app_2_3.dtd">http://java.sun.com/dtd/web-app_2_3.dtd</A>&quot;&gt;
-
-&lt;web-app&gt;
-
-    &lt;!-- General description of the web application --&gt;
-
-    &lt;display-name&gt;DeepaMehta&lt;/display-name&gt;
-    &lt;description&gt;
-      DeepaMehta
-      by J\u0x9arg Richter (<A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>)
-    &lt;/description&gt;
-
-    &lt;!-- Context initialization parameters that define shared
-         String constants used within your application, which
-         can be customized by the system administrator who is
-         installing your application.
-    --&gt;
-
-    &lt;context-param&gt;
-      &lt;param-name&gt;service&lt;/param-name&gt;
-      &lt;param-value&gt;default&lt;/param-value&gt;
-      &lt;description&gt;
-        Selects a DeepaMehta service.
-        If this parameter is not set the &quot;default&quot; service will be used.
-        To configure DeepaMehta services see the file install/client/dms.rc
-      &lt;/description&gt;
-    &lt;/context-param&gt;
-
-    &lt;context-param&gt;
-      &lt;param-name&gt;language&lt;/param-name&gt;
-      &lt;param-value&gt;en&lt;/param-value&gt;
-    &lt;/context-param&gt;
-
-    &lt;context-param&gt;
-      &lt;param-name&gt;country&lt;/param-name&gt;
-      &lt;param-value&gt;US&lt;/param-value&gt;
-    &lt;/context-param&gt;
-
-    &lt;!-- Servlet definitions for the servlets that make up
-         the web application.
-    --&gt;
-
-    &lt;servlet&gt;
-      &lt;servlet-name&gt;DeepaMehta&lt;/servlet-name&gt;
-      &lt;description&gt;DeepaMehta Controller&lt;/description&gt;
-      &lt;servlet-class&gt;de.deepamehta.webfront.SearchServlet&lt;/servlet-class&gt;
-    &lt;/servlet&gt;
-
-    &lt;!-- Define mappings that are used by the servlet container to
-         translate a particular request URI (context-relative) to a
-         particular servlet.
-    --&gt;
-
-    &lt;servlet-mapping&gt;
-      &lt;servlet-name&gt;DeepaMehta&lt;/servlet-name&gt;
-      &lt;url-pattern&gt;/controller&lt;/url-pattern&gt;
-    &lt;/servlet-mapping&gt;
-
-    &lt;!-- Define the default session timeout for your application,
-         in minutes.
-    --&gt;
-
-    &lt;session-config&gt;
-      &lt;session-timeout&gt;30&lt;/session-timeout&gt;
-    &lt;/session-config&gt;
-
-&lt;/web-app&gt;
+&lt;!DOCTYPE web-app 
+    PUBLIC &quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot; 
+    &quot;<A HREF="http://java.sun.com/dtd/web-app_2_3.dtd">http://java.sun.com/dtd/web-app_2_3.dtd</A>&quot;&gt;
+
+&lt;web-app&gt;
+
+    &lt;!-- General description of the web application --&gt;
+
+    &lt;display-name&gt;DeepaMehta&lt;/display-name&gt;
+    &lt;description&gt;
+      DeepaMehta
+      by J\u0x9arg Richter (<A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>)
+    &lt;/description&gt;
+
+    &lt;!-- Context initialization parameters that define shared
+         String constants used within your application, which
+         can be customized by the system administrator who is
+         installing your application.
+    --&gt;
+
+    &lt;context-param&gt;
+      &lt;param-name&gt;service&lt;/param-name&gt;
+      &lt;param-value&gt;default&lt;/param-value&gt;
+      &lt;description&gt;
+        Selects a DeepaMehta service.
+        If this parameter is not set the &quot;default&quot; service will be used.
+        To configure DeepaMehta services see the file install/client/dms.rc
+      &lt;/description&gt;
+    &lt;/context-param&gt;
+
+    &lt;context-param&gt;
+      &lt;param-name&gt;language&lt;/param-name&gt;
+      &lt;param-value&gt;en&lt;/param-value&gt;
+    &lt;/context-param&gt;
+
+    &lt;context-param&gt;
+      &lt;param-name&gt;country&lt;/param-name&gt;
+      &lt;param-value&gt;US&lt;/param-value&gt;
+    &lt;/context-param&gt;
+
+    &lt;!-- Servlet definitions for the servlets that make up
+         the web application.
+    --&gt;
+
+    &lt;servlet&gt;
+      &lt;servlet-name&gt;DeepaMehta&lt;/servlet-name&gt;
+      &lt;description&gt;DeepaMehta Controller&lt;/description&gt;
+      &lt;servlet-class&gt;de.deepamehta.webfront.SearchServlet&lt;/servlet-class&gt;
+    &lt;/servlet&gt;
+
+    &lt;!-- Define mappings that are used by the servlet container to
+         translate a particular request URI (context-relative) to a
+         particular servlet.
+    --&gt;
+
+    &lt;servlet-mapping&gt;
+      &lt;servlet-name&gt;DeepaMehta&lt;/servlet-name&gt;
+      &lt;url-pattern&gt;/controller&lt;/url-pattern&gt;
+    &lt;/servlet-mapping&gt;
+
+    &lt;!-- Define the default session timeout for your application,
+         in minutes.
+    --&gt;
+
+    &lt;session-config&gt;
+      &lt;session-timeout&gt;30&lt;/session-timeout&gt;
+    &lt;/session-config&gt;
+
+&lt;/web-app&gt;

Modified: branches/eschnepel/install/examples/dm-topicmapviewer/build.xml
===================================================================
--- branches/eschnepel/install/examples/dm-topicmapviewer/build.xml	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/dm-topicmapviewer/build.xml	2007-10-03 17:45:23 UTC (rev 230)
@@ -46,7 +46,7 @@
 	&lt;/target&gt;
 
 	&lt;target name=&quot;cleanup&quot; description=&quot;remove build directory&quot;&gt;
-		&lt;delete includes=&quot;${build}/**&quot; /&gt;
+		&lt;delete dir=&quot;${build}&quot; includes=&quot;**&quot;/&gt;
 	&lt;/target&gt;
 
 &lt;/project&gt;

Modified: branches/eschnepel/install/examples/dm-topicmapviewer/config/web.xml
===================================================================
--- branches/eschnepel/install/examples/dm-topicmapviewer/config/web.xml	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/dm-topicmapviewer/config/web.xml	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,77 +1,77 @@
-&lt;!DOCTYPE web-app 
-    PUBLIC &quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot; 
-    &quot;<A HREF="http://java.sun.com/dtd/web-app_2_3.dtd">http://java.sun.com/dtd/web-app_2_3.dtd</A>&quot;&gt;
-
-&lt;web-app&gt;
-
-    &lt;!-- General description of the web application --&gt;
-
-    &lt;display-name&gt;DeepaMehta Topicmap Viewer&lt;/display-name&gt;
-    &lt;description&gt;
-      Version 1.0b1.
-      Written by J\u0x9arg Richter (<A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>)
-    &lt;/description&gt;
-
-    &lt;!-- Context initialization parameters that define shared
-         String constants used within your application, which
-         can be customized by the system administrator who is
-         installing your application.
-    --&gt;
-
-    &lt;context-param&gt;
-      &lt;param-name&gt;service&lt;/param-name&gt;
-      &lt;param-value&gt;default&lt;/param-value&gt;
-      &lt;description&gt;
-        Selects a DeepaMehta service.
-        If this parameter is not set the &quot;default&quot; service will be used.
-        To configure DeepaMehta services see the file install/client/dms.rc
-      &lt;/description&gt;
-    &lt;/context-param&gt;
-
-    &lt;context-param&gt;
-      &lt;param-name&gt;generator&lt;/param-name&gt;
-      &lt;param-value&gt;jsp&lt;/param-value&gt;
-      &lt;description&gt;
-        Selects the HTML generator method.
-        Supported values are &quot;jsp&quot; (default) and &quot;xslt&quot; (experimental)
-      &lt;/description&gt;
-    &lt;/context-param&gt;
-
-    &lt;context-param&gt;
-      &lt;param-name&gt;stylesheet&lt;/param-name&gt;
-      &lt;param-value&gt;browser/browser.xsl&lt;/param-value&gt;
-      &lt;description&gt;
-        Sets the stylesheet for the XSL transformation.
-		This parameter is required if the XSLT generator method is used, see parameter &quot;generator&quot;
-      &lt;/description&gt;
-    &lt;/context-param&gt;
-
-    &lt;!-- Servlet definitions for the servlets that make up
-         the web application.
-    --&gt;
-
-    &lt;servlet&gt;
-      &lt;servlet-name&gt;DeepaMehta Topicmap Viewer&lt;/servlet-name&gt;
-      &lt;description&gt;DeepaMehta Topicmap Viewer Controller&lt;/description&gt;
-      &lt;servlet-class&gt;de.deepamehta.topicmapviewer.TopicmapViewerServlet&lt;/servlet-class&gt;
-    &lt;/servlet&gt;
-
-    &lt;!-- Define mappings that are used by the servlet container to
-         translate a particular request URI (context-relative) to a
-         particular servlet.
-    --&gt;
-
-    &lt;servlet-mapping&gt;
-      &lt;servlet-name&gt;DeepaMehta Topicmap Viewer&lt;/servlet-name&gt;
-      &lt;url-pattern&gt;/controller&lt;/url-pattern&gt;
-    &lt;/servlet-mapping&gt;
-
-    &lt;!-- Define the default session timeout for your application,
-         in minutes.
-    --&gt;
-
-    &lt;session-config&gt;
-      &lt;session-timeout&gt;240&lt;/session-timeout&gt;
-    &lt;/session-config&gt;
-
-&lt;/web-app&gt;
+&lt;!DOCTYPE web-app 
+    PUBLIC &quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot; 
+    &quot;<A HREF="http://java.sun.com/dtd/web-app_2_3.dtd">http://java.sun.com/dtd/web-app_2_3.dtd</A>&quot;&gt;
+
+&lt;web-app&gt;
+
+    &lt;!-- General description of the web application --&gt;
+
+    &lt;display-name&gt;DeepaMehta Topicmap Viewer&lt;/display-name&gt;
+    &lt;description&gt;
+      Version 1.0b1.
+      Written by J\u0x9arg Richter (<A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>)
+    &lt;/description&gt;
+
+    &lt;!-- Context initialization parameters that define shared
+         String constants used within your application, which
+         can be customized by the system administrator who is
+         installing your application.
+    --&gt;
+
+    &lt;context-param&gt;
+      &lt;param-name&gt;service&lt;/param-name&gt;
+      &lt;param-value&gt;default&lt;/param-value&gt;
+      &lt;description&gt;
+        Selects a DeepaMehta service.
+        If this parameter is not set the &quot;default&quot; service will be used.
+        To configure DeepaMehta services see the file install/client/dms.rc
+      &lt;/description&gt;
+    &lt;/context-param&gt;
+
+    &lt;context-param&gt;
+      &lt;param-name&gt;generator&lt;/param-name&gt;
+      &lt;param-value&gt;jsp&lt;/param-value&gt;
+      &lt;description&gt;
+        Selects the HTML generator method.
+        Supported values are &quot;jsp&quot; (default) and &quot;xslt&quot; (experimental)
+      &lt;/description&gt;
+    &lt;/context-param&gt;
+
+    &lt;context-param&gt;
+      &lt;param-name&gt;stylesheet&lt;/param-name&gt;
+      &lt;param-value&gt;browser/browser.xsl&lt;/param-value&gt;
+      &lt;description&gt;
+        Sets the stylesheet for the XSL transformation.
+		This parameter is required if the XSLT generator method is used, see parameter &quot;generator&quot;
+      &lt;/description&gt;
+    &lt;/context-param&gt;
+
+    &lt;!-- Servlet definitions for the servlets that make up
+         the web application.
+    --&gt;
+
+    &lt;servlet&gt;
+      &lt;servlet-name&gt;DeepaMehta Topicmap Viewer&lt;/servlet-name&gt;
+      &lt;description&gt;DeepaMehta Topicmap Viewer Controller&lt;/description&gt;
+      &lt;servlet-class&gt;de.deepamehta.topicmapviewer.TopicmapViewerServlet&lt;/servlet-class&gt;
+    &lt;/servlet&gt;
+
+    &lt;!-- Define mappings that are used by the servlet container to
+         translate a particular request URI (context-relative) to a
+         particular servlet.
+    --&gt;
+
+    &lt;servlet-mapping&gt;
+      &lt;servlet-name&gt;DeepaMehta Topicmap Viewer&lt;/servlet-name&gt;
+      &lt;url-pattern&gt;/controller&lt;/url-pattern&gt;
+    &lt;/servlet-mapping&gt;
+
+    &lt;!-- Define the default session timeout for your application,
+         in minutes.
+    --&gt;
+
+    &lt;session-config&gt;
+      &lt;session-timeout&gt;240&lt;/session-timeout&gt;
+    &lt;/session-config&gt;
+
+&lt;/web-app&gt;

Modified: branches/eschnepel/install/examples/dm-web/config/web.xml
===================================================================
--- branches/eschnepel/install/examples/dm-web/config/web.xml	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/dm-web/config/web.xml	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,77 +1,77 @@
-&lt;!DOCTYPE web-app 
-    PUBLIC &quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot; 
-    &quot;<A HREF="http://java.sun.com/dtd/web-app_2_3.dtd">http://java.sun.com/dtd/web-app_2_3.dtd</A>&quot;&gt;
-
-&lt;web-app&gt;
-
-    &lt;!-- General description of the web application --&gt;
-
-    &lt;display-name&gt;DeepaMehta Web&lt;/display-name&gt;
-    &lt;description&gt;
-      Version 1.0b1.
-      Written by J\u0x9arg Richter (<A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>)
-    &lt;/description&gt;
-
-    &lt;!-- Context initialization parameters that define shared
-         String constants used within your application, which
-         can be customized by the system administrator who is
-         installing your application.
-    --&gt;
-
-    &lt;context-param&gt;
-      &lt;param-name&gt;service&lt;/param-name&gt;
-      &lt;param-value&gt;default&lt;/param-value&gt;
-      &lt;description&gt;
-        Selects a DeepaMehta service.
-        If this parameter is not set the &quot;default&quot; service will be used.
-        To configure DeepaMehta services see the file install/client/dms.rc
-      &lt;/description&gt;
-    &lt;/context-param&gt;
-
-    &lt;context-param&gt;
-      &lt;param-name&gt;generator&lt;/param-name&gt;
-      &lt;param-value&gt;jsp&lt;/param-value&gt;
-      &lt;description&gt;
-        Selects the HTML generator method.
-        Supported values are &quot;jsp&quot; (default) and &quot;xslt&quot; (experimental)
-      &lt;/description&gt;
-    &lt;/context-param&gt;
-
-    &lt;context-param&gt;
-      &lt;param-name&gt;stylesheet&lt;/param-name&gt;
-      &lt;param-value&gt;browser/browser.xsl&lt;/param-value&gt;
-      &lt;description&gt;
-        Sets the stylesheet for the XSL transformation.
-		This parameter is required if the XSLT generator method is used, see parameter &quot;generator&quot;
-      &lt;/description&gt;
-    &lt;/context-param&gt;
-
-    &lt;!-- Servlet definitions for the servlets that make up
-         the web application.
-    --&gt;
-
-    &lt;servlet&gt;
-      &lt;servlet-name&gt;DeepaMehta Web&lt;/servlet-name&gt;
-      &lt;description&gt;DeepaMehta Web Controller&lt;/description&gt;
-      &lt;servlet-class&gt;de.deepamehta.webfrontend.WebFrontendServlet&lt;/servlet-class&gt;
-    &lt;/servlet&gt;
-
-    &lt;!-- Define mappings that are used by the servlet container to
-         translate a particular request URI (context-relative) to a
-         particular servlet.
-    --&gt;
-
-    &lt;servlet-mapping&gt;
-      &lt;servlet-name&gt;DeepaMehta Web&lt;/servlet-name&gt;
-      &lt;url-pattern&gt;/controller&lt;/url-pattern&gt;
-    &lt;/servlet-mapping&gt;
-
-    &lt;!-- Define the default session timeout for your application,
-         in minutes.
-    --&gt;
-
-    &lt;session-config&gt;
-      &lt;session-timeout&gt;240&lt;/session-timeout&gt;
-    &lt;/session-config&gt;
-
-&lt;/web-app&gt;
+&lt;!DOCTYPE web-app 
+    PUBLIC &quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot; 
+    &quot;<A HREF="http://java.sun.com/dtd/web-app_2_3.dtd">http://java.sun.com/dtd/web-app_2_3.dtd</A>&quot;&gt;
+
+&lt;web-app&gt;
+
+    &lt;!-- General description of the web application --&gt;
+
+    &lt;display-name&gt;DeepaMehta Web&lt;/display-name&gt;
+    &lt;description&gt;
+      Version 1.0b1.
+      Written by J\u0x9arg Richter (<A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>)
+    &lt;/description&gt;
+
+    &lt;!-- Context initialization parameters that define shared
+         String constants used within your application, which
+         can be customized by the system administrator who is
+         installing your application.
+    --&gt;
+
+    &lt;context-param&gt;
+      &lt;param-name&gt;service&lt;/param-name&gt;
+      &lt;param-value&gt;default&lt;/param-value&gt;
+      &lt;description&gt;
+        Selects a DeepaMehta service.
+        If this parameter is not set the &quot;default&quot; service will be used.
+        To configure DeepaMehta services see the file install/client/dms.rc
+      &lt;/description&gt;
+    &lt;/context-param&gt;
+
+    &lt;context-param&gt;
+      &lt;param-name&gt;generator&lt;/param-name&gt;
+      &lt;param-value&gt;jsp&lt;/param-value&gt;
+      &lt;description&gt;
+        Selects the HTML generator method.
+        Supported values are &quot;jsp&quot; (default) and &quot;xslt&quot; (experimental)
+      &lt;/description&gt;
+    &lt;/context-param&gt;
+
+    &lt;context-param&gt;
+      &lt;param-name&gt;stylesheet&lt;/param-name&gt;
+      &lt;param-value&gt;browser/browser.xsl&lt;/param-value&gt;
+      &lt;description&gt;
+        Sets the stylesheet for the XSL transformation.
+		This parameter is required if the XSLT generator method is used, see parameter &quot;generator&quot;
+      &lt;/description&gt;
+    &lt;/context-param&gt;
+
+    &lt;!-- Servlet definitions for the servlets that make up
+         the web application.
+    --&gt;
+
+    &lt;servlet&gt;
+      &lt;servlet-name&gt;DeepaMehta Web&lt;/servlet-name&gt;
+      &lt;description&gt;DeepaMehta Web Controller&lt;/description&gt;
+      &lt;servlet-class&gt;de.deepamehta.webfrontend.WebFrontendServlet&lt;/servlet-class&gt;
+    &lt;/servlet&gt;
+
+    &lt;!-- Define mappings that are used by the servlet container to
+         translate a particular request URI (context-relative) to a
+         particular servlet.
+    --&gt;
+
+    &lt;servlet-mapping&gt;
+      &lt;servlet-name&gt;DeepaMehta Web&lt;/servlet-name&gt;
+      &lt;url-pattern&gt;/controller&lt;/url-pattern&gt;
+    &lt;/servlet-mapping&gt;
+
+    &lt;!-- Define the default session timeout for your application,
+         in minutes.
+    --&gt;
+
+    &lt;session-config&gt;
+      &lt;session-timeout&gt;240&lt;/session-timeout&gt;
+    &lt;/session-config&gt;
+
+&lt;/web-app&gt;

Modified: branches/eschnepel/install/examples/kompetenzstern/build.xml
===================================================================
--- branches/eschnepel/install/examples/kompetenzstern/build.xml	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/kompetenzstern/build.xml	2007-10-03 17:45:23 UTC (rev 230)
@@ -67,8 +67,7 @@
 	&lt;/target&gt;
 
 	&lt;target name=&quot;cleanup&quot; description=&quot;remove build directory&quot;&gt;
-		&lt;delete dir=&quot;${build}&quot; /&gt;
-		&lt;mkdir dir=&quot;${build}&quot; /&gt;
+		&lt;delete dir=&quot;${build}&quot; includes=&quot;**&quot;/&gt;
 	&lt;/target&gt;
 
 	&lt;target name=&quot;install&quot; description=&quot;initialisation for the dm-db&quot;&gt;

Modified: branches/eschnepel/install/examples/kompetenzstern/businesscheck.sql
===================================================================
--- branches/eschnepel/install/examples/kompetenzstern/businesscheck.sql	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/kompetenzstern/businesscheck.sql	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,287 +1,287 @@
--- This patch creates the &quot;Business Check&quot; Template.
---
--- It consists of:
--- * four assessment layers (&quot;Bewertungsebenen&quot;)
--- * eight top-level criteria
--- * 24 second-level criteria (each top-level criterion has three subcriteria)
-
--- ===========================================================================
-
---- create template &quot;Business Check&quot;
-INSERT INTO Topic VALUES ('tt-kompetenzsterntemplate', 1, 1, 't-businesscheck', 'Business Check');
-INSERT INTO TopicProp VALUES ('t-businesscheck', 1, 'Name', 'Business Check');
-
--- ===========================================================================
-
---- create assessment layers
-INSERT INTO Topic VALUES ('tt-bewertungsebene', 1, 1, 't-chancen',    'Chancen');
-INSERT INTO Topic VALUES ('tt-bewertungsebene', 1, 1, 't-plaene',     'Pl&#195;&#164;ne');
-INSERT INTO Topic VALUES ('tt-bewertungsebene', 1, 1, 't-ablaeufe',   'Abl&#195;&#164;ufe');
-INSERT INTO Topic VALUES ('tt-bewertungsebene', 1, 1, 't-ergebnisse', 'Ergebnisse');
-INSERT INTO TopicProp VALUES ('t-chancen',  1,   'Name', 'Chancen');
-INSERT INTO TopicProp VALUES ('t-plaene', 1,     'Name', 'Pl&#195;&#164;ne');
-INSERT INTO TopicProp VALUES ('t-ablaeufe', 1,   'Name', 'Abl&#195;&#164;ufe');
-INSERT INTO TopicProp VALUES ('t-ergebnisse', 1, 'Name', 'Ergebnisse');
-
---- assign assessment layers to template &quot;Business Check&quot;
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-650', '', 't-businesscheck', 1, 't-chancen', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-651', '', 't-businesscheck', 1, 't-plaene', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-652', '', 't-businesscheck', 1, 't-ablaeufe', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-653', '', 't-businesscheck', 1, 't-ergebnisse', 1);
-INSERT INTO AssociationProp VALUES ('a-650', 1, 'Ordinal Number', '1');
-INSERT INTO AssociationProp VALUES ('a-651', 1, 'Ordinal Number', '2');
-INSERT INTO AssociationProp VALUES ('a-652', 1, 'Ordinal Number', '3');
-INSERT INTO AssociationProp VALUES ('a-653', 1, 'Ordinal Number', '4');
-
--- ===========================================================================
-
---- create top-level criteria
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-ziele',      'Ziele');
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-management', 'Management');
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-betrieb',    'Betrieb');
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-ertraege',   'Ertr&#195;&#164;ge');
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-produkte',   'Produkte');
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-vertrieb',   'Vertrieb');
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-marketing',  'Marketing');
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-markt',      'Markt');
-INSERT INTO TopicProp VALUES ('t-ziele', 1,      'Name', 'Ziele');
-INSERT INTO TopicProp VALUES ('t-management', 1, 'Name', 'Management');
-INSERT INTO TopicProp VALUES ('t-betrieb', 1,    'Name', 'Betrieb');
-INSERT INTO TopicProp VALUES ('t-ertraege', 1,   'Name', 'Ertr&#195;&#164;ge');
-INSERT INTO TopicProp VALUES ('t-produkte', 1,   'Name', 'Produkte');
-INSERT INTO TopicProp VALUES ('t-vertrieb', 1,   'Name', 'Vertrieb');
-INSERT INTO TopicProp VALUES ('t-marketing', 1,  'Name', 'Marketing');
-INSERT INTO TopicProp VALUES ('t-markt', 1,      'Name', 'Markt');
-INSERT INTO TopicProp VALUES ('t-ziele', 1,      'Hilfe', 'Der Hilfe-Text f&#195;&#188;r &quot;Ziele&quot; ...');
-INSERT INTO TopicProp VALUES ('t-management', 1, 'Hilfe', 'Der Hilfe-Text f&#195;&#188;r &quot;Management&quot; ...');
-INSERT INTO TopicProp VALUES ('t-betrieb', 1,    'Hilfe', 'Der Hilfe-Text f&#195;&#188;r &quot;Betrieb&quot; ...');
-INSERT INTO TopicProp VALUES ('t-ertraege', 1,   'Hilfe', 'Der Hilfe-Text f&#195;&#188;r &quot;Ertr&#195;&#164;ge&quot; ...');
-INSERT INTO TopicProp VALUES ('t-produkte', 1,   'Hilfe', 'Der Hilfe-Text f&#195;&#188;r &quot;Produkte&quot; ...');
-INSERT INTO TopicProp VALUES ('t-vertrieb', 1,   'Hilfe', 'Der Hilfe-Text f&#195;&#188;r &quot;Vertrieb&quot; ...');
-INSERT INTO TopicProp VALUES ('t-marketing', 1,  'Hilfe', 'Der Hilfe-Text f&#195;&#188;r &quot;Marketing&quot; ...');
-INSERT INTO TopicProp VALUES ('t-markt', 1,      'Hilfe', 'Der Hilfe-Text f&#195;&#188;r &quot;Markt&quot; ...');
-
---- assign top-level criteria to template &quot;Business Check&quot;
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-642', '', 't-businesscheck', 1, 't-ziele', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-643', '', 't-businesscheck', 1, 't-management', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-644', '', 't-businesscheck', 1, 't-betrieb', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-645', '', 't-businesscheck', 1, 't-ertraege', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-649', '', 't-businesscheck', 1, 't-produkte', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-648', '', 't-businesscheck', 1, 't-vertrieb', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-647', '', 't-businesscheck', 1, 't-marketing', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-646', '', 't-businesscheck', 1, 't-markt', 1);
-
---- order top-level criteria
-INSERT INTO AssociationProp VALUES ('a-642', 1, 'Ordinal Number', '1');
-INSERT INTO AssociationProp VALUES ('a-643', 1, 'Ordinal Number', '2');
-INSERT INTO AssociationProp VALUES ('a-644', 1, 'Ordinal Number', '3');
-INSERT INTO AssociationProp VALUES ('a-645', 1, 'Ordinal Number', '4');
-INSERT INTO AssociationProp VALUES ('a-649', 1, 'Ordinal Number', '5');
-INSERT INTO AssociationProp VALUES ('a-648', 1, 'Ordinal Number', '6');
-INSERT INTO AssociationProp VALUES ('a-647', 1, 'Ordinal Number', '7');
-INSERT INTO AssociationProp VALUES ('a-646', 1, 'Ordinal Number', '8');
-
--- ===========================================================================
-
---- create second-level criteria
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-innovationspotenziale', 'Innovationspotenziale');
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-unternehmenszukunft',   'Unternehmenszukunft');
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-unternehmenspartner',   'Unternehmenspartner');
-INSERT INTO TopicProp VALUES ('t-innovationspotenziale', 1, 'Name', 'Innovationspotenziale');
-INSERT INTO TopicProp VALUES ('t-unternehmenszukunft', 1,   'Name', 'Unternehmenszukunft');
-INSERT INTO TopicProp VALUES ('t-unternehmenspartner', 1,   'Name', 'Unternehmenspartner');
-
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-wettbewerb-zugang', 'Wettbewerb, Zugang');
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-marktpartner',      'Marktpartner');
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-markterwartungen',  'Markterwartungen');
-INSERT INTO TopicProp VALUES ('t-wettbewerb-zugang', 1, 'Name', 'Wettbewerb, Zugang');
-INSERT INTO TopicProp VALUES ('t-marktpartner', 1,      'Name', 'Marktpartner');
-INSERT INTO TopicProp VALUES ('t-markterwartungen', 1,  'Name', 'Markterwartungen');
-
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-produktplanung',    'Produktplanung');
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-geschaeftsleitung', 'Gesch&#195;&#164;ftsleitung');
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-techn-loesungen',   'Techn. L&#195;&#182;sungen');
-INSERT INTO TopicProp VALUES ('t-produktplanung', 1,    'Name', 'Produktplanung');
-INSERT INTO TopicProp VALUES ('t-geschaeftsleitung', 1, 'Name', 'Gesch&#195;&#164;ftsleitung');
-INSERT INTO TopicProp VALUES ('t-techn-loesungen', 1,   'Name', 'Techn. L&#195;&#182;sungen');
-
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-kommunikation',       'Kommunikation');
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-produktmarketing',    'Produktmarketing');
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-preisattraktivitaet', 'Preisattraktivit&#195;&#164;t');
-INSERT INTO TopicProp VALUES ('t-kommunikation', 1,       'Name', 'Kommunikation');
-INSERT INTO TopicProp VALUES ('t-produktmarketing', 1,    'Name', 'Produktmarketing');
-INSERT INTO TopicProp VALUES ('t-preisattraktivitaet', 1, 'Name', 'Preisattraktivit&#195;&#164;t');
-
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-betriebsstruktur', 'Betriebsstruktur');
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-betriebsqualitaet', 'Betriebsqualit&#195;&#164;t');
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-betriebsablaeufe', 'Betriebsabl&#195;&#164;ufe');
-INSERT INTO TopicProp VALUES ('t-betriebsstruktur', 1, 'Name', 'Betriebsstruktur');
-INSERT INTO TopicProp VALUES ('t-betriebsqualitaet', 1, 'Name', 'Betriebsqualit&#195;&#164;t');
-INSERT INTO TopicProp VALUES ('t-betriebsablaeufe', 1, 'Name', 'Betriebsabl&#195;&#164;ufe');
-
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-vertriebsstruktur',  'Vertriebsstruktur');
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-vertriebsqualitaet', 'Vertriebsqualit&#195;&#164;t');
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-vertriebsablaeufe',  'Vertriebsabl&#195;&#164;ufe');
-INSERT INTO TopicProp VALUES ('t-vertriebsstruktur', 1,  'Name', 'Vertriebsstruktur');
-INSERT INTO TopicProp VALUES ('t-vertriebsqualitaet', 1, 'Name', 'Vertriebsqualit&#195;&#164;t');
-INSERT INTO TopicProp VALUES ('t-vertriebsablaeufe', 1,  'Name', 'Vertriebsabl&#195;&#164;ufe');
-
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-wirtschaftlichkeit', 'Wirtschaftlichkeit');
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-ertragslage',        'Ertragslage');
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-zielabweichungen',   'Zielabweichungen');
-INSERT INTO TopicProp VALUES ('t-wirtschaftlichkeit', 1, 'Name', 'Wirtschaftlichkeit');
-INSERT INTO TopicProp VALUES ('t-ertragslage', 1,        'Name', 'Ertragslage');
-INSERT INTO TopicProp VALUES ('t-zielabweichungen', 1,   'Name', 'Zielabweichungen');
-
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-produktleistungen', 'Produktleistungen');
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-kundennutzen',      'Kundennutzen');
-INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-marktabweichungen', 'Marktabweichungen');
-INSERT INTO TopicProp VALUES ('t-produktleistungen', 1, 'Name', 'Produktleistungen');
-INSERT INTO TopicProp VALUES ('t-kundennutzen',      1, 'Name', 'Kundennutzen');
-INSERT INTO TopicProp VALUES ('t-marktabweichungen', 1, 'Name', 'Marktabweichungen');
-
---- assign second-level criteria to top-level criteria
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-732', '', 't-ziele', 1, 't-innovationspotenziale', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-733', '', 't-ziele', 1, 't-unternehmenszukunft', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-734', '', 't-ziele', 1, 't-unternehmenspartner', 1);
-
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-735', '', 't-markt', 1, 't-wettbewerb-zugang', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-736', '', 't-markt', 1, 't-marktpartner', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-737', '', 't-markt', 1, 't-markterwartungen', 1);
-
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-738', '', 't-management', 1, 't-produktplanung', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-739', '', 't-management', 1, 't-geschaeftsleitung', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-740', '', 't-management', 1, 't-techn-loesungen', 1);
-
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-741', '', 't-marketing', 1, 't-kommunikation', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-742', '', 't-marketing', 1, 't-produktmarketing', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-743', '', 't-marketing', 1, 't-preisattraktivitaet', 1);
-
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-744', '', 't-betrieb', 1, 't-betriebsstruktur', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-745', '', 't-betrieb', 1, 't-betriebsqualitaet', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-746', '', 't-betrieb', 1, 't-betriebsablaeufe', 1);
-
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-747', '', 't-vertrieb', 1, 't-vertriebsstruktur', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-748', '', 't-vertrieb', 1, 't-vertriebsqualitaet', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-749', '', 't-vertrieb', 1, 't-vertriebsablaeufe', 1);
-
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-750', '', 't-ertraege', 1, 't-wirtschaftlichkeit', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-751', '', 't-ertraege', 1, 't-ertragslage', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-752', '', 't-ertraege', 1, 't-zielabweichungen', 1);
-
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-753', '', 't-produkte', 1, 't-produktleistungen', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-754', '', 't-produkte', 1, 't-kundennutzen', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-755', '', 't-produkte', 1, 't-marktabweichungen', 1);
-
--- ===========================================================================
-
-
-
-------------
---- View ---
-------------
-
-
-
---- template
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-businesscheck', 1, 330, 260);
-
---- assessment layers
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-chancen', 1, 350, 110);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-plaene', 1, 350, 210);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-ablaeufe', 1, 350, 310);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-ergebnisse', 1, 350, 410);
-
---- top-level criteria
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-ziele', 1, 200, 110);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-management', 1, 200, 210);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-betrieb', 1, 200, 310);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-ertraege', 1, 200, 410);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-produkte', 1, 475, 410);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-vertrieb', 1, 475, 310);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-marketing', 1, 475, 210);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-markt', 1, 475, 110);
-
---- second-level criteria
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-innovationspotenziale', 1, 93, 78);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-unternehmenszukunft', 1, 63, 98);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-unternehmenspartner', 1, 31, 110);
-
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-wettbewerb-zugang', 1, 588, 98);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-marktpartner', 1, 560, 117);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-markterwartungen', 1, 532, 133);
-
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-produktplanung', 1, 81, 176);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-geschaeftsleitung', 1, 51, 187);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-techn-loesungen', 1, 23, 199);
-
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-kommunikation', 1, 555, 215);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-produktmarketing', 1, 582, 197);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-preisattraktivitaet', 1, 528, 228);
-
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-betriebsstruktur', 1, 18, 355);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-betriebsqualitaet', 1, 79, 316);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-betriebsablaeufe', 1, 48, 335);
-
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-vertriebsstruktur', 1, 591, 288);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-vertriebsqualitaet', 1, 565, 306);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-vertriebsablaeufe', 1, 537, 323);
-
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-wirtschaftlichkeit', 1, 85, 419);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-ertragslage', 1, 54, 434);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-zielabweichungen', 1, 22, 449);
-
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-produktleistungen', 1, 567, 409);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-kundennutzen', 1, 540, 427);
-INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-marktabweichungen', 1, 595, 390);
-
---- associations
-
---- from template to assessment layers
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-650', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-651', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-652', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-653', 1);
-
---- from template to top-level criteria
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-642', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-643', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-644', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-645', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-646', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-647', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-648', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-649', 1);
-
---- from top-level criteria to second-level criteria
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-732', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-733', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-734', 1);
-
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-735', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-736', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-737', 1);
-
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-738', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-739', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-740', 1);
-
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-741', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-742', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-743', 1);
-
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-744', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-745', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-746', 1);
-
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-747', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-748', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-749', 1);
-
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-750', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-751', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-752', 1);
-
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-753', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-754', 1);
-INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-755', 1);
+-- This patch creates the &quot;Business Check&quot; Template.
+--
+-- It consists of:
+-- * four assessment layers (&quot;Bewertungsebenen&quot;)
+-- * eight top-level criteria
+-- * 24 second-level criteria (each top-level criterion has three subcriteria)
+
+-- ===========================================================================
+
+--- create template &quot;Business Check&quot;
+INSERT INTO Topic VALUES ('tt-kompetenzsterntemplate', 1, 1, 't-businesscheck', 'Business Check');
+INSERT INTO TopicProp VALUES ('t-businesscheck', 1, 'Name', 'Business Check');
+
+-- ===========================================================================
+
+--- create assessment layers
+INSERT INTO Topic VALUES ('tt-bewertungsebene', 1, 1, 't-chancen',    'Chancen');
+INSERT INTO Topic VALUES ('tt-bewertungsebene', 1, 1, 't-plaene',     'Pl&#195;&#164;ne');
+INSERT INTO Topic VALUES ('tt-bewertungsebene', 1, 1, 't-ablaeufe',   'Abl&#195;&#164;ufe');
+INSERT INTO Topic VALUES ('tt-bewertungsebene', 1, 1, 't-ergebnisse', 'Ergebnisse');
+INSERT INTO TopicProp VALUES ('t-chancen',  1,   'Name', 'Chancen');
+INSERT INTO TopicProp VALUES ('t-plaene', 1,     'Name', 'Pl&#195;&#164;ne');
+INSERT INTO TopicProp VALUES ('t-ablaeufe', 1,   'Name', 'Abl&#195;&#164;ufe');
+INSERT INTO TopicProp VALUES ('t-ergebnisse', 1, 'Name', 'Ergebnisse');
+
+--- assign assessment layers to template &quot;Business Check&quot;
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-650', '', 't-businesscheck', 1, 't-chancen', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-651', '', 't-businesscheck', 1, 't-plaene', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-652', '', 't-businesscheck', 1, 't-ablaeufe', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-653', '', 't-businesscheck', 1, 't-ergebnisse', 1);
+INSERT INTO AssociationProp VALUES ('a-650', 1, 'Ordinal Number', '1');
+INSERT INTO AssociationProp VALUES ('a-651', 1, 'Ordinal Number', '2');
+INSERT INTO AssociationProp VALUES ('a-652', 1, 'Ordinal Number', '3');
+INSERT INTO AssociationProp VALUES ('a-653', 1, 'Ordinal Number', '4');
+
+-- ===========================================================================
+
+--- create top-level criteria
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-ziele',      'Ziele');
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-management', 'Management');
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-betrieb',    'Betrieb');
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-ertraege',   'Ertr&#195;&#164;ge');
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-produkte',   'Produkte');
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-vertrieb',   'Vertrieb');
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-marketing',  'Marketing');
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-markt',      'Markt');
+INSERT INTO TopicProp VALUES ('t-ziele', 1,      'Name', 'Ziele');
+INSERT INTO TopicProp VALUES ('t-management', 1, 'Name', 'Management');
+INSERT INTO TopicProp VALUES ('t-betrieb', 1,    'Name', 'Betrieb');
+INSERT INTO TopicProp VALUES ('t-ertraege', 1,   'Name', 'Ertr&#195;&#164;ge');
+INSERT INTO TopicProp VALUES ('t-produkte', 1,   'Name', 'Produkte');
+INSERT INTO TopicProp VALUES ('t-vertrieb', 1,   'Name', 'Vertrieb');
+INSERT INTO TopicProp VALUES ('t-marketing', 1,  'Name', 'Marketing');
+INSERT INTO TopicProp VALUES ('t-markt', 1,      'Name', 'Markt');
+INSERT INTO TopicProp VALUES ('t-ziele', 1,      'Hilfe', 'Der Hilfe-Text f&#195;&#188;r &quot;Ziele&quot; ...');
+INSERT INTO TopicProp VALUES ('t-management', 1, 'Hilfe', 'Der Hilfe-Text f&#195;&#188;r &quot;Management&quot; ...');
+INSERT INTO TopicProp VALUES ('t-betrieb', 1,    'Hilfe', 'Der Hilfe-Text f&#195;&#188;r &quot;Betrieb&quot; ...');
+INSERT INTO TopicProp VALUES ('t-ertraege', 1,   'Hilfe', 'Der Hilfe-Text f&#195;&#188;r &quot;Ertr&#195;&#164;ge&quot; ...');
+INSERT INTO TopicProp VALUES ('t-produkte', 1,   'Hilfe', 'Der Hilfe-Text f&#195;&#188;r &quot;Produkte&quot; ...');
+INSERT INTO TopicProp VALUES ('t-vertrieb', 1,   'Hilfe', 'Der Hilfe-Text f&#195;&#188;r &quot;Vertrieb&quot; ...');
+INSERT INTO TopicProp VALUES ('t-marketing', 1,  'Hilfe', 'Der Hilfe-Text f&#195;&#188;r &quot;Marketing&quot; ...');
+INSERT INTO TopicProp VALUES ('t-markt', 1,      'Hilfe', 'Der Hilfe-Text f&#195;&#188;r &quot;Markt&quot; ...');
+
+--- assign top-level criteria to template &quot;Business Check&quot;
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-642', '', 't-businesscheck', 1, 't-ziele', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-643', '', 't-businesscheck', 1, 't-management', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-644', '', 't-businesscheck', 1, 't-betrieb', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-645', '', 't-businesscheck', 1, 't-ertraege', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-649', '', 't-businesscheck', 1, 't-produkte', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-648', '', 't-businesscheck', 1, 't-vertrieb', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-647', '', 't-businesscheck', 1, 't-marketing', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-646', '', 't-businesscheck', 1, 't-markt', 1);
+
+--- order top-level criteria
+INSERT INTO AssociationProp VALUES ('a-642', 1, 'Ordinal Number', '1');
+INSERT INTO AssociationProp VALUES ('a-643', 1, 'Ordinal Number', '2');
+INSERT INTO AssociationProp VALUES ('a-644', 1, 'Ordinal Number', '3');
+INSERT INTO AssociationProp VALUES ('a-645', 1, 'Ordinal Number', '4');
+INSERT INTO AssociationProp VALUES ('a-649', 1, 'Ordinal Number', '5');
+INSERT INTO AssociationProp VALUES ('a-648', 1, 'Ordinal Number', '6');
+INSERT INTO AssociationProp VALUES ('a-647', 1, 'Ordinal Number', '7');
+INSERT INTO AssociationProp VALUES ('a-646', 1, 'Ordinal Number', '8');
+
+-- ===========================================================================
+
+--- create second-level criteria
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-innovationspotenziale', 'Innovationspotenziale');
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-unternehmenszukunft',   'Unternehmenszukunft');
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-unternehmenspartner',   'Unternehmenspartner');
+INSERT INTO TopicProp VALUES ('t-innovationspotenziale', 1, 'Name', 'Innovationspotenziale');
+INSERT INTO TopicProp VALUES ('t-unternehmenszukunft', 1,   'Name', 'Unternehmenszukunft');
+INSERT INTO TopicProp VALUES ('t-unternehmenspartner', 1,   'Name', 'Unternehmenspartner');
+
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-wettbewerb-zugang', 'Wettbewerb, Zugang');
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-marktpartner',      'Marktpartner');
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-markterwartungen',  'Markterwartungen');
+INSERT INTO TopicProp VALUES ('t-wettbewerb-zugang', 1, 'Name', 'Wettbewerb, Zugang');
+INSERT INTO TopicProp VALUES ('t-marktpartner', 1,      'Name', 'Marktpartner');
+INSERT INTO TopicProp VALUES ('t-markterwartungen', 1,  'Name', 'Markterwartungen');
+
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-produktplanung',    'Produktplanung');
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-geschaeftsleitung', 'Gesch&#195;&#164;ftsleitung');
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-techn-loesungen',   'Techn. L&#195;&#182;sungen');
+INSERT INTO TopicProp VALUES ('t-produktplanung', 1,    'Name', 'Produktplanung');
+INSERT INTO TopicProp VALUES ('t-geschaeftsleitung', 1, 'Name', 'Gesch&#195;&#164;ftsleitung');
+INSERT INTO TopicProp VALUES ('t-techn-loesungen', 1,   'Name', 'Techn. L&#195;&#182;sungen');
+
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-kommunikation',       'Kommunikation');
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-produktmarketing',    'Produktmarketing');
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-preisattraktivitaet', 'Preisattraktivit&#195;&#164;t');
+INSERT INTO TopicProp VALUES ('t-kommunikation', 1,       'Name', 'Kommunikation');
+INSERT INTO TopicProp VALUES ('t-produktmarketing', 1,    'Name', 'Produktmarketing');
+INSERT INTO TopicProp VALUES ('t-preisattraktivitaet', 1, 'Name', 'Preisattraktivit&#195;&#164;t');
+
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-betriebsstruktur', 'Betriebsstruktur');
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-betriebsqualitaet', 'Betriebsqualit&#195;&#164;t');
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-betriebsablaeufe', 'Betriebsabl&#195;&#164;ufe');
+INSERT INTO TopicProp VALUES ('t-betriebsstruktur', 1, 'Name', 'Betriebsstruktur');
+INSERT INTO TopicProp VALUES ('t-betriebsqualitaet', 1, 'Name', 'Betriebsqualit&#195;&#164;t');
+INSERT INTO TopicProp VALUES ('t-betriebsablaeufe', 1, 'Name', 'Betriebsabl&#195;&#164;ufe');
+
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-vertriebsstruktur',  'Vertriebsstruktur');
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-vertriebsqualitaet', 'Vertriebsqualit&#195;&#164;t');
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-vertriebsablaeufe',  'Vertriebsabl&#195;&#164;ufe');
+INSERT INTO TopicProp VALUES ('t-vertriebsstruktur', 1,  'Name', 'Vertriebsstruktur');
+INSERT INTO TopicProp VALUES ('t-vertriebsqualitaet', 1, 'Name', 'Vertriebsqualit&#195;&#164;t');
+INSERT INTO TopicProp VALUES ('t-vertriebsablaeufe', 1,  'Name', 'Vertriebsabl&#195;&#164;ufe');
+
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-wirtschaftlichkeit', 'Wirtschaftlichkeit');
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-ertragslage',        'Ertragslage');
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-zielabweichungen',   'Zielabweichungen');
+INSERT INTO TopicProp VALUES ('t-wirtschaftlichkeit', 1, 'Name', 'Wirtschaftlichkeit');
+INSERT INTO TopicProp VALUES ('t-ertragslage', 1,        'Name', 'Ertragslage');
+INSERT INTO TopicProp VALUES ('t-zielabweichungen', 1,   'Name', 'Zielabweichungen');
+
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-produktleistungen', 'Produktleistungen');
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-kundennutzen',      'Kundennutzen');
+INSERT INTO Topic VALUES ('tt-kriterium', 1, 1, 't-marktabweichungen', 'Marktabweichungen');
+INSERT INTO TopicProp VALUES ('t-produktleistungen', 1, 'Name', 'Produktleistungen');
+INSERT INTO TopicProp VALUES ('t-kundennutzen',      1, 'Name', 'Kundennutzen');
+INSERT INTO TopicProp VALUES ('t-marktabweichungen', 1, 'Name', 'Marktabweichungen');
+
+--- assign second-level criteria to top-level criteria
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-732', '', 't-ziele', 1, 't-innovationspotenziale', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-733', '', 't-ziele', 1, 't-unternehmenszukunft', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-734', '', 't-ziele', 1, 't-unternehmenspartner', 1);
+
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-735', '', 't-markt', 1, 't-wettbewerb-zugang', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-736', '', 't-markt', 1, 't-marktpartner', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-737', '', 't-markt', 1, 't-markterwartungen', 1);
+
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-738', '', 't-management', 1, 't-produktplanung', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-739', '', 't-management', 1, 't-geschaeftsleitung', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-740', '', 't-management', 1, 't-techn-loesungen', 1);
+
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-741', '', 't-marketing', 1, 't-kommunikation', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-742', '', 't-marketing', 1, 't-produktmarketing', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-743', '', 't-marketing', 1, 't-preisattraktivitaet', 1);
+
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-744', '', 't-betrieb', 1, 't-betriebsstruktur', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-745', '', 't-betrieb', 1, 't-betriebsqualitaet', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-746', '', 't-betrieb', 1, 't-betriebsablaeufe', 1);
+
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-747', '', 't-vertrieb', 1, 't-vertriebsstruktur', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-748', '', 't-vertrieb', 1, 't-vertriebsqualitaet', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-749', '', 't-vertrieb', 1, 't-vertriebsablaeufe', 1);
+
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-750', '', 't-ertraege', 1, 't-wirtschaftlichkeit', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-751', '', 't-ertraege', 1, 't-ertragslage', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-752', '', 't-ertraege', 1, 't-zielabweichungen', 1);
+
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-753', '', 't-produkte', 1, 't-produktleistungen', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-754', '', 't-produkte', 1, 't-kundennutzen', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-755', '', 't-produkte', 1, 't-marktabweichungen', 1);
+
+-- ===========================================================================
+
+
+
+------------
+--- View ---
+------------
+
+
+
+--- template
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-businesscheck', 1, 330, 260);
+
+--- assessment layers
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-chancen', 1, 350, 110);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-plaene', 1, 350, 210);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-ablaeufe', 1, 350, 310);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-ergebnisse', 1, 350, 410);
+
+--- top-level criteria
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-ziele', 1, 200, 110);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-management', 1, 200, 210);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-betrieb', 1, 200, 310);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-ertraege', 1, 200, 410);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-produkte', 1, 475, 410);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-vertrieb', 1, 475, 310);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-marketing', 1, 475, 210);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-markt', 1, 475, 110);
+
+--- second-level criteria
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-innovationspotenziale', 1, 93, 78);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-unternehmenszukunft', 1, 63, 98);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-unternehmenspartner', 1, 31, 110);
+
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-wettbewerb-zugang', 1, 588, 98);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-marktpartner', 1, 560, 117);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-markterwartungen', 1, 532, 133);
+
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-produktplanung', 1, 81, 176);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-geschaeftsleitung', 1, 51, 187);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-techn-loesungen', 1, 23, 199);
+
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-kommunikation', 1, 555, 215);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-produktmarketing', 1, 582, 197);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-preisattraktivitaet', 1, 528, 228);
+
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-betriebsstruktur', 1, 18, 355);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-betriebsqualitaet', 1, 79, 316);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-betriebsablaeufe', 1, 48, 335);
+
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-vertriebsstruktur', 1, 591, 288);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-vertriebsqualitaet', 1, 565, 306);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-vertriebsablaeufe', 1, 537, 323);
+
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-wirtschaftlichkeit', 1, 85, 419);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-ertragslage', 1, 54, 434);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-zielabweichungen', 1, 22, 449);
+
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-produktleistungen', 1, 567, 409);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-kundennutzen', 1, 540, 427);
+INSERT INTO ViewTopic VALUES ('t-businesscheck', 1, 't-marktabweichungen', 1, 595, 390);
+
+--- associations
+
+--- from template to assessment layers
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-650', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-651', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-652', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-653', 1);
+
+--- from template to top-level criteria
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-642', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-643', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-644', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-645', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-646', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-647', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-648', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-649', 1);
+
+--- from top-level criteria to second-level criteria
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-732', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-733', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-734', 1);
+
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-735', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-736', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-737', 1);
+
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-738', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-739', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-740', 1);
+
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-741', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-742', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-743', 1);
+
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-744', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-745', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-746', 1);
+
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-747', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-748', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-749', 1);
+
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-750', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-751', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-752', 1);
+
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-753', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-754', 1);
+INSERT INTO ViewAssociation VALUES ('t-businesscheck', 1, 'a-755', 1);

Modified: branches/eschnepel/install/examples/kompetenzstern/config/web.xml
===================================================================
--- branches/eschnepel/install/examples/kompetenzstern/config/web.xml	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/kompetenzstern/config/web.xml	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,59 +1,59 @@
-&lt;!DOCTYPE web-app 
-    PUBLIC &quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot; 
-    &quot;<A HREF="http://java.sun.com/dtd/web-app_2_3.dtd">http://java.sun.com/dtd/web-app_2_3.dtd</A>&quot;&gt;
-
-&lt;web-app&gt;
-
-    &lt;!-- General description of the web application --&gt;
-
-    &lt;display-name&gt;Kompetenzstern&lt;/display-name&gt;
-    &lt;description&gt;
-      Version 1.0b1.
-      Written by J\u0x9arg Richter (<A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>)
-    &lt;/description&gt;
-
-    &lt;!-- Context initialization parameters that define shared
-         String constants used within your application, which
-         can be customized by the system administrator who is
-         installing your application.
-    --&gt;
-
-    &lt;context-param&gt;
-      &lt;param-name&gt;service&lt;/param-name&gt;
-      &lt;param-value&gt;default&lt;/param-value&gt;
-      &lt;description&gt;
-        Selects a DeepaMehta service.
-        If this parameter is not set the &quot;default&quot; service will be used.
-        To configure DeepaMehta services see the file install/client/dms.rc
-      &lt;/description&gt;
-    &lt;/context-param&gt;
-
-    &lt;!-- Servlet definitions for the servlets that make up
-         the web application.
-    --&gt;
-
-    &lt;servlet&gt;
-      &lt;servlet-name&gt;Kompetenzstern Servlet&lt;/servlet-name&gt;
-      &lt;description&gt;Kompetenzstern Controler&lt;/description&gt;
-      &lt;servlet-class&gt;de.deepamehta.kompetenzstern.KSServlet&lt;/servlet-class&gt;
-    &lt;/servlet&gt;
-
-    &lt;!-- Define mappings that are used by the servlet container to
-         translate a particular request URI (context-relative) to a
-         particular servlet.
-    --&gt;
-
-    &lt;servlet-mapping&gt;
-      &lt;servlet-name&gt;Kompetenzstern Servlet&lt;/servlet-name&gt;
-      &lt;url-pattern&gt;/controller&lt;/url-pattern&gt;
-    &lt;/servlet-mapping&gt;
-
-    &lt;!-- Define the default session timeout for your application,
-         in minutes.
-    --&gt;
-
-    &lt;session-config&gt;
-      &lt;session-timeout&gt;30&lt;/session-timeout&gt;
-    &lt;/session-config&gt;
-
-&lt;/web-app&gt;
+&lt;!DOCTYPE web-app 
+    PUBLIC &quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot; 
+    &quot;<A HREF="http://java.sun.com/dtd/web-app_2_3.dtd">http://java.sun.com/dtd/web-app_2_3.dtd</A>&quot;&gt;
+
+&lt;web-app&gt;
+
+    &lt;!-- General description of the web application --&gt;
+
+    &lt;display-name&gt;Kompetenzstern&lt;/display-name&gt;
+    &lt;description&gt;
+      Version 1.0b1.
+      Written by J\u0x9arg Richter (<A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>)
+    &lt;/description&gt;
+
+    &lt;!-- Context initialization parameters that define shared
+         String constants used within your application, which
+         can be customized by the system administrator who is
+         installing your application.
+    --&gt;
+
+    &lt;context-param&gt;
+      &lt;param-name&gt;service&lt;/param-name&gt;
+      &lt;param-value&gt;default&lt;/param-value&gt;
+      &lt;description&gt;
+        Selects a DeepaMehta service.
+        If this parameter is not set the &quot;default&quot; service will be used.
+        To configure DeepaMehta services see the file install/client/dms.rc
+      &lt;/description&gt;
+    &lt;/context-param&gt;
+
+    &lt;!-- Servlet definitions for the servlets that make up
+         the web application.
+    --&gt;
+
+    &lt;servlet&gt;
+      &lt;servlet-name&gt;Kompetenzstern Servlet&lt;/servlet-name&gt;
+      &lt;description&gt;Kompetenzstern Controler&lt;/description&gt;
+      &lt;servlet-class&gt;de.deepamehta.kompetenzstern.KSServlet&lt;/servlet-class&gt;
+    &lt;/servlet&gt;
+
+    &lt;!-- Define mappings that are used by the servlet container to
+         translate a particular request URI (context-relative) to a
+         particular servlet.
+    --&gt;
+
+    &lt;servlet-mapping&gt;
+      &lt;servlet-name&gt;Kompetenzstern Servlet&lt;/servlet-name&gt;
+      &lt;url-pattern&gt;/controller&lt;/url-pattern&gt;
+    &lt;/servlet-mapping&gt;
+
+    &lt;!-- Define the default session timeout for your application,
+         in minutes.
+    --&gt;
+
+    &lt;session-config&gt;
+      &lt;session-timeout&gt;30&lt;/session-timeout&gt;
+    &lt;/session-config&gt;
+
+&lt;/web-app&gt;

Modified: branches/eschnepel/install/examples/kompetenzstern/pages/Home.jsp
===================================================================
--- branches/eschnepel/install/examples/kompetenzstern/pages/Home.jsp	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/kompetenzstern/pages/Home.jsp	2007-10-03 17:45:23 UTC (rev 230)
@@ -1 +1,34 @@
-&lt;%@ include file=&quot;KS.jsp&quot; %&gt;&lt;% begin(session, out); %&gt;&lt;%!	static String[] propSel = {KS.PROPERTY_DESCRIPTION, KS.PROPERTY_ZUSAMMENFASSUNG};	//	static Action editAction        = new Action(KS.ACTION_EDIT_KS, &quot;edit.gif&quot;, &quot;Bearbeiten&quot;);	static Action deleteAction      = new Action(KS.ACTION_DELETE_KS, &quot;trash.gif&quot;, &quot;L&#154;schen&quot;);	static Action[] actions = {editAction, deleteAction};	//	static Hashtable colWidths = new Hashtable();	/* static {		colWidths.put(KS.PROPERTY_NAME, &quot;200&quot;);		colWidths.put(KS.PROPERTY_PROFILE, &quot;150&quot;);	} */%&gt;&lt;%	HTMLGenerator html = (HTMLGenerator) session.getAttribute(&quot;html&quot;);	String ksID = (String) session.getAttribute(&quot;ksID&quot;);	Vector ksList = (Vector) session.getAttribute(&quot;ksList&quot;);	out.println(&quot;&lt;H2&gt;Kompetenzstern&lt;/H2&gt;&quot;);	out.println(&quot;&lt;TABLE&gt;&quot;);	out.println(&quot;&lt;TR&gt;&lt;TD&gt;&quot;);	out.println(html.listHeading(ksList.size(), &quot;&quot;, &quot;Kompetenzstern&quot;, &quot;Kompetenzsterne&quot;));	// ### deprecated	out.println(&quot;&lt;P&gt;&quot;);	out.println(html.list(ksList, ksID, p!
 ropSel, true, actions, KS.ACTION_SHOW_KS_INFO, null, colWidths));	out.println(&quot;&lt;P&gt;&lt;HR&gt;&quot;);	out.println(html.link(&quot;Kompetenzstern erzeugen&quot;, KS.ACTION_SHOW_KS_FORM));	out.println(&quot;&lt;/TD&gt;&quot;);	out.println(&quot;&lt;/TR&gt;&quot;);	out.println(&quot;&lt;/TABLE&gt;&quot;);%&gt;&lt;% end(out); %&gt;
\ No newline at end of file
+&lt;%@ include file=&quot;KS.jsp&quot; %&gt;
+
+&lt;% begin(session, out); %&gt;
+&lt;%!
+	static String[] propSel = {KS.PROPERTY_DESCRIPTION, KS.PROPERTY_ZUSAMMENFASSUNG};
+	//
+	static Action editAction        = new Action(KS.ACTION_EDIT_KS, &quot;edit.gif&quot;, &quot;Bearbeiten&quot;);
+	static Action deleteAction      = new Action(KS.ACTION_DELETE_KS, &quot;trash.gif&quot;, &quot;L&#154;schen&quot;);
+	static Action[] actions = {editAction, deleteAction};
+	//
+	static Hashtable colWidths = new Hashtable();
+	/* static {
+		colWidths.put(KS.PROPERTY_NAME, &quot;200&quot;);
+		colWidths.put(KS.PROPERTY_PROFILE, &quot;150&quot;);
+	} */
+%&gt;
+&lt;%
+	HTMLGenerator html = (HTMLGenerator) session.getAttribute(&quot;html&quot;);
+	String ksID = (String) session.getAttribute(&quot;ksID&quot;);
+	Vector ksList = (Vector) session.getAttribute(&quot;ksList&quot;);
+
+	out.println(&quot;&lt;H2&gt;Kompetenzstern&lt;/H2&gt;&quot;);
+	out.println(&quot;&lt;TABLE&gt;&quot;);
+	out.println(&quot;&lt;TR&gt;&lt;TD&gt;&quot;);
+	out.println(html.listHeading(ksList.size(), &quot;&quot;, &quot;Kompetenzstern&quot;, &quot;Kompetenzsterne&quot;));	// ### deprecated
+	out.println(&quot;&lt;P&gt;&quot;);
+	out.println(html.list(ksList, ksID, propSel, true, actions, KS.ACTION_SHOW_KS_INFO, null, colWidths));
+	out.println(&quot;&lt;P&gt;&lt;HR&gt;&quot;);
+	out.println(html.link(&quot;Kompetenzstern erzeugen&quot;, KS.ACTION_SHOW_KS_FORM));
+	out.println(&quot;&lt;/TD&gt;&quot;);
+	out.println(&quot;&lt;/TR&gt;&quot;);
+	out.println(&quot;&lt;/TABLE&gt;&quot;);
+%&gt;
+&lt;% end(out); %&gt;

Modified: branches/eschnepel/install/examples/ldap/src/de/deepamehta/topics/LdapGroupContainerTopic.java
===================================================================
--- branches/eschnepel/install/examples/ldap/src/de/deepamehta/topics/LdapGroupContainerTopic.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/ldap/src/de/deepamehta/topics/LdapGroupContainerTopic.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,59 +1,59 @@
-package de.deepamehta.topics;
-
-import de.deepamehta.BaseTopic;
-import de.deepamehta.service.ApplicationService;
-
-/**
- *
- */
-public class LdapGroupContainerTopic extends ElementContainerTopic {
-
-	String[] groupingProperties = {};
-
-	public LdapGroupContainerTopic(BaseTopic topic, ApplicationService as) {
-		super(topic, as);
-	}
-
-
-
-	// *********************************************************
-	// *** Implementation of abstract ContainerTopic methods ***
-	// *********************************************************
-
-
-
-	protected String getContentType() {
-		return &quot;group&quot;;
-	}
-
-	protected String getContentTypeID() {
-		return &quot;tt-ldapgroup&quot;;
-	}
-
-
-
-	// ***************************************************************
-	// *** Implementation of abstract ElementContainerTopic method ***
-	// ***************************************************************
-
-
-
-	public String getNameAttribute() {		// ### was getNameProperty()
-		return &quot;cn&quot;;
-	}
-
-
-
-	// ###
-
-	protected String[] getGroupingProperties() {
-		return groupingProperties;
-	}
-	
-	/**
-	 *  Overwritten fro ElementContainer
-	 */
-	protected String createTopicID(String elementID) {
-		return &quot;t-&quot; + getContentType() + &quot;-&quot; + elementID.hashCode();
-	}
-}
+package de.deepamehta.topics;
+
+import de.deepamehta.BaseTopic;
+import de.deepamehta.service.ApplicationService;
+
+/**
+ *
+ */
+public class LdapGroupContainerTopic extends ElementContainerTopic {
+
+	String[] groupingProperties = {};
+
+	public LdapGroupContainerTopic(BaseTopic topic, ApplicationService as) {
+		super(topic, as);
+	}
+
+
+
+	// *********************************************************
+	// *** Implementation of abstract ContainerTopic methods ***
+	// *********************************************************
+
+
+
+	protected String getContentType() {
+		return &quot;group&quot;;
+	}
+
+	protected String getContentTypeID() {
+		return &quot;tt-ldapgroup&quot;;
+	}
+
+
+
+	// ***************************************************************
+	// *** Implementation of abstract ElementContainerTopic method ***
+	// ***************************************************************
+
+
+
+	public String getNameAttribute() {		// ### was getNameProperty()
+		return &quot;cn&quot;;
+	}
+
+
+
+	// ###
+
+	protected String[] getGroupingProperties() {
+		return groupingProperties;
+	}
+	
+	/**
+	 *  Overwritten fro ElementContainer
+	 */
+	protected String createTopicID(String elementID) {
+		return &quot;t-&quot; + getContentType() + &quot;-&quot; + elementID.hashCode();
+	}
+}

Modified: branches/eschnepel/install/examples/ldap/src/de/deepamehta/topics/LdapGroupTopic.java
===================================================================
--- branches/eschnepel/install/examples/ldap/src/de/deepamehta/topics/LdapGroupTopic.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/ldap/src/de/deepamehta/topics/LdapGroupTopic.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,64 +1,64 @@
-package de.deepamehta.topics;
-
-import de.deepamehta.BaseTopic;
-import de.deepamehta.TopicInitException;
-import de.deepamehta.service.ApplicationService;
-import de.deepamehta.service.CorporateDirectives;
-import de.deepamehta.service.Session;
-
-
-
-/**
- *
- */
-public class LdapGroupTopic extends DataConsumerTopic {
-
-
-
-	// *******************
-	// *** Constructor ***
-	// *******************
-
-
-
-	public LdapGroupTopic(BaseTopic topic, ApplicationService as) {
-		super(topic, as);
-	}
-
-
-
-	// **************
-	// *** Method ***
-	// **************
-
-
-
-	// ----------------------
-	// --- Defining Hooks ---
-	// ----------------------
-
-
-
-	public CorporateDirectives init(int initLevel, Session session)
-															throws TopicInitException {
-		CorporateDirectives directives = super.init(initLevel, session);
-		//
-		if (initLevel == INITLEVEL_1) {
-			if (LOG_TOPIC_INIT) {
-				System.out.println(&quot;&gt;&gt;&gt; LdapGroupTopic.init(&quot; + initLevel + &quot;): &quot; + this +
-					&quot; -- registers relation&quot;);
-			}
-			registerRelationX(&quot;at-ldapmember&quot;, &quot;user&quot;, &quot;member&quot;, &quot;tt-ldapuser&quot;, &quot;user&quot;,
-				&quot;cn&quot;);
-		}
-		//
-		return directives;
-	}
-
-	/**
-	 * Overwritten from DataConsumerTopic
-	 */
-	protected String createTopicID(String topicTypeName, String id) {
-		return &quot;t-&quot; + topicTypeName + &quot;-&quot; + id.hashCode();
-	}
-}
+package de.deepamehta.topics;
+
+import de.deepamehta.BaseTopic;
+import de.deepamehta.TopicInitException;
+import de.deepamehta.service.ApplicationService;
+import de.deepamehta.service.CorporateDirectives;
+import de.deepamehta.service.Session;
+
+
+
+/**
+ *
+ */
+public class LdapGroupTopic extends DataConsumerTopic {
+
+
+
+	// *******************
+	// *** Constructor ***
+	// *******************
+
+
+
+	public LdapGroupTopic(BaseTopic topic, ApplicationService as) {
+		super(topic, as);
+	}
+
+
+
+	// **************
+	// *** Method ***
+	// **************
+
+
+
+	// ----------------------
+	// --- Defining Hooks ---
+	// ----------------------
+
+
+
+	public CorporateDirectives init(int initLevel, Session session)
+															throws TopicInitException {
+		CorporateDirectives directives = super.init(initLevel, session);
+		//
+		if (initLevel == INITLEVEL_1) {
+			if (LOG_TOPIC_INIT) {
+				System.out.println(&quot;&gt;&gt;&gt; LdapGroupTopic.init(&quot; + initLevel + &quot;): &quot; + this +
+					&quot; -- registers relation&quot;);
+			}
+			registerRelationX(&quot;at-ldapmember&quot;, &quot;user&quot;, &quot;member&quot;, &quot;tt-ldapuser&quot;, &quot;user&quot;,
+				&quot;cn&quot;);
+		}
+		//
+		return directives;
+	}
+
+	/**
+	 * Overwritten from DataConsumerTopic
+	 */
+	protected String createTopicID(String topicTypeName, String id) {
+		return &quot;t-&quot; + topicTypeName + &quot;-&quot; + id.hashCode();
+	}
+}

Modified: branches/eschnepel/install/examples/ldap/src/de/deepamehta/topics/LdapUserContainerTopic.java
===================================================================
--- branches/eschnepel/install/examples/ldap/src/de/deepamehta/topics/LdapUserContainerTopic.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/ldap/src/de/deepamehta/topics/LdapUserContainerTopic.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,66 +1,66 @@
-package de.deepamehta.topics;
-
-import de.deepamehta.BaseTopic;
-import de.deepamehta.service.ApplicationService;
-
-
-
-public class LdapUserContainerTopic extends ElementContainerTopic {
-
-
-
-	String[] groupingProperties = {};	// ###
-
-
-
-	// *******************
-	// *** Constructor ***
-	// *******************
-
-
-
-	public LdapUserContainerTopic(BaseTopic topic, ApplicationService as) {
-		super(topic, as);
-	}
-
-
-
-	// *********************************************************
-	// *** Implementation of abstract ContainerTopic methods ***
-	// *********************************************************
-
-
-
-	protected String getContentType() {
-		return &quot;user&quot;;
-	}
-
-	protected String getContentTypeID() {
-		return &quot;tt-ldapuser&quot;;
-	}
-
-
-
-	// ***************************************************************
-	// *** Implementation of abstract ElementContainerTopic method ***
-	// ***************************************************************
-
-
-
-	public String getNameAttribute() {		// ### was getNameProperty()
-		return &quot;cn&quot;;	// ###
-	}
-
-
-
-	// ###
-
-	protected String[] getGroupingProperties() {
-		return groupingProperties;
-	}
-	
-	// Overrides ElementContainer
-	protected String createTopicID(String elementID) {
-		return &quot;t-&quot; + getContentType() + &quot;-&quot; + elementID.hashCode();
-	}
-}
+package de.deepamehta.topics;
+
+import de.deepamehta.BaseTopic;
+import de.deepamehta.service.ApplicationService;
+
+
+
+public class LdapUserContainerTopic extends ElementContainerTopic {
+
+
+
+	String[] groupingProperties = {};	// ###
+
+
+
+	// *******************
+	// *** Constructor ***
+	// *******************
+
+
+
+	public LdapUserContainerTopic(BaseTopic topic, ApplicationService as) {
+		super(topic, as);
+	}
+
+
+
+	// *********************************************************
+	// *** Implementation of abstract ContainerTopic methods ***
+	// *********************************************************
+
+
+
+	protected String getContentType() {
+		return &quot;user&quot;;
+	}
+
+	protected String getContentTypeID() {
+		return &quot;tt-ldapuser&quot;;
+	}
+
+
+
+	// ***************************************************************
+	// *** Implementation of abstract ElementContainerTopic method ***
+	// ***************************************************************
+
+
+
+	public String getNameAttribute() {		// ### was getNameProperty()
+		return &quot;cn&quot;;	// ###
+	}
+
+
+
+	// ###
+
+	protected String[] getGroupingProperties() {
+		return groupingProperties;
+	}
+	
+	// Overrides ElementContainer
+	protected String createTopicID(String elementID) {
+		return &quot;t-&quot; + getContentType() + &quot;-&quot; + elementID.hashCode();
+	}
+}

Modified: branches/eschnepel/install/examples/ldap/src/de/deepamehta/topics/LdapUserTopic.java
===================================================================
--- branches/eschnepel/install/examples/ldap/src/de/deepamehta/topics/LdapUserTopic.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/ldap/src/de/deepamehta/topics/LdapUserTopic.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,58 +1,58 @@
-package de.deepamehta.topics;
-
-import de.deepamehta.BaseTopic;
-import de.deepamehta.TopicInitException;
-import de.deepamehta.service.ApplicationService;
-import de.deepamehta.service.CorporateDirectives;
-import de.deepamehta.service.Session;
-
-
-
-/**
- *
- */
-public class LdapUserTopic extends DataConsumerTopic {
-
-
-
-	// *******************
-	// *** Constructor ***
-	// *******************
-
-
-
-	public LdapUserTopic(BaseTopic topic, ApplicationService as) {
-		super(topic, as);
-	}
-
-
-
-	// ----------------------
-	// --- Defining Hooks ---
-	// ----------------------
-
-
-
-	public CorporateDirectives init(int initLevel, Session session)
-															throws TopicInitException {
-		CorporateDirectives directives = super.init(initLevel, session);
-		//
-		if (initLevel == INITLEVEL_1) {
-			if (LOG_TOPIC_INIT) {
-				System.out.println(&quot;&gt;&gt;&gt; LdapUserTopic.init(&quot; + initLevel + &quot;): &quot; + this +
-					&quot; -- register relation&quot;);
-			}
-			registerRelationX(&quot;at-ldapmemberof&quot;, &quot;group&quot;, &quot;memberOf&quot;, &quot;tt-ldapgroup&quot;,
-				&quot;group&quot;, &quot;cn&quot;);
-		}
-		//
-		return directives;
-	}
-	
-	/**
-	 *  Overwritten from DataConsumerTopic
-	 */
-	protected String createTopicID(String topicTypeName, String id) {
-		return &quot;t-&quot; + topicTypeName + &quot;-&quot; + id.hashCode();
-	}
-}
+package de.deepamehta.topics;
+
+import de.deepamehta.BaseTopic;
+import de.deepamehta.TopicInitException;
+import de.deepamehta.service.ApplicationService;
+import de.deepamehta.service.CorporateDirectives;
+import de.deepamehta.service.Session;
+
+
+
+/**
+ *
+ */
+public class LdapUserTopic extends DataConsumerTopic {
+
+
+
+	// *******************
+	// *** Constructor ***
+	// *******************
+
+
+
+	public LdapUserTopic(BaseTopic topic, ApplicationService as) {
+		super(topic, as);
+	}
+
+
+
+	// ----------------------
+	// --- Defining Hooks ---
+	// ----------------------
+
+
+
+	public CorporateDirectives init(int initLevel, Session session)
+															throws TopicInitException {
+		CorporateDirectives directives = super.init(initLevel, session);
+		//
+		if (initLevel == INITLEVEL_1) {
+			if (LOG_TOPIC_INIT) {
+				System.out.println(&quot;&gt;&gt;&gt; LdapUserTopic.init(&quot; + initLevel + &quot;): &quot; + this +
+					&quot; -- register relation&quot;);
+			}
+			registerRelationX(&quot;at-ldapmemberof&quot;, &quot;group&quot;, &quot;memberOf&quot;, &quot;tt-ldapgroup&quot;,
+				&quot;group&quot;, &quot;cn&quot;);
+		}
+		//
+		return directives;
+	}
+	
+	/**
+	 *  Overwritten from DataConsumerTopic
+	 */
+	protected String createTopicID(String topicTypeName, String id) {
+		return &quot;t-&quot; + topicTypeName + &quot;-&quot; + id.hashCode();
+	}
+}

Modified: branches/eschnepel/install/examples/movies/bin/dmexamples_oracle.bat
===================================================================
--- branches/eschnepel/install/examples/movies/bin/dmexamples_oracle.bat	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/movies/bin/dmexamples_oracle.bat	2007-10-03 17:45:23 UTC (rev 230)
@@ -1 +1,2 @@
 sqlplus movies/movies @dmexamples_oracle.sql
+

Modified: branches/eschnepel/install/examples/movies/bin/dmexamples_oracle.sql
===================================================================
--- branches/eschnepel/install/examples/movies/bin/dmexamples_oracle.sql	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/movies/bin/dmexamples_oracle.sql	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,31 +1,31 @@
--- disables the ampersand variable expansion
-SET DEFINE OFF
-
--- drop all tables
-@@..\db\dropall.sql
-
--- table definitions
-@@..\db\db_tables_oracle.sql
-
--- table inserts
-@@..\db\db_inserts.sql
-
--- restoring example application (movies.sql)
--- @@..\movies.sql
-
--- commit changes
-commit;
-
--- exit SQLPlus
--- quit;
-
-
-
-
-
-
-
-
-
-
-
+-- disables the ampersand variable expansion
+SET DEFINE OFF
+
+-- drop all tables
+@@..\db\dropall.sql
+
+-- table definitions
+@@..\db\db_tables_oracle.sql
+
+-- table inserts
+@@..\db\db_inserts.sql
+
+-- restoring example application (movies.sql)
+-- @@..\movies.sql
+
+-- commit changes
+commit;
+
+-- exit SQLPlus
+-- quit;
+
+
+
+
+
+
+
+
+
+
+

Modified: branches/eschnepel/install/examples/movies/db/db_inserts.sql
===================================================================
--- branches/eschnepel/install/examples/movies/db/db_inserts.sql	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/movies/db/db_inserts.sql	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,64 +1,64 @@
-INSERT INTO Movie VALUES (1, 'Ed Wood', '', 1, 'USA', '1994', '2:06');
-INSERT INTO Movie VALUES (2, 'Erbarmungslos', 'Unforgiven', 2, 'USA', '1992', '2:00');
-INSERT INTO Movie VALUES (3, 'Before Sunrise', '', 3, 'USA/A', '1994', '1:37');
-INSERT INTO Movie VALUES (4, 'Killing Zoe', '', 4, 'USA', '1994', '1:36');
-INSERT INTO Movie VALUES (5, 'Rollerball', '', 5, 'USA', '1974', '2:05');
-INSERT INTO Movie VALUES (6, 'The Saint', '', 4, 'USA', '1997', '1:56');
-INSERT INTO Movie VALUES (7, 'Gilbert Grape', 'Whats Eating Gilbert Grape?', 6, 'USA', '1993', '1:57');
-INSERT INTO Movie VALUES (8, '12 Monkeys', '', 0, 'USA', '1995', '2:09');
-INSERT INTO Movie VALUES (9, 'Mikey und Nicky', '', 0, 'USA', '1976', '1:53');
-INSERT INTO Movie VALUES (10, 'Casino', '', 0, 'USA', '1995', '2:45');
-INSERT INTO Movie VALUES (11, 'Delicatessen', '', 0, 'F', '1990', '1:39');
-INSERT INTO Movie VALUES (12, 'Snake Eyes', '', 0, 'USA', '1993', '1:47');
-INSERT INTO Movie VALUES (13, 'Dead Man Walking', '', 0, 'USA', '1995', '2:02');
-INSERT INTO Movie VALUES (14, 'Smoke', '', 0, 'USA', '1995', '1:48');
-
-INSERT INTO Actor VALUES (1, 'Johnny Depp');
-INSERT INTO Actor VALUES (2, 'Martin Landau');
-INSERT INTO Actor VALUES (3, 'Sarah Jessica Parker');
-INSERT INTO Actor VALUES (4, 'Clint Eastwood');
-INSERT INTO Actor VALUES (5, 'Gene Hackman');
-INSERT INTO Actor VALUES (6, 'Morgan Freeman');
-INSERT INTO Actor VALUES (7, 'Ethan Hawke');
-INSERT INTO Actor VALUES (8, 'Julie Delpy');
-INSERT INTO Actor VALUES (9, 'Andrea Eckert');
-INSERT INTO Actor VALUES (10, 'Eric Stoltz');
-INSERT INTO Actor VALUES (11, 'Jean-Hugues Anglade');
-INSERT INTO Actor VALUES (12, 'James Caan');
-INSERT INTO Actor VALUES (13, 'John Houseman');
-INSERT INTO Actor VALUES (14, 'John Beck');
-INSERT INTO Actor VALUES (15, 'Val Kilmer');
-INSERT INTO Actor VALUES (16, 'Elisabeth Shue');
-INSERT INTO Actor VALUES (17, 'Rade Serbedzija');
-INSERT INTO Actor VALUES (18, 'Juliette Lewis');
-INSERT INTO Actor VALUES (19, 'Leonardo DiCaprio');
-
-INSERT INTO Mitwirkung VALUES (1, 1);
-INSERT INTO Mitwirkung VALUES (1, 2);
-INSERT INTO Mitwirkung VALUES (1, 3);
-INSERT INTO Mitwirkung VALUES (2, 4);
-INSERT INTO Mitwirkung VALUES (2, 5);
-INSERT INTO Mitwirkung VALUES (2, 6);
-INSERT INTO Mitwirkung VALUES (3, 7);
-INSERT INTO Mitwirkung VALUES (3, 8);
-INSERT INTO Mitwirkung VALUES (3, 9);
-INSERT INTO Mitwirkung VALUES (4, 10);
-INSERT INTO Mitwirkung VALUES (4, 8);
-INSERT INTO Mitwirkung VALUES (4, 11);
-INSERT INTO Mitwirkung VALUES (5, 12);
-INSERT INTO Mitwirkung VALUES (5, 13);
-INSERT INTO Mitwirkung VALUES (5, 14);
-INSERT INTO Mitwirkung VALUES (6, 15);
-INSERT INTO Mitwirkung VALUES (6, 16);
-INSERT INTO Mitwirkung VALUES (6, 17);
-INSERT INTO Mitwirkung VALUES (7, 1);
-INSERT INTO Mitwirkung VALUES (7, 18);
-INSERT INTO Mitwirkung VALUES (7, 19);
-
-INSERT INTO Gattung VALUES(1, 'Tragikkomoedie');
-INSERT INTO Gattung VALUES(2, 'Western');
-INSERT INTO Gattung VALUES(3, 'Liebesfilm');
-INSERT INTO Gattung VALUES(4, 'Actionthriller');
-INSERT INTO Gattung VALUES(5, 'Actionfilm');
-INSERT INTO Gattung VALUES(6, 'Familiendrama');
-
+INSERT INTO Movie VALUES (1, 'Ed Wood', '', 1, 'USA', '1994', '2:06');
+INSERT INTO Movie VALUES (2, 'Erbarmungslos', 'Unforgiven', 2, 'USA', '1992', '2:00');
+INSERT INTO Movie VALUES (3, 'Before Sunrise', '', 3, 'USA/A', '1994', '1:37');
+INSERT INTO Movie VALUES (4, 'Killing Zoe', '', 4, 'USA', '1994', '1:36');
+INSERT INTO Movie VALUES (5, 'Rollerball', '', 5, 'USA', '1974', '2:05');
+INSERT INTO Movie VALUES (6, 'The Saint', '', 4, 'USA', '1997', '1:56');
+INSERT INTO Movie VALUES (7, 'Gilbert Grape', 'Whats Eating Gilbert Grape?', 6, 'USA', '1993', '1:57');
+INSERT INTO Movie VALUES (8, '12 Monkeys', '', 0, 'USA', '1995', '2:09');
+INSERT INTO Movie VALUES (9, 'Mikey und Nicky', '', 0, 'USA', '1976', '1:53');
+INSERT INTO Movie VALUES (10, 'Casino', '', 0, 'USA', '1995', '2:45');
+INSERT INTO Movie VALUES (11, 'Delicatessen', '', 0, 'F', '1990', '1:39');
+INSERT INTO Movie VALUES (12, 'Snake Eyes', '', 0, 'USA', '1993', '1:47');
+INSERT INTO Movie VALUES (13, 'Dead Man Walking', '', 0, 'USA', '1995', '2:02');
+INSERT INTO Movie VALUES (14, 'Smoke', '', 0, 'USA', '1995', '1:48');
+
+INSERT INTO Actor VALUES (1, 'Johnny Depp');
+INSERT INTO Actor VALUES (2, 'Martin Landau');
+INSERT INTO Actor VALUES (3, 'Sarah Jessica Parker');
+INSERT INTO Actor VALUES (4, 'Clint Eastwood');
+INSERT INTO Actor VALUES (5, 'Gene Hackman');
+INSERT INTO Actor VALUES (6, 'Morgan Freeman');
+INSERT INTO Actor VALUES (7, 'Ethan Hawke');
+INSERT INTO Actor VALUES (8, 'Julie Delpy');
+INSERT INTO Actor VALUES (9, 'Andrea Eckert');
+INSERT INTO Actor VALUES (10, 'Eric Stoltz');
+INSERT INTO Actor VALUES (11, 'Jean-Hugues Anglade');
+INSERT INTO Actor VALUES (12, 'James Caan');
+INSERT INTO Actor VALUES (13, 'John Houseman');
+INSERT INTO Actor VALUES (14, 'John Beck');
+INSERT INTO Actor VALUES (15, 'Val Kilmer');
+INSERT INTO Actor VALUES (16, 'Elisabeth Shue');
+INSERT INTO Actor VALUES (17, 'Rade Serbedzija');
+INSERT INTO Actor VALUES (18, 'Juliette Lewis');
+INSERT INTO Actor VALUES (19, 'Leonardo DiCaprio');
+
+INSERT INTO Mitwirkung VALUES (1, 1);
+INSERT INTO Mitwirkung VALUES (1, 2);
+INSERT INTO Mitwirkung VALUES (1, 3);
+INSERT INTO Mitwirkung VALUES (2, 4);
+INSERT INTO Mitwirkung VALUES (2, 5);
+INSERT INTO Mitwirkung VALUES (2, 6);
+INSERT INTO Mitwirkung VALUES (3, 7);
+INSERT INTO Mitwirkung VALUES (3, 8);
+INSERT INTO Mitwirkung VALUES (3, 9);
+INSERT INTO Mitwirkung VALUES (4, 10);
+INSERT INTO Mitwirkung VALUES (4, 8);
+INSERT INTO Mitwirkung VALUES (4, 11);
+INSERT INTO Mitwirkung VALUES (5, 12);
+INSERT INTO Mitwirkung VALUES (5, 13);
+INSERT INTO Mitwirkung VALUES (5, 14);
+INSERT INTO Mitwirkung VALUES (6, 15);
+INSERT INTO Mitwirkung VALUES (6, 16);
+INSERT INTO Mitwirkung VALUES (6, 17);
+INSERT INTO Mitwirkung VALUES (7, 1);
+INSERT INTO Mitwirkung VALUES (7, 18);
+INSERT INTO Mitwirkung VALUES (7, 19);
+
+INSERT INTO Gattung VALUES(1, 'Tragikkomoedie');
+INSERT INTO Gattung VALUES(2, 'Western');
+INSERT INTO Gattung VALUES(3, 'Liebesfilm');
+INSERT INTO Gattung VALUES(4, 'Actionthriller');
+INSERT INTO Gattung VALUES(5, 'Actionfilm');
+INSERT INTO Gattung VALUES(6, 'Familiendrama');
+

Modified: branches/eschnepel/install/examples/movies/db/db_tables_derby.sql
===================================================================
--- branches/eschnepel/install/examples/movies/db/db_tables_derby.sql	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/movies/db/db_tables_derby.sql	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,29 +1,29 @@
-
-CREATE TABLE Movie (
-    ID INT PRIMARY KEY NOT NULL,
-    Title VARCHAR(100),
-    Originaltitle VARCHAR(100),
-    GattungID INT,
-    Country VARCHAR(20),
-    YearOfProduction VARCHAR(10),
-    Duration CHAR(4)
-);
-
-CREATE TABLE ACTOR (
-    ID INT PRIMARY KEY NOT NULL,
-    Name VARCHAR(40)
-);
-
-CREATE TABLE Mitwirkung (
-    MovieID INT NOT NULL,
-    ActorID INT NOT NULL
-);
-
-CREATE INDEX IDX_Mitwirkung_MovieID ON Mitwirkung(MovieID);
-CREATE INDEX IDX_Mitwirkung_ActorID ON Mitwirkung(ActorID);
-
-CREATE TABLE Gattung (
-    ID INT PRIMARY KEY NOT NULL,
-    Name VARCHAR(40)
-);
-
+
+CREATE TABLE Movie (
+    ID INT PRIMARY KEY NOT NULL,
+    Title VARCHAR(100),
+    Originaltitle VARCHAR(100),
+    GattungID INT,
+    Country VARCHAR(20),
+    YearOfProduction VARCHAR(10),
+    Duration CHAR(4)
+);
+
+CREATE TABLE ACTOR (
+    ID INT PRIMARY KEY NOT NULL,
+    Name VARCHAR(40)
+);
+
+CREATE TABLE Mitwirkung (
+    MovieID INT NOT NULL,
+    ActorID INT NOT NULL
+);
+
+CREATE INDEX IDX_Mitwirkung_MovieID ON Mitwirkung(MovieID);
+CREATE INDEX IDX_Mitwirkung_ActorID ON Mitwirkung(ActorID);
+
+CREATE TABLE Gattung (
+    ID INT PRIMARY KEY NOT NULL,
+    Name VARCHAR(40)
+);
+

Modified: branches/eschnepel/install/examples/movies/db/db_tables_hsqldb.sql
===================================================================
--- branches/eschnepel/install/examples/movies/db/db_tables_hsqldb.sql	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/movies/db/db_tables_hsqldb.sql	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,29 +1,29 @@
-
-CREATE TABLE Movie (
-    ID INT NOT NULL PRIMARY KEY,
-    Title VARCHAR(100),
-    Originaltitle VARCHAR(100),
-    GattungID INT,
-    Country VARCHAR(20),
-    YearOfProduction VARCHAR(10),
-    Duration CHAR(4)
-);
-
-CREATE TABLE ACTOR (
-    ID INT NOT NULL PRIMARY KEY,
-    Name VARCHAR(40)
-);
-
-CREATE TABLE Mitwirkung (
-    MovieID INT NOT NULL,
-    ActorID INT NOT NULL
-);
-
-CREATE INDEX IDX_Mitwirkung_MovieID ON Mitwirkung(MovieID);
-CREATE INDEX IDX_Mitwirkung_ActorID ON Mitwirkung(ActorID);
-
-CREATE TABLE Gattung (
-    ID INT NOT NULL PRIMARY KEY,
-    Name VARCHAR(40)
-);
-
+
+CREATE TABLE Movie (
+    ID INT NOT NULL PRIMARY KEY,
+    Title VARCHAR(100),
+    Originaltitle VARCHAR(100),
+    GattungID INT,
+    Country VARCHAR(20),
+    YearOfProduction VARCHAR(10),
+    Duration CHAR(4)
+);
+
+CREATE TABLE ACTOR (
+    ID INT NOT NULL PRIMARY KEY,
+    Name VARCHAR(40)
+);
+
+CREATE TABLE Mitwirkung (
+    MovieID INT NOT NULL,
+    ActorID INT NOT NULL
+);
+
+CREATE INDEX IDX_Mitwirkung_MovieID ON Mitwirkung(MovieID);
+CREATE INDEX IDX_Mitwirkung_ActorID ON Mitwirkung(ActorID);
+
+CREATE TABLE Gattung (
+    ID INT NOT NULL PRIMARY KEY,
+    Name VARCHAR(40)
+);
+

Modified: branches/eschnepel/install/examples/movies/db/db_tables_mysql.sql
===================================================================
--- branches/eschnepel/install/examples/movies/db/db_tables_mysql.sql	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/movies/db/db_tables_mysql.sql	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,28 +1,28 @@
-
-CREATE TABLE Movie (
-    ID INT PRIMARY KEY NOT NULL,
-    Title VARCHAR(100),
-    Originaltitle VARCHAR(100),
-    GattungID INT,
-    Country VARCHAR(20),
-    YearOfProduction VARCHAR(10),
-    Duration CHAR(4)
-);
-
-CREATE TABLE Actor (
-    ID INT PRIMARY KEY NOT NULL,
-    Name VARCHAR(40)
-);
-
-CREATE TABLE Mitwirkung (
-    MovieID INT NOT NULL,
-    ActorID INT NOT NULL,
-    INDEX(MovieID),
-    INDEX(ActorID)
-);
-
-CREATE TABLE Gattung (
-    ID INT PRIMARY KEY NOT NULL,
-    Name VARCHAR(40)
-);
-
+
+CREATE TABLE Movie (
+    ID INT PRIMARY KEY NOT NULL,
+    Title VARCHAR(100),
+    Originaltitle VARCHAR(100),
+    GattungID INT,
+    Country VARCHAR(20),
+    YearOfProduction VARCHAR(10),
+    Duration CHAR(4)
+);
+
+CREATE TABLE Actor (
+    ID INT PRIMARY KEY NOT NULL,
+    Name VARCHAR(40)
+);
+
+CREATE TABLE Mitwirkung (
+    MovieID INT NOT NULL,
+    ActorID INT NOT NULL,
+    INDEX(MovieID),
+    INDEX(ActorID)
+);
+
+CREATE TABLE Gattung (
+    ID INT PRIMARY KEY NOT NULL,
+    Name VARCHAR(40)
+);
+

Modified: branches/eschnepel/install/examples/movies/db/db_tables_oracle.sql
===================================================================
--- branches/eschnepel/install/examples/movies/db/db_tables_oracle.sql	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/movies/db/db_tables_oracle.sql	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,34 +1,34 @@
-CREATE TABLE movie
-(
-    id            INT NOT NULL,
-    title         VARCHAR(100),
-    originaltitle VARCHAR(100),
-    gattungid     INT,
-    country       VARCHAR(20),
-    YearOfProduction          VARCHAR(10),
-    duration      VARCHAR(4),
-    CONSTRAINT pk_movie PRIMARY KEY (id)
-);
-
-CREATE TABLE actor
-(
-    id   INT NOT NULL,
-    name VARCHAR(40),
-    CONSTRAINT pk_actor PRIMARY KEY (id)
-);
-
-CREATE TABLE mitwirkung
-(
-    movieid INT NOT NULL,
-    actorid INT NOT NULL
-);
-CREATE INDEX i1_mitwirkung ON mitwirkung (movieid);
-CREATE INDEX i2_mitwirkung ON mitwirkung (actorid);
-
-CREATE TABLE gattung
-(
-    id   INT NOT NULL,
-    name VARCHAR(40),
-    CONSTRAINT pk_gattung PRIMARY KEY (id)
-);
-
+CREATE TABLE movie
+(
+    id            INT NOT NULL,
+    title         VARCHAR(100),
+    originaltitle VARCHAR(100),
+    gattungid     INT,
+    country       VARCHAR(20),
+    YearOfProduction          VARCHAR(10),
+    duration      VARCHAR(4),
+    CONSTRAINT pk_movie PRIMARY KEY (id)
+);
+
+CREATE TABLE actor
+(
+    id   INT NOT NULL,
+    name VARCHAR(40),
+    CONSTRAINT pk_actor PRIMARY KEY (id)
+);
+
+CREATE TABLE mitwirkung
+(
+    movieid INT NOT NULL,
+    actorid INT NOT NULL
+);
+CREATE INDEX i1_mitwirkung ON mitwirkung (movieid);
+CREATE INDEX i2_mitwirkung ON mitwirkung (actorid);
+
+CREATE TABLE gattung
+(
+    id   INT NOT NULL,
+    name VARCHAR(40),
+    CONSTRAINT pk_gattung PRIMARY KEY (id)
+);
+

Modified: branches/eschnepel/install/examples/movies/db/dmdb-movies-oracle.sql
===================================================================
--- branches/eschnepel/install/examples/movies/db/dmdb-movies-oracle.sql	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/movies/db/dmdb-movies-oracle.sql	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,31 +1,31 @@
-------------------
---- Datasource ---
-------------------
-
-
-
---- SQL Datasource ---
--- &quot;Movies&quot; datasource
-INSERT INTO Topic VALUES ('tt-datasource', 1, 1, 't-moviesdb', 'Movies (MySQL-DB)');
-INSERT INTO TopicProp VALUES ('t-moviesdb', 1, 'Name', 'Movies (MySQL-DB)');
-INSERT INTO TopicProp VALUES ('t-moviesdb', 1, 'URL', 'jdbc:oracle:thin:dm/<A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">dm at localhost</A>:1521:orcl');
-INSERT INTO TopicProp VALUES ('t-moviesdb', 1, 'Database Type', 'oracle');
-INSERT INTO TopicProp VALUES ('t-moviesdb', 1, 'Idle Elementtype', 'Movie');
--- Associate types with datasource
-INSERT INTO Association VALUES ('at-association', 1, 1, 'a-514', '', 'tt-movie', 1, 't-moviesdb', 1);
-INSERT INTO Association VALUES ('at-association', 1, 1, 'a-515', '', 'tt-moviecontainer', 1, 't-moviesdb', 1);
-INSERT INTO Association VALUES ('at-association', 1, 1, 'a-516', '', 'tt-actor', 1, 't-moviesdb', 1);
-INSERT INTO Association VALUES ('at-association', 1, 1, 'a-517', '', 'tt-actorcontainer', 1, 't-moviesdb', 1);
-
---- XML Datasource --- ### can't be used together with SQL example
--- The &quot;Movies and Actors&quot; example map
--- INSERT INTO Topic VALUES ('tt-project', 1, 1, 't-moviesxmlmap', 'Movies and Actors (XML-Source)');
--- &quot;Movies&quot; datasource
--- INSERT INTO Topic VALUES ('tt-datasource', 1, 1, 't-moviesxmlsource', 'Movies (XML-File)');
--- INSERT INTO TopicProp VALUES ('t-moviesxmlsource', 1, 'URL', 'xml:../../examples/Movies.xml');
--- INSERT INTO TopicProp VALUES ('t-moviesxmlsource', 1, 'Entities', 'Movie Actor Association');
--- Associate types with datasource
--- INSERT INTO Association VALUES ('at-association', 1, 1, 'a-518', '', 'tt-movie', 1, 't-moviesxmlsource', 1);
--- INSERT INTO Association VALUES ('at-association', 1, 1, 'a-519', '', 'tt-moviecontainer', 1, 't-moviesxmlsource', 1);
--- INSERT INTO Association VALUES ('at-association', 1, 1, 'a-520', '', 'tt-actor', 1, 't-moviesxmlsource', 1);
--- INSERT INTO Association VALUES ('at-association', 1, 1, 'a-521', '', 'tt-actorcontainer', 1, 't-moviesxmlsource', 1);
+------------------
+--- Datasource ---
+------------------
+
+
+
+--- SQL Datasource ---
+-- &quot;Movies&quot; datasource
+INSERT INTO Topic VALUES ('tt-datasource', 1, 1, 't-moviesdb', 'Movies (MySQL-DB)');
+INSERT INTO TopicProp VALUES ('t-moviesdb', 1, 'Name', 'Movies (MySQL-DB)');
+INSERT INTO TopicProp VALUES ('t-moviesdb', 1, 'URL', 'jdbc:oracle:thin:dm/<A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">dm at localhost</A>:1521:orcl');
+INSERT INTO TopicProp VALUES ('t-moviesdb', 1, 'Database Type', 'oracle');
+INSERT INTO TopicProp VALUES ('t-moviesdb', 1, 'Idle Elementtype', 'Movie');
+-- Associate types with datasource
+INSERT INTO Association VALUES ('at-association', 1, 1, 'a-514', '', 'tt-movie', 1, 't-moviesdb', 1);
+INSERT INTO Association VALUES ('at-association', 1, 1, 'a-515', '', 'tt-moviecontainer', 1, 't-moviesdb', 1);
+INSERT INTO Association VALUES ('at-association', 1, 1, 'a-516', '', 'tt-actor', 1, 't-moviesdb', 1);
+INSERT INTO Association VALUES ('at-association', 1, 1, 'a-517', '', 'tt-actorcontainer', 1, 't-moviesdb', 1);
+
+--- XML Datasource --- ### can't be used together with SQL example
+-- The &quot;Movies and Actors&quot; example map
+-- INSERT INTO Topic VALUES ('tt-project', 1, 1, 't-moviesxmlmap', 'Movies and Actors (XML-Source)');
+-- &quot;Movies&quot; datasource
+-- INSERT INTO Topic VALUES ('tt-datasource', 1, 1, 't-moviesxmlsource', 'Movies (XML-File)');
+-- INSERT INTO TopicProp VALUES ('t-moviesxmlsource', 1, 'URL', 'xml:../../examples/Movies.xml');
+-- INSERT INTO TopicProp VALUES ('t-moviesxmlsource', 1, 'Entities', 'Movie Actor Association');
+-- Associate types with datasource
+-- INSERT INTO Association VALUES ('at-association', 1, 1, 'a-518', '', 'tt-movie', 1, 't-moviesxmlsource', 1);
+-- INSERT INTO Association VALUES ('at-association', 1, 1, 'a-519', '', 'tt-moviecontainer', 1, 't-moviesxmlsource', 1);
+-- INSERT INTO Association VALUES ('at-association', 1, 1, 'a-520', '', 'tt-actor', 1, 't-moviesxmlsource', 1);
+-- INSERT INTO Association VALUES ('at-association', 1, 1, 'a-521', '', 'tt-actorcontainer', 1, 't-moviesxmlsource', 1);

Modified: branches/eschnepel/install/examples/movies/db/dmdb-movies-sql.xml
===================================================================
--- branches/eschnepel/install/examples/movies/db/dmdb-movies-sql.xml	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/movies/db/dmdb-movies-sql.xml	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,33 +1,33 @@
-&lt;project name=&quot;Movies-db-sql&quot;&gt;
-	&lt;target name=&quot;dmdb-movies&quot;&gt;
-		&lt;echo file=&quot;tmp-dmdb.sql&quot;&gt;
-------------------
---- Datasource ---
-------------------
-
---- SQL Datasource ---
--- &quot;Movies&quot; datasource
-INSERT INTO Topic VALUES ('tt-datasource', 1, 1, 't-moviesdb', 'Movies (${movies.db.type}-DB)');
-INSERT INTO TopicProp VALUES ('t-moviesdb', 1, 'Name', 'Movies (${movies.db.type}-DB)');
-INSERT INTO TopicProp VALUES ('t-moviesdb', 1, 'URL', '${movies.db.url}');
-INSERT INTO TopicProp VALUES ('t-moviesdb', 1, 'Database Type', '${movies.db.type}');
-INSERT INTO TopicProp VALUES ('t-moviesdb', 1, 'Idle Elementtype', 'Movie');
-INSERT INTO TopicProp VALUES ('t-moviesdb', 1, 'Username', '${movies.db.user}');
-INSERT INTO TopicProp VALUES ('t-moviesdb', 1, 'Password', '${movies.db.password}');
--- Associate types with datasource
-INSERT INTO Association VALUES ('at-association', 1, 1, 'a-514', '', 'tt-movie', 1, 't-moviesdb', 1);
-INSERT INTO Association VALUES ('at-association', 1, 1, 'a-515', '', 'tt-moviecontainer', 1, 't-moviesdb', 1);
-INSERT INTO Association VALUES ('at-association', 1, 1, 'a-516', '', 'tt-actor', 1, 't-moviesdb', 1);
-INSERT INTO Association VALUES ('at-association', 1, 1, 'a-517', '', 'tt-actorcontainer', 1, 't-moviesdb', 1);
-		&lt;/echo&gt;
-		&lt;sql driver=&quot;${db.driver}&quot; url=&quot;${db.url}&quot; userid=&quot;${db.user}&quot; password=&quot;${db.password}&quot; classpathref=&quot;dblibs&quot; autocommit=&quot;${db.autocommit}&quot;&gt;
-			&lt;fileset dir=&quot;.&quot;&gt;
-				&lt;include name=&quot;tmp-dmdb.sql&quot; /&gt;
-			&lt;/fileset&gt;
-			&lt;fileset dir=&quot;${db-specific}&quot;&gt;
-				&lt;include name=&quot;${db.close-session}&quot; /&gt;
-			&lt;/fileset&gt;
-		&lt;/sql&gt;
-		&lt;delete file=&quot;tmp-dmdb.sql&quot;&gt;&lt;/delete&gt;
-	&lt;/target&gt;
-&lt;/project&gt;
+&lt;project name=&quot;Movies-db-sql&quot;&gt;
+	&lt;target name=&quot;dmdb-movies&quot;&gt;
+		&lt;echo file=&quot;tmp-dmdb.sql&quot;&gt;
+------------------
+--- Datasource ---
+------------------
+
+--- SQL Datasource ---
+-- &quot;Movies&quot; datasource
+INSERT INTO Topic VALUES ('tt-datasource', 1, 1, 't-moviesdb', 'Movies (${movies.db.type}-DB)');
+INSERT INTO TopicProp VALUES ('t-moviesdb', 1, 'Name', 'Movies (${movies.db.type}-DB)');
+INSERT INTO TopicProp VALUES ('t-moviesdb', 1, 'URL', '${movies.db.url}');
+INSERT INTO TopicProp VALUES ('t-moviesdb', 1, 'Database Type', '${movies.db.type}');
+INSERT INTO TopicProp VALUES ('t-moviesdb', 1, 'Idle Elementtype', 'Movie');
+INSERT INTO TopicProp VALUES ('t-moviesdb', 1, 'Username', '${movies.db.user}');
+INSERT INTO TopicProp VALUES ('t-moviesdb', 1, 'Password', '${movies.db.password}');
+-- Associate types with datasource
+INSERT INTO Association VALUES ('at-association', 1, 1, 'a-514', '', 'tt-movie', 1, 't-moviesdb', 1);
+INSERT INTO Association VALUES ('at-association', 1, 1, 'a-515', '', 'tt-moviecontainer', 1, 't-moviesdb', 1);
+INSERT INTO Association VALUES ('at-association', 1, 1, 'a-516', '', 'tt-actor', 1, 't-moviesdb', 1);
+INSERT INTO Association VALUES ('at-association', 1, 1, 'a-517', '', 'tt-actorcontainer', 1, 't-moviesdb', 1);
+		&lt;/echo&gt;
+		&lt;sql driver=&quot;${db.driver}&quot; url=&quot;${db.url}&quot; userid=&quot;${db.user}&quot; password=&quot;${db.password}&quot; classpathref=&quot;dblibs&quot; autocommit=&quot;${db.autocommit}&quot;&gt;
+			&lt;fileset dir=&quot;.&quot;&gt;
+				&lt;include name=&quot;tmp-dmdb.sql&quot; /&gt;
+			&lt;/fileset&gt;
+			&lt;fileset dir=&quot;${db-specific}&quot;&gt;
+				&lt;include name=&quot;${db.close-session}&quot; /&gt;
+			&lt;/fileset&gt;
+		&lt;/sql&gt;
+		&lt;delete file=&quot;tmp-dmdb.sql&quot;&gt;&lt;/delete&gt;
+	&lt;/target&gt;
+&lt;/project&gt;

Modified: branches/eschnepel/install/examples/movies/db/dmdb-movies-xml.sql
===================================================================
--- branches/eschnepel/install/examples/movies/db/dmdb-movies-xml.sql	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/movies/db/dmdb-movies-xml.sql	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,18 +1,18 @@
-------------------
---- Datasource ---
-------------------
-
-
-
---- XML Datasource ---
--- The &quot;Movies and Actors&quot; example map
-INSERT INTO Topic VALUES ('tt-project', 1, 1, 't-moviesxmlmap', 'Movies and Actors (XML-Source)');
--- &quot;Movies&quot; datasource
-INSERT INTO Topic VALUES ('tt-datasource', 1, 1, 't-moviesxmlsource', 'Movies (XML-File)');
-INSERT INTO TopicProp VALUES ('t-moviesxmlsource', 1, 'URL', 'xml:../../examples/Movies.xml');
-INSERT INTO TopicProp VALUES ('t-moviesxmlsource', 1, 'Entities', 'Movie Actor Association');
--- Associate types with datasource
-INSERT INTO Association VALUES ('at-association', 1, 1, 'a-518', '', 'tt-movie', 1, 't-moviesxmlsource', 1);
-INSERT INTO Association VALUES ('at-association', 1, 1, 'a-519', '', 'tt-moviecontainer', 1, 't-moviesxmlsource', 1);
-INSERT INTO Association VALUES ('at-association', 1, 1, 'a-520', '', 'tt-actor', 1, 't-moviesxmlsource', 1);
-INSERT INTO Association VALUES ('at-association', 1, 1, 'a-521', '', 'tt-actorcontainer', 1, 't-moviesxmlsource', 1);
+------------------
+--- Datasource ---
+------------------
+
+
+
+--- XML Datasource ---
+-- The &quot;Movies and Actors&quot; example map
+INSERT INTO Topic VALUES ('tt-project', 1, 1, 't-moviesxmlmap', 'Movies and Actors (XML-Source)');
+-- &quot;Movies&quot; datasource
+INSERT INTO Topic VALUES ('tt-datasource', 1, 1, 't-moviesxmlsource', 'Movies (XML-File)');
+INSERT INTO TopicProp VALUES ('t-moviesxmlsource', 1, 'URL', 'xml:../../examples/Movies.xml');
+INSERT INTO TopicProp VALUES ('t-moviesxmlsource', 1, 'Entities', 'Movie Actor Association');
+-- Associate types with datasource
+INSERT INTO Association VALUES ('at-association', 1, 1, 'a-518', '', 'tt-movie', 1, 't-moviesxmlsource', 1);
+INSERT INTO Association VALUES ('at-association', 1, 1, 'a-519', '', 'tt-moviecontainer', 1, 't-moviesxmlsource', 1);
+INSERT INTO Association VALUES ('at-association', 1, 1, 'a-520', '', 'tt-actor', 1, 't-moviesxmlsource', 1);
+INSERT INTO Association VALUES ('at-association', 1, 1, 'a-521', '', 'tt-actorcontainer', 1, 't-moviesxmlsource', 1);

Modified: branches/eschnepel/install/examples/movies/db/dmdb-movies.sql
===================================================================
--- branches/eschnepel/install/examples/movies/db/dmdb-movies.sql	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/movies/db/dmdb-movies.sql	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,140 +1,140 @@
---------------------------
---- &quot;Movies&quot; workspace ---
---------------------------
-
-
-
--- workspace
-INSERT INTO Topic VALUES ('tt-workspace', 1, 1, 't-examplesgroup', 'Movies');
-INSERT INTO TopicProp VALUES ('t-examplesgroup', 1, 'Name', 'Movies');
-INSERT INTO TopicProp VALUES ('t-examplesgroup', 1, 'Public', 'on');
-INSERT INTO TopicProp VALUES ('t-examplesgroup', 1, 'Default', 'off');
--- workspace topicmap
-INSERT INTO Topic VALUES ('tt-topicmap', 1, 1, 't-examplesgroupmap', 'Movies');
-INSERT INTO TopicProp VALUES ('t-examplesgroupmap', 1, 'Name', 'Movies');
-INSERT INTO Association VALUES ('at-aggregation', 1, 1, 'a-502', '', 't-examplesgroup', 1, 't-examplesgroupmap', 1);
--- chat
-INSERT INTO Topic VALUES ('tt-chatboard', 1, 1, 't-exampleschat', 'Movies Chats');
-INSERT INTO TopicProp VALUES ('t-exampleschat', 1, 'Name', 'Movies Chats');
-INSERT INTO ViewTopic VALUES ('t-examplesgroupmap', 1, 't-exampleschat', 1, 30, 100);
--- forum
-INSERT INTO Topic VALUES ('tt-messageboard', 1, 1, 't-moviesforum', 'Movies Forum');
-INSERT INTO TopicProp VALUES ('t-moviesforum', 1, 'Name', 'Movies Forum');
-INSERT INTO ViewTopic VALUES ('t-examplesgroupmap', 1, 't-moviesforum', 1, 120, 100);
--- assign types to workspace
-INSERT INTO Association VALUES ('at-uses', 1, 1, 'a-198', '', 't-examplesgroup', 1, 'tt-movie', 1);
-INSERT INTO Association VALUES ('at-uses', 1, 1, 'a-199', '', 't-examplesgroup', 1, 'tt-actor', 1);
-INSERT INTO AssociationProp VALUES ('a-198', 1, 'Access Permission', 'create');
-INSERT INTO AssociationProp VALUES ('a-199', 1, 'Access Permission', 'create');
-
-
-
--------------------
---- Topic Types ---
--------------------
-
-
-
---- &quot;Movie&quot; ---
-INSERT INTO Topic VALUES ('tt-topictype', 1, 1, 'tt-movie', 'Movie');
--- set properties
-INSERT INTO TopicProp VALUES ('tt-movie', 1, 'Name', 'Movie');
-INSERT INTO TopicProp VALUES ('tt-movie', 1, 'Plural Name', 'Movies');
-INSERT INTO TopicProp VALUES ('tt-movie', 1, 'Icon', 'movie.gif');
-INSERT INTO TopicProp VALUES ('tt-movie', 1, 'Unique Topic Names', 'on');
-INSERT INTO TopicProp VALUES ('tt-movie', 1, 'Custom Implementation', 'de.deepamehta.movies.topics.MovieTopic');
--- assign properties
--- INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-506', '', 'tt-movie', 1, 'pp-title', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-507', '', 'tt-movie', 1, 'pp-year', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-508', '', 'tt-movie', 1, 'pp-country', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-509', '', 'tt-movie', 1, 'pp-duration', 1);
-INSERT INTO AssociationProp VALUES ('a-507', 1, 'Ordinal Number', '120');
-INSERT INTO AssociationProp VALUES ('a-508', 1, 'Ordinal Number', '110');
-INSERT INTO AssociationProp VALUES ('a-509', 1, 'Ordinal Number', '130');
--- super type
-INSERT INTO Association VALUES ('at-derivation', 1, 1, 'a-506', '', 'tt-generic', 1, 'tt-movie', 1);
--- container type
-INSERT INTO Topic VALUES ('tt-topictype', 1, 1, 'tt-moviecontainer', 'Movie Search');
--- set properties of container type
-INSERT INTO TopicProp VALUES ('tt-moviecontainer', 1, 'Name', 'Movie Search');
-INSERT INTO TopicProp VALUES ('tt-moviecontainer', 1, 'Icon', 'moviecontainer.gif');
-INSERT INTO TopicProp VALUES ('tt-moviecontainer', 1, 'Custom Implementation', 'de.deepamehta.movies.topics.MovieContainerTopic');
--- assign properties to container type
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-510', '', 'tt-moviecontainer', 1, 'pp-title', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-511', '', 'tt-moviecontainer', 1, 'pp-year', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-512', '', 'tt-moviecontainer', 1, 'pp-country', 1);
-INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-513', '', 'tt-actorcontainer', 1, 'pp-name', 1);
--- derive container type
-INSERT INTO Association VALUES ('at-derivation', 1, 1, 'a-503', '', 'tt-elementcontainer', 1, 'tt-moviecontainer', 1);
--- assign type to container type
-INSERT INTO Association VALUES ('at-aggregation', 1, 1, 'a-518', '', 'tt-moviecontainer', 1, 'tt-movie', 1);
-
---- &quot;Actor&quot; ---
-INSERT INTO Topic VALUES ('tt-topictype', 1, 1, 'tt-actor', 'Actor');
--- set properties
-INSERT INTO TopicProp VALUES ('tt-actor', 1, 'Name', 'Actor');
-INSERT INTO TopicProp VALUES ('tt-actor', 1, 'Plural Name', 'Actors');
-INSERT INTO TopicProp VALUES ('tt-actor', 1, 'Icon', 'actor.gif');
-INSERT INTO TopicProp VALUES ('tt-actor', 1, 'Unique Topic Names', 'on');
-INSERT INTO TopicProp VALUES ('tt-actor', 1, 'Custom Implementation', 'de.deepamehta.movies.topics.ActorTopic');
--- super type
-INSERT INTO Association VALUES ('at-derivation', 1, 1, 'a-505', '', 'tt-person', 1, 'tt-actor', 1);
--- container type
-INSERT INTO Topic VALUES ('tt-topictype', 1, 1, 'tt-actorcontainer', 'Actor Search');
--- set properties of container type
-INSERT INTO TopicProp VALUES ('tt-actorcontainer', 1, 'Name', 'Actor Search');
-INSERT INTO TopicProp VALUES ('tt-actorcontainer', 1, 'Icon', 'actorcontainer.gif');
-INSERT INTO TopicProp VALUES ('tt-actorcontainer', 1, 'Custom Implementation', 'de.deepamehta.movies.topics.ActorContainerTopic');
--- derive container type
-INSERT INTO Association VALUES ('at-derivation', 1, 1, 'a-504', '', 'tt-elementcontainer', 1, 'tt-actorcontainer', 1);
--- assign type to container type
-INSERT INTO Association VALUES ('at-aggregation', 1, 1, 'a-519', '', 'tt-actorcontainer', 1, 'tt-actor', 1);
-
-
-
-------------------
---- Properties ---
-------------------
-
-
-
-INSERT INTO Topic VALUES ('tt-property', 1, 1, 'pp-title', 'Title');
-INSERT INTO TopicProp VALUES ('pp-title', 1, 'Name', 'Title');
-INSERT INTO TopicProp VALUES ('pp-title', 1, 'Visualization', 'Input Field');
-
-INSERT INTO Topic VALUES ('tt-property', 1, 1, 'pp-year', 'YearOfProduction');
-INSERT INTO TopicProp VALUES ('pp-year', 1, 'Name', 'YearOfProduction');
-INSERT INTO TopicProp VALUES ('pp-year', 1, 'Visualization', 'Input Field');
-
-INSERT INTO Topic VALUES ('tt-property', 1, 1, 'pp-country', 'Country');
-INSERT INTO TopicProp VALUES ('pp-country', 1, 'Name', 'Country');
-INSERT INTO TopicProp VALUES ('pp-country', 1, 'Visualization', 'Input Field');
-
-
-
-------------------
---- Datasource ---
-------------------
-
--- This will be done by another script
-
-
-
---------------------
---- Example View ---
---------------------
-
-
-
--- The &quot;Movies and Actors&quot; example map
-INSERT INTO Topic VALUES ('tt-topicmap', 1, 1, 't-moviesmap', 'Movies and Actors');
-INSERT INTO TopicProp VALUES ('t-moviesmap', 1, 'Name', 'Movies and Actors');
-INSERT INTO TopicProp VALUES ('t-moviesmap', 1, 'Description', 'This example demonstrates the integration of corporate datasources.\n\nThe &quot;Movies and Actors&quot; example uses a SQL-Datasource.');
--- &quot;Movies&quot; and &quot;Actors&quot; container
-INSERT INTO Topic VALUES ('tt-moviecontainer', 1, 1, 't-movies', 'Movies');
-INSERT INTO Topic VALUES ('tt-actorcontainer', 1, 1, 't-actors', 'Actors');
-
-INSERT INTO ViewTopic VALUES ('t-moviesmap', 1, 't-movies', 1, 150, 100);
-INSERT INTO ViewTopic VALUES ('t-moviesmap', 1, 't-actors', 1, 270, 120);
-
-INSERT INTO ViewTopic VALUES ('t-examplesgroupmap', 1, 't-moviesmap', 1, 100, 50);
+--------------------------
+--- &quot;Movies&quot; workspace ---
+--------------------------
+
+
+
+-- workspace
+INSERT INTO Topic VALUES ('tt-workspace', 1, 1, 't-examplesgroup', 'Movies');
+INSERT INTO TopicProp VALUES ('t-examplesgroup', 1, 'Name', 'Movies');
+INSERT INTO TopicProp VALUES ('t-examplesgroup', 1, 'Public', 'on');
+INSERT INTO TopicProp VALUES ('t-examplesgroup', 1, 'Default', 'off');
+-- workspace topicmap
+INSERT INTO Topic VALUES ('tt-topicmap', 1, 1, 't-examplesgroupmap', 'Movies');
+INSERT INTO TopicProp VALUES ('t-examplesgroupmap', 1, 'Name', 'Movies');
+INSERT INTO Association VALUES ('at-aggregation', 1, 1, 'a-502', '', 't-examplesgroup', 1, 't-examplesgroupmap', 1);
+-- chat
+INSERT INTO Topic VALUES ('tt-chatboard', 1, 1, 't-exampleschat', 'Movies Chats');
+INSERT INTO TopicProp VALUES ('t-exampleschat', 1, 'Name', 'Movies Chats');
+INSERT INTO ViewTopic VALUES ('t-examplesgroupmap', 1, 't-exampleschat', 1, 30, 100);
+-- forum
+INSERT INTO Topic VALUES ('tt-messageboard', 1, 1, 't-moviesforum', 'Movies Forum');
+INSERT INTO TopicProp VALUES ('t-moviesforum', 1, 'Name', 'Movies Forum');
+INSERT INTO ViewTopic VALUES ('t-examplesgroupmap', 1, 't-moviesforum', 1, 120, 100);
+-- assign types to workspace
+INSERT INTO Association VALUES ('at-uses', 1, 1, 'a-198', '', 't-examplesgroup', 1, 'tt-movie', 1);
+INSERT INTO Association VALUES ('at-uses', 1, 1, 'a-199', '', 't-examplesgroup', 1, 'tt-actor', 1);
+INSERT INTO AssociationProp VALUES ('a-198', 1, 'Access Permission', 'create');
+INSERT INTO AssociationProp VALUES ('a-199', 1, 'Access Permission', 'create');
+
+
+
+-------------------
+--- Topic Types ---
+-------------------
+
+
+
+--- &quot;Movie&quot; ---
+INSERT INTO Topic VALUES ('tt-topictype', 1, 1, 'tt-movie', 'Movie');
+-- set properties
+INSERT INTO TopicProp VALUES ('tt-movie', 1, 'Name', 'Movie');
+INSERT INTO TopicProp VALUES ('tt-movie', 1, 'Plural Name', 'Movies');
+INSERT INTO TopicProp VALUES ('tt-movie', 1, 'Icon', 'movie.gif');
+INSERT INTO TopicProp VALUES ('tt-movie', 1, 'Unique Topic Names', 'on');
+INSERT INTO TopicProp VALUES ('tt-movie', 1, 'Custom Implementation', 'de.deepamehta.movies.topics.MovieTopic');
+-- assign properties
+-- INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-506', '', 'tt-movie', 1, 'pp-title', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-507', '', 'tt-movie', 1, 'pp-year', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-508', '', 'tt-movie', 1, 'pp-country', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-509', '', 'tt-movie', 1, 'pp-duration', 1);
+INSERT INTO AssociationProp VALUES ('a-507', 1, 'Ordinal Number', '120');
+INSERT INTO AssociationProp VALUES ('a-508', 1, 'Ordinal Number', '110');
+INSERT INTO AssociationProp VALUES ('a-509', 1, 'Ordinal Number', '130');
+-- super type
+INSERT INTO Association VALUES ('at-derivation', 1, 1, 'a-506', '', 'tt-generic', 1, 'tt-movie', 1);
+-- container type
+INSERT INTO Topic VALUES ('tt-topictype', 1, 1, 'tt-moviecontainer', 'Movie Search');
+-- set properties of container type
+INSERT INTO TopicProp VALUES ('tt-moviecontainer', 1, 'Name', 'Movie Search');
+INSERT INTO TopicProp VALUES ('tt-moviecontainer', 1, 'Icon', 'moviecontainer.gif');
+INSERT INTO TopicProp VALUES ('tt-moviecontainer', 1, 'Custom Implementation', 'de.deepamehta.movies.topics.MovieContainerTopic');
+-- assign properties to container type
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-510', '', 'tt-moviecontainer', 1, 'pp-title', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-511', '', 'tt-moviecontainer', 1, 'pp-year', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-512', '', 'tt-moviecontainer', 1, 'pp-country', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-513', '', 'tt-actorcontainer', 1, 'pp-name', 1);
+-- derive container type
+INSERT INTO Association VALUES ('at-derivation', 1, 1, 'a-503', '', 'tt-elementcontainer', 1, 'tt-moviecontainer', 1);
+-- assign type to container type
+INSERT INTO Association VALUES ('at-aggregation', 1, 1, 'a-518', '', 'tt-moviecontainer', 1, 'tt-movie', 1);
+
+--- &quot;Actor&quot; ---
+INSERT INTO Topic VALUES ('tt-topictype', 1, 1, 'tt-actor', 'Actor');
+-- set properties
+INSERT INTO TopicProp VALUES ('tt-actor', 1, 'Name', 'Actor');
+INSERT INTO TopicProp VALUES ('tt-actor', 1, 'Plural Name', 'Actors');
+INSERT INTO TopicProp VALUES ('tt-actor', 1, 'Icon', 'actor.gif');
+INSERT INTO TopicProp VALUES ('tt-actor', 1, 'Unique Topic Names', 'on');
+INSERT INTO TopicProp VALUES ('tt-actor', 1, 'Custom Implementation', 'de.deepamehta.movies.topics.ActorTopic');
+-- super type
+INSERT INTO Association VALUES ('at-derivation', 1, 1, 'a-505', '', 'tt-person', 1, 'tt-actor', 1);
+-- container type
+INSERT INTO Topic VALUES ('tt-topictype', 1, 1, 'tt-actorcontainer', 'Actor Search');
+-- set properties of container type
+INSERT INTO TopicProp VALUES ('tt-actorcontainer', 1, 'Name', 'Actor Search');
+INSERT INTO TopicProp VALUES ('tt-actorcontainer', 1, 'Icon', 'actorcontainer.gif');
+INSERT INTO TopicProp VALUES ('tt-actorcontainer', 1, 'Custom Implementation', 'de.deepamehta.movies.topics.ActorContainerTopic');
+-- derive container type
+INSERT INTO Association VALUES ('at-derivation', 1, 1, 'a-504', '', 'tt-elementcontainer', 1, 'tt-actorcontainer', 1);
+-- assign type to container type
+INSERT INTO Association VALUES ('at-aggregation', 1, 1, 'a-519', '', 'tt-actorcontainer', 1, 'tt-actor', 1);
+
+
+
+------------------
+--- Properties ---
+------------------
+
+
+
+INSERT INTO Topic VALUES ('tt-property', 1, 1, 'pp-title', 'Title');
+INSERT INTO TopicProp VALUES ('pp-title', 1, 'Name', 'Title');
+INSERT INTO TopicProp VALUES ('pp-title', 1, 'Visualization', 'Input Field');
+
+INSERT INTO Topic VALUES ('tt-property', 1, 1, 'pp-year', 'YearOfProduction');
+INSERT INTO TopicProp VALUES ('pp-year', 1, 'Name', 'YearOfProduction');
+INSERT INTO TopicProp VALUES ('pp-year', 1, 'Visualization', 'Input Field');
+
+INSERT INTO Topic VALUES ('tt-property', 1, 1, 'pp-country', 'Country');
+INSERT INTO TopicProp VALUES ('pp-country', 1, 'Name', 'Country');
+INSERT INTO TopicProp VALUES ('pp-country', 1, 'Visualization', 'Input Field');
+
+
+
+------------------
+--- Datasource ---
+------------------
+
+-- This will be done by another script
+
+
+
+--------------------
+--- Example View ---
+--------------------
+
+
+
+-- The &quot;Movies and Actors&quot; example map
+INSERT INTO Topic VALUES ('tt-topicmap', 1, 1, 't-moviesmap', 'Movies and Actors');
+INSERT INTO TopicProp VALUES ('t-moviesmap', 1, 'Name', 'Movies and Actors');
+INSERT INTO TopicProp VALUES ('t-moviesmap', 1, 'Description', 'This example demonstrates the integration of corporate datasources.\n\nThe &quot;Movies and Actors&quot; example uses a SQL-Datasource.');
+-- &quot;Movies&quot; and &quot;Actors&quot; container
+INSERT INTO Topic VALUES ('tt-moviecontainer', 1, 1, 't-movies', 'Movies');
+INSERT INTO Topic VALUES ('tt-actorcontainer', 1, 1, 't-actors', 'Actors');
+
+INSERT INTO ViewTopic VALUES ('t-moviesmap', 1, 't-movies', 1, 150, 100);
+INSERT INTO ViewTopic VALUES ('t-moviesmap', 1, 't-actors', 1, 270, 120);
+
+INSERT INTO ViewTopic VALUES ('t-examplesgroupmap', 1, 't-moviesmap', 1, 100, 50);

Modified: branches/eschnepel/install/examples/movies/movies.xml
===================================================================
--- branches/eschnepel/install/examples/movies/movies.xml	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/movies/movies.xml	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,56 +1,56 @@
-&lt;FilmDB&gt;
-&lt;Film ID=&quot;1&quot;&gt;&lt;Titel&gt;Ed Wood&lt;/Titel&gt;&lt;Gattung&gt;Tragikkomoedie&lt;/Gattung&gt;&lt;Entstehungsland&gt;USA&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1994&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;2:06&lt;/Dauer&gt;&lt;/Film&gt;
-&lt;Film ID=&quot;2&quot;&gt;&lt;Titel&gt;Erbarmungslos&lt;/Titel&gt;&lt;Originaltitel&gt;Unforgiven&lt;/Originaltitel&gt;&lt;Gattung&gt;Western&lt;/Gattung&gt;&lt;Entstehungsland&gt;USA&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1992&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;2:00&lt;/Dauer&gt;&lt;/Film&gt;
-&lt;Film ID=&quot;3&quot;&gt;&lt;Titel&gt;Before Sunrise&lt;/Titel&gt;&lt;Gattung&gt;Liebesfilm&lt;/Gattung&gt;&lt;Entstehungsland&gt;USA/A&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1994&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;1:37&lt;/Dauer&gt;&lt;/Film&gt;
-&lt;Film ID=&quot;4&quot;&gt;&lt;Titel&gt;Killing Zoe&lt;/Titel&gt;&lt;Gattung&gt;Actionthriller&lt;/Gattung&gt;&lt;Entstehungsland&gt;USA&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1994&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;1:36&lt;/Dauer&gt;&lt;/Film&gt;
-&lt;Film ID=&quot;5&quot;&gt;&lt;Titel&gt;Rollerball&lt;/Titel&gt;&lt;Gattung&gt;Actionfilm&lt;/Gattung&gt;&lt;Entstehungsland&gt;USA&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1974&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;2:05&lt;/Dauer&gt;&lt;/Film&gt;
-&lt;Film ID=&quot;6&quot;&gt;&lt;Titel&gt;The Saint&lt;/Titel&gt;&lt;Gattung&gt;Actionthriller&lt;/Gattung&gt;&lt;Entstehungsland&gt;USA&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1997&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;1:56&lt;/Dauer&gt;&lt;/Film&gt;
-&lt;Film ID=&quot;7&quot;&gt;&lt;Titel&gt;Gilbert Grape&lt;/Titel&gt;&lt;Originaltitel&gt;What's Eating Gilbert Grape?&lt;/Originaltitel&gt;&lt;Gattung&gt;Familiendrama&lt;/Gattung&gt;&lt;Entstehungsland&gt;USA&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1993&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;1:57&lt;/Dauer&gt;&lt;/Film&gt;
-&lt;Film ID=&quot;8&quot;&gt;&lt;Titel&gt;12 Monkeys&lt;/Titel&gt;&lt;Entstehungsland&gt;USA&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1995&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;2:09&lt;/Dauer&gt;&lt;/Film&gt;
-&lt;Film ID=&quot;9&quot;&gt;&lt;Titel&gt;Mikey und Nicky&lt;/Titel&gt;&lt;Entstehungsland&gt;USA&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1976&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;1:53&lt;/Dauer&gt;&lt;/Film&gt;
-&lt;Film ID=&quot;10&quot;&gt;&lt;Titel&gt;Casino&lt;/Titel&gt;&lt;Entstehungsland&gt;USA&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1995&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;2:45&lt;/Dauer&gt;&lt;/Film&gt;
-&lt;Film ID=&quot;11&quot;&gt;&lt;Titel&gt;Delicatessen&lt;/Titel&gt;&lt;Entstehungsland&gt;F&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1990&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;1:39&lt;/Dauer&gt;&lt;/Film&gt;
-&lt;Film ID=&quot;12&quot;&gt;&lt;Titel&gt;Snake Eyes&lt;/Titel&gt;&lt;Entstehungsland&gt;USA&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1993&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;1:47&lt;/Dauer&gt;&lt;/Film&gt;
-&lt;Film ID=&quot;13&quot;&gt;&lt;Titel&gt;Dead Man Walking&lt;/Titel&gt;&lt;Entstehungsland&gt;USA&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1995&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;2:02&lt;/Dauer&gt;&lt;/Film&gt;
-&lt;Film ID=&quot;14&quot;&gt;&lt;Titel&gt;Smoke&lt;/Titel&gt;&lt;Entstehungsland&gt;USA&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1995&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;1:48&lt;/Dauer&gt;&lt;/Film&gt;
-&lt;Mitwirkender ID=&quot;1&quot;&gt;&lt;Name&gt;Johnny Depp&lt;/Name&gt;&lt;/Mitwirkender&gt;
-&lt;Mitwirkender ID=&quot;2&quot;&gt;&lt;Name&gt;Martin Landau&lt;/Name&gt;&lt;/Mitwirkender&gt;
-&lt;Mitwirkender ID=&quot;3&quot;&gt;&lt;Name&gt;Sarah Jessica Parker&lt;/Name&gt;&lt;/Mitwirkender&gt;
-&lt;Mitwirkender ID=&quot;4&quot;&gt;&lt;Name&gt;Clint Eastwood&lt;/Name&gt;&lt;/Mitwirkender&gt;
-&lt;Mitwirkender ID=&quot;5&quot;&gt;&lt;Name&gt;Gene Hackman&lt;/Name&gt;&lt;/Mitwirkender&gt;
-&lt;Mitwirkender ID=&quot;6&quot;&gt;&lt;Name&gt;Morgan Freeman&lt;/Name&gt;&lt;/Mitwirkender&gt;
-&lt;Mitwirkender ID=&quot;7&quot;&gt;&lt;Name&gt;Ethan Hawke&lt;/Name&gt;&lt;/Mitwirkender&gt;
-&lt;Mitwirkender ID=&quot;8&quot;&gt;&lt;Name&gt;Julie Delpy&lt;/Name&gt;&lt;/Mitwirkender&gt;
-&lt;Mitwirkender ID=&quot;9&quot;&gt;&lt;Name&gt;Andrea Eckert&lt;/Name&gt;&lt;/Mitwirkender&gt;
-&lt;Mitwirkender ID=&quot;10&quot;&gt;&lt;Name&gt;Eric Stoltz&lt;/Name&gt;&lt;/Mitwirkender&gt;
-&lt;Mitwirkender ID=&quot;11&quot;&gt;&lt;Name&gt;Jean-Hugues Anglade&lt;/Name&gt;&lt;/Mitwirkender&gt;
-&lt;Mitwirkender ID=&quot;12&quot;&gt;&lt;Name&gt;James Caan&lt;/Name&gt;&lt;/Mitwirkender&gt;
-&lt;Mitwirkender ID=&quot;13&quot;&gt;&lt;Name&gt;John Houseman&lt;/Name&gt;&lt;/Mitwirkender&gt;
-&lt;Mitwirkender ID=&quot;14&quot;&gt;&lt;Name&gt;John Beck&lt;/Name&gt;&lt;/Mitwirkender&gt;
-&lt;Mitwirkender ID=&quot;15&quot;&gt;&lt;Name&gt;Val Kilmer&lt;/Name&gt;&lt;/Mitwirkender&gt;
-&lt;Mitwirkender ID=&quot;16&quot;&gt;&lt;Name&gt;Elisabeth Shue&lt;/Name&gt;&lt;/Mitwirkender&gt;
-&lt;Mitwirkender ID=&quot;17&quot;&gt;&lt;Name&gt;Rade Serbedzija&lt;/Name&gt;&lt;/Mitwirkender&gt;
-&lt;Mitwirkender ID=&quot;18&quot;&gt;&lt;Name&gt;Juliette Lewis&lt;/Name&gt;&lt;/Mitwirkender&gt;
-&lt;Mitwirkender ID=&quot;19&quot;&gt;&lt;Name&gt;Leonardo DiCaprio&lt;/Name&gt;&lt;/Mitwirkender&gt;
-&lt;Mitwirkung ID=&quot;1&quot;&gt;&lt;FilmID&gt;1&lt;/FilmID&gt;&lt;MitwirkenderID&gt;1&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
-&lt;Mitwirkung ID=&quot;2&quot;&gt;&lt;FilmID&gt;1&lt;/FilmID&gt;&lt;MitwirkenderID&gt;2&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
-&lt;Mitwirkung ID=&quot;3&quot;&gt;&lt;FilmID&gt;1&lt;/FilmID&gt;&lt;MitwirkenderID&gt;3&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
-&lt;Mitwirkung ID=&quot;4&quot;&gt;&lt;FilmID&gt;2&lt;/FilmID&gt;&lt;MitwirkenderID&gt;4&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
-&lt;Mitwirkung ID=&quot;5&quot;&gt;&lt;FilmID&gt;2&lt;/FilmID&gt;&lt;MitwirkenderID&gt;5&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
-&lt;Mitwirkung ID=&quot;6&quot;&gt;&lt;FilmID&gt;2&lt;/FilmID&gt;&lt;MitwirkenderID&gt;6&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
-&lt;Mitwirkung ID=&quot;7&quot;&gt;&lt;FilmID&gt;3&lt;/FilmID&gt;&lt;MitwirkenderID&gt;7&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
-&lt;Mitwirkung ID=&quot;8&quot;&gt;&lt;FilmID&gt;3&lt;/FilmID&gt;&lt;MitwirkenderID&gt;8&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
-&lt;Mitwirkung ID=&quot;9&quot;&gt;&lt;FilmID&gt;3&lt;/FilmID&gt;&lt;MitwirkenderID&gt;9&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
-&lt;Mitwirkung ID=&quot;10&quot;&gt;&lt;FilmID&gt;4&lt;/FilmID&gt;&lt;MitwirkenderID&gt;10&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
-&lt;Mitwirkung ID=&quot;11&quot;&gt;&lt;FilmID&gt;4&lt;/FilmID&gt;&lt;MitwirkenderID&gt;8&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
-&lt;Mitwirkung ID=&quot;12&quot;&gt;&lt;FilmID&gt;4&lt;/FilmID&gt;&lt;MitwirkenderID&gt;11&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
-&lt;Mitwirkung ID=&quot;13&quot;&gt;&lt;FilmID&gt;5&lt;/FilmID&gt;&lt;MitwirkenderID&gt;12&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
-&lt;Mitwirkung ID=&quot;14&quot;&gt;&lt;FilmID&gt;5&lt;/FilmID&gt;&lt;MitwirkenderID&gt;13&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
-&lt;Mitwirkung ID=&quot;15&quot;&gt;&lt;FilmID&gt;5&lt;/FilmID&gt;&lt;MitwirkenderID&gt;14&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
-&lt;Mitwirkung ID=&quot;16&quot;&gt;&lt;FilmID&gt;6&lt;/FilmID&gt;&lt;MitwirkenderID&gt;15&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
-&lt;Mitwirkung ID=&quot;17&quot;&gt;&lt;FilmID&gt;6&lt;/FilmID&gt;&lt;MitwirkenderID&gt;16&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
-&lt;Mitwirkung ID=&quot;18&quot;&gt;&lt;FilmID&gt;6&lt;/FilmID&gt;&lt;MitwirkenderID&gt;17&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
-&lt;Mitwirkung ID=&quot;19&quot;&gt;&lt;FilmID&gt;7&lt;/FilmID&gt;&lt;MitwirkenderID&gt;1&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
-&lt;Mitwirkung ID=&quot;20&quot;&gt;&lt;FilmID&gt;7&lt;/FilmID&gt;&lt;MitwirkenderID&gt;18&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
-&lt;Mitwirkung ID=&quot;21&quot;&gt;&lt;FilmID&gt;7&lt;/FilmID&gt;&lt;MitwirkenderID&gt;19&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
-&lt;/FilmDB&gt;
+&lt;FilmDB&gt;
+&lt;Film ID=&quot;1&quot;&gt;&lt;Titel&gt;Ed Wood&lt;/Titel&gt;&lt;Gattung&gt;Tragikkomoedie&lt;/Gattung&gt;&lt;Entstehungsland&gt;USA&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1994&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;2:06&lt;/Dauer&gt;&lt;/Film&gt;
+&lt;Film ID=&quot;2&quot;&gt;&lt;Titel&gt;Erbarmungslos&lt;/Titel&gt;&lt;Originaltitel&gt;Unforgiven&lt;/Originaltitel&gt;&lt;Gattung&gt;Western&lt;/Gattung&gt;&lt;Entstehungsland&gt;USA&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1992&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;2:00&lt;/Dauer&gt;&lt;/Film&gt;
+&lt;Film ID=&quot;3&quot;&gt;&lt;Titel&gt;Before Sunrise&lt;/Titel&gt;&lt;Gattung&gt;Liebesfilm&lt;/Gattung&gt;&lt;Entstehungsland&gt;USA/A&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1994&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;1:37&lt;/Dauer&gt;&lt;/Film&gt;
+&lt;Film ID=&quot;4&quot;&gt;&lt;Titel&gt;Killing Zoe&lt;/Titel&gt;&lt;Gattung&gt;Actionthriller&lt;/Gattung&gt;&lt;Entstehungsland&gt;USA&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1994&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;1:36&lt;/Dauer&gt;&lt;/Film&gt;
+&lt;Film ID=&quot;5&quot;&gt;&lt;Titel&gt;Rollerball&lt;/Titel&gt;&lt;Gattung&gt;Actionfilm&lt;/Gattung&gt;&lt;Entstehungsland&gt;USA&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1974&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;2:05&lt;/Dauer&gt;&lt;/Film&gt;
+&lt;Film ID=&quot;6&quot;&gt;&lt;Titel&gt;The Saint&lt;/Titel&gt;&lt;Gattung&gt;Actionthriller&lt;/Gattung&gt;&lt;Entstehungsland&gt;USA&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1997&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;1:56&lt;/Dauer&gt;&lt;/Film&gt;
+&lt;Film ID=&quot;7&quot;&gt;&lt;Titel&gt;Gilbert Grape&lt;/Titel&gt;&lt;Originaltitel&gt;What's Eating Gilbert Grape?&lt;/Originaltitel&gt;&lt;Gattung&gt;Familiendrama&lt;/Gattung&gt;&lt;Entstehungsland&gt;USA&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1993&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;1:57&lt;/Dauer&gt;&lt;/Film&gt;
+&lt;Film ID=&quot;8&quot;&gt;&lt;Titel&gt;12 Monkeys&lt;/Titel&gt;&lt;Entstehungsland&gt;USA&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1995&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;2:09&lt;/Dauer&gt;&lt;/Film&gt;
+&lt;Film ID=&quot;9&quot;&gt;&lt;Titel&gt;Mikey und Nicky&lt;/Titel&gt;&lt;Entstehungsland&gt;USA&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1976&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;1:53&lt;/Dauer&gt;&lt;/Film&gt;
+&lt;Film ID=&quot;10&quot;&gt;&lt;Titel&gt;Casino&lt;/Titel&gt;&lt;Entstehungsland&gt;USA&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1995&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;2:45&lt;/Dauer&gt;&lt;/Film&gt;
+&lt;Film ID=&quot;11&quot;&gt;&lt;Titel&gt;Delicatessen&lt;/Titel&gt;&lt;Entstehungsland&gt;F&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1990&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;1:39&lt;/Dauer&gt;&lt;/Film&gt;
+&lt;Film ID=&quot;12&quot;&gt;&lt;Titel&gt;Snake Eyes&lt;/Titel&gt;&lt;Entstehungsland&gt;USA&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1993&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;1:47&lt;/Dauer&gt;&lt;/Film&gt;
+&lt;Film ID=&quot;13&quot;&gt;&lt;Titel&gt;Dead Man Walking&lt;/Titel&gt;&lt;Entstehungsland&gt;USA&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1995&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;2:02&lt;/Dauer&gt;&lt;/Film&gt;
+&lt;Film ID=&quot;14&quot;&gt;&lt;Titel&gt;Smoke&lt;/Titel&gt;&lt;Entstehungsland&gt;USA&lt;/Entstehungsland&gt;&lt;Entstehungsjahr&gt;1995&lt;/Entstehungsjahr&gt;&lt;Dauer&gt;1:48&lt;/Dauer&gt;&lt;/Film&gt;
+&lt;Mitwirkender ID=&quot;1&quot;&gt;&lt;Name&gt;Johnny Depp&lt;/Name&gt;&lt;/Mitwirkender&gt;
+&lt;Mitwirkender ID=&quot;2&quot;&gt;&lt;Name&gt;Martin Landau&lt;/Name&gt;&lt;/Mitwirkender&gt;
+&lt;Mitwirkender ID=&quot;3&quot;&gt;&lt;Name&gt;Sarah Jessica Parker&lt;/Name&gt;&lt;/Mitwirkender&gt;
+&lt;Mitwirkender ID=&quot;4&quot;&gt;&lt;Name&gt;Clint Eastwood&lt;/Name&gt;&lt;/Mitwirkender&gt;
+&lt;Mitwirkender ID=&quot;5&quot;&gt;&lt;Name&gt;Gene Hackman&lt;/Name&gt;&lt;/Mitwirkender&gt;
+&lt;Mitwirkender ID=&quot;6&quot;&gt;&lt;Name&gt;Morgan Freeman&lt;/Name&gt;&lt;/Mitwirkender&gt;
+&lt;Mitwirkender ID=&quot;7&quot;&gt;&lt;Name&gt;Ethan Hawke&lt;/Name&gt;&lt;/Mitwirkender&gt;
+&lt;Mitwirkender ID=&quot;8&quot;&gt;&lt;Name&gt;Julie Delpy&lt;/Name&gt;&lt;/Mitwirkender&gt;
+&lt;Mitwirkender ID=&quot;9&quot;&gt;&lt;Name&gt;Andrea Eckert&lt;/Name&gt;&lt;/Mitwirkender&gt;
+&lt;Mitwirkender ID=&quot;10&quot;&gt;&lt;Name&gt;Eric Stoltz&lt;/Name&gt;&lt;/Mitwirkender&gt;
+&lt;Mitwirkender ID=&quot;11&quot;&gt;&lt;Name&gt;Jean-Hugues Anglade&lt;/Name&gt;&lt;/Mitwirkender&gt;
+&lt;Mitwirkender ID=&quot;12&quot;&gt;&lt;Name&gt;James Caan&lt;/Name&gt;&lt;/Mitwirkender&gt;
+&lt;Mitwirkender ID=&quot;13&quot;&gt;&lt;Name&gt;John Houseman&lt;/Name&gt;&lt;/Mitwirkender&gt;
+&lt;Mitwirkender ID=&quot;14&quot;&gt;&lt;Name&gt;John Beck&lt;/Name&gt;&lt;/Mitwirkender&gt;
+&lt;Mitwirkender ID=&quot;15&quot;&gt;&lt;Name&gt;Val Kilmer&lt;/Name&gt;&lt;/Mitwirkender&gt;
+&lt;Mitwirkender ID=&quot;16&quot;&gt;&lt;Name&gt;Elisabeth Shue&lt;/Name&gt;&lt;/Mitwirkender&gt;
+&lt;Mitwirkender ID=&quot;17&quot;&gt;&lt;Name&gt;Rade Serbedzija&lt;/Name&gt;&lt;/Mitwirkender&gt;
+&lt;Mitwirkender ID=&quot;18&quot;&gt;&lt;Name&gt;Juliette Lewis&lt;/Name&gt;&lt;/Mitwirkender&gt;
+&lt;Mitwirkender ID=&quot;19&quot;&gt;&lt;Name&gt;Leonardo DiCaprio&lt;/Name&gt;&lt;/Mitwirkender&gt;
+&lt;Mitwirkung ID=&quot;1&quot;&gt;&lt;FilmID&gt;1&lt;/FilmID&gt;&lt;MitwirkenderID&gt;1&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
+&lt;Mitwirkung ID=&quot;2&quot;&gt;&lt;FilmID&gt;1&lt;/FilmID&gt;&lt;MitwirkenderID&gt;2&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
+&lt;Mitwirkung ID=&quot;3&quot;&gt;&lt;FilmID&gt;1&lt;/FilmID&gt;&lt;MitwirkenderID&gt;3&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
+&lt;Mitwirkung ID=&quot;4&quot;&gt;&lt;FilmID&gt;2&lt;/FilmID&gt;&lt;MitwirkenderID&gt;4&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
+&lt;Mitwirkung ID=&quot;5&quot;&gt;&lt;FilmID&gt;2&lt;/FilmID&gt;&lt;MitwirkenderID&gt;5&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
+&lt;Mitwirkung ID=&quot;6&quot;&gt;&lt;FilmID&gt;2&lt;/FilmID&gt;&lt;MitwirkenderID&gt;6&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
+&lt;Mitwirkung ID=&quot;7&quot;&gt;&lt;FilmID&gt;3&lt;/FilmID&gt;&lt;MitwirkenderID&gt;7&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
+&lt;Mitwirkung ID=&quot;8&quot;&gt;&lt;FilmID&gt;3&lt;/FilmID&gt;&lt;MitwirkenderID&gt;8&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
+&lt;Mitwirkung ID=&quot;9&quot;&gt;&lt;FilmID&gt;3&lt;/FilmID&gt;&lt;MitwirkenderID&gt;9&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
+&lt;Mitwirkung ID=&quot;10&quot;&gt;&lt;FilmID&gt;4&lt;/FilmID&gt;&lt;MitwirkenderID&gt;10&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
+&lt;Mitwirkung ID=&quot;11&quot;&gt;&lt;FilmID&gt;4&lt;/FilmID&gt;&lt;MitwirkenderID&gt;8&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
+&lt;Mitwirkung ID=&quot;12&quot;&gt;&lt;FilmID&gt;4&lt;/FilmID&gt;&lt;MitwirkenderID&gt;11&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
+&lt;Mitwirkung ID=&quot;13&quot;&gt;&lt;FilmID&gt;5&lt;/FilmID&gt;&lt;MitwirkenderID&gt;12&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
+&lt;Mitwirkung ID=&quot;14&quot;&gt;&lt;FilmID&gt;5&lt;/FilmID&gt;&lt;MitwirkenderID&gt;13&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
+&lt;Mitwirkung ID=&quot;15&quot;&gt;&lt;FilmID&gt;5&lt;/FilmID&gt;&lt;MitwirkenderID&gt;14&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
+&lt;Mitwirkung ID=&quot;16&quot;&gt;&lt;FilmID&gt;6&lt;/FilmID&gt;&lt;MitwirkenderID&gt;15&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
+&lt;Mitwirkung ID=&quot;17&quot;&gt;&lt;FilmID&gt;6&lt;/FilmID&gt;&lt;MitwirkenderID&gt;16&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
+&lt;Mitwirkung ID=&quot;18&quot;&gt;&lt;FilmID&gt;6&lt;/FilmID&gt;&lt;MitwirkenderID&gt;17&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
+&lt;Mitwirkung ID=&quot;19&quot;&gt;&lt;FilmID&gt;7&lt;/FilmID&gt;&lt;MitwirkenderID&gt;1&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
+&lt;Mitwirkung ID=&quot;20&quot;&gt;&lt;FilmID&gt;7&lt;/FilmID&gt;&lt;MitwirkenderID&gt;18&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
+&lt;Mitwirkung ID=&quot;21&quot;&gt;&lt;FilmID&gt;7&lt;/FilmID&gt;&lt;MitwirkenderID&gt;19&lt;/MitwirkenderID&gt;&lt;/Mitwirkung&gt;
+&lt;/FilmDB&gt;

Modified: branches/eschnepel/install/examples/movies/src/de/deepamehta/movies/topics/ActorContainerTopic.java
===================================================================
--- branches/eschnepel/install/examples/movies/src/de/deepamehta/movies/topics/ActorContainerTopic.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/movies/src/de/deepamehta/movies/topics/ActorContainerTopic.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,78 +1,78 @@
-package de.deepamehta.movies.topics;
-
-import de.deepamehta.BaseTopic;
-import de.deepamehta.service.ApplicationService;
-import de.deepamehta.topics.ElementContainerTopic;
-
-
-
-/**
- * Part of the &quot;Movies&quot; example.
- * &lt;P&gt;
- * &lt;HR&gt;
- * Last functional change: 16.3.2004 (2.0b3-pre1)&lt;BR&gt;
- * Last documentation update: 8.11.2000 (2.0a7-pre2)&lt;BR&gt;
- * J&ouml;rg Richter&lt;BR&gt;
- * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>
- */
-public class ActorContainerTopic extends ElementContainerTopic {
-
-
-
-	// *******************
-	// *** Constructor ***
-	// *******************
-
-
-
-	public ActorContainerTopic(BaseTopic topic, ApplicationService as) {
-		super(topic, as);
-	}
-
-
-
-	// **********************
-	// *** Defining Hooks ***
-	// **********************
-
-
-
-	// ---------------------------
-	// --- Handling Properties ---
-	// ---------------------------
-
-
-
-	// overridden because &quot;Actor Container&quot; has its own &quot;Name&quot; property (the search field)
-	public String getNameProperty() {
-		return null;	// ### container name doesn'r rely on any property
-	}
-
-
-
-	// *********************************************************
-	// *** Implementation of abstract ContainerTopic methods ***
-	// *********************************************************
-
-
-
-	protected String getContentType() {
-		return &quot;Actor&quot;;
-	}
-
-	protected String getContentTypeID() {
-		return &quot;tt-actor&quot;;
-	}
-
-
-
-	// ***************************************************************
-	// *** Implementation of abstract ElementContainerTopic method ***
-	// ***************************************************************
-
-
-
-	public String getNameAttribute() {
-		return &quot;Name&quot;;
-	}
-}
+package de.deepamehta.movies.topics;
+
+import de.deepamehta.BaseTopic;
+import de.deepamehta.service.ApplicationService;
+import de.deepamehta.topics.ElementContainerTopic;
+
+
+
+/**
+ * Part of the &quot;Movies&quot; example.
+ * &lt;P&gt;
+ * &lt;HR&gt;
+ * Last functional change: 16.3.2004 (2.0b3-pre1)&lt;BR&gt;
+ * Last documentation update: 8.11.2000 (2.0a7-pre2)&lt;BR&gt;
+ * J&ouml;rg Richter&lt;BR&gt;
+ * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>
+ */
+public class ActorContainerTopic extends ElementContainerTopic {
+
+
+
+	// *******************
+	// *** Constructor ***
+	// *******************
+
+
+
+	public ActorContainerTopic(BaseTopic topic, ApplicationService as) {
+		super(topic, as);
+	}
+
+
+
+	// **********************
+	// *** Defining Hooks ***
+	// **********************
+
+
+
+	// ---------------------------
+	// --- Handling Properties ---
+	// ---------------------------
+
+
+
+	// overridden because &quot;Actor Container&quot; has its own &quot;Name&quot; property (the search field)
+	public String getNameProperty() {
+		return null;	// ### container name doesn'r rely on any property
+	}
+
+
+
+	// *********************************************************
+	// *** Implementation of abstract ContainerTopic methods ***
+	// *********************************************************
+
+
+
+	protected String getContentType() {
+		return &quot;Actor&quot;;
+	}
+
+	protected String getContentTypeID() {
+		return &quot;tt-actor&quot;;
+	}
+
+
+
+	// ***************************************************************
+	// *** Implementation of abstract ElementContainerTopic method ***
+	// ***************************************************************
+
+
+
+	public String getNameAttribute() {
+		return &quot;Name&quot;;
+	}
+}

Modified: branches/eschnepel/install/examples/movies/src/de/deepamehta/movies/topics/ActorTopic.java
===================================================================
--- branches/eschnepel/install/examples/movies/src/de/deepamehta/movies/topics/ActorTopic.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/movies/src/de/deepamehta/movies/topics/ActorTopic.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,82 +1,82 @@
-package de.deepamehta.movies.topics;
-
-import de.deepamehta.BaseTopic;
-import de.deepamehta.TopicInitException;
-import de.deepamehta.service.ApplicationService;
-import de.deepamehta.service.CorporateDirectives;
-import de.deepamehta.service.Session;
-import de.deepamehta.topics.DataConsumerTopic;
-import de.deepamehta.topics.TypeTopic;
-
-import java.util.Vector;
-
-
-
-/**
- * Part of the &quot;Movies&quot; example.
- * &lt;P&gt;
- * ### Note: not derived from PersonTopic however in corporate memory this derivation does exist.
- * ### Consequence: An actor doesn't have the customized topic behavoir of a person especially the
- * ### naming behavoir
- * &lt;P&gt;
- * &lt;HR&gt;
- * Last functional change: 16.3.2004 (2.0b3-pre1)&lt;BR&gt;
- * Last documentation update: 8.11.2000 (2.0a7-pre2)&lt;BR&gt;
- * J&ouml;rg Richter&lt;BR&gt;
- * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>
- */
-public class ActorTopic extends DataConsumerTopic {
-
-
-
-	// *******************
-	// *** Constructor ***
-	// *******************
-
-
-
-	public ActorTopic(BaseTopic topic, ApplicationService as) {
-		super(topic, as);
-	}
-
-
-
-	// **********************
-	// *** Defining Hooks ***
-	// **********************
-
-
-
-	// ------------------
-	// --- Life Cycle ---
-	// ------------------
-
-
-
-	public CorporateDirectives init(int initLevel, Session session) throws TopicInitException {
-		CorporateDirectives directives = super.init(initLevel, session);
-		//
-		if (initLevel == INITLEVEL_1) {
-			if (LOG_TOPIC_INIT) {
-				System.out.println(&quot;&gt;&gt;&gt; ActorTopic.init(&quot; + initLevel + &quot;): &quot; + this + &quot; -- register relation&quot;);
-			}
-			registerRelationN(&quot;Actor&quot;, &quot;at-association&quot;, &quot;Mitwirkung&quot;, &quot;ActorID&quot;, &quot;MovieID&quot;, &quot;tt-movie&quot;, &quot;Movie&quot;, &quot;Title&quot;);
-		}
-		//
-		return directives;
-	}
-
-
-
-	// ---------------------------
-	// --- Handling Properties ---
-	// ---------------------------
-
-
-
-	public static Vector hiddenProperties(TypeTopic type) {
-		Vector props = new Vector();
-		props.addElement(PROPERTY_FIRST_NAME);
-		return props;
-	}
-}
+package de.deepamehta.movies.topics;
+
+import de.deepamehta.BaseTopic;
+import de.deepamehta.TopicInitException;
+import de.deepamehta.service.ApplicationService;
+import de.deepamehta.service.CorporateDirectives;
+import de.deepamehta.service.Session;
+import de.deepamehta.topics.DataConsumerTopic;
+import de.deepamehta.topics.TypeTopic;
+
+import java.util.Vector;
+
+
+
+/**
+ * Part of the &quot;Movies&quot; example.
+ * &lt;P&gt;
+ * ### Note: not derived from PersonTopic however in corporate memory this derivation does exist.
+ * ### Consequence: An actor doesn't have the customized topic behavoir of a person especially the
+ * ### naming behavoir
+ * &lt;P&gt;
+ * &lt;HR&gt;
+ * Last functional change: 16.3.2004 (2.0b3-pre1)&lt;BR&gt;
+ * Last documentation update: 8.11.2000 (2.0a7-pre2)&lt;BR&gt;
+ * J&ouml;rg Richter&lt;BR&gt;
+ * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>
+ */
+public class ActorTopic extends DataConsumerTopic {
+
+
+
+	// *******************
+	// *** Constructor ***
+	// *******************
+
+
+
+	public ActorTopic(BaseTopic topic, ApplicationService as) {
+		super(topic, as);
+	}
+
+
+
+	// **********************
+	// *** Defining Hooks ***
+	// **********************
+
+
+
+	// ------------------
+	// --- Life Cycle ---
+	// ------------------
+
+
+
+	public CorporateDirectives init(int initLevel, Session session) throws TopicInitException {
+		CorporateDirectives directives = super.init(initLevel, session);
+		//
+		if (initLevel == INITLEVEL_1) {
+			if (LOG_TOPIC_INIT) {
+				System.out.println(&quot;&gt;&gt;&gt; ActorTopic.init(&quot; + initLevel + &quot;): &quot; + this + &quot; -- register relation&quot;);
+			}
+			registerRelationN(&quot;Actor&quot;, &quot;at-association&quot;, &quot;Mitwirkung&quot;, &quot;ActorID&quot;, &quot;MovieID&quot;, &quot;tt-movie&quot;, &quot;Movie&quot;, &quot;Title&quot;);
+		}
+		//
+		return directives;
+	}
+
+
+
+	// ---------------------------
+	// --- Handling Properties ---
+	// ---------------------------
+
+
+
+	public static Vector hiddenProperties(TypeTopic type) {
+		Vector props = new Vector();
+		props.addElement(PROPERTY_FIRST_NAME);
+		return props;
+	}
+}

Modified: branches/eschnepel/install/examples/movies/src/de/deepamehta/movies/topics/MovieContainerTopic.java
===================================================================
--- branches/eschnepel/install/examples/movies/src/de/deepamehta/movies/topics/MovieContainerTopic.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/movies/src/de/deepamehta/movies/topics/MovieContainerTopic.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,76 +1,76 @@
-package de.deepamehta.movies.topics;
-
-import de.deepamehta.BaseTopic;
-import de.deepamehta.service.ApplicationService;
-import de.deepamehta.topics.ElementContainerTopic;
-
-
-
-/**
- * Part of the &quot;Movies&quot; example.
- * &lt;P&gt;
- * &lt;HR&gt;
- * Last functional change: 16.3.2004 (2.0b3-pre1)&lt;BR&gt;
- * Last documentation update: 8.11.2000 (2.0a7-pre2)&lt;BR&gt;
- * J&ouml;rg Richter&lt;BR&gt;
- * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>
- */
-public class MovieContainerTopic extends ElementContainerTopic {
-
-
-
-	String[] groupingProperties = {&quot;Year&quot;, &quot;Country&quot;, &quot;Genre&quot;};
-
-
-
-	// *******************
-	// *** Constructor ***
-	// *******************
-
-
-
-	public MovieContainerTopic(BaseTopic topic, ApplicationService as) {
-		super(topic, as);
-	}
-
-
-
-	// *******************************************************
-	// *** Implementing abstract methods of ContainerTopic ***
-	// *******************************************************
-
-
-
-	protected String getContentType() {
-		return &quot;Movie&quot;;
-	}
-
-	protected String getContentTypeID() {
-		return &quot;tt-movie&quot;;
-	}
-
-
-
-	// **************************************************************
-	// *** Implementing abstract methods of ElementContainerTopic ***
-	// **************************************************************
-
-
-
-	public String getNameAttribute() {
-		return &quot;Title&quot;;
-	}
-
-
-
-	// ***************
-	// *** Methods ***
-	// ***************
-
-
-
-	// overrides ContainerTopic
-	protected String[] getGroupingProperties() {
-		return groupingProperties;
-	}
-}
+package de.deepamehta.movies.topics;
+
+import de.deepamehta.BaseTopic;
+import de.deepamehta.service.ApplicationService;
+import de.deepamehta.topics.ElementContainerTopic;
+
+
+
+/**
+ * Part of the &quot;Movies&quot; example.
+ * &lt;P&gt;
+ * &lt;HR&gt;
+ * Last functional change: 16.3.2004 (2.0b3-pre1)&lt;BR&gt;
+ * Last documentation update: 8.11.2000 (2.0a7-pre2)&lt;BR&gt;
+ * J&ouml;rg Richter&lt;BR&gt;
+ * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>
+ */
+public class MovieContainerTopic extends ElementContainerTopic {
+
+
+
+	String[] groupingProperties = {&quot;Year&quot;, &quot;Country&quot;, &quot;Genre&quot;};
+
+
+
+	// *******************
+	// *** Constructor ***
+	// *******************
+
+
+
+	public MovieContainerTopic(BaseTopic topic, ApplicationService as) {
+		super(topic, as);
+	}
+
+
+
+	// *******************************************************
+	// *** Implementing abstract methods of ContainerTopic ***
+	// *******************************************************
+
+
+
+	protected String getContentType() {
+		return &quot;Movie&quot;;
+	}
+
+	protected String getContentTypeID() {
+		return &quot;tt-movie&quot;;
+	}
+
+
+
+	// **************************************************************
+	// *** Implementing abstract methods of ElementContainerTopic ***
+	// **************************************************************
+
+
+
+	public String getNameAttribute() {
+		return &quot;Title&quot;;
+	}
+
+
+
+	// ***************
+	// *** Methods ***
+	// ***************
+
+
+
+	// overrides ContainerTopic
+	protected String[] getGroupingProperties() {
+		return groupingProperties;
+	}
+}

Modified: branches/eschnepel/install/examples/movies/src/de/deepamehta/movies/topics/MovieTopic.java
===================================================================
--- branches/eschnepel/install/examples/movies/src/de/deepamehta/movies/topics/MovieTopic.java	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/install/examples/movies/src/de/deepamehta/movies/topics/MovieTopic.java	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,95 +1,95 @@
-package de.deepamehta.movies.topics;
-
-import de.deepamehta.BaseTopic;
-import de.deepamehta.PropertyDefinition;
-import de.deepamehta.TopicInitException;
-import de.deepamehta.service.ApplicationService;
-import de.deepamehta.service.CorporateDirectives;
-import de.deepamehta.service.Session;
-import de.deepamehta.topics.DataConsumerTopic;
-
-import java.util.Hashtable;
-
-
-
-/**
- * Part of the &quot;Movies&quot; example.
- * &lt;P&gt;
- * &lt;HR&gt;
- * Last functional change: 16.3.2004 (2.0b3-pre1)&lt;BR&gt;
- * Last documentation update: 8.11.2000 (2.0a7-pre2)&lt;BR&gt;
- * J&ouml;rg Richter&lt;BR&gt;
- * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>
- */
-public class MovieTopic extends DataConsumerTopic {
-
-
-
-	// *******************
-	// *** Constructor ***
-	// *******************
-
-
-
-	public MovieTopic(BaseTopic topic, ApplicationService as) {
-		super(topic, as);
-	}
-
-
-
-	// **********************
-	// *** Defining Hooks ***
-	// **********************
-
-
-
-	// ------------------
-	// --- Life Cycle ---
-	// ------------------
-
-
-
-	public CorporateDirectives init(int initLevel, Session session) throws TopicInitException {
-		CorporateDirectives directives = super.init(initLevel, session);
-		//
-		if (initLevel == INITLEVEL_1) {
-			if (LOG_TOPIC_INIT) {
-				System.out.println(&quot;&gt;&gt;&gt; MovieTopic.init(&quot; + initLevel + &quot;): &quot; + this + &quot; -- registers relation&quot;);
-			}
-			registerRelationN(&quot;Movie&quot;, &quot;at-association&quot;, &quot;Mitwirkung&quot;, &quot;MovieID&quot;, &quot;ActorID&quot;, &quot;tt-actor&quot;, &quot;Actor&quot;, &quot;Name&quot;);
-		}
-		//
-		return directives;
-	}
-
-
-
-
-	// ---------------------------
-	// --- Handling Properties ---
-	// ---------------------------
-
-
-
-	public static Hashtable makeProperties(Hashtable elementData) {
-		// transfer &quot;Title&quot; -&gt; &quot;Name&quot;
-		String title = (String) elementData.get(&quot;Title&quot;);
-		if (title != null) {
-			elementData.remove(&quot;Title&quot;);
-			elementData.put(PROPERTY_NAME, title);
-		}
-		//
-		return elementData;
-	}
-
-	public static void propertyLabel(PropertyDefinition propDef, ApplicationService as, Session session) {
-		String propName = propDef.getPropertyName();
-		if (propName.equals(PROPERTY_NAME)) {
-			propDef.setPropertyLabel(&quot;Title&quot;);
-		}
-	}
-
-	/* ### public String getNameProperty() {
-		return &quot;Title&quot;;
-	} */
-}
+package de.deepamehta.movies.topics;
+
+import de.deepamehta.BaseTopic;
+import de.deepamehta.PropertyDefinition;
+import de.deepamehta.TopicInitException;
+import de.deepamehta.service.ApplicationService;
+import de.deepamehta.service.CorporateDirectives;
+import de.deepamehta.service.Session;
+import de.deepamehta.topics.DataConsumerTopic;
+
+import java.util.Hashtable;
+
+
+
+/**
+ * Part of the &quot;Movies&quot; example.
+ * &lt;P&gt;
+ * &lt;HR&gt;
+ * Last functional change: 16.3.2004 (2.0b3-pre1)&lt;BR&gt;
+ * Last documentation update: 8.11.2000 (2.0a7-pre2)&lt;BR&gt;
+ * J&ouml;rg Richter&lt;BR&gt;
+ * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at freenet.de</A>
+ */
+public class MovieTopic extends DataConsumerTopic {
+
+
+
+	// *******************
+	// *** Constructor ***
+	// *******************
+
+
+
+	public MovieTopic(BaseTopic topic, ApplicationService as) {
+		super(topic, as);
+	}
+
+
+
+	// **********************
+	// *** Defining Hooks ***
+	// **********************
+
+
+
+	// ------------------
+	// --- Life Cycle ---
+	// ------------------
+
+
+
+	public CorporateDirectives init(int initLevel, Session session) throws TopicInitException {
+		CorporateDirectives directives = super.init(initLevel, session);
+		//
+		if (initLevel == INITLEVEL_1) {
+			if (LOG_TOPIC_INIT) {
+				System.out.println(&quot;&gt;&gt;&gt; MovieTopic.init(&quot; + initLevel + &quot;): &quot; + this + &quot; -- registers relation&quot;);
+			}
+			registerRelationN(&quot;Movie&quot;, &quot;at-association&quot;, &quot;Mitwirkung&quot;, &quot;MovieID&quot;, &quot;ActorID&quot;, &quot;tt-actor&quot;, &quot;Actor&quot;, &quot;Name&quot;);
+		}
+		//
+		return directives;
+	}
+
+
+
+
+	// ---------------------------
+	// --- Handling Properties ---
+	// ---------------------------
+
+
+
+	public static Hashtable makeProperties(Hashtable elementData) {
+		// transfer &quot;Title&quot; -&gt; &quot;Name&quot;
+		String title = (String) elementData.get(&quot;Title&quot;);
+		if (title != null) {
+			elementData.remove(&quot;Title&quot;);
+			elementData.put(PROPERTY_NAME, title);
+		}
+		//
+		return elementData;
+	}
+
+	public static void propertyLabel(PropertyDefinition propDef, ApplicationService as, Session session) {
+		String propName = propDef.getPropertyName();
+		if (propName.equals(PROPERTY_NAME)) {
+			propDef.setPropertyLabel(&quot;Title&quot;);
+		}
+	}
+
+	/* ### public String getNameProperty() {
+		return &quot;Title&quot;;
+	} */
+}

Modified: branches/eschnepel/run.bat
===================================================================
--- branches/eschnepel/run.bat	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/run.bat	2007-10-03 17:45:23 UTC (rev 230)
@@ -1,17 +1,17 @@
<A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">- at echo</A> off
-if &quot;%ANT_HOME%&quot;==&quot;&quot; goto setDefaultAntHome
-
-:stripAntHome
-if not _%ANT_HOME:~-1%==_\ goto testAntHome
-set ANT_HOME=%ANT_HOME:~0,-1%
-goto stripAntHome
-
-:testAntHome
-if exist %ANT_HOME%/bin/ant.bat goto callAnt
-
-:setDefaultAntHome
-rem %~dp0 is expanded pathname of the current script under NT
-set ANT_HOME=%~dp0ant
-
-:callAnt
-call %ANT_HOME%/bin/ant.bat %%
<A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">+ at echo</A> off
+if &quot;%ANT_HOME%&quot;==&quot;&quot; goto setDefaultAntHome
+
+:stripAntHome
+if not _%ANT_HOME:~-1%==_\ goto testAntHome
+set ANT_HOME=%ANT_HOME:~0,-1%
+goto stripAntHome
+
+:testAntHome
+if exist %ANT_HOME%/bin/ant.bat goto callAnt
+
+:setDefaultAntHome
+rem %~dp0 is expanded pathname of the current script under NT
+set ANT_HOME=%~dp0ant
+
+:callAnt
+call %ANT_HOME%/bin/ant.bat %%

Modified: branches/eschnepel/run.sh
===================================================================
--- branches/eschnepel/run.sh	2007-10-03 13:42:34 UTC (rev 229)
+++ branches/eschnepel/run.sh	2007-10-03 17:45:23 UTC (rev 230)
@@ -31,4 +31,6 @@
 export ANT_HOME=&quot;$(pwd)/ant&quot;
 #fi
 
+cd ${current}
+
 ${ANT_HOME}/bin/ant $*


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000074.html">[deepamehta-svn] r229 - in branches/eschnepel:	develop/src/de/deepamehta develop/src/de/deepamehta/assocs	develop/src/de/deepamehta/service	develop/src/de/deepamehta/service/web	develop/src/de/deepamehta/topics	develop/src/de/deepamehta/util install/client/stylesheets	install/db/patches
</A></li>
	<LI>Next message: <A HREF="000076.html">[deepamehta-svn] r231 - in trunk: .	develop/src/de/deepamehta/service/web	develop/src/de/deepamehta/topics install/config
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#75">[ date ]</a>
              <a href="thread.html#75">[ thread ]</a>
              <a href="subject.html#75">[ subject ]</a>
              <a href="author.html#75">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">More information about the deepamehta-svn
mailing list</a><br>
</body></html>
