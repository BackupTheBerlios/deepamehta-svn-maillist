<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [deepamehta-svn] r371 - in branches/apps: .	develop/src/de/deepamehta develop/src/de/deepamehta/client	develop/src/de/deepamehta/service	develop/src/de/deepamehta/service/web	develop/src/de/deepamehta/topics install install/client/icons	install/db install/db/patches libs libs/ext
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/deepamehta-svn/2009-September/index.html" >
   <LINK REL="made" HREF="mailto:deepamehta-svn%40lists.berlios.de?Subject=Re%3A%20%5Bdeepamehta-svn%5D%20r371%20-%20in%20branches/apps%3A%20.%0A%09develop/src/de/deepamehta%20develop/src/de/deepamehta/client%0A%09develop/src/de/deepamehta/service%0A%09develop/src/de/deepamehta/service/web%0A%09develop/src/de/deepamehta/topics%20install%20install/client/icons%0A%09install/db%20install/db/patches%20libs%20libs/ext&In-Reply-To=%3C200909120843.n8C8htno013047%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="000216.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[deepamehta-svn] r371 - in branches/apps: .	develop/src/de/deepamehta develop/src/de/deepamehta/client	develop/src/de/deepamehta/service	develop/src/de/deepamehta/service/web	develop/src/de/deepamehta/topics install install/client/icons	install/db install/db/patches libs libs/ext</H1>
    <B>maltito at mail.berlios.de</B> 
    <A HREF="mailto:deepamehta-svn%40lists.berlios.de?Subject=Re%3A%20%5Bdeepamehta-svn%5D%20r371%20-%20in%20branches/apps%3A%20.%0A%09develop/src/de/deepamehta%20develop/src/de/deepamehta/client%0A%09develop/src/de/deepamehta/service%0A%09develop/src/de/deepamehta/service/web%0A%09develop/src/de/deepamehta/topics%20install%20install/client/icons%0A%09install/db%20install/db/patches%20libs%20libs/ext&In-Reply-To=%3C200909120843.n8C8htno013047%40sheep.berlios.de%3E"
       TITLE="[deepamehta-svn] r371 - in branches/apps: .	develop/src/de/deepamehta develop/src/de/deepamehta/client	develop/src/de/deepamehta/service	develop/src/de/deepamehta/service/web	develop/src/de/deepamehta/topics install install/client/icons	install/db install/db/patches libs libs/ext">maltito at mail.berlios.de
       </A><BR>
    <I>Sat Sep 12 10:43:55 CEST 2009</I>
    <P><UL>
        
        <LI>Next message: <A HREF="000216.html">[deepamehta-svn] r372 - in branches/apps/develop/src/de/deepamehta:	client topics
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#215">[ date ]</a>
              <a href="thread.html#215">[ thread ]</a>
              <a href="subject.html#215">[ subject ]</a>
              <a href="author.html#215">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: maltito
Date: 2009-09-12 10:41:53 +0200 (Sat, 12 Sep 2009)
New Revision: 371

Added:
   branches/apps/develop/src/de/deepamehta/client/BrowserNavigationListener.java
   branches/apps/install/apps/
   branches/apps/install/client/icons/applications-internet.png
   branches/apps/install/client/icons/getuptodate.gif
   branches/apps/install/client/icons/latex-klein.png
   branches/apps/install/client/icons/twitter_bird.gif
   branches/apps/install/db/patches/cm-2.20.sql
   branches/apps/libs/ext/
   branches/apps/libs/ext/Scenario.jar
   branches/apps/libs/ext/cobra-no-commons.jar
   branches/apps/libs/ext/javafx-swing.jar
   branches/apps/libs/ext/javafxc.jar
   branches/apps/libs/ext/javafxgui.jar
   branches/apps/libs/ext/javafxrt.jar
   branches/apps/libs/ext/jlfgr-1_0.jar
   branches/apps/libs/ext/jmc.jar
   branches/apps/libs/ext/js.jar
   branches/apps/libs/ext/jweb-ext.jar
   branches/apps/libs/ext/primary.jar
   branches/apps/libs/ext/websvc.jar
   branches/apps/libs/lobo-pub.jar
   branches/apps/libs/lobo.jar
   branches/apps/libs/mysql-connector-java-5.0.8-bin.jar
   branches/apps/libs/yahooSearch2-01.jar
Modified:
   branches/apps/config.xml
   branches/apps/develop/src/de/deepamehta/DeepaMehtaConstants.java
   branches/apps/develop/src/de/deepamehta/client/PresentationPropertyDefinition.java
   branches/apps/develop/src/de/deepamehta/client/PresentationType.java
   branches/apps/develop/src/de/deepamehta/client/PropertyPanel.java
   branches/apps/develop/src/de/deepamehta/service/ApplicationService.java
   branches/apps/develop/src/de/deepamehta/service/web/JSONRPCServlet.java
   branches/apps/develop/src/de/deepamehta/topics/LiveTopic.java
   branches/apps/develop/src/de/deepamehta/topics/WebpageTopic.java
   branches/apps/install/db/cm.sql
Log:
Initial commit of the DeepaMehta Browser Monolith.

Known Issues:
* The client should crash while initializing as an Applet cause of TypeDef initialization within the PropertyPanel and the missing ext/*.jar libraries
* a Webpage topic looses it's URL after being deselected caused by JComponent.getText() in PresentationPropertyDefinition and the workaround for now is to hit Enter in the URL Input Field
Here help is very much appreciated atm.

Ohter Changes:
* switched from using Google Search API to Yahoo Search API ()
* updated MySQL Connector for 1.5/1.6
* aded a new  folder underneath libs ext a place for all plugins Lobo needs
* created empty apps directory and added some icons for the next commits 
* building depends on JDK 1.5

Have fun with conquering the web through DeepaMehta :)

Modified: branches/apps/config.xml
===================================================================
--- branches/apps/config.xml	2009-08-07 10:51:17 UTC (rev 370)
+++ branches/apps/config.xml	2009-09-12 08:41:53 UTC (rev 371)
@@ -39,8 +39,10 @@
 		&lt;pathelement location=&quot;${dm.base-dir}/${libpath}/xml4j.jar&quot; /&gt;
 		&lt;pathelement location=&quot;${dm.base-dir}/${libpath}/avalon-framework.jar&quot; /&gt;
 		&lt;pathelement location=&quot;${dm.base-dir}/${libpath}/commons-fileupload-1.0.jar&quot; /&gt;
-		&lt;pathelement location=&quot;${dm.base-dir}/${libpath}/googleapi.jar&quot; /&gt;
+		&lt;pathelement location=&quot;${dm.base-dir}/${libpath}/yahooSearch2-01.jar&quot; /&gt;
 		&lt;pathelement location=&quot;${dm.base-dir}/${libpath}/commons-logging.jar&quot; /&gt;
+		&lt;pathelement location=&quot;${dm.base-dir}/${libpath}/lobo.jar&quot; /&gt;
+		&lt;pathelement location=&quot;${dm.base-dir}/${libpath}/lobo-pub.jar&quot; /&gt;
 	&lt;/path&gt;
 	&lt;pathconvert property=&quot;jarclasspath&quot; pathsep=&quot; &quot; refid=&quot;javalibs&quot;&gt;
 		&lt;!-- The classpath inside the .JAR archive is always interpreted relative to the location

Modified: branches/apps/develop/src/de/deepamehta/DeepaMehtaConstants.java
===================================================================
--- branches/apps/develop/src/de/deepamehta/DeepaMehtaConstants.java	2009-08-07 10:51:17 UTC (rev 370)
+++ branches/apps/develop/src/de/deepamehta/DeepaMehtaConstants.java	2009-09-12 08:41:53 UTC (rev 371)
@@ -43,7 +43,7 @@
 	// --- diagnosis log switches ---
 	static final boolean LOG_REQUESTS = true;		// server
 	static final boolean LOG_CM = false;			// server
-	static final boolean LOG_CM_QUERIES = false;	// server
+	static final boolean LOG_CM_QUERIES = true;	// server
 	static final boolean LOG_LCM = false;			// server
 	static final boolean LOG_CDS = false;			// server
 	static final boolean LOG_GEOM = false;			// server
@@ -147,6 +147,7 @@
 	static final String PROPERTY_RESULT = &quot;Result&quot;;								// &quot;Search&quot;
 	static final String PROPERTY_ROLE_EDITOR = &quot;Editor&quot;;						// &quot;Membership&quot;
 	static final String PROPERTY_ROLE_PUBLISHER = &quot;Publisher&quot;;					// &quot;Membership&quot;
+    static final String PROPERTY_BROWSER = &quot;Lobo Browser&quot;;                      // &quot;Lobo Browser&quot; Property Field for storing URL&quot; added in cm2.20.sql
 
 	// --- property values ---
 	static final String PERMISSION_VIEW = &quot;view&quot;;
@@ -392,7 +393,7 @@
 	static final String ICON_HIDE_TOPIC = &quot;eye-closed.gif&quot;;
 	static final String ICON_DELETE_TOPIC = &quot;trash.gif&quot;;
 	static final String ICON_SHOW_HELP = &quot;viewhilfe.gif&quot;;
-	static final String ICON_SEARCH_INTERNET = &quot;google.gif&quot;;
+	static final String ICON_SEARCH_INTERNET = &quot;yahoo.gif&quot;;
 	static final String ICON_GROUP_BY = &quot;eye-grey.gif&quot;;
 	static final String ICON_COMPOSE_EMAIL = &quot;composeEmail.gif&quot;;
 
@@ -461,7 +462,7 @@
 	// --- Layouts ---
     static final int LAYOUT_ROWS = 1;
     static final int LAYOUT_COLS = 2;
-    
+
     // --- Layout Styles (for bean-based info generator) ---
     static final int LAYOUT_STYLE_2COLUMN = 1;
     static final int LAYOUT_STYLE_FLOW = 2;
@@ -793,9 +794,9 @@
 	public static final int DIRECTIVE_LAUNCH_APPLICATION = 46;
 	public static final int DIRECTIVE_OPEN_URL = 47;
 	public static final int DIRECTIVE_CHOOSE_COLOR = 49;
-	
 
 
+
 	// ---------------------
 	// --- Message Types ---
 	// ---------------------
@@ -1095,7 +1096,7 @@
 
 
 
-	static final int EDITOR_CONTEXT_PERSONAL = 1;	// personal workspace topicmap 
+	static final int EDITOR_CONTEXT_PERSONAL = 1;	// personal workspace topicmap
 	static final int EDITOR_CONTEXT_WORKGROUP = 2;	// shared workspace topicmap
 	static final int EDITOR_CONTEXT_VIEW = 3;		// open topicmap
 
@@ -1186,6 +1187,7 @@
 	public static final String VISUAL_FILE_CHOOSER = &quot;File Chooser&quot;;
 	public static final String VISUAL_COLOR_CHOOSER = &quot;Color Chooser&quot;;
 	public static final String VISUAL_HIDDEN = &quot;hidden&quot;;	// ### not a real mode
+	public static final String VISUAL_BROWSER = &quot;Lobo Browser&quot;;
 
 
 

Added: branches/apps/develop/src/de/deepamehta/client/BrowserNavigationListener.java
===================================================================
--- branches/apps/develop/src/de/deepamehta/client/BrowserNavigationListener.java	2009-08-07 10:51:17 UTC (rev 370)
+++ branches/apps/develop/src/de/deepamehta/client/BrowserNavigationListener.java	2009-09-12 08:41:53 UTC (rev 371)
@@ -0,0 +1,48 @@
+/*
+ * To change this template, choose Tools | Templates
+ * and open the template in the editor.
+ */
+
+package de.deepamehta.client;
+
+import de.deepamehta.BaseTopic;
+import de.deepamehta.DeepaMehtaConstants;
+import org.lobobrowser.ua.NavigationEvent;
+import org.lobobrowser.ua.NavigationListener;
+import org.lobobrowser.ua.NavigationVetoException;
+
+/**
+ *
+ * @author Malte Rei&#223;ig / <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">mre at deepamehta.de</A>
+ */
+public class BrowserNavigationListener implements DeepaMehtaConstants, NavigationListener {
+
+    private PropertyPanelControler controler;
+    private PropertyPanel panel;
+
+    public BrowserNavigationListener (PropertyPanelControler controler, PropertyPanel panel) {
+        this.controler = controler;
+        this.panel = panel;
+    }
+
+    public void beforeNavigate(NavigationEvent arg0) throws NavigationVetoException {
+        if (arg0.isFromClick()) {
+            String command = CMD_FOLLOW_HYPERLINK + COMMAND_SEPARATOR + arg0.getURL();
+            System.out.println(&quot;Deepa Browser was clicked:&quot; + arg0.getMethod().toString() +&quot;, &quot; + arg0.getParamInfo() + &quot;, &quot; + arg0.isFromClick());
+            controler.executeTopicCommand(panel.getTopicmap().getEditor().getTopicMap(), panel.getTopic(), command);
+        }
+        // throw new UnsupportedOperationException(&quot;beforeNavigate:&quot; + arg0.getMethod().toString());
+    }
+
+    public void beforeLocalNavigate(NavigationEvent arg0) throws NavigationVetoException {
+        // System.out.println(&quot;beforeLocalNavigate:&quot; + arg0.getMethod().toString());
+        // throw new UnsupportedOperationException(&quot;beforeLocalNavigate.&quot; + arg0.getMethod().toString());
+    }
+
+    public void beforeWindowOpen(NavigationEvent arg0) throws NavigationVetoException {
+        String filePath = arg0.getURL().getPath();
+        System.out.println(&quot;    maybe a download is going to start: it's a &quot; + filePath.substring(filePath.length()-4));
+        // throw new UnsupportedOperationException(&quot;beforeWindowOpen.&quot; + arg0.getMethod().toString());
+    }
+
+}

Modified: branches/apps/develop/src/de/deepamehta/client/PresentationPropertyDefinition.java
===================================================================
--- branches/apps/develop/src/de/deepamehta/client/PresentationPropertyDefinition.java	2009-08-07 10:51:17 UTC (rev 370)
+++ branches/apps/develop/src/de/deepamehta/client/PresentationPropertyDefinition.java	2009-09-12 08:41:53 UTC (rev 371)
@@ -10,6 +10,8 @@
 import java.io.IOException;
 import java.util.Enumeration;
 
+import java.util.logging.Level;
+import java.util.logging.Logger;
 import javax.swing.BoxLayout;
 import javax.swing.ButtonGroup;
 import javax.swing.ImageIcon;
@@ -24,6 +26,8 @@
 import javax.swing.JTextArea;
 import javax.swing.JTextField;
 import javax.swing.event.HyperlinkListener;
+import org.lobobrowser.gui.FramePanel;
+import org.lobobrowser.main.PlatformInit;
 
 
 
@@ -32,7 +36,7 @@
  * suitable GUI component for editing the value of the respective property.
  * &lt;P&gt;
  * &lt;CODE&gt;PresentationPropertyDefinition&lt;/CODE&gt; objects are created while reading a
- * {@link PresentationType}. 
+ * {@link PresentationType}.
  * &lt;P&gt;
  * &lt;HR&gt;
  * Last functional change: 10.9.2007 (2.0b8)&lt;BR&gt;
@@ -88,7 +92,7 @@
 	 * @see		PropertyPanel.PropertyField#PropertyPanel.PropertyField
 	 */
 	Object[] createGUIComponent(ActionListener actionListener, HyperlinkListener hyperlinkListener,
-																	PropertyPanelControler controler) {
+																	PropertyPanelControler controler, BrowserNavigationListener deepaListener) {
 		Object result[] = new Object[2];
 		if (visualization.equals(VISUAL_FIELD) ||
 			visualization.equals(VISUAL_FILE_CHOOSER) ||
@@ -125,7 +129,7 @@
 			result[0] = createOptionMenu(actionListener, controler);
 			return result;
 		} else if (visualization.equals(VISUAL_RADIOBUTTONS)) {
-			ButtonGroup group = new ButtonGroup();		
+			ButtonGroup group = new ButtonGroup();
 			result[0] = createOptionButtons(actionListener, group, controler);
 			result[1] = group;
 			return result;
@@ -140,6 +144,18 @@
 			return result;
 		} else if (visualization.equals(VISUAL_HIDDEN)) {
 			return result;
+		} else if (visualization.equals(VISUAL_BROWSER)) {
+            if (deepaListener == null) {
+                // this exception must be caught in streamConstructor when the
+                // Property Panel ist intialized for the first time
+                // or the import must be moved out of this class
+                // throw new ClassNotFoundException(&quot;No Lobo Browser Package available.&quot;);
+                createTextEditor(actionListener, hyperlinkListener, result, controler);
+                Logger.getLogger(PropertyPanel.class.getName()).log(Level.SEVERE, null, &quot;BrowserNavigationListener Not Found&quot;);
+            } else {
+                createBrowser(actionListener, hyperlinkListener, result, controler, deepaListener);
+            }
+            return result;
 		} else {
 			System.out.println(&quot;*** PresentationPropertyDefinition.createGUIComponent&quot; +
 				&quot;(): unexpected visualization mode (\&quot;&quot; + visualization + &quot;\&quot;) -- default &quot; +
@@ -222,6 +238,43 @@
 		result[1] = textEditor;
 	}
 
+    /**
+	 * Called for &lt;code&gt;VISUAL_BROWSER&lt;/code&gt;. If BrowserNavigationListener
+	 */
+	private void createBrowser(ActionListener actionListener, HyperlinkListener hyperlinkListener,
+																	Object[] result, PropertyPanelControler controler, BrowserNavigationListener deepaListener) {
+        if( deepaListener == null) {
+            createTextEditor(actionListener, hyperlinkListener, result, controler);
+        } else {
+            try {
+                PlatformInit.getInstance().initLogging(true);
+                PlatformInit.getInstance().init(false, false);
+            } catch (Exception ex) {
+                System.out.print(&quot;Error:&quot; + ex.toString());
+            }
+            FramePanel panel = new FramePanel() { //null, false, false, true) {
+                public Dimension getPreferredSize() {
+                    return new Dimension(800, 1000);	// ### height 800 pixels
+                }
+            };
+            panel.addNavigationListener(deepaListener);
+            result[0] = panel;
+        }
+        //
+        // ### DJProject Native SWT Browser Code ####
+        //
+        //        try {
+        //            JPanel webBrowserPanel = new JPanel(new BorderLayout());
+        //            webBrowserPanel.setBorder(BorderFactory.createTitledBorder(&quot;Native Web Browser component&quot;));
+        //            final JWebBrowser webBrowser = new JWebBrowser(null);
+        //            webBrowserPanel.add(webBrowser, BorderLayout.CENTER);
+        //            result[1] = webBrowser;
+        //            result[0] = webBrowserPanel;
+        //        } catch (Exception ex) {
+        //            System.out.print(&quot;Error:&quot; + ex.toString());
+        //        }
+	}
+
 	private JComponent createOptionMenu(ActionListener actionListener, PropertyPanelControler controler) {
 		JComboBox cbox = new JComboBox();
 		cbox.setMaximumRowCount(32);

Modified: branches/apps/develop/src/de/deepamehta/client/PresentationType.java
===================================================================
--- branches/apps/develop/src/de/deepamehta/client/PresentationType.java	2009-08-07 10:51:17 UTC (rev 370)
+++ branches/apps/develop/src/de/deepamehta/client/PresentationType.java	2009-09-12 08:41:53 UTC (rev 371)
@@ -85,6 +85,8 @@
 		// --- type definition ---
 		int fieldCount = in.readInt();
 		for (int i = 0; i &lt; fieldCount; i++) {
+            // ### DeepaMehta Thin Client Applet Compatibility
+            // The next line throws a ClassNotFoundException if the Lobo Extensions are not available
 			typeDefinition.addElement(new PresentationPropertyDefinition(in));
 		}
 		// --- type icon ---

Modified: branches/apps/develop/src/de/deepamehta/client/PropertyPanel.java
===================================================================
--- branches/apps/develop/src/de/deepamehta/client/PropertyPanel.java	2009-08-07 10:51:17 UTC (rev 370)
+++ branches/apps/develop/src/de/deepamehta/client/PropertyPanel.java	2009-09-12 08:41:53 UTC (rev 371)
@@ -5,9 +5,9 @@
 import de.deepamehta.BaseTopic;
 import de.deepamehta.DeepaMehtaConstants;
 import de.deepamehta.DeepaMehtaException;
-import de.deepamehta.PropertyDefinition;
 import de.deepamehta.Topic;
 import de.deepamehta.Type;
+import de.deepamehta.client.BrowserNavigationListener;
 import de.deepamehta.util.DeepaMehtaUtils;
 
 import java.awt.BorderLayout;
@@ -17,6 +17,7 @@
 import java.awt.event.ActionListener;
 import java.awt.event.ItemEvent;
 import java.awt.event.ItemListener;
+import java.net.MalformedURLException;
 import java.util.Enumeration;
 import java.util.Hashtable;
 import java.util.NoSuchElementException;
@@ -36,12 +37,13 @@
 import javax.swing.JRadioButton;
 import javax.swing.JScrollBar;
 import javax.swing.JScrollPane;
-import javax.swing.JTextPane;
 import javax.swing.event.DocumentEvent;
 import javax.swing.event.DocumentListener;
 import javax.swing.event.HyperlinkEvent;
 import javax.swing.event.HyperlinkListener;
 import javax.swing.text.JTextComponent;
+import org.lobobrowser.gui.FramePanel;
+import org.lobobrowser.ua.RequestType;
 
 
 
@@ -141,7 +143,7 @@
 	private boolean propertiesAreDirty;
 
 	// ---
-	
+
 	/**
 	 * Key: Topic Type ID (&lt;code&gt;String&lt;/code&gt;)&lt;br&gt;
 	 * Value: PresentationType
@@ -345,7 +347,7 @@
 		setPropertiesDirty(&quot;typing&quot;);
 	}
 
-	public void removeUpdate(DocumentEvent e) {	
+	public void removeUpdate(DocumentEvent e) {
 		setPropertiesDirty(&quot;deleting&quot;);
 	}
 
@@ -954,7 +956,7 @@
 			return;
 		}
 		// ---
-		// go through all fields of the type definition		
+		// go through all fields of the type definition
 		Enumeration e = propertyFields.elements();
 		while (e.hasMoreElements()) {
 			PropertyField propField = (PropertyField) e.nextElement();
@@ -1496,10 +1498,18 @@
 			if (isHidden()) {
 				actionListener = null;		// ### required?
 				hyperlinkListener = null;	// ### required?
-			}
-			Object[] component = propertyDef.createGUIComponent(actionListener, hyperlinkListener, controler);
-			this.view = (JComponent) component[0];
-			this.model = component[1];
+			}// actionListener is a reference to the PropertyPanel
+            Object deepaListener = null;
+            try {
+                // actionListener is a reference to the PropertyPanel
+                Class test = Class.forName(&quot;org.lobobrowser.ua.NavigationListener&quot;);
+                deepaListener = new BrowserNavigationListener(controler, (PropertyPanel) actionListener);
+            } catch (ClassNotFoundException ex) {
+                System.out.println(&quot;    Lobo Extension is not installed: &quot; + ex);
+            }
+            Object[] component = propertyDef.createGUIComponent(actionListener, hyperlinkListener, controler, (BrowserNavigationListener) deepaListener);
+            this.view = (JComponent) component[0];
+            this.model = component[1];
 		}
 
 
@@ -1567,7 +1577,12 @@
 				}
 				String minute = (String) menus[1].getSelectedItem();
 				return hour + TIME_SEPARATOR + minute;
-			} else {
+			} else if (visualization.equals(VISUAL_BROWSER)) {
+                FramePanel panel = (FramePanel) view;
+                System.out.println(&quot;INFO: Visula Browser says: Yeah, we have a view: &quot; + panel);//.getName());
+                //### Browser Components getText has to return URL, in this field the URL stored
+                return &quot;&quot;;
+            } else {
 				throw new DeepaMehtaException(&quot;unexpected visualization mode: \&quot;&quot; +
 					visualization + &quot;\&quot;&quot;);
 			}
@@ -1622,6 +1637,25 @@
 				setTime(text, actionListener);
 			} else if (visualization.equals(VISUAL_HIDDEN)) {
 				// do nothing
+			} else if (visualization.equals(VISUAL_BROWSER)) {
+                try {
+                    // ### Browser That's the theory of compatibility
+                    if (view instanceof TextEditorPanel) {
+                        // just if lobo browser package is not available
+                        TextEditorPanel textEditor = (TextEditorPanel) model;
+                        textEditor.setText(text + &quot;&lt;br/&gt; Sorry, but the page cannot be displayed.&lt;br/&gt; &quot; +
+                                &quot;Please use DeepaMehta with the LoboBrowser Extension&quot;, baseURL, documentListener);
+                        // restore scrollbar value
+                        System.out.println(&quot;    without lobo browsing, there is just a Text Editor&quot;);
+                    } else {
+                        // normal case
+                        System.out.println(&quot;    lobo reporting, goes to: &quot; + text);
+                        FramePanel htmlPanel = (FramePanel) view;
+                        htmlPanel.navigate(text, RequestType.PROGRAMMATIC);
+                    }
+                } catch (MalformedURLException ex) {
+                    Logger.getLogger(PropertyPanel.class.getName()).log(Level.SEVERE, null, ex);
+                }
 			} else {
 				throw new DeepaMehtaException(&quot;unexpected visualization mode: \&quot;&quot; + visualization + &quot;\&quot;&quot;);
 			}

Modified: branches/apps/develop/src/de/deepamehta/service/ApplicationService.java
===================================================================
--- branches/apps/develop/src/de/deepamehta/service/ApplicationService.java	2009-08-07 10:51:17 UTC (rev 370)
+++ branches/apps/develop/src/de/deepamehta/service/ApplicationService.java	2009-09-12 08:41:53 UTC (rev 371)
@@ -33,10 +33,7 @@
 import de.deepamehta.util.CaseInsensitveHashtable;
 import de.deepamehta.util.DeepaMehtaUtils;
 
-import com.google.soap.search.GoogleSearch;
-import com.google.soap.search.GoogleSearchFault;
-import com.google.soap.search.GoogleSearchResult;
-import com.google.soap.search.GoogleSearchResultElement;
+import com.yahoo.search.*;
 
 import java.awt.Point;
 import java.io.CharArrayWriter;
@@ -173,8 +170,8 @@
 		logger.info(&quot;active installation: \&quot;&quot; + installation.getName() + &quot;\&quot;&quot;);
 	}
 
-	
-	
+
+
 	// ***************
 	// *** Methods ***
 	// ***************
@@ -913,7 +910,7 @@
 	 * &lt;p&gt;
 	 * &lt;table&gt;
 	 * &lt;tr&gt;&lt;td&gt;&lt;b&gt;Called by&lt;/b&gt;&lt;/td&gt;												&lt;td&gt;&lt;code&gt;evokeContent&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;
-	 * &lt;tr&gt;&lt;td&gt;{@link #performGoogleSearch}&lt;/td&gt;									&lt;td&gt;&lt;code&gt;false&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;
+	 * &lt;tr&gt;&lt;td&gt;{@link #performYahooSearch}&lt;/td&gt;									&lt;td&gt;&lt;code&gt;false&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;
 	 * &lt;tr&gt;&lt;td&gt;{@link de.deepamehta.topics.TopicContainerTopic#performQuery}&lt;/td&gt;	&lt;td&gt;&lt;code&gt;false&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;
 	 * &lt;tr&gt;&lt;td&gt;{@link de.deepamehta.topics.ElementContainerTopic#performQuery}&lt;/td&gt;	&lt;td&gt;&lt;code&gt;true&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;
 	 * &lt;/table&gt;
@@ -1742,7 +1739,7 @@
 	 * @param	session							### may be null
 	 *
 	 * @see		#setTopicProperty
-	 * @see		#performGoogleSearch
+	 * @see		#performYahooSearch
 	 * @see		CorporateDirectives#setTopicProperties
 	 * @see		InteractionConnection#setTopicData
 	 * @see		EmbeddedService#setTopicProperties
@@ -1915,7 +1912,7 @@
 	public String triggerPropertyLabel(PropertyDefinition propDef, TypeTopic type, String relTopicTypeID) {
 		Class[] paramTypes = {PropertyDefinition.class, String.class, ApplicationService.class};
 		Object[] paramValues = {propDef, relTopicTypeID, this};
-		try {	
+		try {
 			String propLabel = (String) triggerStaticHook(type.getImplementingClass(), &quot;propertyLabel&quot;,
 				paramTypes, paramValues, true);	// throwIfNoSuchHookExists=true
 			return propLabel;
@@ -3698,7 +3695,7 @@
 
 	/**
 	 * References checked: 15.2.2005 (2.0b5)
-	 * 
+	 *
 	 * @return	The membership association-type to use for joining a user to the specified
 	 *			workgroup as {@link de.deepamehta.BaseTopic} (type &lt;code&gt;tt-topictype&lt;/code&gt;).
 	 *
@@ -3744,50 +3741,59 @@
 
 
 
-	public void performGoogleSearch(String searchText, String topicID, String topicmapID, String viewmode,
+	public void performYahooSearch(String searchText, String topicID, String topicmapID, String viewmode,
 																	Session session, CorporateDirectives directives) {
 		try {
-			GoogleSearch s = new GoogleSearch();
-			s.setKey(getGoogleKey());		// throws DME
-			s.setQueryString(searchText);
-			// ### s.setMaxResults(10);		// Note: more than 10 doesn't work
-			GoogleSearchResult r = s.doSearch();
-			GoogleSearchResultElement[] elems = r.getResultElements();
-			// --- process result ---
+			//System.out.println(&quot;Proxy set: &quot;+de.deepamehta.DeepaMehtaUtils.setProxyConfiguration(&quot;proxy02.tfh-berlin.de&quot;, &quot;2784&quot;));
+			SearchClient s = new SearchClient(getGoogleKey()); //throws DME
+			WebSearchRequest webSearchRequest = new WebSearchRequest(searchText);
+			webSearchRequest.setResults(10);
+			webSearchRequest.setCountry(&quot;de&quot;);
+			webSearchRequest.setAdultOk(true);
+			webSearchRequest.setLanguage(&quot;de&quot;);
+
+			WebSearchResults r = s.webSearch(webSearchRequest);
 			Vector webpages = new Vector();
-			// ### Downloader downloader = new Downloader(this, session, topicmapID, viewmode);
-			for (int i = 0; i &lt; elems.length; i++) {
-				GoogleSearchResultElement elem = elems[i];
-				PresentableTopic webpage = createWebpageTopic(elem.getURL(), elem.getTitle(), topicID);
-				String webpageID = webpage.getID();
-				// ### must evoke here, because createNewContainer() evokes only if &lt; 7
-				if (webpage.getEvoke()) {
+			int resultLength = r.listResults().length;
+			System.out.println(&quot;laenge der resultliste &quot;+resultLength);
+			for (int i = 0; i &lt; resultLength; i++) {
+                WebSearchResult result = r.listResults()[i];
+                // Print out the document title and URL.
+                PresentableTopic webpage = createWebpageTopic(result.getUrl(), result.getTitle(), topicID);
+                String webpageID = webpage.getID();
+                if (webpage.getEvoke()) {
 					createLiveTopic(webpage, topicmapID, viewmode, session, directives);
-					setTopicProperties(webpageID, 1, webpage.getProperties(), topicmapID, session);
+					setTopicProperties(webpageID, 1, webpage.getProperties(), topicmapID, session);	// ### triggers not PropertiesChangedHook !
 				}
 				if (!cm.associationExists(topicID, webpageID, false)) {	// ignoreDirection=false
 					String assocID = getNewAssociationID();
 					cm.createAssociation(assocID, 1, SEMANTIC_WEBSEARCH_RESULT, 1, topicID, 1, webpageID, 1);
-					cm.setAssociationData(assocID, 1, PROPERTY_NAME, elem.getTitle());
-					cm.setAssociationData(assocID, 1, PROPERTY_DESCRIPTION, elem.getSnippet());
+					cm.setAssociationData(assocID, 1, PROPERTY_NAME, result.getTitle());
+					cm.setAssociationData(assocID, 1, PROPERTY_DESCRIPTION, result.getSummary());
 				}
-				webpages.addElement(webpage);	// ### complete?
-				// ### downloader.addURL(elem.getURL(), webpageID);
-			}
+				webpages.addElement(webpage);
+                System.out.println(&quot;   &quot; + (i + 1) + &quot;: &quot; + result.getTitle() + &quot; - &quot; +
+                        result.getUrl());
+            }
+
 			// --- show result ---
 			directives.add(createNewContainer(getLiveTopic(topicID, 1), &quot;tt-webpagecontainer&quot;, null, new Hashtable(),
 				topicID, SEMANTIC_WEBSEARCH_RESULT, webpages.size(), webpages, false));
-			// ---
-			// ### downloader.startDownload();
+
+		    
 		} catch (DeepaMehtaException dme) {
-			System.out.println(&quot;*** ApplicationService.performGoogleSearch(): call to the Google Web APIs failed: &quot; + dme);
-			directives.add(DIRECTIVE_SHOW_MESSAGE, &quot;To perform a Google search you need a key from www.google.com/apis/. &quot; +
+			System.out.println(&quot;*** ApplicationService.performYahooSearch(): call to the Yahoo Web APIs failed: &quot; + dme);
+			directives.add(DIRECTIVE_SHOW_MESSAGE, &quot;To perform a Yahoo search you need a key from www.google.com/apis/. &quot; +
 				&quot;Then as a DeepaMehta administrator enter the key into \&quot;CorporateWeb Settings\&quot;&quot;,
 				new Integer(NOTIFICATION_WARNING));
-		} catch (GoogleSearchFault f) {
-			System.out.println(&quot;*** ApplicationService.performGoogleSearch(): call to the Google Web APIs failed: &quot; + f);
-			directives.add(DIRECTIVE_SHOW_MESSAGE, &quot;Error while performing Google search for \&quot;&quot; + searchText + &quot;\&quot; (&quot; + f.getMessage() + &quot;)&quot;,
+		} catch (IOException f) {
+			System.out.println(&quot;*** ApplicationService.performYahooSearch(): call to the Yahoo Web APIs failed: &quot; + f);
+			directives.add(DIRECTIVE_SHOW_MESSAGE, &quot;IOError while performing Yahoo search for \&quot;&quot; + searchText + &quot;\&quot; (&quot; + f.getMessage() + &quot;)&quot;,
 				new Integer(NOTIFICATION_WARNING));
+		} catch (SearchException f) {
+			System.out.println(&quot;*** ApplicationService.performYahooSearch(): call to the Yahoo Web APIs failed: &quot; + f);
+			directives.add(DIRECTIVE_SHOW_MESSAGE, &quot;Error while performing Yahoo search for \&quot;&quot; + searchText + &quot;\&quot; (&quot; + f.getMessage() + &quot;)&quot;,
+				new Integer(NOTIFICATION_WARNING));
 		}
 	}
 
@@ -3824,7 +3830,7 @@
 
 
 	public TopicBean createTopicBean(String topicID, int version) {
-		TopicBean bean = new TopicBean();
+        TopicBean bean = new TopicBean();
 		//
 		LiveTopic topic = getLiveTopic(topicID, version);
 		TypeTopic type = getTopicType(topicID, version);
@@ -3835,7 +3841,7 @@
 		bean.icon = topic.getIconfile();
 		//
 		addFieldsToTopicBean(type, topicID, version, &quot;&quot;, &quot;&quot;, true, bean);
-		return bean;
+        return bean;
 	}
 
 	/**
@@ -3843,8 +3849,8 @@
 	 *
 	 * @param	type		the type of the topic. Acts as &quot;template&quot;: all fields of this type definition are added.
 	 * @param	topicID		the ID of the topic. If null, the added fields are empty.
-	 * @param   fieldPrefix contains the type hierarchy as name of a TopicBeanField 
-	 * @param   labelPrefix contains the naming hierarchy as labelof a TopicBeanField 
+	 * @param   fieldPrefix contains the type hierarchy as name of a TopicBeanField
+	 * @param   labelPrefix contains the naming hierarchy as labelof a TopicBeanField
 	 */
 	private void addFieldsToTopicBean(TypeTopic type, String topicID, int version, String fieldPrefix, String labelPrefix, boolean deep, TopicBean bean) {
 		// ### compare to HTMLGenerator.infoFields()
@@ -3912,7 +3918,7 @@
 		}
 		TypeTopic relTopicType = type(rel.relTopicTypeID, 1);
 		boolean many = rel.cardinality.equals(CARDINALITY_MANY);
-		String labelPrefix = !rel.name.equals(&quot;&quot;) ? rel.name + TopicBean.FIELD_SEPARATOR : many ? relTopicType.getPluralNaming() + 
+		String labelPrefix = !rel.name.equals(&quot;&quot;) ? rel.name + TopicBean.FIELD_SEPARATOR : many ? relTopicType.getPluralNaming() +
 			TopicBean.FIELD_SEPARATOR : relTopicType.getName() + TopicBean.FIELD_SEPARATOR;
 		fieldPrefix = fieldPrefix + relTopicType.getName() + TopicBean.FIELD_SEPARATOR;
 		boolean deep = rel.webInfo.equals(WEB_INFO_DEEP);
@@ -5144,7 +5150,7 @@
 		}
 	}
 
-	/* ### 
+	/* ###
 	/ **
 	 * @see		#personalizeView
 	 * /

Modified: branches/apps/develop/src/de/deepamehta/service/web/JSONRPCServlet.java
===================================================================
--- branches/apps/develop/src/de/deepamehta/service/web/JSONRPCServlet.java	2009-08-07 10:51:17 UTC (rev 370)
+++ branches/apps/develop/src/de/deepamehta/service/web/JSONRPCServlet.java	2009-09-12 08:41:53 UTC (rev 371)
@@ -36,9 +36,11 @@
 /**
  * &lt;p&gt;
  * &lt;hr&gt;
- * Last change: 4.7.2008 (2.0b8)&lt;br&gt;
- * J&ouml;rg Richter&lt;br&gt;
- * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at deepamehta.de</A>
+ * Last change: 17.8.2009 (2.0b8-pre)&lt;br&gt;
+ * Malte Rei&szlig;ig&lt;br&gt;
+
+ * 
+ * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">mre at deepamehta.de</A>
  */
 public class JSONRPCServlet extends HttpServlet implements ApplicationServiceHost, DeepaMehtaConstants {
 
@@ -220,6 +222,7 @@
 		Session session = getSession(request);
 		CorporateDirectives directives = new CorporateDirectives();
 		String method = request.getMethod();
+        System.out.println(&quot;    HTTP Header AuthType is : &quot; + request.getAuthType() + &quot; \n &quot;);
 		//
         String remoteMethodCall = &quot;&quot;;
         String remoteParams = &quot;&quot;;
@@ -244,14 +247,14 @@
         // --- trigger performPostrequest() hook
         String result = performPostRequest(remoteMethodCall, remoteParams, session, directives);
         if(result.equals(&quot;&quot;)) {
-            response.setStatus(response.SC_INTERNAL_SERVER_ERROR);
-            response.sendError(response.SC_INTERNAL_SERVER_ERROR);
-            if (result.indexOf(&quot;\&quot;error\&quot;: null&quot;) != -1){
-                System.out.println(&quot;*** ERROR: &quot; + result.substring(result.indexOf(&quot;\&quot;error\&quot;: null&quot;) + 13, result.length() - 3));
-            }
+            // response.setStatus(response.SC_INTERNAL_SERVER_ERROR);
+            System.out.println(&quot; === JSONRPC === *** unexpected result *** &quot; + result + &quot; setting response to continue...&quot;);
+            response.sendError(response.SC_INTERNAL_SERVER_ERROR); // 500
         } else {
             response.setStatus(response.SC_OK);
             response.setContentType(&quot;applicaton/json&quot;);
+            response.setContentLength(result.getBytes().length);
+            // response.setLocale(&quot;en_EN&quot;);
             System.out.println(&quot;&gt;&gt;&gt; RESPONSE BODY: &quot;+response.getCharacterEncoding()+&quot; written &quot;+result.length() +&quot; character\n&quot;);
             // LOG System.out.println(&quot;INFO: &quot;+result + &quot;\n&quot;);
             // write back
@@ -260,13 +263,6 @@
             writer.checkError();
             writer.close();
         }
-        
-//        String actionResult = performAction(remoteParams, remoteParams, session, directives);
-//        // --- trigger preparePage() hook ---
-//        preparePage(actionResult, params, session, directives);
-//        //
-//        redirectToPage(result, request, response);
-		//
 		// process directives
 		directives.updateCorporateMemory(as, session, null, null);
 		// Note: topicmapID=null, viewmode=null ### should be OK because in web interface there is no &quot;default topicmap&quot;

Modified: branches/apps/develop/src/de/deepamehta/topics/LiveTopic.java
===================================================================
--- branches/apps/develop/src/de/deepamehta/topics/LiveTopic.java	2009-08-07 10:51:17 UTC (rev 370)
+++ branches/apps/develop/src/de/deepamehta/topics/LiveTopic.java	2009-09-12 08:41:53 UTC (rev 371)
@@ -540,7 +540,7 @@
 			String typeID = st.nextToken();
 			showTypeHelp(typeID, session, directives);
 		} else if (cmd.equals(CMD_SEARCH_INTERNET)) {
-			as.performGoogleSearch(getName(), getID(), topicmapID, viewmode, session, directives);
+			as.performYahooSearch(getName(), getID(), topicmapID, viewmode, session, directives);
 		} else if (cmd.equals(CMD_SUBMIT_FORM)) {
 			// Note: there is no standard behavoir for &quot;submitForm&quot; command -- do nothing
 			// just avoid &quot;command not implemented&quot; exception

Modified: branches/apps/develop/src/de/deepamehta/topics/WebpageTopic.java
===================================================================
--- branches/apps/develop/src/de/deepamehta/topics/WebpageTopic.java	2009-08-07 10:51:17 UTC (rev 370)
+++ branches/apps/develop/src/de/deepamehta/topics/WebpageTopic.java	2009-09-12 08:41:53 UTC (rev 371)
@@ -3,6 +3,8 @@
 import de.deepamehta.BaseAssociation;
 import de.deepamehta.BaseTopic;
 import de.deepamehta.DeepaMehtaException;
+import de.deepamehta.PresentableAssociation;
+import de.deepamehta.PresentableTopic;
 import de.deepamehta.PropertyDefinition;
 import de.deepamehta.service.ApplicationService;
 import de.deepamehta.service.CorporateCommands;
@@ -23,7 +25,7 @@
  * &lt;p&gt;
  * &lt;h4&gt;Active behavoir&lt;/h4&gt;
  *
- * ### The active &lt;i&gt;displaing in browser&lt;/i&gt; behavoir of a &lt;code&gt;WorkspaceTopic&lt;/code&gt; is 
+ * ### The active &lt;i&gt;displaing in browser&lt;/i&gt; behavoir of a &lt;code&gt;WorkspaceTopic&lt;/code&gt; is
  * loading the webpage in the clients browser once the user triggers the default action.
  * &lt;p&gt;
  * The active &lt;i&gt;downloading&lt;/i&gt; behavoir of a &lt;code&gt;WorkspaceTopic&lt;/code&gt; is
@@ -36,18 +38,18 @@
  * &lt;p&gt;
  * The active &lt;i&gt;notification disabling&lt;/i&gt; behavoir of a &lt;code&gt;WorkspaceTopic&lt;/code&gt; is
  * deleting association of type &lt;code&gt;notification&lt;/code&gt; between &lt;code&gt;WorkspaceTopic&lt;/code&gt;
- * and &lt;code&gt;UserTopic&lt;/code&gt; that means that user does not want to be notified about 
+ * and &lt;code&gt;UserTopic&lt;/code&gt; that means that user does not want to be notified about
  * existence and last changes of this webpage.
  * &lt;p&gt;
  * The active &lt;i&gt;properties change allowed&lt;/i&gt; behavoir of a &lt;code&gt;WorkspaceTopic&lt;/code&gt; is
- * checking of &lt;code&gt;URL&lt;/code&gt; and &lt;code&gt;Checking Interval&lt;/code&gt; properties. If the 
+ * checking of &lt;code&gt;URL&lt;/code&gt; and &lt;code&gt;Checking Interval&lt;/code&gt; properties. If the
  * &lt;code&gt;URL&lt;/code&gt; property is entered without prefix &lt;code&gt;<A HREF="http://&lt;/code">http://&lt;/code</A>&gt;, this prefix is
  * automaticaly added. If some error is found in propeties, &lt;code&gt;DeepaMehtaException&lt;/code&gt;
  * with description of error is thrown and changes are rejected.
  * &lt;p&gt;
  * The active &lt;i&gt;properties changed&lt;/i&gt; behavoir of a &lt;code&gt;WorkspaceTopic&lt;/code&gt; is
- * reacting on changes in &lt;code&gt;URL&lt;/code&gt; and &lt;code&gt;Checking Interval&lt;/code&gt; properties. 
- * If the notification thread is already running for this topic, &lt;code&gt;URL&lt;/code&gt; 
+ * reacting on changes in &lt;code&gt;URL&lt;/code&gt; and &lt;code&gt;Checking Interval&lt;/code&gt; properties.
+ * If the notification thread is already running for this topic, &lt;code&gt;URL&lt;/code&gt;
  * and &lt;code&gt;Checking Interval&lt;/code&gt; properties are updated in this thread.
  * &lt;p&gt;
  * The active &lt;i&gt;property disabling&lt;/i&gt; behavoir of a &lt;code&gt;WorkspaceTopic&lt;/code&gt; is
@@ -55,27 +57,28 @@
  * &lt;p&gt;
  * The active &lt;i&gt;retrieve domain information&lt;/i&gt; behavoir gets the domain information from
  *  the appropriate whois server.
- * &lt;p&gt; 
- * The class contains two internal classes: {@link WebpageTopic.WebpageParserCallback 
- * WebpageParserCallback} (parsing of HTML text) 
- * and {@link WebpageTopic.WebpageChecker WebpageChecker} (thread used to check 
+ * &lt;p&gt;
+ * The class contains two internal classes: {@link WebpageTopic.WebpageParserCallback
+ * WebpageParserCallback} (parsing of HTML text)
+ * and {@link WebpageTopic.WebpageChecker WebpageChecker} (thread used to check
  * changes on webpages).
  * &lt;p&gt;
  * &lt;hr&gt;
- * Last change: 30.6.2008 (2.0b8)&lt;br&gt;
- * J&ouml;rg Richter&lt;br&gt;
- * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at deepamehta.de</A>
+ * Last change: 21.04.2009 (2.0b8)&lt;br&gt;
+ * J&ouml;rg Richter&lt;br&gt; / Malte Rei&szlig;ig
+ * <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">jri at deepamehta.de</A> / <A HREF="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">mre at deepamehta.de</A>
  */
 public class WebpageTopic extends LiveTopic {
 
 
 
-	private static final String ITEM_DOWNLOAD_WEBPAGE = &quot;Reload&quot;;
+	private static final String ITEM_DOWNLOAD_WEBPAGE = &quot;Download&quot;;
 	private static final String  CMD_DOWNLOAD_WEBPAGE = &quot;updateWebpage&quot;;
-	private static final String ICON_DOWNLOAD_WEBPAGE = &quot;webpage.gif&quot;;
+	private static final String ICON_DOWNLOAD_WEBPAGE = &quot;webpage.gif&quot;; // applications-internet.gif
 
 
 
+
 	// *******************
 	// *** Constructor ***
 	// *******************
@@ -96,7 +99,7 @@
 
 	/**
 	 * @see		de.deepamehta.service.ApplicationService#getTopicCommands
-	 */	
+	 */
 	public CorporateCommands contextCommands(String topicmapID, String viewmode,
 								Session session, CorporateDirectives directives) {
 		CorporateCommands commands = new CorporateCommands(as);
@@ -104,7 +107,7 @@
 		//
 		commands.addNavigationCommands(this, editorContext, session);
 		//
-		// --- &quot;Reload&quot; ---
+		// --- &quot;Download&quot; ---
 		commands.addSeparator();
 		commands.addCommand(ITEM_DOWNLOAD_WEBPAGE, CMD_DOWNLOAD_WEBPAGE, FILESERVER_ICONS_PATH, ICON_DOWNLOAD_WEBPAGE);
 		//
@@ -133,22 +136,35 @@
 				// ###	System.out.println(&quot;&gt;&gt;&gt; Webpage \&quot;&quot; + urlProperty + &quot;\&quot; exists &quot; +
 				// ###		&quot;locally -- URL transformed to \&quot;&quot; + urlString + &quot;\&quot;&quot;);
 				// ### } else {
-					urlString = urlProperty;
+				urlString = urlProperty;
 					//
 				// ###	System.out.println(&quot;&gt;&gt;&gt; Webpage \&quot;&quot; + urlProperty + &quot;\&quot; does NOT &quot; +
 				// ###		&quot;exists locally -- online connection required&quot;);
 				// ### }
 				directives.add(DIRECTIVE_OPEN_URL, urlString);
+                // as.setTopicProperty(this, PROPERTY_BROWSER, urlString);
 			// ### } catch (MalformedURLException e) {
 			// ###	throw new DeepaMehtaException(&quot;URL is invalid: \&quot;&quot; + urlProperty + &quot;\&quot;&quot;);
 			// ### }
 		} else if (command.equals(CMD_DOWNLOAD_WEBPAGE)) {
 			// download(topicmapID, viewmode, session, directives);
+		} else if (command.startsWith(CMD_FOLLOW_HYPERLINK)) {
+			String url = command.substring(CMD_FOLLOW_HYPERLINK.length()+COMMAND_SEPARATOR.length());
+            System.out.println(&quot;    linkClicked let's browse to: &quot; + url);
+            BaseTopic webpage = getWebpageTopic(url, session);
+            PresentableTopic pt = as.createPresentableTopic(webpage, this.getID(), topicmapID);
+            // is this the way to create an association in CM?
+            BaseAssociation link = as.createLiveAssociation(cm.getNewAssociationID() ,ASSOCTYPE_GENERIC, this.getID(), webpage.getID(), session, directives);
+            PresentableAssociation pa = as.createPresentableAssociation(ASSOCTYPE_GENERIC, this.getID(), 1, webpage.getID(), 1, true);
+            System.out.println(&quot;    created a link/assoc (&quot;+link.getID() +&quot;) and a new webpage topic(&quot;+webpage.getID()+&quot;) nearby &quot; +this.getID() + &quot; in map: &quot; + topicmapID);
+            directives.add(DIRECTIVE_SHOW_TOPIC, pt);
+            directives.add(DIRECTIVE_SHOW_ASSOCIATION, pa);
+            directives.add(DIRECTIVE_SELECT_TOPIC, pt.getID());
 		} else {
 			return super.executeCommand(command, session, topicmapID, viewmode);
 		}
 		return directives;
-	}
+    }
 
 
 
@@ -157,11 +173,41 @@
 	// ---------------------------
 
 
-
+    /**
+     * If the URL is already stored in the Corporate Memory, reject the propertyChanged
+     *
+     * ### To extend the propertyCangedAllowed Hook for the topicMapId for revealing
+     * the one webpage topic immediately, instead of just rejecting the user's input
+     *
+     * @param propName
+     * @param propValue
+     * @param session
+     * @param directives
+     * @return
+     */
 	public boolean propertyChangeAllowed(String propName, String propValue, Session session, CorporateDirectives directives) {
-		if (propName.equals(PROPERTY_URL)) {
+        if (propName.equals(PROPERTY_URL)) {
 			try {
-				new URL(propValue);
+                Hashtable props = new Hashtable();
+                props.put(PROPERTY_URL, propValue);	// ### ignore ref -- still an issue?
+                URL url = new URL(propValue);
+                Vector webpages = cm.getTopics(TOPICTYPE_WEBPAGE, props);
+                String title = propValue.substring(7);
+                int count = webpages.size();
+                if (count &gt; 0) {
+                    // System.out.println(&quot;    URL Cannot be changed, already known topic shares the URL&quot;);
+                    directives.add(DIRECTIVE_SHOW_MESSAGE, &quot;This URL is already known to DeepaMehta, let's see if it is this ...&quot;, new Integer(NOTIFICATION_WARNING));
+                    directives.add(DIRECTIVE_SHOW_TOPIC, new PresentableTopic((BaseTopic)webpages.get(0)));
+                    directives.add(DIRECTIVE_SELECT_TOPIC, ((BaseTopic)webpages.get(0)).getID());
+                    // workaround to allow retrigger URL by hitting Enter
+                    as.setTopicProperty(this, PROPERTY_BROWSER, url.toString()); // reset anyway, to be removed when getText Problem is solved
+                    directives.add(DIRECTIVE_FOCUS_PROPERTY);
+                    // return false;
+                } else {
+                    as.setTopicProperty(this, PROPERTY_BROWSER, url.toString());
+                    // props.put(PROPERTY_BROWSER, url.toString());
+                    directives.add(DIRECTIVE_FOCUS_PROPERTY);
+                }
 			} catch (MalformedURLException e) {
 				String errText = &quot;\&quot;&quot; + propValue + &quot;\&quot; is not a valid URL&quot;;
 				directives.add(DIRECTIVE_SHOW_MESSAGE, errText, new Integer(NOTIFICATION_WARNING));
@@ -179,10 +225,10 @@
 																					String viewmode, Session session) {
 		CorporateDirectives directives = super.propertiesChanged(newProps, oldProps, topicmapID, viewmode, session);
 		// --- &quot;URL&quot; ---
-		String prop = (String) newProps.get(PROPERTY_URL);
-		if (prop != null) {
-			try {
-				URL url = new URL(prop);
+		String newUrl = (String) newProps.get(PROPERTY_URL);
+		if (newUrl != null) {
+            try {
+				URL url = new URL(newUrl);
 				String host = url.getHost();
 				// remove old website assignment
 				BaseTopic website = getWebsite();
@@ -205,14 +251,15 @@
 				System.out.println(&quot;*** WebpageTopic.propertiesChanged(): &quot; + e);
 			}
 		}
-		//
-		return directives;
+        return directives;
 	}
 
 	public String getNameProperty() {
-		return PROPERTY_URL;
+		return PROPERTY_NAME;
 	}
 
+    // What is this used for ? Link in PropertyPanel ?
+    // Associate Webpage to Website via &quot;BaseUrl&quot; ?
 	public Hashtable getPropertyBaseURLs() {
 		Hashtable baseURLs = new Hashtable();
 		String url = null;
@@ -228,7 +275,7 @@
 	public static Vector hiddenProperties(TypeTopic type) {
 		Vector props = new Vector();
 		props.addElement(PROPERTY_ICON);
-        // props.addElement(PROPERTY_DESCRIPTION);
+        props.addElement(PROPERTY_DESCRIPTION);
         // props.addElement(PROPERTY_URL);
 		return props;
 	}
@@ -269,8 +316,47 @@
 		return (BaseTopic) websites.firstElement();
 	}
 
+    private BaseTopic getWebpageTopic(String prop, Session session) {
+        System.out.println(&quot;    getWebpageTopic for:&quot; + prop);
+        BaseTopic webpage;
+        Hashtable props = new Hashtable();
+        props.put(PROPERTY_URL, prop);	// ### ignore ref -- still an issue?
+        Vector webpages = cm.getTopics(TOPICTYPE_WEBPAGE, props);
+        String title = prop.substring(11); // strips <A HREF="http://www.">http://www.</A> in the normal case
+        int count = webpages.size();
+        if (count == 0) {
+            // System.out.println(&quot;Properties Changed Hook performs existing check&quot;);
+            String[] elements = prop.split(&quot;.&quot;);
+            if (elements.length &gt; 2) {
+                title = elements[1] + elements[2];
+            }
+            System.out.println(&quot;    it's a new webpage, let's make it a topic, title: &quot; + title);
+            webpage = as.createLiveTopic(cm.getNewTopicID(), TOPICTYPE_WEBPAGE,
+                    title, session);
+            if (prop != null) {
+                as.setTopicProperty(webpage.getID(), 1, PROPERTY_BROWSER, prop.toString());
+                as.setTopicProperty(webpage.getID(), 1, PROPERTY_URL, prop.toString());
+                as.setTopicProperty(webpage.getID(), 1, PROPERTY_NAME, title);
+                System.out.println(&quot;    webpage topic knows where to go next: &quot; + prop);
+            }
+            //webpage.setProperties(props);
+            //webpage.setEvoke(true);
+        } else {
+            System.out.println(&quot;    it's known webpage, let's go with the topic to: &quot; + prop);
+            webpage = (BaseTopic) webpages.firstElement();
+            // set Browser Window too
+            as.setTopicProperty(webpage.getID(), 1, PROPERTY_BROWSER, prop.toString());
+            if (count &gt; 1) {
+                System.out.println(&quot;*** WebpageTopic.getWebpageTopic(): there're &quot; + count +
+                    &quot; Webpage topics for \&quot;&quot; + prop + &quot;\&quot;&quot;);
+            }
+            // webpage = new PresentableTopic(webpageTopic, this.getID());
+        }
+        return webpage;
+    }
 
 
+
 	// ***********************
 	// *** Private Methods ***
 	// ***********************
@@ -282,8 +368,8 @@
 	 *
 	 * @param	directives	directives which should be later executed
 	 *
-	 * @see		#executeCommand	 	 
-	 * @see		#propertiesChanged 
+	 * @see		#executeCommand
+	 * @see		#propertiesChanged
 	 */
 	private void download(String topicmapID, String viewmode, Session session, CorporateDirectives directives) {
 		// error check 1

Added: branches/apps/install/client/icons/applications-internet.png
===================================================================
(Binary files differ)


Property changes on: branches/apps/install/client/icons/applications-internet.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: branches/apps/install/client/icons/getuptodate.gif
===================================================================
(Binary files differ)


Property changes on: branches/apps/install/client/icons/getuptodate.gif
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: branches/apps/install/client/icons/latex-klein.png
===================================================================
(Binary files differ)


Property changes on: branches/apps/install/client/icons/latex-klein.png
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: branches/apps/install/client/icons/twitter_bird.gif
===================================================================
(Binary files differ)


Property changes on: branches/apps/install/client/icons/twitter_bird.gif
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Modified: branches/apps/install/db/cm.sql
===================================================================
--- branches/apps/install/db/cm.sql	2009-08-07 10:51:17 UTC (rev 370)
+++ branches/apps/install/db/cm.sql	2009-09-12 08:41:53 UTC (rev 371)
@@ -194,12 +194,13 @@
 INSERT INTO TopicProp VALUES ('tt-webpage', 1, 'Name', 'Webpage');
 INSERT INTO TopicProp VALUES ('tt-webpage', 1, 'Plural Name', 'Webpages');
 INSERT INTO TopicProp VALUES ('tt-webpage', 1, 'Description', '&lt;HTML&gt;&lt;BODY&gt;A &lt;I&gt;Webpage&lt;/I&gt; is a ...&lt;/BODY&gt;&lt;/HTML&gt;');
-INSERT INTO TopicProp VALUES ('tt-webpage', 1, 'Icon', 'webpage.gif');
+INSERT INTO TopicProp VALUES ('tt-webpage', 1, 'Icon', 'applications-internet.png');
 INSERT INTO TopicProp VALUES ('tt-webpage', 1, 'Unique Topic Names', 'on');
 INSERT INTO TopicProp VALUES ('tt-webpage', 1, 'Custom Implementation', 'de.deepamehta.topics.WebpageTopic');
 -- assign properties
 INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-23', '', 'tt-webpage', 1, 'pp-url', 1);
--- INSERT INTO AssociationProp VALUES ('a-23', 1, 'Ordinal Number', '1');
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-511', '', 'tt-webpage', 1, 'pp-browser', 1);
+INSERT INTO AssociationProp VALUES ('a-511', 1, 'Ordinal Number', '200');
 -- super type
 INSERT INTO Association VALUES ('at-derivation', 1, 1, 'a-46', '', 'tt-generic', 1, 'tt-webpage', 1);
 -- container type
@@ -1154,10 +1155,10 @@
 INSERT INTO TopicProp VALUES ('at-preference', 1, 'Plural Name', 'Preferences');
 INSERT INTO TopicProp VALUES ('at-preference', 1, 'Color', '#A00000');
 
---- &quot;Google Result&quot; ---
-INSERT INTO Topic VALUES ('tt-assoctype', 1, 1, 'at-googleresult', 'Google Result');
-INSERT INTO TopicProp VALUES ('at-googleresult', 1, 'Name', 'Google Result');
-INSERT INTO TopicProp VALUES ('at-googleresult', 1, 'Plural Name', 'Google Results');
+--- &quot;Yahoo Result&quot; ---
+INSERT INTO Topic VALUES ('tt-assoctype', 1, 1, 'at-googleresult', 'Yahoo Result');
+INSERT INTO TopicProp VALUES ('at-googleresult', 1, 'Name', 'Yahoo Result');
+INSERT INTO TopicProp VALUES ('at-googleresult', 1, 'Plural Name', 'Yahoo Results');
 INSERT INTO TopicProp VALUES ('at-googleresult', 1, 'Color', '#A000A0');
 -- super type
 INSERT INTO Association VALUES ('at-derivation', 1, 1, 'a-174', '', 'at-association', 1, 'at-googleresult', 1);
@@ -1187,7 +1188,6 @@
 ------------------
 
 
-
 --- &quot;Name&quot; ---
 INSERT INTO Topic VALUES ('tt-property', 1, 1, 'pp-name', 'Name');
 INSERT INTO TopicProp VALUES ('pp-name', 1, 'Visualization', 'Input Field');
@@ -1332,6 +1332,10 @@
 INSERT INTO Topic VALUES ('tt-property', 1, 1, 'pp-url', 'URL');
 INSERT INTO TopicProp VALUES ('pp-url', 1, 'Visualization', 'Input Field');
 
+--- &quot;Browser Window&quot; ---
+INSERT INTO Topic VALUES ('tt-property', 1, 1, 'pp-browser', 'Lobo Browser');
+INSERT INTO TopicProp VALUES ('pp-browser', 1, 'Visualization', 'Lobo Browser');
+
 --- &quot;Domain Information&quot; ---
 INSERT INTO Topic VALUES ('tt-property', 1, 1, 'pp-domaininfo', 'Domain Information');
 INSERT INTO TopicProp VALUES ('pp-domaininfo', 1, 'Visualization', 'Multiline Input Field');
@@ -1763,8 +1767,11 @@
 INSERT INTO TopicProp VALUES ('pp-height', 1, 'Name', 'Height');
 INSERT INTO TopicProp VALUES ('pp-height', 1, 'Visualization', 'Input Field');
 
+--- &quot;Lobo Browser&quot; ---
+INSERT INTO Topic VALUES ('tt-constant', 1, 1, 't-lobobrowser', 'Lobo Browser');
+INSERT INTO TopicProp VALUES ('t-lobobrowser', 1, 'Name', 'Lobo Browser');
+INSERT INTO TopicProp VALUES ('t-lobobrowser', 1, 'Icon', 'applications-internet.png');
 
-
 --------------------
 --- Associations ---
 --------------------
@@ -1773,6 +1780,7 @@
 
 -- assign property values to &quot;Visualization&quot;
 INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-51', '', 'pp-visualization', 1, 't-inputfield', 1);
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-2301', '', 'pp-visualization', 1, 't-lobobrowser', 1);
 INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-52', '', 'pp-visualization', 1, 't-multilineinputfield', 1);
 INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-259', '', 'pp-visualization', 1, 't-texteditor', 1);
 INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-53', '', 'pp-visualization', 1, 't-optionsmenu', 1);

Added: branches/apps/install/db/patches/cm-2.20.sql
===================================================================
--- branches/apps/install/db/patches/cm-2.20.sql	2009-08-07 10:51:17 UTC (rev 370)
+++ branches/apps/install/db/patches/cm-2.20.sql	2009-09-12 08:41:53 UTC (rev 371)
@@ -0,0 +1,36 @@
+---
+--- This patch updates CM 2.19 to 2.20
+--- Apply this patch if you want to update DeepaMehta rev346-20080910 to DeepaMehta 2.0b8 while keeping your content
+---
+
+
+
+----------------------------
+--- Lobo Browser Feature ---
+----------------------------
+
+--- &quot;Lobo Browser&quot; ---
+INSERT INTO Topic VALUES ('tt-property', 1, 1, 'pp-browser', 'Lobo Browser');
+INSERT INTO TopicProp VALUES ('pp-browser', 1, 'Visualization', 'Lobo Browser');
+
+INSERT INTO Association VALUES ('at-composition', 1, 1, 'a-511', '', 'tt-webpage', 1, 'pp-browser', 1);
+INSERT INTO AssociationProp VALUES ('a-511', 1, 'Ordinal Number', '200');
+
+UPDATE TopicProp SET PropValue='applications-internet.png' WHERE TopicID='tt-webpage' AND PropName='Icon';
+
+-- change googley key name needs to adapt as.getGoogleKey then.. 
+-- UPDATE TopicProp SET PropValue='Yahoo Search API Key' WHERE TopicID='pp-googlekey' AND PropName='Name';
+-- UPDATE Topic SET Name='Yahoo Search API UpdateKey' WHERE ID='pp-googlekey';
+
+
+
+-----------------------
+--- Version Control ---
+-----------------------
+
+-- change version labels
+UPDATE TopicProp SET PropValue='DeepaMehta 2.0b8e'         WHERE TopicID='t-deepamehtainstallation' AND PropName='Client Name';
+UPDATE TopicProp SET PropValue='DeepaMehtaServer 2.0b8e'   WHERE TopicID='t-deepamehtainstallation' AND PropName='Server Name';
+
+-- update DB content version
+UPDATE KeyGenerator SET NextKey=19 WHERE Relation='DB-Content Version';

Added: branches/apps/libs/ext/Scenario.jar
===================================================================
(Binary files differ)


Property changes on: branches/apps/libs/ext/Scenario.jar
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: branches/apps/libs/ext/cobra-no-commons.jar
===================================================================
(Binary files differ)


Property changes on: branches/apps/libs/ext/cobra-no-commons.jar
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: branches/apps/libs/ext/javafx-swing.jar
===================================================================
(Binary files differ)


Property changes on: branches/apps/libs/ext/javafx-swing.jar
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: branches/apps/libs/ext/javafxc.jar
===================================================================
(Binary files differ)


Property changes on: branches/apps/libs/ext/javafxc.jar
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: branches/apps/libs/ext/javafxgui.jar
===================================================================
(Binary files differ)


Property changes on: branches/apps/libs/ext/javafxgui.jar
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: branches/apps/libs/ext/javafxrt.jar
===================================================================
(Binary files differ)


Property changes on: branches/apps/libs/ext/javafxrt.jar
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: branches/apps/libs/ext/jlfgr-1_0.jar
===================================================================
(Binary files differ)


Property changes on: branches/apps/libs/ext/jlfgr-1_0.jar
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: branches/apps/libs/ext/jmc.jar
===================================================================
(Binary files differ)


Property changes on: branches/apps/libs/ext/jmc.jar
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: branches/apps/libs/ext/js.jar
===================================================================
(Binary files differ)


Property changes on: branches/apps/libs/ext/js.jar
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: branches/apps/libs/ext/jweb-ext.jar
===================================================================
(Binary files differ)


Property changes on: branches/apps/libs/ext/jweb-ext.jar
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: branches/apps/libs/ext/primary.jar
===================================================================
(Binary files differ)


Property changes on: branches/apps/libs/ext/primary.jar
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: branches/apps/libs/ext/websvc.jar
===================================================================
(Binary files differ)


Property changes on: branches/apps/libs/ext/websvc.jar
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: branches/apps/libs/lobo-pub.jar
===================================================================
(Binary files differ)


Property changes on: branches/apps/libs/lobo-pub.jar
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: branches/apps/libs/lobo.jar
===================================================================
(Binary files differ)


Property changes on: branches/apps/libs/lobo.jar
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: branches/apps/libs/mysql-connector-java-5.0.8-bin.jar
===================================================================
(Binary files differ)


Property changes on: branches/apps/libs/mysql-connector-java-5.0.8-bin.jar
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream

Added: branches/apps/libs/yahooSearch2-01.jar
===================================================================
(Binary files differ)


Property changes on: branches/apps/libs/yahooSearch2-01.jar
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:mime-type
   + application/octet-stream


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="000216.html">[deepamehta-svn] r372 - in branches/apps/develop/src/de/deepamehta:	client topics
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#215">[ date ]</a>
              <a href="thread.html#215">[ thread ]</a>
              <a href="subject.html#215">[ subject ]</a>
              <a href="author.html#215">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/deepamehta-svn">More information about the deepamehta-svn
mailing list</a><br>
</body></html>
